# This is an automated backup - check out https://outlands.uorazorscripts.com/script/4c677d36-c276-403c-833c-65f893ae76f7 for latest
# Automation by Jaseowns
## Script: Mining
## Created by: mushnar#0
#############################################

@clearignore

@setvar! automatically_gate_when_detecting_hostile 1
@setvar! automatically_gate_when_pouch_popped 1
@setvar! automatically_gate_when_overweight 1


@setvar! automatically_gate_when_large_value_of_ingots 0
@setvar! automatically_gate_when_large_value_of_ore 0
@setvar! ingots_gate_amount 500
@setvar! ore_gate_amount 500


@setvar! automatically_smelt_ore 1
@setvar! always_display_tracking_window 1
@setvar! use_peacemaking 1


@setvar! house_door 0x4A6A2E7F
@setvar! resource_stockpile 0x420A5B19


@setvar! automatically_drink_potions 1
@setvar! automatically_open_potion_satchel 1
@setvar! automatically_drink_healing_potion 1
@setvar! automatically_drink_cure_potion 1

@setvar! health_value_to_drink_healing_potion 75
@setvar! health_value_to_drink_cure_potion 75

@setvar! potion_error_message_frequency 2000


if not timerexists "skill_cooldown_timer"
    createtimer "skill_cooldown_timer"
    settimer "skill_cooldown_timer" 10000
endif


if not timerexists "forge_ping"
    createtimer "forge_ping"
    settimer "forge_ping" 4000
endif

if not timerexists "overhead_cooldown"
    createtimer "overhead_cooldown"
    settimer "overhead_cooldown" 0
endif

removetimer "potion_error_message_cooldown"
if not timerexists "potion_error_message_cooldown"
    createtimer "potion_error_message_cooldown"
    settimer "potion_error_message_cooldown" potion_error_message_frequency
endif


removelist animalsIgnoreList
createlist animalsIgnoreList
pushlist animalsIgnoreList "a plover"
pushlist animalsIgnoreList "a sheep"
pushlist animalsIgnoreList "a frenzied ostard"
pushlist animalsIgnoreList "a tundra ostard"
pushlist animalsIgnoreList "a desert ostard"
pushlist animalsIgnoreList "a forest ostard"
pushlist animalsIgnoreList "a finch"
pushlist animalsIgnoreList "a sparrow"
pushlist animalsIgnoreList "a towhee"
pushlist animalsIgnoreList "a lapwing"
pushlist animalsIgnoreList "a silverback"
pushlist animalsIgnoreList "a crow"
pushlist animalsIgnoreList "a woodpecker"
pushlist animalsIgnoreList "a horse"
pushlist animalsIgnoreList "a swift"
pushlist animalsIgnoreList "a skylark"
pushlist animalsIgnoreList "a hawk"
pushlist animalsIgnoreList "a chickadee"
pushlist animalsIgnoreList "a cat"
pushlist animalsIgnoreList "a dog"
pushlist animalsIgnoreList "a black bear"
pushlist animalsIgnoreList "a brown bear"
pushlist animalsIgnoreList "a bull"
pushlist animalsIgnoreList "a cow"
pushlist animalsIgnoreList "a chicken"
pushlist animalsIgnoreList "a bird"
pushlist animalsIgnoreList "an eagle"
pushlist animalsIgnoreList "a nuthatch"
pushlist animalsIgnoreList "an elk"
pushlist animalsIgnoreList "a great hart"
pushlist animalsIgnoreList "a kingfisher"
pushlist animalsIgnoreList "a hind"
pushlist animalsIgnoreList "a llama"
pushlist animalsIgnoreList "a sand crab"
pushlist animalsIgnoreList "a pig"
pushlist animalsIgnoreList "a polar bear"
pushlist animalsIgnoreList "a walrus"
pushlist animalsIgnoreList "a cougar"
pushlist animalsIgnoreList "a goat"
pushlist animalsIgnoreList "a raven"
pushlist animalsIgnoreList "a magpie"
pushlist animalsIgnoreList "a warbler"
pushlist animalsIgnoreList "a tern"
pushlist animalsIgnoreList "a nightingale"
pushlist animalsIgnoreList "a wren"
pushlist animalsIgnoreList "red rubble"
pushlist animalsIgnoreList "a spirit wolf"
pushlist animalsIgnoreList "a spirit sabertus"
pushlist animalsIgnoreList "a death asp"
pushlist animalsIgnoreList "a death adder"

if use_peacemaking = 1
	if timer "skill_cooldown_timer" >= 10000
	    skill "Peacemaking"
	    waitfortarget 1000
	endif

	if insysmsg "What instrument shall you play"
	    if findtype "standing harp|sackbut|bamboo flute|tambourine|drum|lute|lap harp|gemshorn|hurdy gurdy|psaltery|shawm|vielle" as instrument
	        target instrument
	    else
	        overhead "NO INSTRUMENT" 33
	        overhead "NO INSTRUMENT" 33
	        overhead "NO INSTRUMENT" 33
	        overhead "NO INSTRUMENT" 33
	        overhead "NO INSTRUMENT" 33
	    endif
	endif
endif



while not dead
    if skill "Tracking" > 0
        if not findbuff "tracking"
            clearsysmsg
            while not gumpexists 4267467659
                useskill 'tracking'
                getlabel backpack ping
            endwhile
            if gumpexists 4267467659
                while not insysmsg "You will now hunt all hostile players."
                    gumpresponse 8 4267467659
                    waitforgump 4267467659 5000
                endwhile
                gumpresponse 6 4267467659
                getlabel backpack ping
            endif
            if always_display_tracking_window = 0
            	gumpclose 4267467659
           	endif
        endif
    endif


    if always_display_tracking_window = 1
    	if not gumpexists 4267467659
	        useskill 'tracking'
    	    getlabel backpack ping
    	endif
    endif


    if timer "skill_cooldown_timer" >= 10000
        skill "detectinghidden"
        waitfortarget 100
        target "self"
        settimer "skill_cooldown_timer" 0
    endif


    if insysmsg "You reveal what was hidden"
        overhead "HIDDEN REVEALED" 53
        overhead "HIDDEN REVEALED" 53
        overhead "HIDDEN REVEALED" 53
        overhead "HIDDEN REVEALED" 53
        overhead "HIDDEN REVEALED" 53
    endif


    if insysmsg "attempting to peak into"
        overhead "THIEF SNOOPING" 53
        overhead "THIEF SNOOPING" 53
        overhead "THIEF SNOOPING" 53
        overhead "THIEF SNOOPING" 53
        overhead "THIEF SNOOPING" 53
    endif


    if findtype 3705 backpack 0 as popped_pouch
        overhead "POUCH POPPED" 33
        overhead "POUCH POPPED" 33
        overhead "POUCH POPPED" 33
        overhead "POUCH POPPED" 33
        overhead "POUCH POPPED" 33
        @ignore popped_pouch

        if automatically_gate_when_pouch_popped = 1
        	overhead "Gating home!" 88
        	say "[RecallCharge The Drunken Dragon"
        endif
    endif


    if insysmsg "Now tracking:"
        overhead "HOSTILES DETECTED" 33
        overhead "HOSTILES DETECTED" 33
        overhead "HOSTILES DETECTED" 33
        overhead "HOSTILES DETECTED" 33
        overhead "HOSTILES DETECTED" 33

        if automatically_gate_when_detecting_hostile = 1
        	overhead "Gating home!" 88
        	say "[RecallCharge The Drunken Dragon"
        endif
    endif

    
	if rhandempty
		if casting
			wait 100
		elseif findtype "pickaxe" backpack as found_pickaxe
			dclick found_pickaxe
			wait 100
		endif

		if casting
			wait 100
		else
			dclick found_pickaxe
		endif
	else
		@getlabel righthand right_hand_description
		if "pickaxe" in right_hand_description
			if casting
				wait 100
			else
				dclick righthand
			endif
		endif
	endif


    if rhandempty
        if findtype "pickaxe" backpack as found_pickaxe
            overhead "Equipping Pickaxe!" 88
            if casting
				wait 100
			else
            	dclick found_pickaxe
            endif
            wait 1000
        else
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            stop
        endif
        
        if rhandempty
        	wait 100
        else
        	if casting
        		wait 100
        	else
        		dclick righthand
        	endif
        endif
    else
        @getlabel righthand right_hand_description
        if "pickaxe" in right_hand_description
            dclick righthand
        elseif findtype "pickaxe" backpack as found_pickaxe
            overhead "Equipping Pickaxe!" 88
            if casting
				wait 100
			else
            	dclick found_pickaxe
            endif
            wait 1000
        else
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            overhead "   No Pickaxes Found   " 53
            stop
        endif
        
        dclick righthand
        
        endif
    endif

    if insysmsg "Harvest double yield/loot triggered"
    	overhead "Æ HARVEST PROC Æ" 62
    endif

   
    if insysmsg "You loosen some rocks but fail to find any useable ore"
        overhead "¼ MINING ¼" 1366 
    endif    

    if insysmsg "You dig some"
        overhead "¼ MINING ¼" 1366 
    endif

    if insysmsg "You do not see any harvestable resources nearby"
        overhead "² NEXT SPOT ²" 53
    endif
    
 
    if insysmsg "harvesting is not allowed"
        overhead "LEAVE TOWN" 53
    	overhead "LEAVE TOWN" 53
    	overhead "LEAVE TOWN" 53
   	endif


    if findtype 2473 backpack as boom_box
        if findtype 6585 backpack as found_ore
            @getlabel found_ore ore_description

	        if "iron" in ore_description
	            if "shadow" in ore_description
	                overhead "SHADOW IRON" 2406
	            else
	                overhead "IRON" 0
	            endif
	        endif
	        
	        if "copper" in ore_description
	            if "dull copper" in ore_description
	                overhead "DULL COPPER" 2419
	            else
	                overhead "COPPER" 2413
	            endif
	        endif
	                        
	        if "bronze" in ore_description
	            overhead "BRONZE" 2418
	        endif
	        
	        if "gold" in ore_description
	            overhead "GOLD" 2213
	        endif
	        
	        if "agapite" in ore_description
	            overhead "AGAPITE" 2425
	        endif
	        
	        if "verite" in ore_description
	            overhead "VERITE" 2207
	        endif
	        
	        if "valorite" in ore_description
	            overhead "VALORITE" 2219
	        endif
	        
	        if "avarite" in ore_description
	            overhead "AVARITE" 1763
	        endif

            @drop backpack -1 -1 -1
            getlabel backpack ping
            wait 500
            lift found_ore 9999
            getlabel backpack ping
            drop boom_box -1 -1 -1           
            wait 500
            @ignore found_ore
        endif
    endif

    if findtype 4017 ground any any 2 as found_forge
        if timer "forge_ping" >= 4000
            overhead "¼¼ FORGE ¼¼" 88 found_forge
            settimer "forge_ping" 0
        endif
        
        @clearignore
        if findtype 2473 backpack as boom_box
            if findtype 7154 boom_box as found_ingots
                @ignore found_ingots
            endif
        endif
        
        while findtype 6585 backpack as found_ore
            overhead "Æ SMELTING ORE Æ"
            dclick found_ore
            @ignore found_ore
            wait 500
        endwhile
    endif

    if findtype 2473 backpack as boom_box
        if findtype 7154 backpack as found_ingots
            @getlabel found_ingots ingot_description
	        if "iron" in ingot_description
	            if "shadow" in ingot_description
	                overhead "SHADOW IRON" 2406
	            else
	                overhead "IRON" 0
	            endif
	        endif
	        
	        if "copper" in ingot_description
	            if "dull copper" in ingot_description
	                overhead "DULL COPPER" 2419
	            else
	                overhead "COPPER" 2413
	            endif
	        endif
	                        
	        if "bronze" in ingot_description
	            overhead "BRONZE" 2418
	        endif
	        
	        if "gold" in ingot_description
	            overhead "GOLD" 2213
	        endif
	        
	        if "agapite" in ingot_description
	            overhead "AGAPITE" 2425
	        endif
	        
	        if "verite" in ingot_description
	            overhead "VERITE" 2207
	        endif
	        
	        if "valorite" in ingot_description
	            overhead "VALORITE" 2219
	        endif
	        
	        if "avarite" in ingot_description
	            overhead "AVARITE" 1763
	        endif

            @drop backpack -1 -1 -1
            getlabel backpack ping
            lift found_ingots 9999
            getlabel backpack ping
            drop boom_box -1 -1 -1
            wait 600
            @ignore found_ingots
        endif
    endif
        
    
    if findtype 4017 ground any any 6 as found_forge
        if timer "forge_ping" >= 4000
            overhead "¼¼ FORGE ¼¼" 88 found_forge
            settimer "forge_ping" 0
        endif
    elseif findtype 4017 ground any any 18 as found_forge
        if timer "forge_ping" >= 4000
            overhead "¼¼ FORGE ¼¼" 88 found_forge
            settimer "forge_ping" 0
        endif
    endif


    if diffweight <= 30
        overhead "OVERWEIGHT" 53

   	    if automatically_gate_when_overweight = 1
        	overhead "Gating home!" 88
        	say "[RecallCharge RUNE NAME HERE"
        endif
    endif


    if counttype 7154 backpack >= ingots_gate_amount
    	overhead "Too many ingots!"

   	    if automatically_gate_when_large_value_of_ingots = 1
        	overhead "Gating home!" 88
        	say "[RecallCharge RUNE NAME HERE"
        endif
    endif


    if counttype 6585 backpack >= ore_gate_amount
    	overhead "Too much ore!"
    	
   	    if automatically_gate_when_large_value_of_ore = 1
        	overhead "Gating home!" 88
        	say "[RecallCharge RUNE NAME HERE"
        endif
    endif


    if find resource_stockpile ground any any 2 as my_resource_stockpile
	    @clearignore
	    if findtype 7154 backpack as found_ingots
		    overhead "RESTOCKING INGOTS" 88
		    menu resource_stockpile 0
		    waitfortarget 1000
		    target self
		    wait 1000
		endif
    endif

    if automatically_drink_potions = 1
        ########## OPEN POTION SATCHEL ##########
            if automatically_open_potion_satchel = 1
			    #Opens potion satchel to display potions on hotbar
			    if findtype 31262 backpack as stored_alchemist_satchel
			        dclick stored_alchemist_satchel
			    endif
			    
			    if findtype 2473 backpack as boom_box
			        if findtype 31262 boom_box as hidden_potion_satchel
			            dclick hidden_potion_satchel
			        endif
			    endif
            endif
        ####################################


        ########## HEALING POTION ##########
            if automatically_drink_healing_potion = 1 and hp <= health_value_to_drink_healing_potion
                if findtype "Yellow Potion" self as healing_potion
                    getlabel healing_potion healing_potion_description

                    if "next usabel" in healing_potion_description
                        if timer "potion_error_message_cooldown" >= potion_error_message_frequency
                            overhead "Healing Potion On Cooldown!" 34
                        endif
                    else
                        overhead "Drinking Healing Potion" 53
                        dclick healing_potion
                        getlabel backpack ping
                        cooldown "Yellow Potion" 10000
                    endif
                else
                    overhead "Out of Healing Potions!" 34
                endif
            endif
        ####################################


        ########## CURE POTION ##########
            if automatically_drink_cure_potion = 1 and poisoned and hp <= health_value_to_drink_cure_potion
                if findtype "Orange Potion" self as cure_potion
                    overhead "Drinking Cure Potion" 44
                    dclick cure_potion
                    getlabel backpack ping
                endif
            endif
        #################################
    endif

    if use_peacemaking = 1
	    if warmode on
		    target closest grey monster
		    @setvar! target_to_analyze lasttarget
		    getlabel target_to_analyze target_description
		    wait 1000
		    
		    if inlist animalsIgnoreList target_description
		        @ignore target_to_analyze
		    else
		        if find target_to_analyze ground -1 -1 12
		            overhead target_description 53
		            if timer "skill_cooldown_timer" >= 10000
		                skill "Peacemaking"
		                waitfortarget 1000
		            endif
		            
		            if insysmsg "What instrument shall you play"
		                if findtype "standing harp|sackbut|bamboo flute|tambourine|drum|lute|lap harp|gemshorn|hurdy gurdy|psaltery|shawm|vielle" as instrument
		                    target instrument
		                else
		                    overhead "NO INSTRUMENT" 33
		                    overhead "NO INSTRUMENT" 33
		                    overhead "NO INSTRUMENT" 33
		                    overhead "NO INSTRUMENT" 33
		                    overhead "NO INSTRUMENT" 33
		                    wait 100
		                    target self
		                endif
		            else
		                if timer "skill_cooldown_timer" >= 10000
		                    overhead "¼ PEACING ¼" 1366 target_to_analyze
		                    skill "Peacemaking"
		                    waitfortarget 1000
		                    target target_to_analyze
		                    settimer "skill_cooldown_timer" 0
		                endif
		                
		                if insysmsg "You fail to pacify your opponent"
		                    settimer "skill_cooldown_timer" 5000
		                    overhead "PEACE FAILED" 53
		                    overhead "PEACE FAILED" 53
		                    overhead "PEACE FAILED" 53
		                endif
		                
		                if insysmsg "You play successfully, pacifying your target"
		                    overhead "¼ PEACED ¼" 1366 target_to_analyze
		                endif
		            endif
		        endif
		    endif
		endif
	endif


    #################### WORLD SAVE ######################    
    if insysmsg "world will save"
        overhead "World save coming soon" 53
        @setvar! world_save_cooldown 14000

        removetimer "world_save_timer"
        if not timerexists "world_save_timer"    
            createtimer "world_save_timer"
            settimer "world_save_timer" 0
        endif

        clearsysmsg
        getlabel backpack ping
    endif


    if timerexists "world_save_timer"
        if timer "world_save_timer" >= world_save_cooldown
            overhead "Waiting for world save..." 53
            removetimer "world_save_timer"
        endif
    endif


    if insysmsg "save complete"
        overhead "World save complete!" 63                
        clearsysmsg
        getlabel backpack ping
    endif
######################################################

	if findtype 1664 ground any any 2
	    dclick house_door
	    wait 500
	endif
endwhile