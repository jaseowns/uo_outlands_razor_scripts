# This is an automated backup - check out https://outlands.uorazorscripts.com/script/d6b286a7-bebf-470b-a1ba-7d3a80114a79 for latest
# Automation by Jaseowns
## Script: Bapeth's Modern Dungeon Picker
## Created by: barryroser#0
#############################################

# "***Bapeths Modern Dungeon Picker***"
# Updated Nov 13th 2024 (Logic fixes)
#
# "***READ THIS***READ THIS***READ THIS***READ THIS***"
#
# "***REQUIRED SETTINGS***"
#
# "In Game Dungeon Chest Menu"
# "Continuous Lockpicking" and "Continuous Remove Trap" must be checked in the lockpicking gump menu
# This gump menu appears when you attempt to open a chest
#
# "Auto Loot Control"
# This script uses razor "Auto-Queue Object Delay" setting
# Make sure this setting is turned ON in the razor Options tab > Targeting & Queues sub-tab
# And set "object delay to 503" AUTO LOOTING WILL BE SLOW IF YOU DONT DO THIS!
#
# "Cooldowns"
# This script uses four cooldowns called "Hiding" "Stealth" "Stealing" and "Move" (Stealing only for Pilfering)
# Create these in the in-game options menu under Cooldowns and they must be spelled correctly
# Sometimes a full game restart is needed if cooldowns are edited
# The "Move" Cooldown should be set to "0.3 seconds"
#
# "***OPTIONAL SETTINGS***"
#
# "Time Sense Container Search"
# Enable this option to display and loot containers in "Time Dungeon"
# The "Time Codex" acts like a switch to turn this setting on/off, open your codex while the script is playing to activate switch
# Stop the script if you need to interact with the Time Codex normally
#
# "Time Sense Dungeon Locked Doors"
# Toggle "WARMODE ON" when within range of a locked "Time Dungeon Door" to automatically lockpick it (Time Sense must be enabled with Time Codex Switch)
# This will use any random lockpick type you have in your pack
#
# "Smoke Bomb Cooldown" for pilfering only (use a separate script for regular smoke bombing)
# Create a cooldown called "Smoke Bomb" (note the space), must be spelled exactly like that
# Default cooldown is set to minimum cooldown time of 60 seconds (This assumes you have 3 points in "Without a Trace")
# This can be edited by searching (ctrl + f) "60000" and replacing it with your personal cooldown timer that matches your thieves codex
# Possible timers for smoke bomb are "60000", "80000", "100000", or "120000" (this is milliseconds)
#
# "Wizard Hat Stealth Trick" - prevents you from stumbling over a player/mob while moving in stealth
# It is recommended to have in your pack a "Blessed and Aspected Armored Magical Wizard Hat" (Purchasable at prev vendor)
# Alternatively you can buy a cheap "Magical Wizards Hat" from the Mage NPC in town (non-aspectable)
# This is for the stealth part of the script
# It will quick swap your hat and reduce your stamina
# If your hat ever gets stuck in a "spam loop"
# Go to Script tab > Options subtab and delete "bwiz" "bmain" and "nonaspectedwiz"
#
# "Auto Pilfer"
# Toggle "WARMODE ON" for "AUTO-PILFER" - It is best to use the "TAB" button and ensure that "TAB" is set to toggle in UO options
# To enable this feature: open the "thieves codex" while the script is playing - this will act like a switch to turn auto-pilfer on/off

# "Hide/Stealth Blocking"
# Toggle "WARMODE ON" to block the scripts smart hide/stealth feature (use for "Boss Room Custodians" and saving cooldown time)
#
# "Auto Chest Protection"
# "ACP" feature will instantly cast (Minimum "50 Magery" required to use)
# Wall of stone, Earth Elemental, Tele + Rope, or Reveal when you are detected
# Does not work when player is revealed by the reveal spell
# Toggle "Wall" "Earth" "Tele" "Reveal" or "None" by doubleclicking an "Atlas"
# Type "[Atlas" in game to spawn a free weightless "Atlas" in your bag
# Hotkey "Grants the player an Atlas" in razor hotkey tab if you dont want to doubleclick
#
# "Auto Frost Shell Protection"
# Create a cooldown in game called "Aspect"
# Frost shell is a powerful 5 second "cheat death" effect that can be instantly enabled for the cost of 5 essence through "activating the Frost Aspect"
# The script will automatically hot swap to "Frost Aspect" when you are Detected by another player (skill not spell), or, if you fall to 50 or less HP
# It is highly reccomended that you make a manual hotkey for "say [AspectArmor Frost"
# You may want to activate "Frost Armor" on your own terms outside of the scope of the script
# To toggle Auto Frost Shell Protection feature on/off "open the party menu" while the script is playing - the party menu acts like a switch (if you require the party menu for normal means, stop the script first before using)
#
# "Auto-Recycler"
# This feature will auto recycle bad items and keep the good ones - To use this feature:
# You must be carrying at least one "item identification wand" and at least one "recycler tool" type (Tinker Tools, Sewing Kit, Saw, Tongs, or Scribes Pen)
# The recycle will happen when the player begins picking a fresh chest (Double Click Scissors to activate auto recycle manually)
# To change items the script kees edit the following lines : 1239, 1266, 2068, 2095   (Do not remove Aspect or Training)
# To change the items the script recycles edit the following lines : 1244, 1268, 2073, 2097
#
# "Loot-Sense & Vacuum Mode"
# This function will overhead display *loot* above items on the ground and pick them up as you pass by (2 tiles)
# Be aware that this may make you overweight from large gold piles from time to time
# To toggle this feature on/off (default is off) "Double click a dagger" (suggest a blessed newbied dagger)
#
# "Auto Detect & Skin Corpses"
# If you have a skinning knife and 50 or more "Forensic Evaluation"
# While in Peace Mode the script will show corpses and auto skin them when in range
# To toggle this feature on/off double click your skinning knife while the script is playing
#
# "Extra Features"
# If you have any of the following items, the script will auto-use them when convenient and necessary;
# Cure Potion, Cleansing Brew, Trapped Pouch, Strength Potion (when weakened by another player), Refresh Potion
# If you are "over weight" the script will now "auto-dump" leather and piles of 444 gold until you are unburdened
#
# "Lootbag"
# Set by using the razor hotkey "Set Grab Item Hotbag"
#
# "Auto Stealth"
# This is an in game setting that is reccomended to be turned ON
# Toggle this on and off by typing [AutoStealth in game
#
# "Spam Reduction"
# Options tab > Targeting & Queues subtab > Uncheck "Attack/Target name overhead"
# Filters tab > Text & Messages subtab > Check "Filter Repeating Razor Messages" ONLY
# 
# "Summoners Name Your Elemental"                                                         
# See "line 151 & 161" if you would like to custom name your earth elemental(s)
# Default is "LootGolem"
#
# -------------------------------"Recommended Builds"-------------------------------
# --"Pilfer Ninja"------"Chest Ninja**"------"Summoner Picker"----"Pilfer Skinner"--
# Detect Hidden - 120  Detect Hidden - 120  Detect Hidden - 120  Forensic Eval-- 120
# Lockpicking ----120  Lockpicking ----120  Lockpicking ----120  Stealth ------- 120
# Stealth ------- 120  Stealth ------- 100  Stealth ------- 120  Hiding -------- 100
# Hiding -------- 100  Hiding -------- 100  Hiding -------- 100  Stealing ------ 100
# Magery --------- 80  Magery --------- 80  Magery -------- 100  Meditation ---- 100
# Camping -------- 80  Camping ------- 120  Camping -------- 80  Magery --------- 80
# Stealing ------ 100  Stealing ------- 80  Spirit Speak --- 80  Snooping ------- 67 (or 100 to steal from players)
#                                                                Focus ---------- 33 (0 if Stealing is 100)
# "Recommended Aspects, Links, and Codex/Tome"
# Harvest or Fortune Aspect (high end tools needed for Fortune and or low level aspect)
# Special/Rare loot Chance Links (Max 20) & Chest Success Chances/Progress Links (Max 10)
# If you Summon "Spirit Pact" and "Earthpull" upgrades are recommended (Summoner Tome)
# If you Lockpick "Overlooked" and "Without a Trace" is recommended (Thieves Codex)
# If you Pilfer "Extortion" is recommended (Thieves Codex)
# "** Bapeths current main build"
#
# "Notes on Rares"
# Not all "Rares" are on the auto loot list
# Keep an eye out for unlooted rares
# I update the list as I find them
#
# "Notes on error" 
# "Screen transitions" and "teleporting far distances" will on occasion error the script 
# This is a bug in razor, simply play the script again if this happens
# It helps to make a habit of replaying the script often to ensure its always playing
# I recommend, if you know how to, loop this script into your other commonly used scripts
#
# "Notes on loop-in"
# You will likley want to use other scripts while playing, and, it is advised to keep this script running at all times
# In order to achieve this you can "loop-in" this script on the back end of any other script you are using
# To learn more about this ask about it in the scripts=and-macros discord channel for Outlands discord
# You can also seach for scripts Bapeth has made that are pre-looped, such as "Bapeths Dungeon Rope + Tele" 
#
# "Script Starts Here"

if skill "Spirit Speak" >= 80 and findtype "an earth elemental" ground -1 -1 1 as Summon
    if not find "bsummon1" ground -1 -1
        while findtype "an earth elemental" ground -1 -1 1 as bsummon1
            if noto bsummon1 = "friend"
                @setvar "bsummon1" bsummon1
                # Name your summon if you like (no spaces must be unique)
                rename bsummon1 "LootGolem"
            endif
            break
        endwhile
        getlabel backpack ping
    elseif not find "bsummon2" ground -1 -1
        while findtype "an earth elemental" ground -1 -1 1 as bsummon2
            if noto bsummon2 = "friend"
                @setvar "bsummon2" bsummon2
                # Name your summon if you like (no spaces must be unique)
                rename bsummon2 "LootGolem"
            endif
            break
        endwhile
    endif
endif

if findtype 5912 self and not varexist "bwiz" and findlayer self head as regularhat
    getlabel regularhat desc
    if "magical" in desc
        dclick regularhat
        pause 500
        getlabel backpack ping
        replay
    endif
endif
if not find "bwiz" self and findtype 5912 backpack as wizhat
    getlabel wizhat desc
    if "restyled" in desc
        @ignore wizhat
        replay
    elseif "armored" in desc
        @setvar "bwiz" wizhat
    elseif "magical" in desc
        @setvar "bwiz" wizhat
        @setvar "nonaspectedwiz" wizhat
    endif
endif
if varexist "bwiz" and find "bwiz" backpack
    if not find "bmain" self and findlayer self head as hat
        @setvar "bmain" hat
    endif
    if not varexist "bmain"
        overhead "I need a primary hat or helm to wear.." 88
        pause 2000
        overhead "Anything will do, just not a magical wizard hat..." 88
        stop
    endif
endif

if skill "Lockpicking" >= 50 and not findtype "lockpicks" backpack and not timerexists lockpickcheck
    overhead "I have no Lockpicks..." 38
    createtimer lockpickcheck
endif
if timerexists lockpickcheck
    if timer lockpickcheck > 21000
        overhead "I have no Lockpicks..." 38
        settimer lockpickcheck 0
    endif
endif
if findtype "lockpicks" backpack
    removetimer lockpickcheck
endif

if skill "Detect" >= 50 and not findtype "drill" backpack and not timerexists drillcheck
    overhead "I have no Removal Tool..." 38
    createtimer drillcheck
endif
if timerexists drillcheck
    if timer drillcheck > 21000
        overhead "I have no Removal Tool..." 38
        settimer drillcheck 0
    endif
endif
if findtype "drill" backpack
    removetimer drillcheck
endif

if not timerexists frostshelltimer
    createtimer frostshelltimer
    settimer frostshelltimer 5000
endif
if timerexists frostshellswitch and timer frostshelltimer > 5000 and not cooldown "Aspect" and hp <= 50
    say "[AspectArmor Frost"
    getlabel backpack ping
    if insysmsg "Your armor is already of that aspect"
        //donothing
    else
        cooldown "Aspect" 30000
        overhead "--Frost Shell Primed--" 2234
    endif
    settimer frostshelltimer 0
endif

if not timerexists frostshellswitch
    if gumpexists 3527489586
        gumpclose 3527489586
        createtimer frostshellswitch
        overhead "--Auto Shell Enabled--" 2085
    endif
endif
if timerexists frostshellswitch
    if gumpexists 3527489586
        gumpclose 3527489586
        removetimer frostshellswitch
        overhead "--Auto Shell Disabled--" 1779
    endif
endif

if not timerexists checkaspect
    createtimer checkaspect
    settimer checkaspect 60000
elseif timer checkaspect >= 60000 
    if findlayer self innertorso as aspectarm
        getlabel aspectarm desc
        if "aspect" in desc
            if "air" in desc
                overhead "<Air Active>" 2263
            elseif "arcane" in desc
                overhead "<Arcane Active>" 1560
            elseif "artisan" in desc
                overhead "<Artisan Active>" 2096
            elseif "blood" in desc
                overhead "<Blood Active>" 2087
            elseif "command" in desc
                overhead "<Command Active>" 1782
            elseif "death" in desc
                overhead "<Death Active>" 2155
            elseif "discipline" in desc
                overhead "<Discipline Active>" 2490
            elseif "earth" in desc
                overhead "<Earth Active>" 2767
            elseif "eldritch" in desc
                overhead "<Eldritch Active>" 2615
            elseif "fire" in desc
                overhead "<Fire Active>" 2635
            elseif "fortune" in desc
                overhead "<Fortune Active>" 2843
            elseif "frost" in desc
                overhead "<Frost Active>" 2234
            elseif "gadget" in desc
                overhead "<Gadget Active>" 2669
            elseif "harvest" in desc
                overhead "<Harvest Active>" 2086
            elseif "holy" in desc
                overhead "<Holy Active>" 2153
            elseif "lightning" in desc
                overhead "<Lightning Active>" 2650
            elseif "lyric" in desc
                overhead "<Lyric Active>" 2241
            elseif "madness" in desc
                overhead "<Madness Active>" 1060
            elseif "poison" in desc
                overhead "<Poison Active>" 2897
            elseif "shadow" in desc
                overhead "<Shadow Active>" 1790
            elseif "void" in desc
                overhead "<Void Active>" 2599
            elseif "water" in desc
                overhead "<Water Active>" 1788
            elseif "war" in desc
                overhead "<War Active>" 2503
            endif
        else 
            overhead "No aspect enabled" 45
        endif
    endif
    settimer checkaspect 0
endif

if timerexists ots
    removetimer ots
endif

if timerexists bchestopen
    removetimer bchestopen
endif

if not timerexists tab
    createtimer tab
endif

if not timerexists getpilf
    createtimer getpilf
endif

if not timerexists spellinvis
    createtimer spellinvis
    settimer spellinvis 1200
endif

if not timerexists ACPcheck
    createtimer ACPcheck
endif

if skill "Magery" >= 80
    if timerexists reflect and not findbuff "Magic Reflection"
        if timer reflect > 30000
            overhead "--Cast Reflect--" 2122
            settimer reflect 12000
        endif
    endif
    if findbuff "Magic Reflection" and timerexists reflect
        removetimer reflect
    endif
    if not findbuff "Magic Reflection" and not timerexists reflect
        createtimer reflect
    endif
endif

if skill "Magery" >= 20
    if timerexists reactive and not findbuff "Reactive Armor"
        if timer reactive > 30000
            overhead "--Cast Reactive--" 2117
            settimer reactive 13500
        endif
    endif
    if findbuff "Reactive Armor" and timerexists reactive
        removetimer reactive
    endif
    if not findbuff "Reactive Armor" and not timerexists reactive
        createtimer reactive
    endif
endif

if not hidden and not timerexists brew and not targetexists and findbuff "Bleed" and findtype 50675 backpack as cbrew
    if not timerexists bleedmobdelay
        createtimer bleedmobdelay
    endif
    if timer bleedmobdelay >= 1100
        while queued
            //donothing
        endwhile
        dclick cbrew
        createtimer brew
        removetimer bleedmobdelay
    endif
    elseif not hidden and not timerexists brew and not targetexists and findbuff "Diseased" and findtype 50675 backpack as cbrew
    while queued
        //donothing
    endwhile
    dclick cbrew
    createtimer brew
endif
if timerexists brew
    if timer brew >= 120000
        removetimer brew
    endif
endif

if not hidden and not casting and findbuff "Weaken" and not targetexists and findtype "White Potion" backpack as stpot
    while queued
        //donothing
    endwhile
    dclick stpot
endif

if not timerexists topupstr
    createtimer topupstr
    settimer topupstr 30000
elseif timer topupstr >= 30000 and not hidden and not casting and str = 100 and findtype "White Potion" backpack as stpot
    while queued
        //donothing
    endwhile
    overhead "--Drink Strength--" 2041
    settimer topupstr 0
endif

if not timerexists topupres
    createtimer topupres
    settimer topupres 30000
elseif timer topupres >= 30000 and not hidden and not casting and not findbuff "Magic Resist Potion" and findtype "Black Potion" backpack as respot
    while queued
        //donothing
    endwhile
    overhead "--Drink Resist--" 2031
    settimer topupres 0
endif

if not targetexists and not hidden and not casting and stam <= 4 and findtype "Red Potion" backpack as redpot
    while queued
        //donothing
    endwhile
    dclick redpot
endif

if not hidden and paralyzed and not targetexists and findtype "pouch" backpack 38
    say "[Pouch"
endif

if not hidden and not casting and poisoned and not targetexists and findtype "Orange Potion" backpack as curepot
    while queued
        //donothing
    endwhile
    dclick curepot
endif

if not timerexists chestsensetimer
    createtimer chestsensetimer
    settimer chestsensetimer 200
endif
if not timerexists timesenseswitch and timer chestsensetimer >= 200
    if not gumpexists 736038070 and skill "Lockpicking" >= 50 
        for 18
        if index > 0 and findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 index as chest
                getlabel chest desc
                if "lock" in desc
                    overhead "{{desc}}" 2085 chest
                    break
                else 
                    overhead "{{desc}}" 1779 chest
                    @ignore chest
                endif
            endif
        endfor
        @clearignore
    endif
    settimer chestsensetimer 0
endif

if not timerexists timesenseswitch
    if gumpexists 3352257441
        gumpclose 3352257441
        createtimer timesenseswitch
        overhead "--Time Sense Enabled--" 88
    endif
endif
if timerexists timesenseswitch
    if gumpexists 3352257441
        gumpclose 3352257441
        removetimer timesenseswitch
        overhead "--Time Sense Disabled--" 38
    endif
endif
if timerexists timesenseswitch and not targetexists and not casting
    if not timerexists timesensecontainer
        createtimer timesensecontainer
        settimer timesensecontainer 1000
    endif
    if timer timesensecontainer >= 1000
        for 18
            if index > 0 and findtype "wooden shelf|dead|chest of drawers|3712|3651|3649|3648|3650|3708|2475|2713|2637|2474|3647|3710|3645|3703|3702|2472|3701|2473|2639|3788|3791|3786|2711|3709|3789|3646|3705|27284|27287|27289|27286|27288|3793|3787|3794|3790|3792|2643|3644" ground -1 -1 index as timecontainers
                getlabel timecontainers desc
                overhead "*search*" 88 timecontainers
                @ignore timecontainers
            endif
            if findtype "wooden shelf|dead|chest of drawers|3712|3651|3649|3648|3650|3708|2475|2713|2637|2474|3647|3710|3645|3703|3702|2472|3701|2473|2639|3788|3791|3786|2711|3709|3789|3646|3705|27284|27287|27289|27286|27288|3793|3787|3794|3790|3792|2643|3644" ground -1 -1 2
                break
            endif
            if warmode and findtype "barred metal door|metal door" ground -1 -1 2
                break
            endif
        endfor
        @clearignore
        settimer timesensecontainer 0
    endif
    if not timerexists switchandstufftimer
        createtimer switchandstufftimer
        settimer switchandstufftimer 1000
    endif
    if timer switchandstufftimer >= 1000
        for 18
            if index > 0 and findtype 4239|4240  ground -1 -1 index as switchandstuff
                getlabel switchandstuff desc
                overhead "*switch*" 78 switchandstuff
                @ignore switchandstuff
            endif
        endfor
        @clearignore
        settimer switchandstufftimer 0
    endif
    while findtype "wooden shelf|dead|chest of drawers|3712|3651|3649|3648|3650|3708|2475|2713|2637|2474|3647|3710|3645|3703|3702|2472|3701|2473|2639|3788|3791|3786|2711|3709|3789|3646|3705|27284|27287|27289|27286|27288|3793|3787|3794|3790|3792|2643|3644" ground -1 -1 2 as timecontainer
        @setvar "baptimecontainer" timecontainer
        while queued
            //donothing
        endwhile
        getlabel timecontainer desc
        if "the remains of" in desc
            overhead "*avatar corpse*" 45 timecontainer
        else
            dclick timecontainer
            pause 500
            getlabel backpack ping
        endif
        while findtype 2594 timecontainer 0 as zerolantern
            @ignore zerolantern
        endwhile
        while findtype 3827 timecontainer 0 as zeroscroll
            @ignore zeroscroll
        endwhile
        while findtype 4225 timecontainer 0 as zeroleather
            @ignore zeroleather
        endwhile
        while findtype 7127 timecontainer 0 as zeroboard
            @ignore zeroboard
        endwhile
        while findtype 5901|5899|5903|5905 timecontainer as timefootwear
            getlabel timefootwear desc
            if "(hue" in desc
                break
            else 
                @ignore timefootwear
            endif
        endwhile
        while findtype "wooden shelf|dead|chest of drawers|3712|3651|3649|3648|3650|3708|2475|2713|2637|2474|3647|3710|3645|3703|3702|2472|3701|2473|2639|3788|3791|3786|2711|3709|3789|3646|3705|27284|27287|27289|27286|27288|3793|3787|3794|3790|3792|2643|3644" timecontainer as innercontainer
            while queued
                //donothing
            endwhile
            dclick innercontainer
            pause 500
            getlabel backpack ping
            @ignore innercontainer
        endwhile
        while findtype 5056|5059|5060|5061|5063|5070|5074|5075|5076|5078|5085|5089|5090|5101|5103|5105|5106|5129|5131|5132|5135|5138|5139|5142|5143|5144|5146|5201|5203|5204|5205|5207|7169|7170|7173|7175|7177|7179|7181|7610|7947|31003|31004|31005|31006|31007|31008|31009|31010|31011|31012|31015|31191|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31043|31045|31047|31049|31051|31053|31055|3834|3740|3742|3762|3763|10245|20006|20008|20010|20012|20014|20016|7026|7027|7029|7031|7033|7034|7035|7107|7109|31002|31130|3920|5042|5117|30990|30993|30994|30995|31184|31186|3719|3922|3938|5121|5123|5125|30989|30992|30996|30997|30998|31176|31188|3568|3713|3721|3932|5040|5044|5112|5127|5177|5179|5181|30991|30999|31000|31001|31014|31178|31180|31182|3909|3911|3913|3915|3917|3934|3937|5046|5049|5115|5119|5182|5185|5187|30988|31128|31190|22187|31141|31142|31169|31172 timecontainer as checkunid
            getlabel checkunid desc
            if "unidentified" in desc
                hotkey 'Grab Item' 
                target checkunid
                overhead "*looting*" 2091 timecontainer
                while queued
                    //donothing
                endwhile
            else 
                @ignore checkunid
            endif
        endwhile
        while findtype "Apothecary Wheel|Barrel of Filth|Beastmaster's Horn|Bomb Cluster|Brace of Knives|Cross of Compassion|Divination Orb|Mirror of Reflection|Murder of Crows|Perilous Python|Prodigy Fiddle|Rose of Fading Beauty|Scale of Balance|screaming mandrake|Statue of the Siren|The Final Hour|Tyromancer's Cache|Tyromancer's Cheese|Vile Concoction|Warning Canary|Widow's Grief|54684|27612|49223|54591|54601|54718|5928|7408|19948|58325|19959|19822|49730|49729|19944|19949|47613|47612|47611|47610|47611|4112|3986|3966|cathedral tapestry|Darkscale tapestry|large painting|landscape painting|portrait painting|figurine|statue|20291|44987|49730|47107|18653|45127|20103|47103|29363|47105|29361|43453|5899|47109|45250|41509|43447|18657|4025|51308|45156|51304|45214|28769|28799|28803|28765|45211|45248|51259|45220|51328|45218|3842|51327|45222|45241|51336|11858|51375|45282|54722|45255|45246|28795|44983|45235|45251|45238|51258|51314|28761|45236|51260|54718|18400|58325|45252|18656|47111|3839|45239|45242|45254|45281|45247|42241|45216|28775|2594|51321|3838|51318|5901|5905|45259|5903|48407|51302|4248|27611|15296|43166|5359|5981|4026|3985|25359|17686|3836|17087|5356|29030|24434|22336|29036|3843|29025|51098|29034|8826|51094|576|3827|22326|45315|3891|2539|39898|39896|39892|39918|39911|39916|39897|39905|39891|39917|39912|39909|39889|31047|31017|31049|31019|31055|31051|31053|31025|31027|31031|31041|54717|31021|31011|31023|31029|31043|31003|31035|31033|31045|31037|31002|20006|31169|31006|30999|31012|31009|30996|7109|7107|31128|31188|20014|31014|31004|31142|31001|31000|37181|31010|30998|31172|30988|30997|31038|31141|7947|20008|31005|31191|31008|31007|30994|30993|31182|30989|20012|31186|31178|31015|30991|20010|20016|31184|31190|30990|30995|31176|31180|30992|31130|5207|7031|7026|7034|7033|7027|7035|7029|5078|5063|5059|5105|5060|5138|5129|5201|5142|5143|5076|5106|7610|5139|5090|5103|5132|7177|5061|7181|7179|3920|5042|5127|5117|5185|5125|3938|5177|3937|5044|5121|3915|3909|3568|3932|5123|5144|5119|5056|5135|5187|5074|5089|3934|3913|3917|3721|5075|5046|5049|7170|5146|5205|5203|5115|5204|5040|5179|5070|5182|5085|5181|3719|7173|5131|3911|5101|7175|7169|3713|5112|22187|9917|3859|3862|3878|3865|3856|3873|3877|3834|3742|3762|3740|3763|10245|3572|3573|3571|3885|7127|4225|12686|19985|19981|19984|19982|19983|19991|19989|19986|19987|19988|19994|19995|19992|19993|19990|19980|19977|19976|19978|7154|19979|43423|3861|3821" timecontainer as bitem
            hotkey 'Grab Item' 
            target bitem
            overhead "*looting*" 2091 timecontainer
            while queued
                //donothing
            endwhile
        endwhile
        @ignore timecontainer
    endwhile
endif
if timerexists timesenseswitch and warmode and findtype "barred metal door|metal door" ground -1 -1 2
    if findtype 5373 backpack as picks
        clearsysmsg 
        overhead "Which door shall I pick?" 88
        hotkey "Set Last Target"
        wft 1000
        while targetexists 
            if not findtype "barred metal door|metal door" ground -1 -1 2
                break
            endif
        endwhile
        @setvar "bapdoorpick" lasttarget 
        overhead "Time is of the essence..." 88
        for 2000
            if not timerexists doorpicktimer
                createtimer doorpicktimer
                settimer doorpicktimer 3150
            endif
            if timer doorpicktimer >= 3150
                dclick picks
                wft 1000
                target bapdoorpick
                overhead "*picking*" 1060 bapdoorpick
                getlabel backpack ping
                settimer doorpicktimer 0
            endif
            if insysmsg "That is not locked"
                warmode "off"
                getlabel backpack ping
                break
            endif
            if insysmsg "Target cannot be seen"
                warmode "off"
                getlabel backpack ping
                break
            endif
            if insysmsg "You pick the lock!"
                overhead "What lay beyond this door..." 87
                dclick bapdoorpick
                warmode "off"
                getlabel backpack ping
                break
            endif
            if not findtype 5373 backpack
                overhead "Argh, it was my last pick..." 38
                warmode "off"
                getlabel backpack ping
                break
            endif
            if not findtype "barred metal door" ground -1 -1 2
                warmode "off"
                getlabel backpack ping
                break
            endif
            if not warmode 
                break
            endif
            if insysmsg "You have worn out your tool"
                overhead "This tool is worn out!" 805
            endif
            if not findtype 5373 backpack
                break
            endif
            if timerexists frostshellswitch and timer frostshelltimer > 5000 and not cooldown "Aspect" and hp <= 50
                say "[AspectArmor Frost"
                getlabel backpack ping
                if insysmsg "Your armor is already of that aspect"
                    //donothing
                else
                    cooldown "Aspect" 30000
                    overhead "--Frost Shell Primed--" 2234
                endif
                settimer frostshelltimer 0
            endif
            if not cooldown "Move" and not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and skill "Hiding" >= 80
                skill "Hiding"
                warmode on
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
            if not cooldown "Move" and findbuff "Invisibility" and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and skill "Hiding" >= 80
                skill "Hiding"
                warmode on
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                    removetimer ots
                endif
            endif
            if hidden and not cooldown "Hiding" and not cooldown "Stealth" and not timerexists ots and skill "Stealth" >= 80
                skill "Stealth"
                getlabel backpack ping
                if not timerexists ots
                    createtimer ots
                endif
            endif
            if insysmsg "move quietly"
                getlabel backpack ping
                cooldown "Stealth" 10000
            endif
            if not cooldown "Move" and hidden and not cooldown "Hiding" and not cooldown "Stealth" and insysmsg "hide first" and skill "Hiding" >= 80
                pause 1000
                getlabel backpack ping
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
                removetimer ots
            endif
        endfor
     else 
         overhead "I am out of lockpicks!" 38
         warmode "off"
         getlabel backpack ping
     endif
endif

if not timerexists autopilferswitch
    if gumpexists 2955404556
        gumpclose 2955404556
        createtimer autopilferswitch
        overhead "--Auto Pilfer Enabled--" 88
    endif
endif
if timerexists autopilferswitch
    if gumpexists 2955404556
        gumpclose 2955404556
        removetimer autopilferswitch
        overhead "--Auto Pilfer Disabled--" 38
    endif
endif
if timerexists autopilferswitch and skill "Stealing" >= 80 and warmode and not targetexists 
    if timer getpilf >= 600
        settimer getpilf 0
        for 12
            hotkey 'Target Closest Murderer Monster'
            hotkey 'Next Grey Monster Target'
            @setvar pilfertarget lasttarget
            if find pilfertarget ground -1 -1 2
                overhead "*pilfer target*" 2091 pilfertarget
                break
            endif
        endfor
    endif
    if hidden
        while find pilfertarget ground -1 -1 2
            if not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing"
                clearsysmsg 
                if not targetexists 
                    if not timerexists repeatinvis and findbuff "Invisibility"
                        settimer spellinvis 0
                    endif
                    hotkey 'Cancel Current Target'
                    skill "Stealing"
                    wft 1000
                    target pilfertarget
                    hotkey 'Cancel Current Target'
                endif
                getlabel backpack ping
                break
            endif
            if not warmode 
                break
            endif
        endwhile 
        if insysmsg "You Steal"
            overhead "The goods are mine!" 2091
            cooldown "Stealing" 5000
            removetimer repeatinvis
            if not hidden
                if skill "Stealth" >= 80 and not cooldown "Smoke bomb" and not cooldown "Hiding" and not cooldown "Stealth" and findtype 52149 backpack as sbombs
                    while queued
                        //donothing
                    endwhile
                    dclick sbombs
                    getlabel backpack ping
                    if hidden
                        if not cooldown "Smoke bomb"
                            cooldown "Smoke bomb" 60000
                        endif
                    else 
                        overhead "I teleported too recently to Smoke..." 45
                    endif
                endif
                if timer spellinvis >= 1200 and not hidden and skill "Magery" >= 80 and mana >= 20
                    hotkey 'Cancel Current Target'
                    cast "Invisibility"
                    wft 3000
                    target self
                    warmode on
                    warmode off
                    hotkey 'Cancel Current Target'
                endif
            endif
        endif
        if insysmsg "The creature is barren"
            overhead "Another thief beat me to it..." 1779
            cooldown "Stealing" 5000
        endif
        if insysmsg "That is too far away"
            overhead "Argh, not close enough..." 1779
            cooldown "Stealing" 5000
        endif
        if insysmsg "Target cannot be seen"
            overhead "Argh, I cant see it..." 1779
            cooldown "Stealing" 5000
        endif
        if insysmsg "You have already stolen"
            overhead "I have already pilfered this..." 1779
            cooldown "Stealing" 5000
        endif
        if insysmsg "You fail"
            overhead "Argh, I failed to Pilfer..." 1779
            cooldown "Stealing" 5000
            if skill "Stealth" >= 80 and not cooldown "Smoke bomb" and not cooldown "Hiding" and not cooldown "Stealth" and findtype 52149 backpack as sbombs
                while queued
                    //donothing
                endwhile
                dclick sbombs
                getlabel backpack ping
                if hidden
                    if not cooldown "Smoke bomb"
                        cooldown "Smoke bomb" 60000
                    endif
                else 
                    overhead "I teleported too recently to Smoke..." 45
                endif
            endif
            if timer spellinvis >= 1200 and not hidden and skill "Magery" >= 80 and mana >= 20
                hotkey 'Cancel Current Target'
                cast "Invisibility"
                wft 3000
                target self
                warmode on
                warmode off
                hotkey 'Cancel Current Target'
                createtimer repeatinvis
            endif
        endif
    elseif not hidden
        while find pilfertarget ground -1 -1 2
            if not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing"
                clearsysmsg 
                if not targetexists 
                    skill "Stealing"
                    wft 1000
                    target pilfertarget
                    hotkey 'Cancel Current Target'
                endif
                getlabel backpack ping
                break
            endif
        endwhile 
        if insysmsg "retaliate"
            overhead "Argh, I failed to Pilfer" 1779
            cooldown "Stealing" 5000
            if not hidden and findtype "yellow potion" backpack as healpot
                while queued
                    //donothing
                endwhile
                dclick healpot
            endif
        endif
        if insysmsg "You Steal"
            overhead "The goods are mine!" 2091
            cooldown "Stealing" 5000
        endif
        if insysmsg "The creature is barren"
            overhead "Another thief beat me to it..." 1779
            cooldown "Stealing" 5000
        endif
        if insysmsg "That is too far away"
            overhead "Argh, not close enough..." 1779
            cooldown "Stealing" 5000
        endif
        if insysmsg "Target cannot be seen"
            overhead "Argh, I cant see it..." 1779
            cooldown "Stealing" 5000
        endif
        if insysmsg "You have already stolen"
            overhead "I have already pilfered this..." 1779
            cooldown "Stealing" 5000
        endif
    endif
endif

if gumpexists 736038070
    gumpclose 736038070
endif

if skill "Lockpicking" >= 50 and findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2 as bchest and not targetexists
    clearsysmsg 
    if not warmode 
        warmode on
        warmode off
    endif
    while queued
        //donothing
    endwhile
    while casting 
        pause 250
    endwhile
    dclick bchest
    @setvar "bchest" lastobject
    getlabel bchest desc
    if "(locked and trapped)" in desc
        createtimer activaterecycle
    endif
    waitforgump 736038070 1000
    if gumpexists 736038070 and not ingump "Cleared Of Traps" 736038070
        while gumpexists 736038070
            gumpresponse 7
            waitforgump 736038070 1000
            if insysmsg "You attempt to remove traps"
                clearsysmsg
                break
            endif
            if insysmsg "That appears to be devoid"
                clearsysmsg
                break
            endif
            if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
                removetimer activaterecycle
                break
            endif
            if not cooldown "Move" and not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endwhile
        if not hidden
            if followers >= 1
                if find "bsummon1"
                    menu bsummon1 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon2"
                        menu bsummon2 2
                        wft 1000
                        target self  
                    endif
                elseif find "bsummon2"
                    menu bsummon2 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon1"
                        menu bsummon1 2
                        wft 1000
                        target self  
                    endif
                endif
            endif
            if not cooldown "Move" and not warmode and not cooldown "Hiding" and not cooldown "Stealth" and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endif
        overhead "*disarming*" 1060 bchest
        while not dead
            if timerexists frostshellswitch and timer frostshelltimer > 5000 and not cooldown "Aspect" and hp <= 50
                say "[AspectArmor Frost"
                getlabel backpack ping
                if insysmsg "Your armor is already of that aspect"
                    //donothing
                else
                    cooldown "Aspect" 30000
                    overhead "--Frost Shell Primed--" 2234
                endif
                settimer frostshelltimer 0
            endif
            if not cooldown "Move" and not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
            if not cooldown "Move" and findbuff "Invisibility" and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                    removetimer ots
                endif
            endif
            if not warmode and hidden and not cooldown "Hiding" and not cooldown "Stealth" and not timerexists ots and skill "Stealth" >= 80
                skill "Stealth"
                getlabel backpack ping
                if not timerexists ots
                    createtimer ots
                endif
            endif
            if insysmsg "move quietly"
                getlabel backpack ping
                cooldown "Stealth" 10000
            endif
            if not cooldown "Move" and hidden and not cooldown "Hiding" and not cooldown "Stealth" and insysmsg "hide first" and skill "Hiding" >= 80
                pause 1000
                getlabel backpack ping
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
                removetimer ots
            endif
            if insysmsg  "You have successfully cleared it of traps"
                overhead "*tick*" 2091 bchest
                break
            endif
            if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
                removetimer activaterecycle
                break
            endif
            if find "bchest" ground -1 -1 2
# Note for author:
# The break here will not work on special Urkton Chests or possibly new Time Dungeon chests.
# It is not a big deal as this part is only for a specific sceanario in which another player
# opens a chest while you are trying to snatch their chest.  It will break into looting instantly.
# I still want to figure out a better way here.
                getlabel bchest desc
                if "wooden" in desc
                    //do nothing
                elseif "metal" in desc
                    //do nothing
                elseif "lock" in desc
                    //do nothing
                else 
                    overhead "*pop*" 2091 bchest
                    break
                endif
            endif
            if ingump "Cleared Of Traps" 736038070
                overhead "*tick*" 2091 bchest
                break
            endif
            if timer tab > 1000
                if not warmode 
                    warmode on
                    warmode off
                endif
                settimer tab 0
            endif
            if insysmsg "You make some progress towards clearing it of traps"
                overhead "*clink*" 810 bchest
            endif
            if insysmsg "You have worn out your tool"
                overhead "This tool is worn out!" 805
            endif
            if ingump "Shrines" 341416395
                if not timerexists "Wacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Wall of Stone ACP ------Enabled------" 2031
                    createtimer "Wall"
                    createtimer "Wacp"
                    removetimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Eacp" and skill "Spirit Speak" >= 80 and skill "Magery" >= 100
                    gumpclose 341416395
                    overhead "Earth Elemental ACP ------Enabled------" 1501
                    createtimer "Elemental"
                    createtimer "Eacp"
                    removetimer "Nacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Tacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Teleport + Rope ACP ------Enabled------" 1272
                    createtimer "Tele"
                    createtimer "Tacp"
                    removetimer "Nacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "None" 
                    removetimer "Reveal"  
                elseif not timerexists "Racp" and skill "Magery" >= 80
                    gumpclose 341416395
                    overhead "Reveal Spellcast ACP ------Enabled------" 2040
                    createtimer "Racp"
                    createtimer "Reveal"
                    removetimer "Nacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"  
                    removetimer "None"    
                elseif not timerexists "Nacp"
                    gumpclose 341416395
                    overhead "Auto Chest Protection ------Disabled------" 38
                    createtimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Wacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "Reveal" 
                endif
            endif
            if insysmsg "You have been revealed!" 
                if timerexists "Tele" and mana >= 9
                    say "[Anger"
                    cast 'Teleport'
                    if findtype "rope" backpack as rope
                        dclick rope
                    else 
                        overhead "I am out of rope..." 34
                    endif
                    removetimer "Tacp"
                    removetimer "Tele"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Wacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                elseif timerexists "Wall" and mana >= 9
                    say "[Anger"
                    cast 'Wall of Stone'
                    removetimer "Wacp"
                    removetimer "Wall"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                elseif timerexists "Elemental" and mana >= 50
                    say "[Anger"
                    cast 'Earth Elemental'
                    removetimer "Eacp"
                    removetimer "Elemental"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                elseif timerexists "Reveal" and mana >= 20
                    say "[Anger"
                    cast 'Reveal'
                    removetimer "Racp"
                    removetimer "Reveal"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Eacp"
                    dclicktype "atlas" backpack
                else
                    say "[Anger"
                endif
                if timerexists frostshellswitch and not cooldown "Aspect"
                    say "[AspectArmor Frost"
                    getlabel backpack ping
                    if insysmsg "Your armor is already of that aspect"
                        //donothing
                    else
                        cooldown "Aspect" 30000
                        overhead "--Frost Shell Primed--" 2234
                    endif
                    settimer frostshelltimer 0
                endif
            endif
            if timer ACPcheck > 42000
                if timerexists "Tele"
                    overhead "Teleport ACP active" 1272
                endif
                if timerexists "Wall"
                    overhead "Wall ACP active" 2031
                endif
                if timerexists "Elemental"
                    overhead "Elemental ACP active" 1501
                endif
                if timerexists "Reveal"
                    overhead "Reveal ACP active" 2040
                endif
                settimer ACPcheck 0
            endif
            if insysmsg "Another player"
                gumpclose 736038070
                dclick bchest
                waitforgump 736038070 1000
                gumpresponse 7
                waitforgump 736038070 1000
            endif
            if timerexists lootvacuumswitch
                if not timerexists lootsensetimer
                    createtimer lootsensetimer
                    settimer lootsensetimer 1000
                endif
                if timer lootsensetimer >= 1000
                    for 18
                        if findtype "3827" ground 0 as regularscroll
                            @ignore regularscroll
                        endif
                        if index > 0 and findtype "54230|apothecary wheel|entrail bucket|beastmaster's horn|bomb cluster|brace of knives|cross of compassion|divination orb|mirror of reflection|murder of crows|perilous python|prodigy fiddle|rose of fading beauty|scale of balance|screaming mandrake|statue of the siren|the final hour|tyromancer's cache|tyromancer's cheese|vile concoction|warning canary|widow's grief|54684|27612|49223|54591|54601|54718|5928|7408|19948|58325|19959|19822|49730|49729|19944|19949|47613|47612|47611|47610|47611|4112|3986|3966|cathedral tapestry|Darkscale tapestry|large painting|landscape painting|portrait painting|20291|44987|49730|47107|18653|45127|20103|47103|29363|47105|29361|43453|5899|47109|45250|41509|43447|18657|4025|51308|45156|51304|45214|28769|28799|28803|28765|45211|45248|51259|45220|51328|45218|3842|51327|45222|45241|51336|11858|51375|45282|54722|45255|45246|28795|44983|45235|45251|45238|51258|51314|28761|45236|51260|54718|18400|58325|45252|18656|47111|3839|45239|45242|45254|45281|45247|42241|45216|28775|2594|51321|3838|51318|5901|5905|45259|5903|48407|51302|4248|27611|15296|43166|5359|5981|4026|3985|25359|17686|3836|17087|5356|29030|24434|22336|29036|3843|29025|51098|29034|8826|51094|576|3827|22326|45315|3891|2539|39898|39896|39892|39918|39911|39916|39897|39905|39891|39917|39912|39909|39889|31047|31017|31049|31019|31055|31051|31053|31025|31027|31031|31041|54717|31021|31011|31023|31029|31043|31003|31035|31033|31045|31037|31002|20006|31169|31006|30999|31012|31009|30996|7109|7107|31128|31188|20014|31014|31004|31142|31001|31000|37181|31010|30998|31172|30988|30997|31038|31141|7947|20008|31005|31191|31008|31007|30994|30993|31182|30989|20012|31186|31178|31015|30991|20010|20016|31184|31190|30990|30995|31176|31180|30992|31130|5207|7031|7026|7034|7033|7027|7035|7029|5078|5063|5059|5105|5060|5138|5129|5201|5142|5143|5076|5106|7610|5139|5090|5103|5132|7177|5061|7181|7179|3920|5042|5127|5117|5185|5125|3938|5177|3937|5044|5121|3915|3909|3568|3932|5123|5144|5119|5056|5135|5187|5074|5089|3934|3913|3917|3721|5075|5046|5049|7170|5146|5205|5203|5115|5204|5040|5179|5070|5182|5085|5181|3719|7173|5131|3911|5101|7175|7169|3713|5112|22187|9917|3859|3862|3878|3865|3856|3873|3877|3834|3742|3762|3740|3763|10245|3572|3573|3571|3885|7127|4225|12686|19985|19981|19984|19982|19983|19991|19989|19986|19987|19988|19994|19995|19992|19993|19990|19980|19977|19976|19978|7154|19979|43423|3861|3821" ground -1 -1 index as lootlocation
                            overhead "*loot*" 2091 lootlocation
                            @ignore lootlocation
                        endif
                    endfor
                    @clearignore 
                    settimer lootsensetimer 0
                endif
            endif
            if hidden and timerexists activaterecycle and findtype "sewing kit|saw|pen and ink|tongs|tool kit" backpack as breakdowntool
                if findtype 20496 backpack as IDwand
                    clearsysmsg 
                    if findtype 3834 backpack 0 as bbook
                        @ignore bbook
                    endif
                    while findtype 5056|5059|5060|5061|5063|5070|5074|5075|5076|5078|5085|5089|5090|5101|5103|5105|5106|5129|5131|5132|5135|5138|5139|5142|5143|5144|5146|5201|5203|5204|5205|5207|7169|7170|7173|7175|7177|7179|7181|7610|7947|31003|31004|31005|31006|31007|31008|31009|31010|31011|31012|31015|31191|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31043|31045|31047|31049|31051|31053|31055|3834|3740|3742|3762|3763|10245|20006|20008|20010|20012|20014|20016|7026|7027|7029|7031|7033|7034|7035|7107|7109|31002|31130|3920|5042|5117|30990|30993|30994|30995|31184|31186|3719|3938|5121|5123|5125|30989|30992|30996|30997|30998|31176|31188|3568|3713|3721|3932|5040|5044|5112|5127|5177|5179|5181|30991|30999|31000|31001|31014|31178|31180|31182|3909|3911|3913|3915|3917|3934|3937|5046|5049|5115|5119|5182|5185|5187|30988|31128|31190|22187|31141|31142|31169|31172 backpack as IDitem
                        getlabel IDitem desc
                        if "unidentified" in desc
                            while queued
                                //donothing
                            endwhile
                            dclick IDwand
                            wft 1000
                            target IDitem
                            waitforsysmsg "You identify the item." 1000
                            getlabel IDitem desc
                            if "aspect" in desc or "training" in desc or "vanquishing" in desc or "supremely" in desc or "slaying" in desc or "enticement" in desc or "invulnerability" in desc or "power" in desc or "exceedingly accurate force" in desc or "exceedingly potent" in desc or "valorite" in desc or "avarite" in desc or "verite" in desc or "agapite" in desc or "fortification" in desc
                                @ignore IDitem
                                overhead "This one is worth keeping..." 2091
                                overhead "*strong magic*" 2091 IDitem
                                say "[surprise" 2091
                            elseif "durable" in desc or "substantial" in desc or "massive" in desc or "fortified" in desc or "indestructible" in desc or "exceptional" in desc or "accurate" in desc or "surpassingly" in desc or "eminently" in desc or "exceedingly" in desc or "ruin" in desc or "might" in desc or "force" in desc or "power" in desc or "mastercrafted" in desc or "defense" in desc or "guarding" in desc or "hardening" in desc or "potent" in desc or "melodious" in desc
                                overhead "*trash*" 1779 IDitem
                                while not gumpexists 949095101
                                    while queued
                                        //donothing
                                    endwhile
                                    dclick breakdowntool
                                    waitforgump 949095101 1000
                                endwhile
                                while not ingump "Recycle Single Item" 949095101
                                    gumpresponse 2
                                    waitforgump 949095101 1000
                                endwhile                                
                                gumpresponse 3
                                waitforgump 949095101 1000
                                target IDitem
                                getlabel backpack ping
                                pause 300
                                gumpclose 949095101
                            else
                                @ignore IDitem
                            endif
                        elseif "aspect" in desc or "training" in desc or "vanquishing" in desc or "supremely" in desc or "slaying" in desc or "enticement" in desc or "invulnerability" in desc or "power" in desc or "exceedingly accurate force" in desc or "exceedingly potent" in desc or "valorite" in desc or "avarite" in desc or "verite" in desc or "agapite" in desc or "fortification" in desc
                            @ignore IDitem
                        elseif "durable" in desc or "substantial" in desc or "massive" in desc or "fortified" in desc or "indestructible" in desc or "exceptional" in desc or "accurate" in desc or "surpassingly" in desc or "eminently" in desc or "exceedingly" in desc or "ruin" in desc or "might" in desc or "force" in desc or "power" in desc or "mastercrafted" in desc or "defense" in desc or "guarding" in desc or "hardening" in desc or "potent" in desc or "melodious" in desc
                            overhead "*trash*" 1779 IDitem
                            while not gumpexists 949095101
                                while queued
                                    //donothing
                                endwhile
                                dclick breakdowntool
                                waitforgump 949095101 1000
                            endwhile
                            while not ingump "Recycle Single Item" 949095101
                                gumpresponse 2
                                waitforgump 949095101 1000
                            endwhile                                
                            gumpresponse 3
                            waitforgump 949095101 1000
                            target IDitem
                            getlabel backpack ping
                            pause 300
                            gumpclose 949095101
                        else
                            @ignore IDitem
                        endif
                        if not findtype 20496 backpack
                            break
                        endif
                    endwhile
                    if gumpexists 949095101
                        gumpclose 949095101
                    endif
                endif
                if targetexists 
                    hotkey "Cancel Current Target"
                endif
            endif
            if varexist "bwiz" and find "bwiz" backpack and find "bmain" self
                if not targetexists and not casting and skill "Stealth" >= 80 and hidden and stam = maxstam
                    while queued
                        //donothing
                    endwhile
                    dclick "bwiz"
                    while queued
                        //donothing
                    endwhile
                    pause 30
                    dclick "bmain"
                    pause 500
                    getlabel backpack ping
                endif
                if not targetexists and not casting and not findlayer self head and find "bmain" self
                    while queued
                        //donothing
                    endwhile
                    dclick "bmain"
                    pause 500
                    getlabel backpack ping
                endif
            endif
            if varexist "bwiz" and find "bmain" self
                if not targetexists and not casting and not find "bwiz" backpack
                    while queued
                        //donothing
                    endwhile
                    dclick "bmain"
                    pause 500
                    getlabel backpack ping
                endif
            endif
        endwhile
        waitforgump 736038070 1000
    endif
    if gumpexists 736038070 and ingump "Cleared Of Traps" 736038070
        while gumpexists 736038070
            while casting 
                pause 250
            endwhile
            dclick bchest
            gumpresponse 4
            waitforgump 736038070 1000
            if insysmsg "You attempt to pick the lock"
                clearsysmsg
                break
            endif
            if insysmsg "It appears to be unlocked"
                clearsysmsg
                break
            endif
            if not cooldown "Move" and not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endwhile
        if not hidden
            if followers >= 1
                if find "bsummon1"
                    menu bsummon1 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon2"
                        menu bsummon2 2
                        wft 1000
                        target self  
                    endif
                elseif find "bsummon2"
                    menu bsummon2 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon1"
                        menu bsummon1 2
                        wft 1000
                        target self  
                    endif
                endif
            endif
            if not cooldown "Move" and not warmode and not cooldown "Hiding" and not cooldown "Stealth" and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endif
        overhead "*picking*" 1060 bchest
        while not dead
            if timerexists frostshellswitch and timer frostshelltimer > 5000 and not cooldown "Aspect" and hp <= 50
                say "[AspectArmor Frost"
                getlabel backpack ping
                if insysmsg "Your armor is already of that aspect"
                    //donothing
                else
                    cooldown "Aspect" 30000
                    overhead "--Frost Shell Primed--" 2234
                endif
                settimer frostshelltimer 0
            endif
            if not cooldown "Move" and not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
            if not cooldown "Move" and findbuff "Invisibility" and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                    removetimer ots
                endif
            endif
            if not warmode and hidden and not cooldown "Hiding" and not cooldown "Stealth" and not timerexists ots and skill "Stealth" >= 80
                skill "Stealth"
                getlabel backpack ping
                if not timerexists ots
                    createtimer ots
                endif
            endif
            if insysmsg "move quietly"
                getlabel backpack ping
                cooldown "Stealth" 10000
            endif
            if not cooldown "Move" and hidden and not cooldown "Hiding" and not cooldown "Stealth" and insysmsg "hide first" and skill "Hiding" >= 80
                pause 1000
                getlabel backpack ping
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
                removetimer ots
            endif
            if insysmsg "You successfully pick the lock"
                overhead "*pop*" 2091 bchest
                break
            endif
            if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
                removetimer activaterecycle
                break
            endif
            if find "bchest" ground -1 -1 2
# Note for author:
# The break here will not work on special Urkton Chests or possibly new Time Dungeon chests.
# It is not a big deal as this part is only for a specific sceanario in which another player
# opens a chest while you are trying to snatch their chest.  It will break into looting instantly.
# I still want to figure out a better way here.
                getlabel bchest desc
                if "wooden" in desc
                    //do nothing
                elseif "metal" in desc
                    //do nothing
                elseif "lock" in desc
                    //do nothing
                else 
                    overhead "*pop*" 2091 bchest
                    break
                endif
            endif
            if timer tab > 1000
                if not warmode 
                    warmode on
                    warmode off
                endif
                settimer tab 0
            endif
            if insysmsg "You make some progress on the lock"
                overhead "*click*" 810 bchest
            endif
            if insysmsg "You have worn out your tool"
                overhead "This tool is worn out!" 805
            endif
            if varexist "bwiz" and find "bwiz" backpack and find "bmain" self and not find "nonaspectedwiz" backpack 
                if not targetexists and not casting and skill "Stealth" >= 80 and hidden and stam = maxstam
                    while queued
                        //donothing
                    endwhile
                    dclick "bwiz"
                    while queued
                        //donothing
                    endwhile
                    pause 30
                    dclick "bmain"
                    pause 500
                    getlabel backpack ping
                endif
                if not targetexists and not casting and not findlayer self head and find "bmain" self
                    while queued
                        //donothing
                    endwhile
                    dclick "bmain"
                    pause 500
                    getlabel backpack ping
                endif
            endif
            if varexist "bwiz" and find "bmain" self
                if not targetexists and not casting and not find "bwiz" backpack
                    while queued
                        //donothing
                    endwhile
                    dclick "bmain"
                    pause 500
                    getlabel backpack ping
                endif
            endif
            if ingump "Shrines" 341416395
                if not timerexists "Wacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Wall of Stone ACP ------Enabled------" 2031
                    createtimer "Wall"
                    createtimer "Wacp"
                    removetimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Eacp" and skill "Spirit Speak" >= 80 and skill "Magery" >= 100
                    gumpclose 341416395
                    overhead "Earth Elemental ACP ------Enabled------" 1501
                    createtimer "Elemental"
                    createtimer "Eacp"
                    removetimer "Nacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Tacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Teleport + Rope ACP ------Enabled------" 1272
                    createtimer "Tele"
                    createtimer "Tacp"
                    removetimer "Nacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "None" 
                    removetimer "Reveal"  
                elseif not timerexists "Racp" and skill "Magery" >= 80
                    gumpclose 341416395
                    overhead "Reveal Spellcast ACP ------Enabled------" 2040
                    createtimer "Racp"
                    createtimer "Reveal"
                    removetimer "Nacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"  
                    removetimer "None"    
                elseif not timerexists "Nacp"
                    gumpclose 341416395
                    overhead "Auto Chest Protection ------Disabled------" 38
                    createtimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Wacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "Reveal" 
                endif
            endif
            if insysmsg "You have been revealed!" 
                if timerexists "Tele" and mana >= 9
                    say "[Anger"
                    cast 'Teleport'
                    if findtype "rope" backpack as rope
                        dclick rope
                    else 
                        overhead "I am out of rope..." 34
                    endif
                    removetimer "Tacp"
                    removetimer "Tele"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Wacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                elseif timerexists "Wall" and mana >= 9
                    say "[Anger"
                    cast 'Wall of Stone'
                    removetimer "Wacp"
                    removetimer "Wall"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                elseif timerexists "Elemental" and mana >= 50
                    say "[Anger"
                    cast 'Earth Elemental'
                    removetimer "Eacp"
                    removetimer "Elemental"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                elseif timerexists "Reveal" and mana >= 20
                    say "[Anger"
                    cast 'Reveal'
                    removetimer "Racp"
                    removetimer "Reveal"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Eacp"
                    dclicktype "atlas" backpack
                else
                    say "[Anger"
                endif
                if timerexists frostshellswitch and not cooldown "Aspect"
                    say "[AspectArmor Frost"
                    getlabel backpack ping
                    if insysmsg "Your armor is already of that aspect"
                        //donothing
                    else
                        cooldown "Aspect" 30000
                        overhead "--Frost Shell Primed--" 2234
                    endif
                    settimer frostshelltimer 0
                endif
            endif
            if timer ACPcheck > 42000
                if timerexists "Tele"
                    overhead "Teleport ACP active" 1272
                endif
                if timerexists "Wall"
                    overhead "Wall ACP active" 2031
                endif
                if timerexists "Elemental"
                    overhead "Elemental ACP active" 1501
                endif
                if timerexists "Reveal"
                    overhead "Reveal ACP active" 2040
                endif
                settimer ACPcheck 0
            endif
            if insysmsg "Another player"
                gumpclose 736038070
                dclick bchest
                waitforgump 736038070 1000
                gumpresponse 4
                waitforgump 736038070 1000
            endif
            if timerexists lootvacuumswitch
                if not timerexists lootsensetimer
                    createtimer lootsensetimer
                    settimer lootsensetimer 1000
                endif
                if timer lootsensetimer >= 1000
                    for 18
                        if findtype "3827" ground 0 as regularscroll
                            @ignore regularscroll
                        endif
                        if index > 0 and findtype "54230|apothecary wheel|entrail bucket|beastmaster's horn|bomb cluster|brace of knives|cross of compassion|divination orb|mirror of reflection|murder of crows|perilous python|prodigy fiddle|rose of fading beauty|scale of balance|screaming mandrake|statue of the siren|the final hour|tyromancer's cache|tyromancer's cheese|vile concoction|warning canary|widow's grief|54684|27612|49223|54591|54601|54718|5928|7408|19948|58325|19959|19822|49730|49729|19944|19949|47613|47612|47611|47610|47611|4112|3986|3966|cathedral tapestry|Darkscale tapestry|large painting|landscape painting|portrait painting|20291|44987|49730|47107|18653|45127|20103|47103|29363|47105|29361|43453|5899|47109|45250|41509|43447|18657|4025|51308|45156|51304|45214|28769|28799|28803|28765|45211|45248|51259|45220|51328|45218|3842|51327|45222|45241|51336|11858|51375|45282|54722|45255|45246|28795|44983|45235|45251|45238|51258|51314|28761|45236|51260|54718|18400|58325|45252|18656|47111|3839|45239|45242|45254|45281|45247|42241|45216|28775|2594|51321|3838|51318|5901|5905|45259|5903|48407|51302|4248|27611|15296|43166|5359|5981|4026|3985|25359|17686|3836|17087|5356|29030|24434|22336|29036|3843|29025|51098|29034|8826|51094|576|3827|22326|45315|3891|2539|39898|39896|39892|39918|39911|39916|39897|39905|39891|39917|39912|39909|39889|31047|31017|31049|31019|31055|31051|31053|31025|31027|31031|31041|54717|31021|31011|31023|31029|31043|31003|31035|31033|31045|31037|31002|20006|31169|31006|30999|31012|31009|30996|7109|7107|31128|31188|20014|31014|31004|31142|31001|31000|37181|31010|30998|31172|30988|30997|31038|31141|7947|20008|31005|31191|31008|31007|30994|30993|31182|30989|20012|31186|31178|31015|30991|20010|20016|31184|31190|30990|30995|31176|31180|30992|31130|5207|7031|7026|7034|7033|7027|7035|7029|5078|5063|5059|5105|5060|5138|5129|5201|5142|5143|5076|5106|7610|5139|5090|5103|5132|7177|5061|7181|7179|3920|5042|5127|5117|5185|5125|3938|5177|3937|5044|5121|3915|3909|3568|3932|5123|5144|5119|5056|5135|5187|5074|5089|3934|3913|3917|3721|5075|5046|5049|7170|5146|5205|5203|5115|5204|5040|5179|5070|5182|5085|5181|3719|7173|5131|3911|5101|7175|7169|3713|5112|22187|9917|3859|3862|3878|3865|3856|3873|3877|3834|3742|3762|3740|3763|10245|3572|3573|3571|3885|7127|4225|12686|19985|19981|19984|19982|19983|19991|19989|19986|19987|19988|19994|19995|19992|19993|19990|19980|19977|19976|19978|7154|19979|43423|3861|3821" ground -1 -1 index as lootlocation
                            overhead "*loot*" 2091 lootlocation
                            @ignore lootlocation
                        endif
                    endfor
                    @clearignore 
                    settimer lootsensetimer 0
                endif
            endif
        endwhile
    endif
endif

if gumpexists 949095101
    gumpclose 949095101
endif

if find "bchest" ground -1 -1 2 as bchest and not targetexists 
    clearsysmsg 
    while findtype "54230|apothecary wheel|entrail bucket|beastmaster's horn|bomb cluster|brace of knives|cross of compassion|divination orb|mirror of reflection|murder of crows|perilous python|prodigy fiddle|rose of fading beauty|scale of balance|screaming mandrake|statue of the siren|the final hour|tyromancer's cache|tyromancer's cheese|vile concoction|warning canary|widow's grief|54684|27612|49223|54591|54601|54718|5928|7408|19948|58325|19959|19822|49730|49729|19944|19949|47613|47612|47611|47610|47611|4112|3986|3966|cathedral tapestry|Darkscale tapestry|large painting|landscape painting|portrait painting|figurine|statue|20291|44987|49730|47107|18653|45127|20103|47103|29363|47105|29361|43453|5899|47109|45250|41509|43447|18657|4025|51308|45156|51304|45214|28769|28799|28803|28765|45211|45248|51259|45220|51328|45218|3842|51327|45222|45241|51336|11858|51375|45282|54722|45255|45246|28795|44983|45235|45251|45238|51258|51314|28761|45236|51260|54718|18400|58325|45252|18656|47111|3839|45239|45242|45254|45281|45247|42241|45216|28775|2594|51321|3838|51318|5901|5905|45259|5903|48407|51302|4248|27611|15296|43166|5359|5981|4026|3985|25359|17686|3836|17087|5356|29030|24434|22336|29036|3843|29025|51098|29034|8826|51094|576|3827|22326|45315|3891|2539|39898|39896|39892|39918|39911|39916|39897|39905|39891|39917|39912|39909|39889|31047|31017|31049|31019|31055|31051|31053|31025|31027|31031|31041|54717|31021|31011|31023|31029|31043|31003|31035|31033|31045|31037|31002|20006|31169|31006|30999|31012|31009|30996|7109|7107|31128|31188|20014|31014|31004|31142|31001|31000|37181|31010|30998|31172|30988|30997|31038|31141|7947|20008|31005|31191|31008|31007|30994|30993|31182|30989|20012|31186|31178|31015|30991|20010|20016|31184|31190|30990|30995|31176|31180|30992|31130|5207|7031|7026|7034|7033|7027|7035|7029|5078|5063|5059|5105|5060|5138|5129|5201|5142|5143|5076|5106|7610|5139|5090|5103|5132|7177|5061|7181|7179|3920|5042|5127|5117|5185|5125|3938|5177|3937|5044|5121|3915|3909|3568|3932|5123|5144|5119|5056|5135|5187|5074|5089|3934|3913|3917|3721|5075|5046|5049|7170|5146|5205|5203|5115|5204|5040|5179|5070|5182|5085|5181|3719|7173|5131|3911|5101|7175|7169|3713|5112|22187|9917|3859|3862|3878|3865|3856|3873|3877|3834|3742|3762|3740|3763|10245|3572|3573|3571|3885|7127|4225|12686|19985|19981|19984|19982|19983|19991|19989|19986|19987|19988|19994|19995|19992|19993|19990|19980|19977|19976|19978|7154|19979|43423|3861|3821" bchest as bitem
        if not timerexists bchestopen
            createtimer bchestopen
            overhead "The treasure is mine!" 2091
        endif
        hotkey 'Grab Item' 
        target bitem
        while queued
            //donothing
        endwhile
        if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
            break
        endif
    endwhile
    if varexist "bwiz" and find "bwiz" backpack and find "bmain" self
        if not targetexists and not casting and skill "Stealth" >= 80 and hidden and stam = maxstam
            while queued
                //donothing
            endwhile
            dclick "bwiz"
            while queued
                //donothing
            endwhile
            pause 30
            dclick "bmain"
            pause 500
            getlabel backpack ping
        endif
        if not targetexists and not casting and not findlayer self head and find "bmain" self
            while queued
                //donothing
            endwhile
            dclick "bmain"
            pause 500
            getlabel backpack ping
        endif
    endif
    if varexist "bwiz" and find "bmain" self
        if not targetexists and not casting and not find "bwiz" backpack
            while queued
                //donothing
            endwhile
            dclick "bmain"
            pause 500
            getlabel backpack ping
        endif
    endif
endif

if ingump "Shrines" 341416395
    if not timerexists "Wacp" and skill "Magery" >= 50
        gumpclose 341416395
        overhead "Wall of Stone ACP ------Enabled------" 2031
        createtimer "Wall"
        createtimer "Wacp"
        removetimer "Nacp"
        removetimer "Eacp"
        removetimer "Tacp"
        removetimer "Racp"
        removetimer "Elemental"
        removetimer "Tele"
        removetimer "None"
        removetimer "Reveal" 
    elseif not timerexists "Eacp" and skill "Spirit Speak" >= 80 and skill "Magery" >= 100
        gumpclose 341416395
        overhead "Earth Elemental ACP ------Enabled------" 1501
        createtimer "Elemental"
        createtimer "Eacp"
        removetimer "Nacp"
        removetimer "Tacp"
        removetimer "Racp"
        removetimer "Wall"
        removetimer "Tele"
        removetimer "None"
        removetimer "Reveal" 
    elseif not timerexists "Tacp" and skill "Magery" >= 50
        gumpclose 341416395
        overhead "Teleport + Rope ACP ------Enabled------" 1272
        createtimer "Tele"
        createtimer "Tacp"
        removetimer "Nacp"
        removetimer "Racp"
        removetimer "Wall"
        removetimer "Elemental"
        removetimer "None" 
        removetimer "Reveal"  
    elseif not timerexists "Racp" and skill "Magery" >= 80
        gumpclose 341416395
        overhead "Reveal Spellcast ACP ------Enabled------" 2040
        createtimer "Racp"
        createtimer "Reveal"
        removetimer "Nacp"
        removetimer "Wall"
        removetimer "Elemental"
        removetimer "Tele"  
        removetimer "None"    
    elseif not timerexists "Nacp"
        gumpclose 341416395
        overhead "Auto Chest Protection ------Disabled------" 38
        createtimer "Nacp"
        removetimer "Eacp"
        removetimer "Tacp"
        removetimer "Wacp"
        removetimer "Wall"
        removetimer "Elemental"
        removetimer "Tele"
        removetimer "Reveal" 
    endif
endif
if insysmsg "You have been revealed!" 
    if timerexists "Tele" and mana >= 9
        say "[Anger"
        cast 'Teleport'
        if findtype "rope" backpack as rope
            dclick rope
        else 
            overhead "I am out of rope..." 34
        endif
        removetimer "Tacp"
        removetimer "Tele"
        createtimer "Eacp"
        createtimer "Nacp"
        createtimer "Wacp"
        createtimer "Racp"
        dclicktype "atlas" backpack
    elseif timerexists "Wall" and mana >= 9
        say "[Anger"
        cast 'Wall of Stone'
        removetimer "Wacp"
        removetimer "Wall"
        createtimer "Eacp"
        createtimer "Nacp"
        createtimer "Tacp"
        createtimer "Racp"
        dclicktype "atlas" backpack
    elseif timerexists "Elemental" and mana >= 50
        say "[Anger"
        cast 'Earth Elemental'
        removetimer "Eacp"
        removetimer "Elemental"
        createtimer "Wacp"
        createtimer "Nacp"
        createtimer "Tacp"
        createtimer "Racp"
        dclicktype "atlas" backpack
    elseif timerexists "Reveal" and mana >= 20
        say "[Anger"
        cast 'Reveal'
        removetimer "Racp"
        removetimer "Reveal"
        createtimer "Wacp"
        createtimer "Nacp"
        createtimer "Tacp"
        createtimer "Eacp"
        dclicktype "atlas" backpack
    else
        say "[Anger"
    endif
    if timerexists frostshellswitch and not cooldown "Aspect"
        say "[AspectArmor Frost"
        getlabel backpack ping
        if insysmsg "Your armor is already of that aspect"
            //donothing
        else
            cooldown "Aspect" 30000
            overhead "--Frost Shell Primed--" 2234
        endif
        settimer frostshelltimer 0
    endif
endif

if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
    removetimer activaterecycle
    if varexist "bwiz" and find "bwiz" backpack and find "bmain" self
        if not targetexists and not casting and skill "Stealth" >= 80 and hidden and stam = maxstam
            while queued
                //donothing
            endwhile
            dclick "bwiz"
            while queued
                //donothing
            endwhile
            pause 30
            dclick "bmain"
            pause 500
            getlabel backpack ping
        endif
        if not targetexists and not casting and not findlayer self head and find "bmain" self
            while queued
                //donothing
            endwhile
            dclick "bmain"
            pause 500
            getlabel backpack ping
        endif
    endif
    if varexist "bwiz" and find "bmain" self
        if not targetexists and not casting and not find "bwiz" backpack
            while queued
                //donothing
            endwhile
            dclick "bmain"
            pause 500
            getlabel backpack ping
        endif
    endif
endif

if timer ACPcheck > 42000
    if timerexists "Tele"
        overhead "Teleport ACP active" 1272
    endif
    if timerexists "Wall"
        overhead "Wall ACP active" 2031
    endif
    if timerexists "Elemental"
        overhead "Elemental ACP active" 1501
    endif
    if timerexists "Reveal"
        overhead "Reveal ACP active" 2040
    endif
    settimer ACPcheck 0
endif

if not timerexists lootvacuumswitch
    if insysmsg "What do you want to use this item on?"
        hotkey "Cancel Current Target"
        createtimer lootvacuumswitch
        settimer lootvacuumswitch 15000
        overhead "--Loot Vacuum Enabled--" 2085
    endif
endif
if timerexists lootvacuumswitch
    if insysmsg "What do you want to use this item on?"
        hotkey "Cancel Current Target"
        removetimer lootvacuumswitch
        overhead "--Loot Vacuum Disabled--" 1779
    endif
endif
while diffweight <= 0 and findtype "gold coin" backpack as dropgold
    if not hidden and stam <= 4 and findtype "Red Potion" backpack as redpot
        while queued
            //donothing
        endwhile
        dclick redpot
    endif
    overhead "My cup runneth over..." 1194
    if findtype 4225 backpack 0 as garbleather
        drop backpack
        lift garbleather 59999
        drop 0
        while queued
            //donothing
        endwhile
    endif
    drop backpack
    lift dropgold 444
    drop 0
    while queued
        //donothing
    endwhile
    settimer lootvacuumswitch 0
endwhile
if timerexists lootvacuumswitch
    if timer lootvacuumswitch >= 9000
        if not timerexists lootsensetimer
            createtimer lootsensetimer
            settimer lootsensetimer 1000
        endif
        if timer lootsensetimer >= 1000
            for 18
                if findtype "3827" ground 0 as regularscroll
                    @ignore regularscroll
                endif
                if index > 0 and findtype "54230|apothecary wheel|entrail bucket|beastmaster's horn|bomb cluster|brace of knives|cross of compassion|divination orb|mirror of reflection|murder of crows|perilous python|prodigy fiddle|rose of fading beauty|scale of balance|screaming mandrake|statue of the siren|the final hour|tyromancer's cache|tyromancer's cheese|vile concoction|warning canary|widow's grief|54684|27612|49223|54591|54601|54718|5928|7408|19948|58325|19959|19822|49730|49729|19944|19949|47613|47612|47611|47610|47611|4112|3986|3966|cathedral tapestry|Darkscale tapestry|large painting|landscape painting|portrait painting|20291|44987|49730|47107|18653|45127|20103|47103|29363|47105|29361|43453|5899|47109|45250|41509|43447|18657|4025|51308|45156|51304|45214|28769|28799|28803|28765|45211|45248|51259|45220|51328|45218|3842|51327|45222|45241|51336|11858|51375|45282|54722|45255|45246|28795|44983|45235|45251|45238|51258|51314|28761|45236|51260|54718|18400|58325|45252|18656|47111|3839|45239|45242|45254|45281|45247|42241|45216|28775|2594|51321|3838|51318|5901|5905|45259|5903|48407|51302|4248|27611|15296|43166|5359|5981|4026|3985|25359|17686|3836|17087|5356|29030|24434|22336|29036|3843|29025|51098|29034|8826|51094|576|3827|22326|45315|3891|2539|39898|39896|39892|39918|39911|39916|39897|39905|39891|39917|39912|39909|39889|31047|31017|31049|31019|31055|31051|31053|31025|31027|31031|31041|54717|31021|31011|31023|31029|31043|31003|31035|31033|31045|31037|31002|20006|31169|31006|30999|31012|31009|30996|7109|7107|31128|31188|20014|31014|31004|31142|31001|31000|37181|31010|30998|31172|30988|30997|31038|31141|7947|20008|31005|31191|31008|31007|30994|30993|31182|30989|20012|31186|31178|31015|30991|20010|20016|31184|31190|30990|30995|31176|31180|30992|31130|5207|7031|7026|7034|7033|7027|7035|7029|5078|5063|5059|5105|5060|5138|5129|5201|5142|5143|5076|5106|7610|5139|5090|5103|5132|7177|5061|7181|7179|3920|5042|5127|5117|5185|5125|3938|5177|3937|5044|5121|3915|3909|3568|3932|5123|5144|5119|5056|5135|5187|5074|5089|3934|3913|3917|3721|5075|5046|5049|7170|5146|5205|5203|5115|5204|5040|5179|5070|5182|5085|5181|3719|7173|5131|3911|5101|7175|7169|3713|5112|22187|9917|3859|3862|3878|3865|3856|3873|3877|3834|3742|3762|3740|3763|10245|3572|3573|3571|3885|7127|4225|12686|19985|19981|19984|19982|19983|19991|19989|19986|19987|19988|19994|19995|19992|19993|19990|19980|19977|19976|19978|7154|19979|43423|3861|3821" ground -1 -1 index as lootlocation
                    overhead "*loot*" 2091 lootlocation
                    @ignore lootlocation
                endif
            endfor
            @clearignore 
            settimer lootsensetimer 0
        endif
        if findtype "3827" ground 0 as regularscroll
            @ignore regularscroll
        endif
        while not casting and not targetexists and findtype "54230|apothecary wheel|entrail bucket|beastmaster's horn|bomb cluster|brace of knives|cross of compassion|divination orb|mirror of reflection|murder of crows|perilous python|prodigy fiddle|rose of fading beauty|scale of balance|screaming mandrake|statue of the siren|the final hour|tyromancer's cache|tyromancer's cheese|vile concoction|warning canary|widow's grief|54684|27612|49223|54591|54601|54718|5928|7408|19948|58325|19959|19822|49730|49729|19944|19949|47613|47612|47611|47610|47611|4112|3986|3966|cathedral tapestry|Darkscale tapestry|large painting|landscape painting|portrait painting|20291|44987|49730|47107|18653|45127|20103|47103|29363|47105|29361|43453|5899|47109|45250|41509|43447|18657|4025|51308|45156|51304|45214|28769|28799|28803|28765|45211|45248|51259|45220|51328|45218|3842|51327|45222|45241|51336|11858|51375|45282|54722|45255|45246|28795|44983|45235|45251|45238|51258|51314|28761|45236|51260|54718|18400|58325|45252|18656|47111|3839|45239|45242|45254|45281|45247|42241|45216|28775|2594|51321|3838|51318|5901|5905|45259|5903|48407|51302|4248|27611|15296|43166|5359|5981|4026|3985|25359|17686|3836|17087|5356|29030|24434|22336|29036|3843|29025|51098|29034|8826|51094|576|3827|22326|45315|3891|2539|39898|39896|39892|39918|39911|39916|39897|39905|39891|39917|39912|39909|39889|31047|31017|31049|31019|31055|31051|31053|31025|31027|31031|31041|54717|31021|31011|31023|31029|31043|31003|31035|31033|31045|31037|31002|20006|31169|31006|30999|31012|31009|30996|7109|7107|31128|31188|20014|31014|31004|31142|31001|31000|37181|31010|30998|31172|30988|30997|31038|31141|7947|20008|31005|31191|31008|31007|30994|30993|31182|30989|20012|31186|31178|31015|30991|20010|20016|31184|31190|30990|30995|31176|31180|30992|31130|5207|7031|7026|7034|7033|7027|7035|7029|5078|5063|5059|5105|5060|5138|5129|5201|5142|5143|5076|5106|7610|5139|5090|5103|5132|7177|5061|7181|7179|3920|5042|5127|5117|5185|5125|3938|5177|3937|5044|5121|3915|3909|3568|3932|5123|5144|5119|5056|5135|5187|5074|5089|3934|3913|3917|3721|5075|5046|5049|7170|5146|5205|5203|5115|5204|5040|5179|5070|5182|5085|5181|3719|7173|5131|3911|5101|7175|7169|3713|5112|22187|9917|3859|3862|3878|3865|3856|3873|3877|3834|3742|3762|3740|3763|10245|3572|3573|3571|3885|7127|4225|12686|19985|19981|19984|19982|19983|19991|19989|19986|19987|19988|19994|19995|19992|19993|19990|19980|19977|19976|19978|7154|19979|43423|3861|3821" ground -1 -1 2 as eatloot
            hotkey 'Grab Item' 
            target eatloot
            while queued
                //donothing
            endwhile 
        endwhile
    endif
endif
if not timerexists skinnerswitch
    if insysmsg "What corpse or location do you wish to carve?"
        hotkey "Cancel Current Target"
        createtimer skinnerswitch
        overhead "--Skinner Mode Enabled--" 2085
    endif
endif

if timerexists skinnerswitch
    if insysmsg "What corpse or location do you wish to carve?"
        hotkey "Cancel Current Target"
        removetimer skinnerswitch
        overhead "--Skinner Mode Disabled--" 1779
    endif
endif
if not hidden and not casting and findtype "Elven Spellblade" backpack
    if not warmode and timerexists skinnerswitch
        if not timerexists corpsetimer
            createtimer corpsetimer
            settimer corpsetimer 2000
        endif
        if timer corpsetimer >= 2000
            for 18
                if index > 0 and findtype "corpse" ground -1 -1 index as corpselocation
                    overhead "corpse" 76 corpselocation
                    @ignore corpselocation
                endif
            endfor
            @clearignore 
            settimer corpsetimer 0
        endif
        if not find "bknife" backpack and findtype "Elven Spellblade" backpack as newknife
            @setvar "bknife" newknife
        endif
        while findtype "corpse" ground -1 -1 2 as bcorpse
            getlabel bcorpse desc
            if "the remains of" in desc
                overhead "avatar corpse" 45 bcorpse
                @ignore bcorpse
            else 
                while queued
                    //do nothing
                endwhile
                dclick "bknife"
                wft 500
                target bcorpse
                getlabel backpack ping
                pause 500
                if insysmsg "You carve materials from the corpse"
                    overhead "*fresh cut*" 2085 bcorpse
                    @ignore bcorpse
                elseif insysmsg "That corpse has already been carved"
                    overhead "*carved*" 1779 bcorpse
                    @ignore bcorpse
                endif
            endif
        endwhile
        clearsysmsg 
    endif
endif
if insysmsg "What should I use these scissors on?" and findtype "sewing kit|saw|pen and ink|tongs|tool kit" backpack as breakdowntool
    hotkey "Cancel Current Target"
    if findtype 20496 backpack as IDwand
        clearsysmsg 
        if findtype 3834 backpack 0 as bbook
            @ignore bbook
        endif
        while findtype 5056|5059|5060|5061|5063|5070|5074|5075|5076|5078|5085|5089|5090|5101|5103|5105|5106|5129|5131|5132|5135|5138|5139|5142|5143|5144|5146|5201|5203|5204|5205|5207|7169|7170|7173|7175|7177|7179|7181|7610|7947|31003|31004|31005|31006|31007|31008|31009|31010|31011|31012|31015|31191|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31043|31045|31047|31049|31051|31053|31055|3834|3740|3742|3762|3763|10245|20006|20008|20010|20012|20014|20016|7026|7027|7029|7031|7033|7034|7035|7107|7109|31002|31130|3920|5042|5117|30990|30993|30994|30995|31184|31186|3719|3938|5121|5123|5125|30989|30992|30996|30997|30998|31176|31188|3568|3713|3721|3932|5040|5044|5112|5127|5177|5179|5181|30991|30999|31000|31001|31014|31178|31180|31182|3909|3911|3913|3915|3917|3934|3937|5046|5049|5115|5119|5182|5185|5187|30988|31128|31190|22187|31141|31142|31169|31172 backpack as IDitem
            getlabel IDitem desc
            if "unidentified" in desc
                while queued
                    //donothing
                endwhile
                dclick IDwand
                wft 1000
                target IDitem
                waitforsysmsg "You identify the item." 1000
                getlabel IDitem desc
                if "aspect" in desc or "training" in desc or "vanquishing" in desc or "supremely" in desc or "slaying" in desc or "enticement" in desc or "invulnerability" in desc or "power" in desc or "exceedingly accurate force" in desc or "exceedingly potent" in desc or "valorite" in desc or "avarite" in desc or "verite" in desc or "agapite" in desc or "fortification" in desc
                    @ignore IDitem
                    overhead "This one is worth keeping..." 2091
                    overhead "*strong magic*" 2091 IDitem
                    say "[surprise" 2091
                elseif "durable" in desc or "substantial" in desc or "massive" in desc or "fortified" in desc or "indestructible" in desc or "exceptional" in desc or "accurate" in desc or "surpassingly" in desc or "eminently" in desc or "exceedingly" in desc or "ruin" in desc or "might" in desc or "force" in desc or "power" in desc or "mastercrafted" in desc or "defense" in desc or "guarding" in desc or "hardening" in desc or "potent" in desc or "melodious" in desc
                    overhead "*trash*" 1779 IDitem
                    while not gumpexists 949095101
                        while queued
                            //donothing
                        endwhile
                        dclick breakdowntool
                        waitforgump 949095101 1000
                    endwhile
                    while not ingump "Recycle Single Item" 949095101
                        gumpresponse 2
                        waitforgump 949095101 1000
                    endwhile                                
                    gumpresponse 3
                    waitforgump 949095101 1000
                    target IDitem
                    getlabel backpack ping
                    pause 300
                    gumpclose 949095101
                else
                    @ignore IDitem
                endif
            elseif "aspect" in desc or "training" in desc or "vanquishing" in desc or "supremely" in desc or "slaying" in desc or "enticement" in desc or "invulnerability" in desc or "power" in desc or "exceedingly accurate force" in desc or "exceedingly potent" in desc or "valorite" in desc or "avarite" in desc or "verite" in desc or "agapite" in desc or "fortification" in desc
                @ignore IDitem
            elseif "durable" in desc or "substantial" in desc or "massive" in desc or "fortified" in desc or "indestructible" in desc or "exceptional" in desc or "accurate" in desc or "surpassingly" in desc or "eminently" in desc or "exceedingly" in desc or "ruin" in desc or "might" in desc or "force" in desc or "power" in desc or "mastercrafted" in desc or "defense" in desc or "guarding" in desc or "hardening" in desc or "potent" in desc or "melodious" in desc
                overhead "*trash*" 1779 IDitem
                while not gumpexists 949095101
                    while queued
                        //donothing
                    endwhile
                    dclick breakdowntool
                    waitforgump 949095101 1000
                endwhile
                while not ingump "Recycle Single Item" 949095101
                    gumpresponse 2
                    waitforgump 949095101 1000
                endwhile                                
                gumpresponse 3
                waitforgump 949095101 1000
                target IDitem
                getlabel backpack ping
                pause 300
                gumpclose 949095101
            else
                @ignore IDitem
            endif
            if not findtype 20496 backpack
                break
            endif
        endwhile
        if gumpexists 949095101
            gumpclose 949095101
        endif
    endif
    if targetexists 
        hotkey "Cancel Current Target"
    endif
endif
if dead     
    overhead "I need a new body..." 88
    stop
endif
loop