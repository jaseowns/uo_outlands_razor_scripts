# This is an automated backup - check out https://outlands.uorazorscripts.com/script/47716944-772c-422f-b3db-034d9a88ae76 for latest
# Automation by Jaseowns
## Script: Lord Glacier's Chill ARCANE MAGE AUTO PILOT - UO OUTLANDS RAZOR SCRIPT - v1.1.4
## Created by: danstock._98439#0
#############################################

/////////
////////                                          Lord Glaciers Chill ARCANE MAGE AUTO PILOT - UO OUTLANDS RAZOR SCRIPT version 1.1.4
///////
//////                                                  UO Outlands Razor script - Released May 16, 2025 - Last updated November 26, 2025
/////                                                     Compiled by DanStock. (aka. Lord Glacier)
////
///



                                                                             ################################
                                                                            //      QUICK MODE CHANGE:      \\
                                                                           ####################################

                                                                               @setvar! DUNGEONMODE 1
                                                                               @setvar! WILDERNESSMODE 0
  
                                                                               # DUNGEON = Auto FIND GATE
                                                                               # WILDERNESS = Auto RECALL

                                                                           ####################################
                                                                            ##################################





                                                   ###############################                     ###############################
                                                  //  SUGGESTED SKILL TEMPLATE:  \\                   //      INVENTORY ITEMS:       \\
                                                 ###################################                 ###################################

                                                     #     120  Necromancy                               Book of Necromancy
                                                     #     120  Cooking                                  Wizards Grimoire
                                                     #     100  Eval Intelligence                        Parrying Codex
                                                     #     100  Magery                                   Arcane Codex
                                                     #     100  Arcane                                   Arcane Staff
                                                     #     100  Wrestling                                Potion Satchel (w/ potions)
                                                     #      80  Parrying                                 Wizard Satchel (w/ regs)
                                                     #                                                   Magic Mushrooms
                                                     #  ASPECT: ARCANE weapon                            Delectable food trays
                                                     #          ARCANE armour                            Trapped pouches
                                                     #                                                   Adventurers rope
                                                     #       or ELDRITCH armour                          Scissors [blessed] *
                                                     #       or VOID armour                              Wooden Box w/ copper key *
                                                     #       or BLOOD armour                             Platemail armour
                                                     #       or FROST armour                             Arcane aspect crystals

                                                 ##################################                  ##################################
                                                  ################################                    ################################
                                                   ##############################                      ##############################



                               
    ///////////////////////
    //    CHANGE LOG:    //
    ///////////////////////

#       Nov 26 2025 - version 1.1.4:  Fixed small bugs in Auto PK Dungeon Gating and Auto Recall After Resurrection sections
#       Nov 21 2025 - version 1.1.3:  Big update! Overhauled entire script to include my latest upgrades and tweaks. Default is now WAR mode for COMBAT and PEACE mode for ESCAPE/RECALL
#       Nov 16 2025 - version 1.1.2:  Squashed bugs in Flamestrike, Potion Keg and Necromancy parts of script.  Sorry it took so long (have not played my Arcane Mage echo in a while)
#       Jun 06 2025 - version 1.1.1:  Updated overhead messages for various potions and abilities and tweaked the order of a few things
#       Jun 05 2025 - version 1.1.0:  Added support for using potion kegs for auto filling potions
#       Jun 04 2025 - version 1.0.9:  Added new variable and option for Snacking during Healing Loop and added reagent checks for casting heals
#       Jun 02 2025 - version 1.0.8:  Various minor tweaks and adjustments to timing and orders of operation
#       May 30 2025 - version 1.0.7:  Added Telekenisis to AutoExplosionPotion loop
#       May 29 2025 - version 1.0.6:  Adjusted targeting loop and various no target tweaks based on player testing
#       May 26 2025 - version 1.0.5:  Added separate variable for 'EnableAutoRecallMessages' to control overhead messages during auto recall 
#       May 23 2025 - version 1.0.4:  Timing and efficiency updates along with additional tips and comments added
#       May 21 2025 - version 1.0.3:  Added option for using DIY auto recall Razor scripts and added Frost Shell cooldown triggers
#       May 20 2025 - version 1.0.2:  Fixed typo in Gold Drop section and updated logic and cooldown triggers for Weapon Abilities
#       May 18 2025 - version 1.0.1:  Added optional cooldown trigger for Mana Thief proc
#       May 16 2025 - version 1.0.0:  Public script release!



    /////////////////
    //    TIPS:    //
    /////////////////

    //    Disclaimer:  I AM NOT AN EXPERT!  I have only played Outlands for a little under 2 years now (with 90% of the first year spent harvesting - main PVM account is only at 15 links) 
    //    This is also the first and only MMO I have played since I last logged out of my OSI accounts on Great Lakes shard back in 2003.  
    //    So take any of my advice with that in mind - I am still a noob.  If you have 30+ links and millions of gold, there is probably a better way to do things, but this works for me at my stage!
    //    I have zero prior experience scripting and I have made these primarily for my own benefit!!  I am learning as I go...
    //    Mostly, I make these scripts in order to play on my Asus ROG Ally handheld - but I have come to enjoy the challenge of making them work for as many builds as possible.
    //    I do not really use Discord (I only installed it to join Outlands - then discovered I had an older account already).  Lots of people message me there, but I rarely check it (sorry).
    //    That being said, I do my best to fix reported bugs (dan@danstockman.com) but usually do not have time to respond to requests for custom stuff (but appreciate any ideas, for sure!)
    //    Since I do not personally use all aspects of the script (and do all my editing in Notepad on my PC at work lol) some bugs take longer for me to find - but I am always adjusting and updating!  Thanks for being patient!
    //    If you see me out in Avadon, my apologies if I dont respond (its a pain to type on the ROG Ally), but to do enjoy hearing that people use my scripts.  Appreciate the support!  GOOD LUCK OUT THERE :)


#         IMPT: FIRST RUN OF SCRIPT SHOULD BE DONE IN HOUSE/INN ROOM AND TAKES ROUGHLY 15 SECONDS TO COMPLETE INITIAL (ONE TIME) SETUP!
#             Initial setup can be redone by setting 'ResetScriptPermanentVariables' variable to '1' below!
#         Or you can re-target script variables individually in the 'Options' tab above the script
#
#     Use the skill template above along with ARCANE ASPECT WEAPON and ARCANE CODEX (LEECH stance, DRAIN finsher and LEYLINE ability for maximum MANA generation)
#     Aspect armour can be ARCANE, ELDRITCH, BLOOD, FROST or your choice - I used ARCANE until it was level 10 and then switched to FROST for the protection (and I am Glacier lol)
#     Recommend use of MELEE ASPECT CHANCE chain links to increase MANA THIEF proc chance on ARCANE ASPECT weapon (and then DAMAGE TO DISEASED chain links, etc.)
#     Eating delectable FOOD (w/ cooking skill) will restore HP and MANA (w/ 60 second cooldown) 
#     Eating MUSHROOMS with the Wizards Grimoire will also restore MANA (60-180 second cooldown)
#     Once ARCANE CODEX and ARCANE ASPECT WEAPON are sufficiently levelled PLATEMAIL ARMOUR can be used and no meditation skills will be necessary
#     Recommend prioritizing CREATE FOOD and (at first) MANA DRAIN spells in WIZARDS GRIMOIRE before moving on to other spells (ie. FLAMESTRIKE, XPLOS, EBLOT, etc.)
#     Use www.outlandsbutler.com (or 'PLAYER STATS' page) to make sure you are hitting your MANA REFUND CAP (early build may require use of MANA DRAIN spell) 
#     Recommend PARRY CODEX stances of BULWARK or SHIELD BASH w/ LAST STAND finisher - auto switching options are available based on war mode and buff status
#     Script displays lots of OVERHEAD MESSAGES by default - these can be disabled in the variable section (minimal target indicators remain - it is my preferred mode!)
#     Recommend using Razor TEXT FILTERS to cancel redundant system messages and Razor spam
#     Script has optional COOLDOWNS you can add (see list below) but they are NOT required for script function - just handy to display on bars in your U.I.
#     Script uses ORGANIZER AGENT-01 for optional MAIN INVENTORY pouch organization (can be set to auto select your main bag in inventory reset below)
#     If enabled AUTO RECALL triggers when RED is within target range (~12 tiles) or when WEIGHT LIMIT is reached in WILDERNESSMODE (optional DIY script usage, as well)
#     If enabled and RED is targeted (~12 tiles) in DUNGEONMODE (or WEIGHT LIMIT reached) script will use DUNGEON ESCAPE mode to locate and activate MOONGATES while keeping you alive
#     If enabled POTIONS will be automatically consumed as needed and MANUAL POTION USE MAY DISRUPT SCRIPT TIMING (turn off script potions if manual hotkey is preferred)
#     If enabled LOOT CHEST in your HOME/INN/BANK is used store goods, script uses ORGANIZER AGENTS 06-09 as sub-containers you can set inside the chest to organize items further
#     If enabled and WOODEN BOX and COPPER KEY found in inventory, script will automactially store and lock any looted items when not in combat (ignores Arcane Staves to prevent losing weapon)
#     Script allows for manual selection of CODEX STANCES in the variable section below (or you can enable AUTOMATIC STANCE SWITCHING instead)
#     If AUTO ARCANE CODEX stance switching is enabled:  WAR = LEECH/DRAIN  PEACE = SURGE/DRAIN  poisoned/bleeding/diseased/lowhp = SHIELD/CATALYST
#     If AUTO PARRY CODEX stance switching is enabled:   WAR = SHIELD BASH/LAST STAND  PEACE = BULWARK/LAST STAND  poisoned/bleeding/diseased/lowhp = WARDING/BARRIER
#     If you die the DEATH LOOP will auto select moongates and travel to last gated town and then waits to auto-select the resurrection gump when a HEALER is located
#     If enabled a DRESS LIST of your [blessed] wearables will be equipped after resurrection (must be named 'UltimateArcaneMage')
#     If enabled after resurrection script can recall home (requires scrolls in [blessed] runebook), resupply, heal, activate aspect and even setup your pack with pouch stacks, etc.
#     If enabled INVENTORY RESET will stack trapped pouches on your main inventory pouch (after putting scissors inside to protect them from shelf restocking) and then hide the stack
#     MANY FEATURES ARE TURNED 'OFF' BY DEFAULT!  MAKE SURE TO CHECK THE VARIABLE SECTION BELOW CLOSELY PRIOR TO FIRST USE!!
#     This script is a compilation of many existing scripts married to my own new stuff, but big thanks to user dennozz for many features I learned from studying their scripts!


#     I believe everything is FINALLY working as intended.  Hopefully build version 1.1.4 is the final product, but always check back for new updates!!
#     I am pretty stoked with where the script is as of Nov 2025. It has come a loooong way and, at least for my own purposes, is 100% functional.
#     Let me know if you find any mistakes that I missed (dan@danstockman.com) or if there is anything that needs to be added.  Good luck and thanks for your support.



                           #############################################################################################################################
                           #                                                                                                                           #
                           #                                            //////////////////////////////                                                 #
                           #                                            //    RESET SCRIPT HERE:    //                                                 #
                           #                                            //////////////////////////////                                                 #
                           #                                                                                                                           #
                           #                      SET THIS VALUE TO '1' AND RUN SCRIPT TO UNSET ALL PERMANENT SCRIPT VARIABLES:                        #
                           #                                                                                                                           #
                                                                   @setvar! ResetScriptPermanentVariables 0
                           #                                                                                                                           #
                           #                    THEN RETURN 'ResetScriptPermanentVariables' TO '0' TO RESTART INITIAL SETUP...                         #
                           #                (Or you can re-target script variables individually in the 'Options' tab above the script!)                #
                           #                                                                                                                           #
                           #                                                                                                                           #
                           #############################################################################################################################



     ###################################################
    ###    OPTIONAL COOLDOWNS TO ADD IN UO CLIENT:    ###
    ###               (case sensitive!)               ###
     ###################################################

#         Mana Thief
#         Mushroom
#         Snacking
#         Healing Potion
#         Purple Potion
#         Seeking Active
#         Leyline Active
#         Weapon Ability
#         Corpse Skin
#         Evil Omen
#         Mind Rot
#         Pain Spike
#         Strangle
#         Frost Shell Cooldown
#         Frost Shell Active




                    ###########################################################################################################################
                    #  MOST FEATURES ARE TURNED 'OFF' BY DEFAULT! PLEASE CHECK THE 'VARIABLES' SECTION BELOW CAREFULLY DURING INITIAL SETUP!  #
                    ###########################################################################################################################




     ###############################
    ###      USER VARIABLES:      ###
     ###############################

//////////////////////////
//      OFFENSIVE:      //
//////////////////////////

@setvar! EnableCastCurse 0
@setvar! EnableCastManaDrain 0

@setvar! EnableCastFlamestrike 1
@setvar! EnableCastEnergyBolt 1
@setvar! EnableCastExplosion 1
@setvar! EnableCastMindblast 0

@setvar! EnableCastMagicArrow 0
    @setvar! MagicArrowCooldown 60000

@setvar! EnableCastHarm 0
    @setvar! HarmCooldown 60000

@setvar! EnableCastFireball 0
    @setvar! FireballCooldown 60000

@setvar! EnableCastLightning 0
    @setvar! LightningCooldown 60000


//////////////////////////
//      DEFENSIVE:      //
//////////////////////////

@setvar! EnableWeaponCheck 1
    # Checks hand for Arcane Staff and will equip if missing
    # Prioritizes aspect weapon and ignores unidentified magic items

@setvar! EnableAutoTaunting 0
    # Requires 80+ Parrying skill and will automatically taunt (increases your AR against target)

@setvar! EnableAutoParalyzePouch 0
    # Will automatically pop trapped pouches if paralyzed (will also trigger auto recall/gating, if enabled)

@setvar! EnableCastHeal 1
@setvar! EnableCastGreaterHeal 1
@setvar! EnableCastCure 1

    @setvar! ActivateAutoHealHPdiff 50
        @setvar! CastGreaterHealHPdiff 50
        @setvar! CastHealHPdiff 70
        @setvar! CastEmergencyHealHPdiff 90

@setvar! EnableEatSnackstoHeal 0
    @setvar! EatSnacktoHealHPdiff 70

@setvar! MiniumManaToApplyBuffs 40
    @setvar! EnableMagicReflection 0
    @setvar! EnableBless 0
    @setvar! EnableReactiveArmour 0
    @setvar! EnableProtection 0

@setvar! LowManaWarningAmount 10
    # Overhead Low Mana warning (independant of other overhead message settings) 

@setvar! EnableFrostAspect 0
    @setvar! FrostAspectTier 0
        # Set your Frost Aspect level (if using Frost Aspect)
        # This will automatically set your optional Frost Shell Cooldown length
        # Frost Shell cooldown can trigger stance switches (if using auto switching below)


//////////////////////////
//       POTIONS:       //
//////////////////////////

@setvar! EnableAutoExplosionPots 0
    # Uses 'Telekenisis' spell to make MOBs sticky first (if Alchemy skill < 80)


@setvar! EnableHealPotion 1
@setvar! EnableCurePotion 1
@setvar! EnableRefreshPotion 0

    @setvar! HealPotionHPdiff 30
    @setvar! RefreshPotionSPdiff 10
        # Adjust HP diff set points for Heal and Refresh potion 
        # Cure pots will be used as needed (if enabled)


    @setvar! EnableStrengthPotion 0
    @setvar! EnableAgilityPotion 0
    @setvar! EnableMagicResistPotion 0
        # Strength, Agility and Resist potions will auto-buff when effects wear off (if enabled) *
        //    * If Alchemy skill is greater than 0.0 but less than or equal to 1.0 the script will take your next STRENGTH potion BEFORE the effect wears off!
        //      For example, with an Alchemy skill of 1.0 your buff duration will be 2m 05s and a new strength potion is available after 2 mins
        //      Taking your next potion during the extra 5 second buffer will keep your HP at 120 (instead of a temporary drop and HP of 100/120)


    if skill 'Alchemy' >= 80
        @setvar! HealingPotionCooldown 7000
    else
        @setvar! HealingPotionCooldown 10000
    endif
    # This only affects your optional cooldown bars (script uses other checks to verify heal pots are available)


@setvar! EnableUsePotionKegs 0
    # Will auto fill empty bottles from potion kegs if counts drop below set amount

    if EnableUsePotionKegs = 1
        @setvar! HealingPotionAmount 5
        @setvar! CurePotionAmount 5
        @setvar! RefreshPotionAmount 5
        @setvar! StrengthPotionAmount 1
        @setvar! AgilityPotionAmount 1
        @setvar! ResistPotionAmount 1
        @setvar! ExplosionPotionAmount 5
    endif

@setvar! EnableManaSnacking 0
    @setvar! EatSnackManadiff 50
    @setvar! EatSnackCooldown 60000
    
@setvar! EnableEatMagicMushrooms 0
    @setvar! EatMushroomManadiff 30
    @setvar! MagicMushroomCooldown 180000

@setvar! EnableMagicMushroomMaker 0
    @setvar! MakeMushroomAmount 5
        # Will automatically make mushrooms when you run out (to set amount)


/////////////////////////
//     NECROMANCY:     //
/////////////////////////

@setvar! MinimumManaAmounttoNecroBuff 10
    @setvar! EnableNecroCorpseSkin 0
    @setvar! EnableNecroMindRot 0
    @setvar! EnableNecroEvilOmen 0
    @setvar! EnableNecroStrangle 0

    @setvar! EnableNecroPainSpike 0
        @setvar! PainSpikeAttackDelay 6000
            # Adjust delay after acquiring a new target before attempting Pain Spike (to accumulate damage) 


/////////////////////////
//    ARCANE CODEX:    //
/////////////////////////

@setvar! EnableArcaneCodexHotbar 0
@setvar! EnableArcaneCodexAbilityHotbar 0

@setvar! EnableArcaneCodexStances 0
    # '0' for 'Disabled'
    # '1' for 'Leech Stance'
    # '2' for 'Shield Stance'
    # '3' for 'Scatter Stance'
    # '4' for 'Fracture Stance'
    # '5' for 'Surge Stance'
    # '6' for 'Auto Arcane Stance Switching'
        // Auto: PEACE = 'Leech Stance'  WAR = 'Surge Stance'  BLEED/POISON/LOWHP = 'Shield Stance'

@setvar! EnableArcaneCodexFinisher 0
    # '0' for 'Disabled'
    # '1' for 'Drain Finisher'
    # '2' for 'Catalyst Finisher'
    # '3' for 'Auto Arcane Finisher Switching'
        // Auto:  PEACE/WAR = 'Drain Finisher'  BLEED/POISON/LOWHP = 'Catalyst Finisher'

if EnableArcaneCodexStances = 6 or EnableArcaneCodexFinisher = 3
    @setvar! SwitchArcaneCodexManaMinimum 20
    @setvar! SwitchArcaneCodexCooldown 5000
endif 

@setvar! UseArcaneWeaponAbilityManadiff 25
    @setvar! EnableArcaneWeaponAbility 0
        # '0' for 'Disabled'
        # '1' for 'Seeking Ability'
        # '2' for 'Leyline Ability'
        # '3' for 'Soulfire Ability'


/////////////////////////
//    SHIELD CODEX:    //
/////////////////////////

@setvar! EnableShieldCodexHotbar 0

@setvar! EnableShieldCodexStances 0
    # '0' for 'Disabled'
    # '1' for 'Shield Bash Stance'
    # '2' for 'Warding Stance'
    # '3' for 'Testudo Stance'
    # '4' for 'Mirror Stance'
    # '5' for 'Bulwark Stance'
    # '6' for 'Auto Shield Stance Switching'
        // Auto:  PEACE = 'Shield Bash Stance'  WAR = 'Bulwark Stance'  BLEED/POISON/LOWHP = 'Warding Stance'

@setvar! EnableShieldCodexFinisher 0
    # '0' for 'Disabled'
    # '1' for 'Last Stand Finisher'
    # '2' for 'Barrier Finisher'
    # '3' for 'Auto Shield Finisher Switching'
        // Auto: PEACE/WAR = 'Last Stand Finisher'  BLEED/POISON/LOWHP = 'Barrier Finisher'

if EnableShieldCodexStances = 6 or EnableShieldCodexFinisher = 3
    @setvar! SwitchShieldCodexManaMinimum 20
    @setvar! SwitchShieldCodexCooldown 5000  
endif 


//////////////////////////
//       UTILITY:       //
//////////////////////////

@setvar! EnableOverheadMessages 1
    # Overhead messages can be turned off (minimal target indicators will remain)

@setvar! EnableAutoCarving 0
    # Requires skinning knife and will automatically carve nearby corpses

@setvar! EnableAutoSatchels 0
    # Will automatically move potions and/or reagents in backpack to satchels

@setvar! EnableGoldVacuum 0
    # Will automatically pickup discarded gold nearby

@setvar! EnableDungeonCleanup 0
    # Will automatically pickup discarded resources nearby (regs, ingots, boards, etc.)
    
@setvar! EnableDropGoldWhenOverweight 0
@setvar! DropGoldAmount 250
    # Will drop set amount of gold when overweight until no longer impeded 

@setvar! EnableLootBag 0
    # Will open your selected LOOTBAG when unloading at HOME/INN/BANK
    # This should be the bag that is set as your 'Grab Bag' in Gridloot, etc.

@setvar! EnablePutLootinLockBox 0
    # Must have WOODEN BOX and COPPER KEY and loot will be automatically secured while FARMING

@setvar! EnableWeightWarningMessage 0
    @setvar! GreenWarningDiffWeight 50
    @setvar! YellowWarningDiffWeight 25
    @setvar! RedWeightLimitDiffWeight 10
        # Weight limit will trigger AUTO RECALL or AUTO DUNGEON GATE if enabled below (otherwise just an overhead message)


/////////////////////////
//  AUTO RECALL/GATE:  //
/////////////////////////

    ##########################
    #      PK TRIGGERS:      #
    ##########################

    //  RED RECALL/ESCAPE (w/ TRACKING SKILL):  //
        
        if skill 'Tracking' >= 50

            @setvar! EnableTrackingAutoRecall 1
                # Make sure "Ignore Houses/Ships" is checked in the Tracking skill menu!

                @setvar! PKTrackingRange 50
                    # Range can be 40, 50 or 60 tiles (or 0 will trigger Auto Recall regardless of range)

                @setvar! EnableRedAlertOverhead 1
                    # If your build has tracking skill, I highly recommend setting up a Razor overhead message instead of using the script one:
                        // This will display PK name/distance overhead when tracked!
                        // Add overhead message w/ a trigger of "Now tracking" and message "[ RED ALERT: {3} ]"  (hue 335)
                        // Then a second with a trigger of "Distance to destination" and message "[ {4} TILES AWAY! ]"  (hue 253)
                        // Once complete you should disable "EnableRedAlertOverhead" above

            if EnableTrackingAutoRecall = 1
                if WILDERNESSMODE = 1
                    # Auto Recall if PK comes into tracking range (wilderness only):
                        @setvar! EnableAutoRedRecall 1
                elseif DUNGEONMODE = 1
                    # Auto Dungeon Gate if PK comes into tracking range (dungeons only):
                        @setvar! EnableAutoRedDungeonGate 1
                            @setvar! DungeonEscapeTimeLimit 120000
                    # Script will revert to normal if time limit is exceeded without gating
                endif
            endif 
            

    //  RED RECALL/ESCAPE (w/ NO TRACKING SKILL):  //
        
        elseif skill 'Tracking' < 50

            @setvar! EnablePKradar 1
                # PK radar must be enabled for Auto Red Recall/Dungeon Gate to function (w/o Tracking Skill)

            @setvar! EnableRedAlertOverhead 1
                # Optional overhead message alert when PK is targeted

            if EnablePKradar = 1
                if WILDERNESSMODE = 1
                    # Auto Recall if PK comes into (~12 tile) target range (wilderness only):
                        @setvar! EnableAutoRedRecall 1
                elseif DUNGEONMODE = 1
                    # Auto Dungeon Gate if PK comes into target range (dungeons only):
                        @setvar! EnableAutoRedDungeonGate 1
                            @setvar! DungeonEscapeTimeLimit 120000
                    # Script will revert to normal if time limit is exceeded without gating
                endif
            endif 
        endif


    ############################
    #     WEIGHT TRIGGERS:     #
    ############################

        if WILDERNESSMODE = 1
            @setvar! EnableAutoWeightRecall 0
        elseif DUNGEONMODE = 1
            @setvar! EnableAutoWeightDungeonGate 0
            @setvar! EnableRecallAfterDungeonGate 0
        endif


    ############################
    #  RESURRECTION TRIGGERS:  #
    ############################

        @setvar! EnableRecallAfterResurrection 0
            # Must have [blessed] runebook charged w/ scrolls to recall after resurrection!

            

        #########################################################
        ####  YOU CAN TRIGGER YOUR OWN RAZOR RECALL SCRIPT:  ####
        #########################################################

        # Enable use of your own Razor script for Auto Recall (otherwise script will prompt for a Runebook and use built-in auto recall):
            @setvar! EnableDIYRecallScript 0
                

            //  Type the name of your own Home Recall Razor script here:
                    createlist DIYRecallScriptList
                    pushlist DIYRecallScriptList " YOUR RECALL SCRIPT NAME "


            ##########################################################
            ####  OR USE THE BUILT-IN AUTO RECALL/ESCAPE SCRIPT:  ####
            ##########################################################

                @setvar! EnableCastRecall 1
                    # '0' for 'Scrolls in charged Runebook to "first" rune'
                    # '1' for 'Cast Recall to Runebook using "default" rune'                  
                    
            //  AUTO RECALL DESTINATION (choose only one):
                    @setvar! BankRecall 0
                    @setvar! OwnerInnRecall 0
                    @setvar! CoOwnerInnRecall 0
                    @setvar! InsideHouseRecall 0
                    @setvar! OutsideHouseRecall 0

                    if OutsideHouseRecall = 1
                        @setvar! EnableCloseMyDoor 0
                        @setvar! MyDoor 0x0000000
                        # Use ">info" to ID your own house door (to quickly close it behind you)
                    endif

                    @setvar! HideAtHomeorInn 0
                        # Will use hiding skill once inside home or inn room


            //  LOADOUT RESET (after RECALL): 
                    #  Safe, Repair Bench, Resource Stockpile, Storage Shelf, Magic Recycler and/or Loot Chest must be found within 2 tiles!
                    #  Storage Tomes can be locked down (within 2 tiles) or located inside Loot Chest

                    @setvar! EnableAutoRecallOverheadMessages 1
                        # Controls overhead messages for recall section only

                        @setvar! EnableSafeDeposit 0
                            # Will deposit all gold and doubloons found in inventory
                        @setvar! EnableRepairBench 0
                            # Will repair all equipment (Repair Bench must have charges available)
                        @setvar! EnableResourceStockpile 0
                            # Will deposit all resources (ingots, boards, gems, etc.)
                        @setvar! EnableStorageShelf 0
                            # Will restock shelf and then resupply a fresh loadout
                        @setvar! EnableMagicRecycler 0
                            # Will add all unidentified magic items to your Recycler 
                            @setvar! EnableRecycleItemsWhenFull 0
                                # If Recycler is full, it will attempt to ID, Recycle and deposit resources (if stockpile nearby) before adding items
                        @setvar! EnableStorageTomes 0
                            # Will add items to any nearby storage tomes (skill scrolls, dyes, runes, maps, cards, etc)
                        @setvar! EnableReagentSplitter 0
                            # Will split reagents into smaller stacks after shelf resupply
                        @setvar! EnableLootChest 0
                            # Will open selected chest to store non-shelf/stockpile/tome items in your HOME/INN/BANK (uses Razor organizer agents 06-09)


            //  LOADOUT RESET (after DEATH): 
                    # This variable will dress you and reorganize your backpack after death (see instructions below)
                    # Your pack will be setup with anti-theft measures and all aspects will be reactivated, etc. 

                    @setvar! EnableDressAfterResurrection 0
                        # Must have a Razor 'Dress List' named 'UltimateArcaneMage' for all your [blessed] wearables

                    @setvar! EnableResetInventoryAfterDeath 0
                    @setvar! EnableSetMainPouchOrganizer01 0
                        //  Requires an equal amount of TRAPPED POUCHES (in shelf loadout) and SCISSORS [blessed] (in backpack)
                        //  Loadout also requires 1 UNTRAPPED POUCH (for main inventory - optionally set as Organizer Agent-01 above) and 1 BAG (for loot, etc.)
                        //  Script will put scissors in each trapped pouch (to keep them from being grabbed during future shelf loading)
                        //  Script then STACKS any trapped pouches on top of your main inventory pouch
                        //  Loot bag will be moved into main inventory pouch and automatically set as your Grab Bag for Gridloot, etc.
                        //  Script will then hide the stack underneath an ATLAS and put a DECOY TRAPPED POUCH out in the open
                        //  ASPECT WEAPON and ARMOR will be re-activated automatically and HP restored to MAX
                        //  Loadout reset finishes by opening backpack, main pouch, loot bag and any satchels


/////////////////////////
//    SCRIPT MODES:    //
/////////////////////////

    // I use this variable to setup multiple "modes" with different hotkeys.
        # Copy and paste to new script and update variables for different setups (Dungeon, Wilderness, SYG, etc.)
        # Just change the NUMBERS (ie. 'if ScriptMode = 2'/'@setvar! ScriptMode 2') and overhead message (ie.'overhead "[ WILDERNESS MODE ]" 1182') for each version 
        # Script will only display overhead mode message when switching between modes or upon first run of a new client login
        # I use a ROG Ally and set each hotkey to a different button (A, B, X, Y) and have multiple script modes at the ready!

        if DUNGEONMODE = 1
            if ScriptMode = 1
                // Do nothing
            else
                overhead "[ DUNGEON MODE ]" 2338
                @setvar! ScriptMode 1
                hotkey 'Toggle War Only'
            endif
        elseif WILDERNESSMODE = 1
            if ScriptMode = 2
                // Do nothing
            else
                overhead "[ WILDERNESS MODE ]" 1182
                @setvar! ScriptMode 2
                hotkey 'Toggle War Only' 
            endif
        endif 


////////////////////////
//  MOB IGNORE LIST:  //
////////////////////////

removelist animalsIgnoreList
createlist animalsIgnoreList
pushlist animalsIgnoreList "a plover"
pushlist animalsIgnoreList "a sheep"
pushlist animalsIgnoreList "a frenzied ostard"
pushlist animalsIgnoreList "a tundra ostard"
pushlist animalsIgnoreList "a desert ostard"
pushlist animalsIgnoreList "a forest ostard"
pushlist animalsIgnoreList "a finch"
pushlist animalsIgnoreList "a sparrow"
pushlist animalsIgnoreList "a towhee"
pushlist animalsIgnoreList "a lapwing"
pushlist animalsIgnoreList "a silverback"
pushlist animalsIgnoreList "a giant frog"
pushlist animalsIgnoreList "a crow"
pushlist animalsIgnoreList "a woodpecker"
pushlist animalsIgnoreList "a horse"
pushlist animalsIgnoreList "a swift"
pushlist animalsIgnoreList "a skylark"
pushlist animalsIgnoreList "a corpser"
pushlist animalsIgnoreList "a hawk"
pushlist animalsIgnoreList "a chickadee"
pushlist animalsIgnoreList "a cat"
pushlist animalsIgnoreList "a dog"
pushlist animalsIgnoreList "a black bear"
pushlist animalsIgnoreList "a brown bear"
pushlist animalsIgnoreList "a grizzly bear"
pushlist animalsIgnoreList "a bull"
pushlist animalsIgnoreList "a cow"
pushlist animalsIgnoreList "a chicken"
pushlist animalsIgnoreList "a bird"
pushlist animalsIgnoreList "an eagle"
pushlist animalsIgnoreList "an elk"
pushlist animalsIgnoreList "a great hart"
pushlist animalsIgnoreList "a kingfisher"
pushlist animalsIgnoreList "a hind"
pushlist animalsIgnoreList "a llama"
pushlist animalsIgnoreList "a sand crab"
pushlist animalsIgnoreList "a pig"
pushlist animalsIgnoreList "a polar bear"
pushlist animalsIgnoreList "a walrus"
pushlist animalsIgnoreList "a cougar"
pushlist animalsIgnoreList "a wolf"
pushlist animalsIgnoreList "a goat"
pushlist animalsIgnoreList "a raven"
pushlist animalsIgnoreList "a magpie"
pushlist animalsIgnoreList "a warbler"
pushlist animalsIgnoreList "a tern"
pushlist animalsIgnoreList "a nightingale"
pushlist animalsIgnoreList "a colossal frog"
pushlist animalsIgnoreList "a wren"
pushlist animalsIgnoreList "red rubble"
pushlist animalsIgnoreList "a spirit wolf"
pushlist animalsIgnoreList "a spirit sabertus"
pushlist animalsIgnoreList "a death asp"
pushlist animalsIgnoreList "a death adder"
pushlist animalsIgnoreList "a nuthatch"
pushlist animalsIgnoreList "a starling"
pushlist animalsIgnoreList "a cuckoo"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"

/////////////////////////
//  END OF VARIABLES!  //
/////////////////////////





################   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ########   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ########   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ########   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ################





///////////////////////
//   SCRIPT RESET:   //
///////////////////////

if ResetScriptPermanentVariables = 1
    unsetvar AutoRecallChargedRunebook
    unsetvar FirstRunArcaneMage
    unsetvar ArcaneMageAutoPilot
    unsetvar LootBag
    unsetvar LootChest
    @setvar! RedTargetFound 0
    @setvar! WarModeToggledWhileFighting 0
    @setvar! TimeToGo 0
    overhead "[ SCRIPT VARIABLES RESET... ]" 333
    sysmsg "Please return 'ResetScriptPermanentVariables' to '0' to continue!" 153
    stop
endif


///////////////////////
//   TIMER SETUPS:   //
///////////////////////

if not timerexists "WorldSaveTimer"
    createtimer "WorldSaveTimer"
    settimer "WorldSaveTimer" 0
endif

if not timerexists 'LootTimer'
    createtimer 'LootTimer'
    settimer 'LootTimer' 0
endif

if not timerexists 'PurplePotionTimer'
    createtimer 'PurplePotionTimer'
    settimer 'PurplePotionTimer' 0
endif

if not timerexists 'ExplosionCD'
    createtimer 'ExplosionCD'
    settimer 'ExplosionCD' 0
endif

if not timerexists 'EnergyBoltCD'
    createtimer 'EnergyBoltCD'
    settimer 'EnergyBoltCD' 0
endif

if not timerexists 'MindBlastCD'
    createtimer 'MindBlastCD'
    settimer 'MindBlastCD' 0
endif

if not timerexists 'WeightTimer'
    createtimer 'WeightTimer'
    settimer 'WeightTimer' 0
endif

if not timerexists 'PKRadar'
    createtimer 'PKRadar'
    settimer 'PKRadar' 0
endif

if not timerexists "DungeonEscape"
    createtimer "DungeonEscape"
    settimer "DungeonEscape" 0
endif

if not timerexists 'TargetChecker'
    createtimer 'TargetChecker'
    settimer 'TargetChecker' 0
endif

if not timerexists 'TauntingTimer'
    createtimer 'TauntingTimer'
    settimer 'TauntingTimer' 0
endif

if not timerexists "WeaponCodexTimer"
    createtimer "WeaponCodexTimer"
    settimer "WeaponCodexTimer" 0
endif

if not timerexists "WeaponCodexCheckTimer" 
    createtimer "WeaponCodexCheckTimer" 
    settimer "WeaponCodexCheckTimer" 2000
endif 

if not timerexists "ShieldCodexTimer"
    createtimer "ShieldCodexTimer"
    settimer "ShieldCodexTimer" 0
endif

if not timerexists "ShieldCodexCheckTimer" 
    createtimer "ShieldCodexCheckTimer" 
    settimer "ShieldCodexCheckTimer" 2000
endif 

if not timerexists "DungeonCleanup"
    createtimer "DungeonCleanup"
    settimer "DungeonCleanup" 0
endif

if not timerexists "DungeonCleanupRadar"
    createtimer "DungeonCleanupRadar"
    settimer "DungeonCleanupRadar" 0
endif

if not timerexists 'ArcaneStaffCheck'
    createtimer 'ArcaneStaffCheck'
    settimer 'ArcaneStaffCheck' 4500
endif

if not timerexists 'TargetTimer'
    createtimer 'TargetTimer'
    settimer 'TargetTimer' 4500
endif


if not timerexists 'ManaOverheadTimer'
    createtimer 'ManaOverheadTimer'
    settimer 'ManaOverheadTimer' 4500
endif

if not timerexists 'REDALERT'
    createtimer 'REDALERT'
    settimer 'REDALERT' 0
endif

if not timerexists 'MANAWAIT'
    createtimer 'MANAWAIT'
    settimer 'MANAWAIT' 4500
endif

if not timerexists 'MURDERTARGET'
    createtimer 'MURDERTARGET'
    settimer 'MURDERTARGET' 4500
endif

if not timerexists 'GETCLOSER'
    createtimer 'GETCLOSER'
    settimer 'GETCLOSER' 4500
endif

if not timerexists 'GATEHERE'
    createtimer 'GATEHERE'
    settimer 'GATEHERE' 4500
endif

if not timerexists 'RECALLDELAY'
    createtimer 'RECALLDELAY'
    settimer 'RECALLDELAY' 4500
endif

if not timerexists 'CANNOTSEE'
    createtimer 'CANNOTSEE'
    settimer 'CANNOTSEE' 4500
endif

if not timerexists 'TOOFAR'
    createtimer 'TOOFAR'
    settimer 'TOOFAR' 4500
endif

if not timerexists 'HEALERSEARCH'
    createtimer 'HEALERSEARCH'
    settimer 'HEALERSEARCH' 4500
endif

if not timerexists 'RUNAWAY'
    createtimer 'RUNAWAY'
    settimer 'RUNAWAY' 6000
endif

if not timerexists 'STORELOOT'
    createtimer 'STORELOOT'
    settimer 'STORELOOT' 6000
endif

if not timerexists 'ATTACKTIMER'
    createtimer 'ATTACKTIMER'
    settimer 'ATTACKTIMER' 15000
endif

if not timerexists 'overweightMessageTimer'
    createtimer 'overweightMessageTimer'
    settimer 'overweightMessageTimer' 4500
endif

if not timerexists 'noTargetMessageTimer'
    createtimer 'noTargetMessageTimer'
    settimer 'noTargetMessageTimer' 4500
endif

if not timerexists 'searchingMessageTimer'
    createtimer 'searchingMessageTimer'
    settimer 'searchingMessageTimer' 4500
endif

if not timerexists "inventorycheck"
    createtimer "inventorycheck"
    settimer "inventorycheck" 5000
endif

if not timerexists 'noRegsMessageTimer'
    createtimer 'noRegsMessageTimer'
    settimer 'noRegsMessageTimer' 4500
endif

if not timerexists 'foodMessageTimer'
    createtimer 'foodMessageTimer'
    settimer 'foodMessageTimer' 4500
endif

if not timerexists 'pouchMessageTimer'
    createtimer 'pouchMessageTimer'
    settimer 'pouchMessageTimer' 4500
endif

if not timerexists 'aidsMessageTimer'
    createtimer 'aidsMessageTimer'
    settimer 'aidsMessageTimer' 4500
endif

if not timerexists 'PotionKegTimer' 
    createtimer 'PotionKegTimer' 
    settimer 'PotionKegTimer' 3500
endif

if not timerexists 'whiteMessageTimer'
    createtimer 'whiteMessageTimer'
    settimer 'whiteMessageTimer' 4500
endif

if not timerexists 'blueMessageTimer'
    createtimer 'blueMessageTimer'
    settimer 'blueMessageTimer' 4500
endif

if not timerexists 'blackMessageTimer'
    createtimer 'blackMessageTimer'
    settimer 'blackMessageTimer' 4500
endif

if not timerexists 'purpleMessageTimer'
    createtimer 'purpleMessageTimer'
    settimer 'purpleMessageTimer' 15000
endif

if not timerexists 'orangeMessageTimer'
    createtimer 'orangeMessageTimer'
    settimer 'orangeMessageTimer' 4500
endif

if not timerexists 'yellowMessageTimer'
    createtimer 'yellowMessageTimer'
    settimer 'yellowMessageTimer' 4500
endif

if not timerexists 'HealPotionTimer' 
    createtimer 'HealPotionTimer' 
    settimer 'HealPotionTimer' 11000
endif 

if not timerexists 'redMessageTimer'
    createtimer 'redMessageTimer'
    settimer 'redMessageTimer' 4500
endif

if not timerexists 'TelekinesisTimer' 
    createtimer 'TelekinesisTimer' 
    settimer 'TelekinesisTimer' 60000
endif 

if not timerexists 'OrganizerAgentTimer' 
    createtimer 'OrganizerAgentTimer' 
    settimer 'OrganizerAgentTimer' 15000
endif

if not timerexists 'MeditationOverheadTimer'
    createtimer 'MeditationOverheadTimer'
    settimer 'MeditationOverheadTimer' 5000
endif

if not timerexists 'SkinningTimer'
    createtimer 'SkinningTimer'
    settimer 'SkinningTimer' 5000
endif

if not timerexists 'MeditationTimer'
    createtimer 'MeditationTimer'
    settimer 'MeditationTimer' 10500
endif

if not timerexists 'ArcaneWeaponAbilityTimer'
    createtimer 'ArcaneWeaponAbilityTimer'
    settimer 'ArcaneWeaponAbilityTimer' 10500
endif

if not timerexists 'magicReflectTimer'
    createtimer 'magicReflectTimer'
    settimer 'magicReflectTimer' 15000
endif

if not timerexists 'armorReflectTimer'
    createtimer 'armorReflectTimer'
    settimer 'armorReflectTimer' 15000
endif

if not timerexists 'protectionTimer'
    createtimer 'protectionTimer'
    settimer 'protectionTimer' 15000
endif

if not timerexists 'EvilOmenTimer'
    createtimer 'EvilOmenTimer'
    settimer 'EvilOmenTimer' 30000
endif

if not timerexists 'CorpseSkinTimer'
    createtimer 'CorpseSkinTimer'
    settimer 'CorpseSkinTimer' 30000
endif

if not timerexists 'PainSpikeTimer'
    createtimer 'PainSpikeTimer'
    settimer 'PainSpikeTimer' 30000
endif

if not timerexists 'PainSpikeDelayTimer'
    createtimer 'PainSpikeDelayTimer'
    settimer 'PainSpikeDelayTimer' 10000
endif

if not timerexists 'StrangleTimer'
    createtimer 'StrangleTimer'
    settimer 'StrangleTimer' 30000
endif

if not timerexists 'MindRotTimer'
    createtimer 'MindRotTimer'
    settimer 'MindRotTimer' 30000
endif

if not timerexists 'SnackTimer'
    createtimer 'SnackTimer'
    settimer 'SnackTimer' 60000
endif

if not timerexists 'WizardSatchelTimer'
    createtimer 'WizardSatchelTimer'
    settimer 'WizardSatchelTimer' 60000
endif

if not timerexists 'PotionSatchelTimer'
    createtimer 'PotionSatchelTimer'
    settimer 'PotionSatchelTimer' 60000
endif

if not timerexists 'CurseTimer'
    createtimer 'CurseTimer'
    settimer 'CurseTimer' 60000
endif

if not timerexists 'ManaDrainTimer'
    createtimer 'ManaDrainTimer'
    settimer 'ManaDrainTimer' 60000
endif

if not timerexists 'MagicArrowTimer'
    createtimer 'MagicArrowTimer'
    settimer 'MagicArrowTimer' MagicArrowCooldown
endif

if not timerexists 'HarmTimer'
    createtimer 'HarmTimer'
    settimer 'HarmTimer' HarmCooldown
endif

if not timerexists 'FireballTimer'
    createtimer 'FireballTimer'
    settimer 'FireballTimer' FireballCooldown
endif

if not timerexists 'LightningTimer'
    createtimer 'LightningTimer'
    settimer 'LightningTimer' LightningCooldown
endif

if not timerexists 'MushroomTimer'
    createtimer 'MushroomTimer'
    settimer 'MushroomTimer' MagicMushroomCooldown
endif

clearsysmsg

if not varexist previousTarget
    @setvar! previousTarget 0
endif


    //////////////////////
    //  INITIAL SETUP:  //
    //////////////////////

if not dead
    if not varexist ArcaneMageAutoPilot
        overhead "Lord Glacier's Chill Arcane Mage Auto Pilot Script" 2234
        # '
        overhead "version 1.1.4" 2234
        wait 1000
        overhead "Last Updated: November 26, 2025" 88
        wait 2500
        overhead "Thank you for trying my Arcane Mage AUTO PILOT script!  It appears this may be your first time running it..." 0
        wait 4000
        overhead "IMPT: Please make sure to check and adjust your VARIABLES!" 153
        wait 4500
        overhead "Please read the TIPS section at the beginning of the script for more info" 88
        wait 3000
        setvar ArcaneMageAutoPilot 1
        sysmsg "Beginning Lord Glacier's Chill Arcane Mage Auto Pilot script.......... " 0
        # '
        wait 1000
    endif

    if EnableAutoRedRecall = 1 or EnableAutoWeightRecall = 1 or EnableRecallAfterResurrection = 1 or EnableRecallAfterDungeonGate = 1 and EnableDIYRecallScript != 1
        if not varexist AutoRecallChargedRunebook
            wait 500
            overhead "Select your escape runebook..." 253
            wait 500
            overhead "You have enabled Auto Recall (PK or Weight) and must select a charged runebook to continue..." 0
            @setvar! AutoRecallChargedRunebook
            sysmsg "Will cast to 'default rune' in Runebook (if 'casting' enabled) or uses scrolls to 'first location' in Runebook (if no Magery skill)" 153
            wait 1500
        endif
    endif

    if EnableLootChest = 1
        if EnableAutoRedRecall = 1 or EnableAutoWeightRecall = 1 or EnableRecallAfterResurrection = 1 or EnableRecallAfterDungeonGate = 1
            if not varexist LootChest
                wait 500
                overhead "Select a secure container to store your Loot..." 253
                sysmsg "Can be disabled under script variables section." 0
                wait 1000
                overhead "Anything that will not go into a Resource Stockpile, Storage Shelf or Magic Recycler" 0
                overhead "(ie. Skill Orbs, Treasure Maps, Paragon chests, etc.)"
                @setvar! LootChest
                sysmsg "Use Razor Organizer Agents 06 - 09 for the Loot Chest and its contents - organize to your own liking!" 0
                wait 1500
            endif
        endif
    endif

    if EnableLootBag = 1 and IHAVEDIED != 1
        if EnableAutoRedRecall = 1 or EnableAutoWeightRecall = 1 or EnableRecallAfterResurrection = 1 or EnableRecallAfterDungeonGate = 1
            if not varexist LootBag
                wait 500
                overhead "Please select your loot bag..." 253
                wait 1000
                overhead "This should be whatever is set as your 'Grab Bag' and will be opened when unloading loot after recalling..." 0
                @setvar! LootBag
                wait 500
                while targetexists
                    wait 100
                endwhile
            endif
            if not find LootBag self
                sysmsg "Loot Bag not found!" 0
                wait 500
                overhead "Select your new loot bag..." 253
                wait 500
                @setvar! LootBag
                wait 500
                while targetexists
                    wait 100
                endwhile
            endif
        endif
    endif

    if not varexist FirstRunArcaneMage
        wait 1000
        overhead "Good luck out there!" 2234
        overhead "         - Dan (aka. Glacier)" 2234
        wait 1500
        setvar FirstRunArcaneMage 1
    endif

    if insysmsg "world is saving"
        settimer "WorldSaveTimer" 0
        if EnableOverheadMessages = 1
            overhead "[ WORLD SAVING... ]" 253
        endif 
        while timer "WorldSaveTimer" < 4500
            if insysmsg "save complete"
                break
            endif
            wait 100
        endwhile   
        if EnableOverheadMessages = 1
            overhead "[ SAVE COMPLETE! ]" 253
        endif 
    endif
endif







                                                                            ###############################
                                                                           ###    SCRIPT STARTS HERE:    ###
                                                                            ###############################


////////////////////////
//  BEGIN ALIVE LOOP  //
////////////////////////

while not dead
    if insysmsg "world is saving"
        settimer "WorldSaveTimer" 0
        if EnableOverheadMessages = 1
            overhead "[ WORLD SAVING... ]" 253
        endif 
        while timer "WorldSaveTimer" < 4500
            if insysmsg "save complete"
                break
            endif
            wait 100
        endwhile   
        if EnableOverheadMessages = 1
            overhead "[ SAVE COMPLETE! ]" 253
        endif 
    endif

    if EnableTrackingAutoRecall = 1 and skill 'Tracking' > 50
        if not findbuff 'tracking'
            while not gumpexists 4267467659
                useskill 'tracking'
                wait 250
            endwhile
            if gumpexists 4267467659
                while not insysmsg "You will now hunt all hostile players."
                    gumpresponse 8 4267467659
                    waitforgump 4267467659 5000
                endwhile
                gumpresponse 6 4267467659
                wait 500
                clearsysmsg
            endif
            gumpclose 4267467659
            if EnableOverheadMessages = 1
                overhead "[ RED RECALL ACTIVATED! ]" 334
            endif
        endif
    endif

    if EnableTrackingAutoRecall = 1
        if PKTrackingRange = 60
            if insysmsg ": 60 step" or insysmsg "60 space" or insysmsg ": 59 step" or insysmsg "59 space" or insysmsg ": 58 step" or insysmsg "58 space" or insysmsg ": 57 step" or insysmsg "57 space" or insysmsg ": 56 step" or insysmsg "56 space" or insysmsg ": 55 step" or insysmsg "55 space" or insysmsg ": 54 step" or insysmsg "54 space" or insysmsg ": 53 step" or insysmsg "53 space" or insysmsg ": 52 step" or insysmsg "52 space" or insysmsg ": 51 step" or insysmsg "51 space" or insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
            endif
        elseif PKTrackingRange = 50
            if insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
            endif
        elseif PKTrackingRange = 40
            if insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
            endif
        elseif PKTrackingRange = 0
            if insysmsg "Now tracking"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
            endif
        endif
    endif

    if EnablePKradar = 1
        if timer "PKRadar" > 1000
            hotkey 'Next Murderer Player Target'
            wait 500
            if insysmsg "No one matching that was found"
                settimer "PKRadar" 0
                clearsysmsg
            else
                hotkey 'Toggle Peace Only'
                @setvar! RedTargetFound 1
                @setvar! TimeToGo 1
                @setvar! MurdererTarget lasttarget
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
            endif
        endif
    endif

    if paralyzed and EnableAutoParalyzePouch = 1
        if findtype "pouch" self
            yell "[pouch"
            wait 250
            hotkey 'Toggle Peace Only'
            @setvar! RedTargetFound 1
            @setvar! WarModeToggledWhileFighting 0
            @setvar! TimeToGo 1
        else
            if timer pouchMessageTimer > 5000 and EnableOverheadMessages = 1
                overhead "[ NO MORE POUCHES! ]" 337
                settimer pouchMessageTimer 0
            endif
        endif
    endif

    if EnableWeightWarningMessage = 1
        if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT WARNING... ]" 77
                settimer "WeightTimer" 0
            else
                overhead "  " 77
                settimer "WeightTimer" 0
            endif
        elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT WARNING! ]" 153
                settimer "WeightTimer" 0
            else
                overhead "  " 153
                settimer "WeightTimer" 0
            endif
        elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT LIMIT REACHED! ]" 37
                settimer "WeightTimer" 0
            else
                overhead "  " 37
                settimer "WeightTimer" 0
            endif

            if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                wait 1000
                hotkey 'Toggle Peace Only'
                @setvar! AutoWeightRecall 1
                replay
            elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                if timer "RECALLDELAY" > 3500 and EnableAutoRecallOverheadMessages = 1
                    overhead "[ WAITING TO RECALL... ]" 149
                    settimer "RECALLDELAY" 0
                endif
                wait 500
            elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                wait 500
                hotkey 'Toggle Peace Only'
                @setvar! TimeToGo 1
                replay
            else
                if EnableOverheadMessages = 1
                    overhead "[ OVERWEIGHT! ]" 337
                else
                    overhead "  " 337
                endif
                wait 1500
                overhead "[ STOPPING SCRIPT! ]" 88
            endif
        endif
    endif

    if skill 'necromancy' >= 50 and not gumpexists 622436516
        if findtype 'necromancer book' backpack
            yell '[necromancyhotbar'
            while not gumpexists 622436516
                yell '[necromancyhotbar'
                waitforgump 622436516 1000
            endwhile
            wait 500
        elseif EnableOverheadMessages = 1
            overhead "[ NO NECRO BOOK! ]" 337
            wait 2500
        endif
    endif

    if not findtype "3972" or not findtype "3962" or not findtype "3963" or not findtype "3980" or not findtype "3976" or not findtype "3973" or not findtype "3974" or not findtype "3981" self
        @setvar! missingRegs 1
        if timer noRegsMessageTimer > 5000 and EnableOverheadMessages = 1
            overhead "[ MISSING REGS! ]" 337
            settimer noRegsMessageTimer 0
        endif
    else
        @setvar! missingRegs 0
    endif

    if EnableDropGoldWhenOverweight = 1
        if weight > maxweight and diffhits < ActivateAutoHealHPdiff 
            if timer overweightMessageTimer > 4500
                overhead "[ OVERWEIGHT! ]" 34
                settimer overweightMessageTimer 0
            endif

            if DropGoldAmount != 0
                clearignore
                @setvar! DisableVacuums 1
                wait 250 

                if EnablePutLootinLockBox = 1
                    if findtype "wooden box" self as lockbox
                        if findtype "copper key" self as key
                            clearignore
                            getlabel lockbox lockboxlabel
                            wait 100
                            if "items" in lockboxlabel
                                // Do nothing
                            else
                                dclick key
                                wft 1500
                                target lockbox
                                if EnableOverheadMessages = 1
                                    overhead "[loot box unlocked]" 84
                                endif
                                wait 500
                                if insysmsg "It appears to be locked."
                                    dclick key
                                    wft 1500
                                    target lockbox
                                    wait 250
                                endif
                            endif
                        elseif EnableOverheadMessages = 1
                            overhead "[ NO LOCKBOX KEY! ]" 337
                        endif
                    endif
                endif

                while weight > maxweight and diffhits < ActivateAutoHealHPdiff 
                    if findtype "gold coin" self as easycomeeasygo
                        lift easycomeeasygo DropGoldAmount
                        droprelloc 0 0
                        getlabel backpack packdesc
                        if EnableOverheadMessages = 1
                            overhead "[ DROPPING GOLD... ]" 149
                        endif
                        wait 250
                        if insysmsg "cannot drop anything"
                            drop backpack -1 -1 -1
                            break 
                        endif
                        wait 250
                    else 
                        break 
                    endif
                    if diffhits > ActivateAutoHealHPdiff 
                        break
                    endif 
                endwhile

                if diffhits > ActivateAutoHealHPdiff 
                    break
                endif 
            endif
        endif
    endif 

    if insysmsg "to be locked"
        clearsysmsg 
        replay
    endif

    if not warmode and WarModeToggledWhileFighting = 1
        hotkey 'Toggle War Only'
        @setvar! WarModeToggledWhileFighting 0
    endif


    //////////////////////////
    //  BEGIN AUTO RECALL:  //
    //////////////////////////

    if not warmode and WarModeToggledWhileFighting = 0
        if EnableAutoWeightRecall = 1 and AutoWeightRecall = 1
            if EnableDIYRecallScript = 1
                @setvar! AutoWeightRecall 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile
                    if EnableOverheadMessages = 1
                        overhead "[ AUTO WEIGHT RECALL! ]" 88
                        wait 1000
                    endif
                    @setvar! AutoWeightRecall 0

                @setvar! RECALLTIME 1
            endif
        elseif EnableAutoRedRecall = 1 and RedTargetFound = 1
            if EnableDIYRecallScript = 1
                @setvar! RedTargetFound 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                @setvar! RECALLTIME 1
            endif
        elseif EnableRecallAfterDungeonGate = 1 and DungeonGateThenTimeToGo = 1
            if EnableDIYRecallScript = 1
                @setvar! DungeonGateThenTimeToGo 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                if EnableOverheadMessages = 1
                    overhead "[ AUTO RECALL! ]" 88
                endif
                @setvar! DungeonGateThenTimeToGo 0
                @setvar! TimeToGo 0
                @setvar! RECALLTIME 1
            endif
        elseif EnableRecallAfterResurrection = 1 and ResThenTimeToGo = 1
            if EnableDIYRecallScript = 1
                @setvar! ResThenTimeToGo 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                if EnableOverheadMessages = 1
                    overhead "[ AUTO RECALL! ]" 88
                    wait 1000
                endif 
                @setvar! TimeToGo 0
                @setvar! ResThenTimeToGo 0
                @setvar! RecallScrollsOnly 1
                @setvar! RECALLTIME 1
            endif
        elseif AutoRecallTime = 1
            if EnableDIYRecallScript = 1
                @setvar! AutoRecallTime 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                if EnableOverheadMessages = 1
                    overhead "[ AUTO RECALL! ]" 88
                    wait 1000
                endif
                @setvar! AutoRecallTime 0
                @setvar! RECALLTIME 1
            endif
        elseif EnableAutoRedDungeonGate = 1 or EnableAutoWeightDungeonGate = 1 and TimeToGo = 1

            settimer "DungeonEscape" 0
            sysmsg "Dungeon Escape mode enabled! (variables 'EnableAutoRedDungeonGate' and/or 'EnableAutoWeightDungeonGate')" 0
            wait 250
            sysmsg "Script will automatically revert after {{DungeonEscapeTimeLimit}}ms or upon dungeon exit" 88 
            wait 250 
            sysmsg "Please proceed to the nearest exit gate!  It will indicated by overhead arrows!" 153

            while timer "DungeonEscape" < DungeonEscapeTimeLimit 
                if insysmsg "world is saving"
                    settimer "WorldSaveTimer" 0
                    if EnableOverheadMessages = 1
                        overhead "[ WORLD SAVING... ]" 253
                    endif 
                    while timer "WorldSaveTimer" < 4500
                        if insysmsg "save complete"
                            break
                        endif
                        wait 100
                    endwhile   
                    if EnableOverheadMessages = 1
                        overhead "[ SAVE COMPLETE! ]" 253
                    endif 
                endif

                if find MurdererTarget ground -1 -1 12
                    if timer "MURDERTARGET" > 4000
                        if EnableOverheadMessages = 1
                            overhead " RED " 337 MurdererTarget
                        else
                            overhead "  " 337 MurdererTarget
                        endif
                        settimer "MURDERTARGET" 0
                    endif
                endif 

                if EnableAutoParalyzePouch = 1
                    if paralyzed
                        if findtype "pouch" self
                            yell "[pouch"
                        else
                            if EnableOverheadMessages = 1
                                overhead "[ NO MORE POUCHES! ]" 337
                            endif
                        endif
                    endif
                endif

                if EnableStrengthPotion = 1 
                    if not findbuff "Strength"
                        if findtype "White Potion" self
                            dclicktype "White Potion"
                            if EnableOverheadMessages = 1
                                overhead "[ STRENGTH POTION ]" 956
                            endif
                            wait 250
                        else
                            if timer whiteMessageTimer > 4500
                                overhead "[ NO STRENGTH POTS! ]" 337
                                settimer whiteMessageTimer 0
                            endif
                        endif
                    endif
                endif 

                if skill 'magery' >= 40 and diffhits < 40 and diffhits > 10 and mana >= 4 and EnableCastHeal = 1 and not casting
                    cast 'heal'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'heal'
                    endwhile

                    while not targetexists
                        if insysmsg "Your concentration is disturbed"
                            interrupt
                            @setvar! SpellInterrupted 1
                            break
                        endif
                        if diffhits >= HealPotionHPdiff
                            break
                        endif 
                    endwhile

                    if SpellInterrupted = 0
                        target 'self'
                    else 
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                    endif
                elseif skill 'magery' >= 60 and diffhits >= CastGreaterHealHPdiff and diffhits < 5 and mana >= 11 and EnableCastGreaterHeal = 1 and not casting
                    cast 'greater heal'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'greater heal'
                    endwhile

                    @settimer! spellTimer 0
                    @setvar! spellCD 1000

                    while not targetexists
                        if insysmsg "Your concentration is disturbed"
                            interrupt
                            @setvar! SpellInterrupted 1
                            break
                        endif

                        if timer spellTimer < spellCD
                             if EnableCurePotion = 1
                                while poisoned and casting and not targetexists
                                    if findtype "Orange Potion" self
                                        dclicktype "Orange Potion"
                                        if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                                            overhead "[ CURE POTION ]" 44
                                            settimer 'orangeMessageTimer' 0
                                        endif 
                                        wait 500
                                    else
                                        if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                                            overhead "[ NO CURE POTS! ]" 337
                                            settimer 'orangeMessageTimer' 0
                                        endif
                                        break
                                    endif
                                endwhile
                            endif

                            if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                                if findtype "Yellow Potion" self as hPot
                                    getlabel hPot potLabel
                                    if "next" in potLabel
                                        // Do nothing
                                    else
                                        @setvar! ch 0
                                         if counttype 3852 self as c
                                            @setvar! ch c
                                        endif
                                        if insysmsg "potion satchel used"
                                        endif
                                        dclicktype 3852
                                        getlabel backpack packdesc
                                        wait 250

                                        if ch != counttype 3852 self or insysmsg "potion satchel used"
                                            settimer 'HealPotionTimer' 0
                                            cooldown "Healing Potion" 11000
                                            if EnableOverheadMessages = 1
                                                overhead "[ HEAL POTION ]" 253
                                            endif 
                                            if diffhits < ActivateAutoHealHPdiff
                                                interrupt
                                                if targetexists
                                                    hotkey 'cancel current target'
                                                endif
                                            endif
                                        endif
                                    endif
                                else
                                    if timer 'yellowMessageTimer' > 5000 and EnableOverheadMessages = 1
                                        overhead "[ NO HEAL POTS! ]" 337
                                        settimer 'yellowMessageTimer' 0
                                    endif
                                endif
                            endif
                        endif
                    endwhile

                    if SpellInterrupted = 0
                        target 'self'
                    endif
                endif

                if EnableHealPotion = 1 and diffhits >= HealPotionHPdiff
                    if findtype "Yellow Potion" self as HealPot
                        getlabel HealPot HealPotlabel
                        if "next" in HealPotlabel
                            // Do nothing
                        else
                            @setvar! HealPotionCheck 0

                            if counttype 3852 self as HealPotCount
                                @setvar! HealPotionCheck HealPotCount
                            endif

                            clearsysmsg
                            dclicktype 3852
                            getlabel backpack backpackdesc
                            wait 250

                            if HealPotionCheck != counttype 3852 self or insysmsg "potion satchel used"
                                settimer 'HealPotionTimer' 0
                                cooldown "Healing Potion" HealingPotionCooldown
                                if EnableOverheadMessages = 1
                                    if insysmsg "potion satchel used"
                                        overhead '[ FREE HEAL POTION ]' 253
                                    else
                                        overhead "[ HEAL POTION ]" 253
                                    endif
                                endif 
                                clearsysmsg
                            endif
                        endif
                    else
                        if timer 'yellowMessageTimer' > 4500
                            overhead "[ NO HEAL POTS! ]" 337
                            settimer 'yellowMessageTimer' 0
                        endif
                    endif
                endif

                if EnableRefreshPotion = 1 and diffstam > RefreshPotionSPdiff
                    if findtype "Red Potion" self
                        dclicktype "Red Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ REFRESH POTION ]" 37
                        endif
                        wait 250
                    else
                        if timer redMessageTimer > 4500
                            overhead "[ NO REFRESH POTS! ]" 337
                            settimer redMessageTimer 0
                        endif
                    endif
                endif

                if EnableCurePotion = 1
                    while poisoned
                        if findtype "Orange Potion" self
                            dclicktype "Orange Potion"
                            if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                                overhead "[ CURE POTION ]" 44
                                settimer 'orangeMessageTimer' 0
                            endif
                            wait 250
                        else
                            if timer 'orangeMessageTimer' > 5000
                                overhead "[ NO CURE POTS! ]" 337
                                settimer 'orangeMessageTimer' 0
                            endif

                            if diffhits >= 30 or not findtype 3972 self or not findtype 3973 self
                                break
                            endif
                        endif
                    endwhile
                endif

                if EnableAgilityPotion = 1 and not findbuff "Agility"
                    if findtype "Blue Potion" self
                        dclicktype "Blue Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ AGILITY POTION ]" 93
                        endif
                        wait 250
                    else
                        if timer blueMessageTimer > 4500
                            overhead "[ NO AGILITY POTS! ]" 337
                            settimer blueMessageTimer 0
                        endif
                    endif
                endif

                if EnableMagicResistPotion = 1 and not findbuff "Magic Resist"
                    if findtype "Black Potion" self
                        dclicktype "Black Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ RESIST POTION ]" 1109
                        endif
                        wait 250
                    else
                        if timer blackMessageTimer > 4500
                            overhead "[ NO RESIST POTS! ]" 337
                            settimer blackMessageTimer 0
                        endif
                    endif
                endif

                if warmode
                    if EnableOverheadMessages = 1
                    overhead "[ ESCAPE CANCELLED! ]" 149
                    else
                        overhead "  " 149
                    endif
                    @setvar! TimeToGo 0
                    settimer "DungeonEscape" DungeonEscapeTimeLimit
                    replay
                endif

                while not gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                    while gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                        gumpresponse 2 3899019871
                        wait 250
                    endwhile
                    wait 1500
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle Peace Only'
                        @setvar! DungeonGateThenTimeToGo 1
                        @setvar! TimeToGo 1
                        replay
                    endif
                endif

                while not gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                    while gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                        gumpresponse 2 3899019871
                        wait 250
                    endwhile
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle Peace Only'
                        @setvar! DungeonGateThenTimeToGo 
                        @setvar! TimeToGo 1
                        replay
                    endif
                endif

                while not gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                    while gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                        gumpresponse 2 3773199800
                        wait 250
                    endwhile
                    wait 1500
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle Peace Only'
                        @setvar! DungeonGateThenTimeToGo 1
                        @setvar! TimeToGo 1
                        replay
                    endif
                endif

                while not gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                    while gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                        gumpresponse 2 3899019871
                        wait 250
                    endwhile
                    wait 1500
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle Peace Only'
                        @setvar! DungeonGateThenTimeToGo 1
                        @setvar! TimeToGo 1
                        replay
                    endif
                endif

                if findtype "moongate" ground -1 1 12 or findtype "blue moongate" ground -1 1 12 as EscapeGate
                    if timer "GETCLOSER" > 4500
                        if EnableOverheadMessages = 1
                            overhead "[ GET CLOSER! ]" 253
                        else
                            overhead "  " 253
                        endif
                        settimer "GETCLOSER" 0
                    endif
                    if timer "GATEHERE" > 500
                        overhead "  " 253 EscapeGate
                        settimer "GATEHERE" 0
                    endif
                else
                    if timer "RUNAWAY" > 4500
                        if EnableOverheadMessages = 1
                            overhead "[ GET TO A GATE... ]" 2118
                        else
                            overhead "  " 2118
                        endif
                        settimer "RUNAWAY" 0
                    endif
                endif
            endwhile
        elseif EnableAutoRedRecall = 0 and EnableAutoWeightRecall = 0 
            // Do nothing
        elseif EnableAutoRedDungeonGate = 0 and EnableAutoWeightDungeonGate = 0 
            // Do nothing
        elseif TimeToGo = 0 and WarModeToggledWhileFighting = 1
           @setvar! WarModeToggledWhileFighting 0
        endif
    endif

    if RECALLTIME = 1
        if EnableCastRecall = 1 and skill "Magery" >= 60 and RecallScrollsOnly != 1 and findtype '3962' self and findtype '3963' self and findtype '3974' self
            cast "Recall"
            while not targetexists
                wait 100
            endwhile
            target AutoRecallChargedRunebook
            wait 1000
        else
            dclick AutoRecallChargedRunebook
            waitforgump 1551740969
            gumpresponse 2
            wait 1000
        endif 

        if insysmsg 'Your concentration is disturbed'
            overhead '[ INTERUPTED! ]' 153
            wait 500
            for 5
            if diffhits > 25 and timer 'HealPotionTimer' > HealingPotionCooldown
                if findtype "Yellow Potion" self as healpot
                    dclick healpot
                    wait 250
                    settimer 'HealPotionTimer' 0
                    cooldown "Healing Potion" HealingPotionCooldown
                    if EnableOverheadMessages = 1
                        overhead "[ HEAL POTION ]" 253
                    endif
                endif
            endif

            while poisoned
                if findtype "Orange Potion" self as curepot
                    dclick curepot
                    wait 500
                endif
            endwhile

            clearsysmsg
            wait 500

            if EnableCastRecall = 1 and skill "Magery" >= 60 and RecallScrollsOnly != 1 and findtype '3962' self and findtype '3963' self and findtype '3974' self
                cast "Recall"
                while not targetexists
                    wait 100
                endwhile
                target AutoRecallChargedRunebook
                wait 1000
            else
                dclick AutoRecallChargedRunebook
                waitforgump 1551740969
                gumpresponse 2
                wait 1000
            endif
 
            if insysmsg 'Your concentration is disturbed'
                wait 500
            else
                break
            endif
            endfor
        endif

        if OutsideHouseRecall = 1
            wait 2500
            if find MyDoor ground -1 -1 2 and EnableCloseMyDoor = 1
                dclick MyDoor
                overhead "*door slams!*" 0 MyDoor
                wait 1000
            endif
            wait 2500
        elseif OwnerInnRecall = 1
            wait 500
            say "Innkeeper, I need a room!" 2234
            waitforgump 2393832411
            gumpresponse 4
            wait 1500
        elseif CoOwnerInnRecall = 1
            wait 500
            say "Innkeeper, I need a room!" 2234
            waitforgump 2393832411
            gumpresponse 5
            wait 500
            gumpresponse 100
            wait 1500
        elseif InsideHouseRecall = 1
            wait 500
        elseif BankRecall = 1
            say "Open my bank!" 2234
            wait 1000
        else
            wait 500
        endif

        if HideAtHomeorInn = 1
            useskill "Hiding"
        endif

        clearignore
        @setvar! RecallScrollsOnly 0
        @setvar! RECALLTIME 0

        if EnableResetInventoryAfterDeath = 1 and IHAVEDIED = 1
            if EnableAutoRecallOverheadMessages = 1
                overhead "[ RESETTING LOADOUT... ]" 77
                wait 500
            endif
        endif

        if IHAVEDIED != 1
            if EnableWeaponCheck = 1 and skill 'Arcane' >= 50 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
                if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                    dclick myArcaneStaff
                    wait 500
                else
                    if timer "ArcaneStaffCheck" > 5000 and EnableAutoRecallOverheadMessages = 1
                        overhead "[ NO ARCANE STAFF! ]" 337
                        settimer "ArcaneStaffCheck" 0
                    endif
                endif
            endif

            if EnableLootBag = 1
                dclick LootBag
                wait 500
            endif

            if EnableLootChest = 1
                dclick LootChest
                wait 500
            endif

            if EnablePutLootinLockBox = 1
                if findtype "wooden box" self as lockbox
                    if findtype "copper key" self as key
                        clearignore
                        getlabel lockbox lockboxlabel
                        wait 250
                        if "items" in lockboxlabel
                            dclick lockbox
                            wait 500
                        else
                            dclick key
                            wft 1500
                            target lockbox
                            if EnableAutoRecallOverheadMessages = 1
                                overhead "[loot box unlocked]" 84
                            endif
                            wait 500
                            dclick lockbox
                            wait 250
                            if insysmsg "It appears to be locked."
                                dclick key
                                wft 1500
                                target lockbox
                                wait 500
                                dclick lockbox
                            endif
                        endif
                    elseif EnableAutoRecallOverheadMessages = 1
                        overhead "[ NO LOCKBOX KEY! ]" 337
                    endif
                endif
            endif

            wait 500

            if EnableSafeDeposit = 1
                if findtype "bank deposit safe" ground -1 -1 2 as safe
                    clearignore
                    while findtype "gold coin" self as gold
                        if findtype "wooden box" self as lockbox
                            if findtype "copper key" self as key
                                getlabel lockbox lockboxlabel
                                if "items" in lockboxlabel
                                    wait 500
                                else
                                    dclick key
                                    wft 1500
                                    target lockbox
                                    wait 250
                                    if insysmsg "It appears to be locked."
                                        dclick key
                                        wft 1500
                                        target lockbox
                                        wait 250
                                    endif
                                endif
                            elseif EnableAutoRecallOverheadMessages = 1
                                overhead "[ NO LOCKBOX KEY! ]" 337
                            endif
                        endif
                        
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ DEPOSITING GOLD... ]" 149
                        else
                            overhead "  " 149
                        endif
                        
                        menu safe 0
                        wait 500
                    endwhile
                    while findtype 2539 self as dubs
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ DEPOSITING DUBS... ]" 149
                        else
                            overhead "  " 149
                        endif
                        
                        menu safe 0
                        wait 500
                    endwhile
                elseif EnableAutoRecallOverheadMessages = 1
                    overhead "[ NO BANK SAFE FOUND ]" 337
                    wait 1500
                endif
            endif

            if EnableResourceStockpile = 1
                if findtype "resource container" ground -1 -1 2 as resource
                    menu resource 0
                    wft 500
                    target self
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ PILING RESOURCES... ]" 84
                        else
                            overhead "  " 84
                        endif
                    wait 1500
                elseif EnableAutoRecallOverheadMessages = 1
                    overhead "[ NO RESOURCE STOCKPILE FOUND ]" 337
                    wait 1500
                endif
            endif

            if EnableRepairBench = 1
                if findtype "repair bench" ground -1 -1 3 as RepairBench
                    clearsysmsg
                    dclick RepairBench
                    wait 500
                    if insysmsg "You do not have any items equipped or in your backpack in need of repairs."
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ NOTHING TO REPAIR! ]" 0
                        endif
                        wait 1500
                    else
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ REPAIRING EQUIPMENT... ]" 339
                        else
                            overhead "  " 339
                        endif
                        settimer RepairTimer 0
                    while timer RepairTimer <= 5000
                        if insysmsg "Repair"
                            break
                        endif
                    endwhile
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ ITEMS REPAIRED! ]" 0
                            wait 500
                            overhead "Repair took: {{RepairTimer}}ms" 77
                        else
                            overhead "  " 0
                        endif
                        removetimer RepairTimer
                        wait 500
                    endif
                elseif EnableAutoRecallOverheadMessages = 1
                    overhead "[ NO REPAIR BENCH FOUND ]" 337
                    wait 1500
                endif
            endif

            if EnableMagicRecycler = 1
                if findtype "ornate elven chest|magic item recycler" ground -1 -1 2 as recycler
                    for 2
                    getlabel recycler recyclerdesc

                    if EnableRecycleItemsWhenFull = 1
                        if "(125 items" in recyclerdesc
                            dclick recycler
                            waitforgump 4045111101
                            gumpresponse 7
                            waitforgump 4045111101
                            gumpresponse 6
                            waitforgump 4045111101
                            gumpresponse 6

                            if EnableAutoRecallOverheadMessages = 1
                                overhead "[ RECYCLING JUNK... ]" 66
                            else
                                overhead "  " 66
                            endif

                            wait 500
                            gumpclose 4045111101

                            if EnableResourceStockpile = 1
                                if findtype "resource container" ground -1 -1 2 as resource
                                    menu resource 0
                                    wft 1500
                                    target recycler
                                    wait 500
                                    if EnableAutoRecallOverheadMessages = 1
                                        overhead "[ PILING RESOURCES... ]" 84
                                    else
                                        overhead "  " 84
                                    endif
                                    wait 500
                                elseif EnableAutoRecallOverheadMessages = 1
                                    overhead "[ NO RESOURCE STOCKPILE FOUND ]" 337
                                endif
                            endif

                            menu recycler 1
                            getlabel backpack backpacklabel

                            if insysmsg "0 recyclable"
                                break
                            else
                                if EnableAutoRecallOverheadMessages = 1
                                    overhead "[ ADDING TO RECYCLER... ]" 6
                                else
                                    overhead "  " 6
                                endif
                                wait 1500
                            endif
                        endif
                    endif                    
                    menu recycler 1
                    wait 500
                    if insysmsg "0 recyclable"
                        if EnableAutoRecallOverheadMessages = 1 and timer "inventorycheck" > 5000
                            overhead "[ NO MAGIC LOOT! ]" 6
                        elseif timer "inventorycheck" > 5000
                            overhead "  " 6
                        endif
                        break
                    else
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ ADDING TO RECYCLER... ]" 6
                        else
                            overhead "  " 6
                        endif
                        settimer "inventorycheck" 0
                        wait 1500
                    endif                    
                    wait 500
                    endfor
                elseif EnableAutoRecallOverheadMessages = 1
                    overhead "[ NO MAGIC ITEM RECYCLER FOUND ]" 337
                endif
            endif

            if EnableLootChest = 1
                dclick LootChest
                if EnableAutoRecallOverheadMessages = 1
                    overhead "[ STASHING LOOT... ]" 69
                else
                    overhead "  " 69
                endif
                wait 500
                for 2
                hotkey "Organizer Agent-06"
                wait 250
                hotkey "Organizer Agent-07"
                wait 250
                hotkey "Organizer Agent-08"
                wait 250
                hotkey "Organizer Agent-09"
                wait 250
                endfor
                while queued
                    wait 100
                endwhile
            endif

            if EnableStorageTomes = 1
                if findtype "book" ground -1 -1 2 as StorageTome or findtype "book" LootChest as StorageTome
                    while findtype "book" ground -1 -1 2 as StorageTome
                        menu StorageTome 0
                        if EnableAutoRecallOverheadMessages = 1 and timer "inventorycheck" > 3500
                            overhead "[ STORING TOME ITEMS... ]" 2117
                            settimer "inventorycheck" 0
                        elseif EnableAutoRecallOverheadMessages = 0 and timer "inventorycheck" > 3500
                            overhead "  " 2117
                            settimer "inventorycheck" 0
                        endif
                        wait 250
                        @ignore StorageTome
                    endwhile
                    while findtype "book" LootChest as StorageTome
                        menu StorageTome 0
                        if EnableAutoRecallOverheadMessages = 1 and timer "inventorycheck" > 3500
                            overhead "[ STORING TOME ITEMS... ]" 2117
                            settimer "inventorycheck" 0
                        elseif EnableAutoRecallOverheadMessages = 0 and timer "inventorycheck" > 3500
                            overhead "  " 2117
                            settimer "inventorycheck" 0
                        endif
                        wait 250
                        @ignore StorageTome
                    endwhile
                    @clearignore
                elseif EnableAutoRecallOverheadMessages = 1
                    overhead "[ NO STORAGE TOMES FOUND ]" 337
                    wait 1500
                endif
            endif
        endif

        if EnableStorageShelf = 1
            if findtype "storage shelf" ground -1 -1 2 as shelf
                if IHAVEDIED != 1
                    menu shelf 0
                    wft 500
                    target self
                    if EnableAutoRecallOverheadMessages = 1
                        overhead "[ STORING GOODS... ]" 2114
                    else
                        overhead "  " 2114
                    endif
                    wait 500
                    gumpclose 3232825965
                    wait 1000
                endif
                menu shelf 1
                if EnableAutoRecallOverheadMessages = 1
                    overhead "[ RESUPPLYING... ]" 93
                    wait 500
                else
                    overhead "  " 93
                endif
                wait 1000
            elseif EnableAutoRecallOverheadMessages = 1
                overhead "[ NO STORAGE SHELF FOUND ]" 337
                wait 1500
            endif
        endif
        
        if EnableResetInventoryAfterDeath = 1 and IHAVEDIED = 1
            clearignore

            if skill 'healing' > 0 and hp < maxhp and not bandaging
                if findtype 'clean bandage%s%' self
                    hotkey 'Bandage Self'
                    if EnableAutoRecallOverheadMessages = 1
                        overhead "[ BANDAGING... ]" 88
                        wait 500
                    endif
                endif
                wait 500
            endif

            if not varexist maininventorybag or not find maininventorybag self
                overhead "[ SELECT MAIN POUCH... ]" 253
                @setvar! maininventorybag
                wft 500
                while targetexists
                    wait 100
                endwhile
                overhead "[ MAIN POUCH SET! ]" 93
                wait 500
            endif

            lift maininventorybag
            wait 500
            drop backpack 69 69 0
            wait 500

            if EnableSetMainPouchOrganizer01 = 1
                hotkey 'Set Organizer Hotbag-01'
                wft 1000
                target maininventorybag
                if EnableAutoRecallOverheadMessages = 1
                    overhead "[ POUCH SET TO AGENT-01! ]" 84
                endif
                wait 500
            endif

            dclick maininventorybag
            wait 1000
            sysmsg "Auto-selecting your loot/grab bag..." 0
            hotkey 'Set Grab Item Hotbag'
            wft 1500

            while targetexists
                if findtype 'bag' self as grabbag
                    target grabbag
                    wait 500
                else
                    wait 1000
                    sysmsg "Auto-select failed!  Please manually target your loot/grab bag!" 0
                    wait 1000
                    overhead "[ SELECT GRAB BAG... ]" 253
                    wait 3500
                endif
                wait 500
            endwhile
            overhead "[ GRAB BAG SET! ]" 93
            wait 500

            if EnableLootBag = 1 
                if not find LootBag self
                    wait 500
                    overhead "Select your new loot bag..." 253
                    wait 500
                    @setvar! LootBag
                    wait 500
                    while targetexists
                        wait 100
                    endwhile
                endif
            endif

            if find grabbag self
                lift grabbag
                wait 500
                drop maininventorybag -1 -1 -1
                wait 500
                @ignore maininventorybag
            endif

            while findtype 'scissors' self
                if skill 'healing' > 0 and hp < maxhp and not bandaging
                    if findtype 'clean bandage%s%' self
                        hotkey 'Bandage Self'
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ BANDAGING... ]" 88
                        endif
                    else
                        if EnableAutoRecallOverheadMessages = 1
                            overhead "[ NO BANDAGES! ]" 337
                        endif
                    endif
                endif

                if findtype 'scissors' backpack as myscissors
                    if findtype 'pouch' self as trappedpouch
                        lift myscissors
                        wait 250
                        drop trappedpouch
                        wait 750
                        lift trappedpouch
                        wait 250
                        drop backpack 69 69 0
                        @ignore trappedpouch
                        @ignore myscissors
                    endif
                endif

                wait 500
                while queued
                    wait 100
                endwhile
            endwhile

            clearignore

            while findtype 'pouch' backpack as decoypouch
                getlabel decoypouch decoypouchlabel
                wait 250
                if '(1 items' in decoypouchlabel
                    lift decoypouch
                    drop backpack 97 97 0
                    break
                else
                    @ignore decoypouch
                endif
            endwhile

            if skill 'healing' > 0 and hp < maxhp and not bandaging
                if findtype 'clean bandage%s%' self
                    hotkey 'Bandage Self'
                    if EnableAutoRecallOverheadMessages = 1
                        overhead "[ BANDAGING... ]" 88
                        wait 500
                    endif
                else
                    if EnableAutoRecallOverheadMessages = 1
                        overhead "[ NO BANDAGES! ]" 337
                        wait 500
                    endif
                endif
            endif

            if findtype 'atlas' backpack as hidemypouchstack
                lift hidemypouchstack
                drop backpack 72 66 0
                wait 500
            else
                say "[atlas"
                wait 500
                if findtype 'atlas' backpack as hidemypouchstack
                    lift hidemypouchstack
                    drop backpack 72 66 0
                    wait 500
                endif
            endif

            if EnableAutoRecallOverheadMessages = 1
                overhead "[ ACTIVATING ASPECT... ]" 2234
                wait 500
            endif

            say "[aspect"
            waitforgump 2424293173
            gumpresponse 8
            wait 500
            gumpresponse 8
            wait 250
            gumpresponse 17
            wait 500
            gumpresponse 17
            wait 250
            gumpclose 2424293173
            dclick backpack
            wait 250

            if EnableWeaponCheck = 1 and skill 'Arcane' >= 80 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
                if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                    dclick myArcaneStaff
                    wait 500
                else
                    if timer "ArcaneStaffCheck" > 5000 and EnableAutoRecallOverheadMessages = 1
                        overhead "[ NO ARCANE STAFF! ]" 337
                        settimer "ArcaneStaffCheck" 0
                    endif
                endif
            endif

            if skill 'magery' >= 60 and hp < maxhp and mana >= 11 and not casting
                while hp < maxhp
                    cast 'greater heal'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'greater heal'
                    endwhile
                    while not targetexists
                        wait 100
                    endwhile
                    target 'self'
                    wait 500
                endwhile
            endif

            if findtype "storage shelf" ground -1 -1 2 as shelf
                menu shelf 1
                wait 500
            endif

            if find maininventorybag self
                dclick maininventorybag
                wait 500
            endif

            if findtype 'alchemists satchel' self as BagofPot
                dclick BagofPot
                wait 500
            endif

            if findtype 'reagent satchel' self as WizardBag
                dclick WizardBag
                wait 500
            endif

            if find grabbag self
                dclick grabbag
                wait 500
            endif

            clearignore
            @setvar! IHAVEDIED 0
            overhead "[ RESET COMPLETE! ]" 69
            wait 500
        endif


        if EnableUsePotionKegs = 1 and findtype 'empty bottle%s%' self and findtype 'keg' self
            @setvar! PotionStockCheck 0
            while PotionStockCheck < 7 and findtype 'empty bottle%s%' self
                if PotionStockCheck = 0 and ExplosionPotionAmount != 0
                    @setvar! PotionType 3853
                    @setvar! KegColour 419
                    @setvar! PotionAmounttoFill ExplosionPotionAmount
                    @setvar! PotionStockCheck 1
                elseif PotionStockCheck = 1 and HealingPotionAmount != 0
                    @setvar! PotionType 3852
                    @setvar! KegColour 253
                    @setvar! PotionAmounttoFill HealingPotionAmount
                    @setvar! PotionStockCheck 2
                elseif PotionStockCheck = 2 and CurePotionAmount != 0
                    @setvar! PotionType 3847
                    @setvar! KegColour 44
                    @setvar! PotionAmounttoFill CurePotionAmount
                    @setvar! PotionStockCheck 3
                elseif PotionStockCheck = 3 and RefreshPotionAmount != 0
                    @setvar! PotionType 3851
                    @setvar! KegColour 37
                    @setvar! PotionAmounttoFill RefreshPotionAmount
                    @setvar! PotionStockCheck 4
                elseif PotionStockCheck = 4 and StrengthPotionAmount != 0
                    @setvar! PotionType 3849
                    @setvar! KegColour 956
                    @setvar! PotionAmounttoFill StrengthPotionAmount
                    @setvar! PotionStockCheck 5
                elseif PotionStockCheck = 5 and AgilityPotionAmount != 0
                    @setvar! PotionType 3848
                    @setvar! KegColour 93
                    @setvar! PotionAmounttoFill AgilityPotionAmount
                    @setvar! PotionStockCheck 6
                elseif PotionStockCheck = 6 and ResistPotionAmount != 0
                    @setvar! PotionType 3846
                    @setvar! KegColour 1109
                    @setvar! PotionAmounttoFill ResistPotionAmount
                    @setvar! PotionStockCheck 7
                else
                    break
                endif
                
                while counttype PotionType self < PotionAmounttoFill
                    if not findtype 'empty bottle%s%' self
                        if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 5000
                            overhead "[ NO EMPTY BOTTLES... ]" 337
                            settimer 'PotionKegTimer' 0 
                        endif
                        break
                    endif
                    
                    if findtype 'keg' self KegColour as myKeg
                        dclick myKeg
                        wait 250
                        if EnableAutoRecallOverheadMessages = 1
                            if timer 'PotionKegTimer' > 2000
                                overhead '[ FILLING POTS... ]' KegColour
                                settimer 'PotionKegTimer' 0
                            endif
                        endif
                    else 
                        if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 5000
                            overhead "[ NO KEG TO USE... ]" KegColour
                            settimer 'PotionKegTimer' 0 
                        endif
                        break
                    endif
                endwhile
                
                if counttype PotionType self < PotionAmounttoFill and not findtype 'empty bottle%s%' self 
                    if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 5000
                        overhead "[ NO EMPTY BOTTLES... ]" 337
                        settimer 'PotionKegTimer' 0 
                    endif
                    break
                endif
            endwhile
        endif

        if EnableReagentSplitter = 1
            if findtype "reagent satchel" self
                while findtype "reagent satchel" self as MyWizardBag
                    getlabel MyWizardBag MyWizardBagdesc
                    if 'decorative' in MyWizardBagdesc
                        @ignore MyWizardBag
                    else
                        break
                    endif
                endwhile
                sysmsg "Disable 'EnableReagentSplitter' in script variables to turn off this feature!" 0
                dclick MyWizardBag
                wait 500
                if EnableAutoRecallOverheadMessages = 1 and timer "inventorycheck" > 3500
                    overhead "[ SPLITTING REGS... ]" 111
                    settimer "inventorycheck" 0
                elseif EnableAutoRecallOverheadMessages = 0 and timer "inventorycheck" > 3500
                    overhead "  " 111
                    settimer "inventorycheck" 0
                endif
                @setvar! amount 0
                @setvar! regsID 3981
                @setvar! myCounter 0
                while findtype regsID self as r
                    @setvar! myCounter index
                    @ignore r
                endwhile
                @clearignore
                if counttype regsID self <= 15
                    @setvar! amount 2
                elseif counttype regsID self <= 30
                    @setvar! amount 4
                elseif counttype regsID self <= 50
                    @setvar! amount 10
                elseif counttype regsID self <= 100
                    @setvar! amount 20
                elseif counttype regsID self <= 150
                    @setvar! amount 30
                elseif counttype regsID self <= 200
                    @setvar! amount 40
                else
                    @setvar! amount 50
                endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 65 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 65 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 65 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 65 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 65 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3962
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                    if moveRegs = 1
                        if index = 0
                            lift regs amount
                            drop MyWizardBag 44 76 0
                            wait 150
                        elseif index = 1
                            lift regs amount
                            drop MyWizardBag 68 76 0
                            wait 150
                        elseif index = 2
                            lift regs amount
                            drop MyWizardBag 96 76 0
                            wait 150
                        elseif index = 3
                            lift regs amount
                            drop MyWizardBag 121 76 0
                            wait 150
                        else
                            lift regs amount
                            drop MyWizardBag 142 76 0
                            wait 150
                        endif
                    endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3976
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 88 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 88 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 88 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 88 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 88 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3974
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 100 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 100 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 100 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 100 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 100 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3980
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 112 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 112 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 112 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 112 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 112 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3973
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 124 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 124 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 124 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 124 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 124 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3963
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 136 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 136 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 136 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 136 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 136 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3972
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 148 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 148 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 148 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 148 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 148 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 8012
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 5
                        @setvar! amount 1
                    elseif counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 40
                        @setvar! amount 8
                    else
                        @setvar! amount 15
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                elseif EnableAutoRecallOverheadMessages = 1
                    overhead "[ NO WIZARD BAG! ]" 337
                endif
            endif
            overhead "[ SCRIPT COMPLETE! ]" 88
            hotkey "Organizer Agent-01"
            @setvar! IHAVEDIED 0
            @setvar! DisableVacuums 0
            @setvar! TimeToGo 0
            @setvar! RedTargetFound 0
            @setvar! WarModeToggledWhileFighting 0
            @setvar! RECALLTIME 0
            stop
        endif
    endif

    //////////////////////////
    //   END AUTO RECALL    //
    //////////////////////////


    ///////////////////////////
    //  BEGIN HEALING LOOP:  //
    ///////////////////////////

    while diffhits >= ActivateAutoHealHPdiff or poisoned
        if dead
            replay
        endif

        if EnablePKradar = 1
            if timer "PKRadar" > 1000
                hotkey 'Next Murderer Player Target'
                wait 500
                if insysmsg "No one matching that was found"
                    settimer "PKRadar" 0
                    clearsysmsg
                else
                    hotkey 'Toggle Peace Only'
                    @setvar! RedTargetFound 1
                    @setvar! TimeToGo 1
                    @setvar! MurdererTarget lasttarget
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    replay
                endif
            endif
        endif

        if EnableTrackingAutoRecall = 1
            if PKTrackingRange = 60
                if insysmsg ": 60 step" or insysmsg "60 space" or insysmsg ": 59 step" or insysmsg "59 space" or insysmsg ": 58 step" or insysmsg "58 space" or insysmsg ": 57 step" or insysmsg "57 space" or insysmsg ": 56 step" or insysmsg "56 space" or insysmsg ": 55 step" or insysmsg "55 space" or insysmsg ": 54 step" or insysmsg "54 space" or insysmsg ": 53 step" or insysmsg "53 space" or insysmsg ": 52 step" or insysmsg "52 space" or insysmsg ": 51 step" or insysmsg "51 space" or insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            elseif PKTrackingRange = 50
                if insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            elseif PKTrackingRange = 40
                if insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            elseif PKTrackingRange = 0
                if insysmsg "Now tracking"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            endif
        endif

        if insysmsg "world is saving"
            settimer "WorldSaveTimer" 0
            if EnableOverheadMessages = 1
                overhead "[ WORLD SAVING... ]" 253
            endif 
            while timer "WorldSaveTimer" < 4500
                if insysmsg "save complete"
                    break
                endif
                wait 100
            endwhile   
            if EnableOverheadMessages = 1
                overhead "[ SAVE COMPLETE! ]" 253
            endif 
        endif

        if EnableStrengthPotion = 1 and diffhits < ActivateAutoHealHPdiff 
            if skill 'Alchemy' > 0 and skill 'Alchemy' < 2
                if insysmsg "You may now use a strength" or not findbuff "Strength"
                    if findtype "White Potion" self
                        dclicktype "White Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ STRENGTH POTION ]" 956
                        endif
                        wait 250
                    else
                        if timer whiteMessageTimer > 4500
                            overhead "[ NO STRENGTH POTS! ]" 337
                            settimer whiteMessageTimer 0
                        endif
                    endif 
                    clearsysmsg
                endif
            else
                if not findbuff "Strength"
                    if findtype "White Potion" self
                        dclicktype "White Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ STRENGTH POTION ]" 956
                        endif
                        wait 250
                    else
                        if timer whiteMessageTimer > 4500
                            overhead "[ NO STRENGTH POTS! ]" 337
                            settimer whiteMessageTimer 0
                        endif
                    endif
                endif
            endif 
        endif 

        if EnableCurePotion = 1 or EnableCastCure = 1
            while poisoned
                if findtype "Orange Potion" self
                    dclicktype "Orange Potion"
                    if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                        overhead "[ CURE POTION ]" 44
                        settimer 'orangeMessageTimer' 0
                    endif 
                    wait 500
                else
                    if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                        overhead "[ NO CURE POTS! ]" 337
                        settimer 'orangeMessageTimer' 0
                    endif

                    if diffhits >= 30 or not findtype 3972 self or not findtype 3973 self
                        break
                    endif

                    if skill 'magery' >= 40 and mana >= 6 and EnableCastCure = 1 and not casting
                        cast 'cure'
                        wait 50
                        while not casting
                            if targetexists
                                hotkey 'cancel current target'
                            endif
                            cast 'cure'
                            wait 50
                        endwhile
                        while not targetexists
                            wait 100
                        endwhile
                        wft 1000
                        target 'self'
                        wait 500
                    else
                        break
                    endif
                endif
            endwhile
        endif

        if diffhits >= HealPotionHPdiff and EnableHealPotion = 1
            if findtype "Yellow Potion" self as hPot
                getlabel hPot potLabel
                if "next" in potLabel
                    #do nothing
                else
                    @setvar! ch 0

                    if counttype 3852 self as c
                        @setvar! ch c
                    endif
                    if insysmsg "potion satchel used"
                    endif

                    dclicktype 3852
                    getlabel backpack packdesc
                    wait 250

                    if ch != counttype 3852 self or insysmsg "potion satchel used"
                        settimer 'HealPotionTimer' 0
                        cooldown "Healing Potion" 11000
                        if EnableOverheadMessages = 1
                            overhead "[ HEAL POTION ]" 253
                        endif 
                    endif
                endif
            else
                if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO HEAL POTS! ]" 337
                    settimer 'yellowMessageTimer' 0
                endif
            endif
        endif

        if skill 'Cooking' >= 50 and timer 'HealPotionTimer' < 11000 and EnableEatSnackstoHeal = 1 and diffhits > EatSnacktoHealHPdiff
            if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as mysnack
                if timer 'SnackTimer' > 60000
                    if EnableOverheadMessages = 1
                        overhead "[ HP MUNCHING... ]" 420
                    endif
                    dclick mysnack
                    wait 500
                    settimer 'SnackTimer' 0
                    cooldown "Snacking" 60000
                endif
            endif
        endif

        if not findtype 3972 self or not findtype 3973 self or not findtype 3974 self or not findtype 3981 self
            @setvar! missingGreaterHealRegs 1
        else
            @setvar! missingGreaterHealRegs 0
        endif

        if not findtype 3972 self or not findtype 3973 self or not findtype 3974 self
            @setvar! missingHealRegs 1
        else
            @setvar! missingHealRegs 0
        endif

        if missingGreaterHealRegs = 1 or missingHealRegs = 1
            if timer noRegsMessageTimer > 4000
                overhead "[ MISSING HEALING REGS! ]" 337
                settimer noRegsMessageTimer 0
            endif
        endif 

        @setvar! SpellInterrupted 0
        
        if skill 'magery' >= 40 and diffhits >= CastHealHPdiff and mana >= 4 and EnableCastHeal = 1 and not casting and missingHealRegs != 1
            cast 'heal'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'heal'
            endwhile

            while not targetexists
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target 'self'
            endif
        elseif skill 'magery' >= 40 and diffhits >= CastEmergencyHealHPdiff and mana >= 4 and EnableCastHeal = 1 and not casting and missingHealRegs != 1
            cast 'heal'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'heal'
            endwhile

            while not targetexists
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target 'self'
            endif
        elseif skill 'magery' >= 60 and diffhits >= CastGreaterHealHPdiff and mana >= 11 and EnableCastGreaterHeal = 1 and not casting and missingGreaterHealRegs != 1
            cast 'greater heal'
            while not casting
                cast 'greater heal'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD

                if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                                    overhead "[ CURE POTION ]" 44
                                    settimer 'orangeMessageTimer' 0
                                endif 
                                wait 500
                            else
                                if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer 'orangeMessageTimer' 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif

                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    settimer 'HealPotionTimer' 0
                                    cooldown "Healing Potion" 11000
                                    if EnableOverheadMessages = 1
                                        overhead "[ HEAL POTION ]" 253
                                    endif 
                                    if diffhits < ActivateAutoHealHPdiff
                                        interrupt
                                    endif
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 5000 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile
            if SpellInterrupted = 0
                target 'self'
            endif
        endif

        @setvar! SpellInterrupted 0

        if paralyzed and EnableAutoParalyzePouch = 1
            if findtype "pouch" self 
                yell "[pouch"
                wait 250
            else
                if timer pouchMessageTimer > 5000 and EnableOverheadMessages = 1
                    overhead "[ NO MORE POUCHES! ]" 337
                    settimer pouchMessageTimer 0
                endif
            endif
        endif

        if insysmsg "to be locked"
            clearsysmsg 
            replay
        endif

        if EnableStrengthPotion = 1 and diffhits < ActivateAutoHealHPdiff 
            if skill 'Alchemy' > 0 and skill 'Alchemy' < 2
                if insysmsg "You may now use a strength" or not findbuff "Strength"
                    if findtype "White Potion" self
                        dclicktype "White Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ STRENGTH POTION ]" 956
                        endif
                        wait 250
                    else
                        if timer whiteMessageTimer > 4500
                            overhead "[ NO STRENGTH POTS! ]" 337
                            settimer whiteMessageTimer 0
                        endif
                    endif 
                    clearsysmsg
                endif
            else
                if not findbuff "Strength"
                    if findtype "White Potion" self
                        dclicktype "White Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ STRENGTH POTION ]" 956
                        endif
                        wait 250
                    else
                        if timer whiteMessageTimer > 4500
                            overhead "[ NO STRENGTH POTS! ]" 337
                            settimer whiteMessageTimer 0
                        endif
                    endif
                endif
            endif 
        endif 

        if EnableAgilityPotion = 1 and not findbuff "Agility"
            if findtype "Blue Potion" self
                dclicktype "Blue Potion"
                if EnableOverheadMessages = 1
                    overhead "[ AGILITY POTION ]" 93
                endif 
                wait 250
            else
                if timer blueMessageTimer > 4500 and EnableOverheadMessages = 1
                overhead "[ NO AGILITY POTS! ]" 337
                    settimer blueMessageTimer 0
                endif
            endif
        endif

        if EnableResistPotion = 1 and not findbuff "Magic Resist"
            if findtype "Black Potion" self
                dclicktype "Black Potion"
                if EnableOverheadMessages = 1
                    overhead "[ RESIST POTION ]" 1109
                endif 
                wait 250
            else
                if timer blackMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO RESIST POTS! ]" 337
                    settimer blackMessageTimer 0
                endif
            endif
        endif

        if EnableRefreshPotion = 1 and diffstam > RefreshPotionSPdiff
            if findtype "Red Potion" self
                dclicktype "Red Potion"
                if EnableOverheadMessages = 1
                    overhead "[ REFRESH POTION ]" 37
                endif 
                wait 250
            else
                if timer redMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO REFRESH POTS! ]" 337
                    settimer redMessageTimer 0
                endif
            endif
        endif

        if EnableWeightWarningMessage = 1
            if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING... ]" 77
                    settimer "WeightTimer" 0
                else
                    overhead "  " 77
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING! ]" 153
                    settimer "WeightTimer" 0
                else
                    overhead "  " 153
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT LIMIT REACHED! ]" 37
                    settimer "WeightTimer" 0
                else
                    overhead "  " 37
                    settimer "WeightTimer" 0
                endif

                if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    wait 1000
                    hotkey 'Toggle Peace Only'
                    @setvar! AutoWeightRecall 1
                    replay
                elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    if timer "RECALLDELAY" > 3500 and EnableAutoRecallOverheadMessages = 1
                        overhead "[ WAITING TO RECALL... ]" 149
                        settimer "RECALLDELAY" 0
                    endif
                    wait 500
                elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                    wait 500
                    hotkey 'Toggle Peace Only'
                    @setvar! TimeToGo 1
                    replay
                else
                    if EnableOverheadMessages = 1
                        overhead "[ OVERWEIGHT! ]" 337
                    else
                        overhead "  " 337
                    endif
                    wait 1500
                    overhead "[ STOPPING SCRIPT! ]" 88
                endif
            endif
        endif

        if EnableUsePotionKegs = 1 and findtype 'empty bottle%s%' self and findtype 'keg' self and diffhits < ActivateAutoHealHPdiff 
            @setvar! PotionStockCheck 0

            while PotionStockCheck < 7 and findtype 'empty bottle%s%' backpack
                if diffhits > ActivateAutoHealHPdiff 
                    replay
                endif 

                if PotionStockCheck = 0 and ExplosionPotionAmount != 0
                    @setvar! PotionType 3853
                    @setvar! KegColour 419
                    @setvar! PotionAmounttoFill ExplosionPotionAmount
                    @setvar! PotionStockCheck 1
                elseif PotionStockCheck = 1 and HealingPotionAmount != 0
                    @setvar! PotionType 3852
                    @setvar! KegColour 253
                    @setvar! PotionAmounttoFill HealingPotionAmount
                    @setvar! PotionStockCheck 2
                elseif PotionStockCheck = 2 and CurePotionAmount != 0
                    @setvar! PotionType 3847
                    @setvar! KegColour 44
                    @setvar! PotionAmounttoFill CurePotionAmount
                    @setvar! PotionStockCheck 3
                elseif PotionStockCheck = 3 and RefreshPotionAmount != 0
                    @setvar! PotionType 3851
                    @setvar! KegColour 37
                    @setvar! PotionAmounttoFill RefreshPotionAmount
                    @setvar! PotionStockCheck 4
                elseif PotionStockCheck = 4 and StrengthPotionAmount != 0
                    @setvar! PotionType 3849
                    @setvar! KegColour 956
                    @setvar! PotionAmounttoFill StrengthPotionAmount
                    @setvar! PotionStockCheck 5
                elseif PotionStockCheck = 5 and AgilityPotionAmount != 0
                    @setvar! PotionType 3848
                    @setvar! KegColour 93
                    @setvar! PotionAmounttoFill AgilityPotionAmount
                    @setvar! PotionStockCheck 6
                elseif PotionStockCheck = 6 and ResistPotionAmount != 0
                    @setvar! PotionType 3846
                    @setvar! KegColour 1109
                    @setvar! PotionAmounttoFill ResistPotionAmount 
                    @setvar! PotionStockCheck 7
                else 
                    replay
                endif

                while counttype PotionType self < PotionAmounttoFill
                    if diffhits > ActivateAutoHealHPdiff 
                        replay
                    endif 

                    if not findtype 'empty bottle%s%' self
                        if EnableOverheadMessages = 1
                            overhead "[ NO EMPTY BOTTLES ]" 337
                        endif 
                        replay
                    endif

                    if findtype 'keg' self KegColour as myKeg
                        dclick myKeg
                        while queued
                            wait 250
                        endwhile   
                    else 
                        break      
                    endif 

                    if insysmsg 'You pour some'
                        if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 3500
                            overhead '[ FILLING POTS... ]' KegColour
                            clearsysmsg
                            settimer 'PotionKegTimer' 0
                        else 
                            overhead '  ' KegColour
                        endif 
                    elseif insysmsg 'You must wait'
                        wait 250 
                        clearsysmsg
                    endif
                endwhile

                if counttype PotionType self < PotionAmounttoFill and not findtype 'empty bottle%s%' backpack
                    if EnableOverheadMessages = 1
                        overhead "[ NO EMPTY BOTTLES ]" 337
                    endif 
                    replay
                endif
            endwhile
        endif 
    endwhile

    ////////////////////////
    //  END HEALING LOOP  //
    ////////////////////////

    ///////////////////////
    //      CHECKS:      //
    ///////////////////////

    if EnableUsePotionKegs = 1 and findtype 'empty bottle%s%' self and findtype 'keg' self and diffhits < ActivateAutoHealHPdiff 
        @setvar! PotionStockCheck 0

        while PotionStockCheck < 7 and findtype 'empty bottle%s%' backpack
            if diffhits > ActivateAutoHealHPdiff 
                replay
            endif 

            if PotionStockCheck = 0 and ExplosionPotionAmount != 0
                @setvar! PotionType 3853
                @setvar! KegColour 419
                @setvar! PotionAmounttoFill ExplosionPotionAmount
                @setvar! PotionStockCheck 1
            elseif PotionStockCheck = 1 and HealingPotionAmount != 0
                @setvar! PotionType 3852
                @setvar! KegColour 253
                @setvar! PotionAmounttoFill HealingPotionAmount
                @setvar! PotionStockCheck 2
            elseif PotionStockCheck = 2 and CurePotionAmount != 0
                @setvar! PotionType 3847
                @setvar! KegColour 44
                @setvar! PotionAmounttoFill CurePotionAmount
                @setvar! PotionStockCheck 3
            elseif PotionStockCheck = 3 and RefreshPotionAmount != 0
                @setvar! PotionType 3851
                @setvar! KegColour 37
                @setvar! PotionAmounttoFill RefreshPotionAmount
                @setvar! PotionStockCheck 4
            elseif PotionStockCheck = 4 and StrengthPotionAmount != 0
                @setvar! PotionType 3849
                @setvar! KegColour 956
                @setvar! PotionAmounttoFill StrengthPotionAmount
                @setvar! PotionStockCheck 5
            elseif PotionStockCheck = 5 and AgilityPotionAmount != 0
                @setvar! PotionType 3848
                @setvar! KegColour 93
                @setvar! PotionAmounttoFill AgilityPotionAmount
                @setvar! PotionStockCheck 6
            elseif PotionStockCheck = 6 and ResistPotionAmount != 0
                @setvar! PotionType 3846
                @setvar! KegColour 1109
                @setvar! PotionAmounttoFill ResistPotionAmount 
                @setvar! PotionStockCheck 7
            else 
                replay
            endif

            while counttype PotionType self < PotionAmounttoFill
                if diffhits > ActivateAutoHealHPdiff 
                    replay
                endif 

                if not findtype 'empty bottle%s%' self
                    if EnableOverheadMessages = 1
                        overhead "[ NO EMPTY BOTTLES ]" 337
                    endif 
                    replay
                endif

                if findtype 'keg' self KegColour as myKeg
                    dclick myKeg
                    while queued
                        wait 250
                    endwhile        
                else 
                    break 
                endif 

                if insysmsg 'You pour some'
                    if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 3500
                        overhead '[ FILLING POTS... ]' KegColour
                        clearsysmsg
                        settimer 'PotionKegTimer' 0
                    else 
                        overhead '  ' KegColour
                    endif 
                elseif insysmsg 'You must wait'
                    wait 250 
                    clearsysmsg
                endif
            endwhile

            if counttype PotionType self < PotionAmounttoFill and not findtype 'empty bottle%s%' backpack
                if EnableOverheadMessages = 1
                    overhead "[ NO EMPTY BOTTLES ]" 337
                endif 
                replay
            endif
        endwhile
    endif 

    if EnableGoldVacuum = 1 and DisableVacuums != 1
        if findtype "gold coin" ground -1 -1 12 as droppedmoney and timer "GoldRadar" > 3500
            overhead "  " 149 droppedmoney
            settimer "GoldRadar" 0
        endif
        while findtype "gold coin" ground -1 -1 2 as droppedmoney and diffhits < ActivateAutoHealHPdiff
            overhead "  " 149
            hotkey "Grab Item"
            wft 2500
            target droppedmoney
            wait 250
            if insysmsg "Invalid or inaccessible item"
                wait 500
                @ignore droppedmoney
            endif
            wait 250
        endwhile
    endif

    if EnableDungeonCleanup = 1 and diffhits < ActivateAutoHealHPdiff 
        while findtype "iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 2 as item
            if EnableOverheadMessages = 1 
                if timer "DungeonCleanup" > 1500
                    overhead '[ CLEANUP... ]' 420
                    settimer "DungeonCleanup" 0
                endif 
            else
                if timer "DungeonCleanup" > 1500
                    overhead '  ' 420
                    settimer "DungeonCleanup" 0
                endif 
            endif
            hotkey "Grab Item"
            wft 1000
            target item
            wait 500                    
        endwhile

        if findtype "gold coin|iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 15 as dungeonjunk and timer "DungeonCleanupRadar" > 3500
            overhead "" 420 dungeonjunk
            settimer "DungeonCleanupRadar" 0
        endif
    endif

    while EnableAutoCarving = 1 and findtype "corpse" ground -1 -1 2 as deadbody and diffhits < ActivateAutoHealHPdiff and findtype 11552 backpack
        if timer SkinningTimer > 5000
            if targetexists
                hotkey 'cancel current target'
            endif
            while not targetexists
                skill 'forensicevaluation'
            endwhile
            if targetexists and find deadbody ground -1 -1 2
                if EnableOverheadMessages = 1
                    overhead "[ SKINNING... ]" 333
                endif
                target 'self'
                @ignore deadbody
                settimer SkinningTimer 0
            endif
        endif
    endwhile

    if EnablePKradar = 1
        if timer "PKRadar" > 1000
            hotkey 'Next Murderer Player Target'
            wait 500
            if insysmsg "No one matching that was found"
                settimer "PKRadar" 0
                clearsysmsg
            else
                hotkey 'Toggle Peace Only'
                @setvar! RedTargetFound 1
                @setvar! TimeToGo 1
                @setvar! MurdererTarget lasttarget
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                replay
            endif
        endif
    endif

    if EnableTrackingAutoRecall = 1
        if PKTrackingRange = 60
            if insysmsg ": 60 step" or insysmsg "60 space" or insysmsg ": 59 step" or insysmsg "59 space" or insysmsg ": 58 step" or insysmsg "58 space" or insysmsg ": 57 step" or insysmsg "57 space" or insysmsg ": 56 step" or insysmsg "56 space" or insysmsg ": 55 step" or insysmsg "55 space" or insysmsg ": 54 step" or insysmsg "54 space" or insysmsg ": 53 step" or insysmsg "53 space" or insysmsg ": 52 step" or insysmsg "52 space" or insysmsg ": 51 step" or insysmsg "51 space" or insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
                replay
            endif
        elseif PKTrackingRange = 50
            if insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
                replay
            endif
        elseif PKTrackingRange = 40
            if insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
                replay
            endif
        elseif PKTrackingRange = 0
            if insysmsg "Now tracking"
                hotkey 'Toggle Peace Only'
                if EnableRedAlertOverhead = 1
                    overhead "[ !! RED ALERT !! ]" 37
                endif
                @setvar! RedTargetFound 1
                @setvar! WarModeToggledWhileFighting 0
                clearsysmsg
                replay
            endif
        endif
    endif

    if insysmsg "world is saving"
        settimer "WorldSaveTimer" 0
        if EnableOverheadMessages = 1
            overhead "[ WORLD SAVING... ]" 253
        endif 
        while timer "WorldSaveTimer" < 4500
            if insysmsg "save complete"
                break
            endif
            wait 100
        endwhile   
        if EnableOverheadMessages = 1
            overhead "[ SAVE COMPLETE! ]" 253
        endif 
    endif

    if timer 'OrganizerAgentTimer' > 30000
        hotkey "Organizer Agent-01"
        settimer 'OrganizerAgentTimer' 0
    endif

    if EnableWeaponCheck = 1 and skill 'Arcane' >= 50 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
        if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
            for 5
            if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                getlabel myArcaneStaff myArcaneStafflabel            
                if "Aspect" in myArcaneStafflabel
                    break
                elseif "unidentified" in myArcaneStafflabel
                    ignore myArcaneStaff
                else 
                    break 
                endif 
            endif 
            endfor 
            dclick myArcaneStaff
            clearignore 
            wait 500
        else
            if timer "ArcaneStaffCheck" > 5000 and EnableOverheadMessages = 1
                overhead "[ NO ARCANE STAFF! ]" 337
                settimer "ArcaneStaffCheck" 0
            endif
        endif
    endif

    if counttype 29012 self = 0 and EnableMagicMushroomMaker = 1
        while counttype 29012 self < MakeMushroomAmount and mana > 3 and diffhits < ActivateAutoHealHPdiff
            if not casting
                cast 'create food'
            endif
            if diffhits > ActivateAutoHealHPdiff
                break
            endif 
        endwhile
    endif

    if EnableEatMagicMushrooms = 1
        if diffmana > EatMushroomManadiff and MakeMushroomAmount > 0 and timer MushroomTimer > MagicMushroomCooldown
            if counttype 29012 backpack

                dclicktype 29012 backpack
                getlabel backpack packdesc
                wait 250

                if insysmsg "You consume a magic mushroom"
                    settimer MushroomTimer 0
                    cooldown "Mushroom" MagicMushroomCooldown
                    if EnableOverheadMessages = 1
                        overhead "[ EATING SHROOMS... ]" 12
                    endif
                endif
            elseif EnableOverheadMessages = 1
                overhead "[ OUT OF SHROOMS! ]" 337
            endif
        endif
    endif
    
    if skill 'Cooking' >= 50 and EnableManaSnacking = 1
        if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as mysnack
            if not timerexists 'SnackTimer'
                createtimer 'SnackTimer'
                settimer 'SnackTimer' EatSnackCooldown
            endif
            if timer 'SnackTimer' > EatSnackCooldown and diffmana > EatSnackManadiff
                if EnableOverheadMessages = 1
                    overhead "[ MANA MUNCHING... ]" 420
                endif                
                dclick mysnack
                wait 500
                settimer 'SnackTimer' 0
                cooldown "Snacking" EatSnackCooldown
            endif
        else
            if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                overhead "[ NO MORE FOOD! ]" 337
                settimer foodMessageTimer 0
            endif
        endif
    elseif not findbuff "food"
        if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as food
            dclick food
            wait 500
        else
            if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                overhead "[ NO MORE FOOD! ]" 337
                settimer foodMessageTimer 0
            endif
        endif
    endif

    if EnableMagicReflection = 1 and skill 'magery' >= 70 and not findbuff "Magic Reflection" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and timer magicReflectTimer > 15000 and findtype 3972 self and findtype 3974 self and findtype 3981 self and not find ClosestTarget ground -1 -1 12
        @setvar! SpellInterrupted 0
        cast 'Magic Reflection'
        while not casting
            getlabel backpack packdesc
            wait 250
            if insysmsg "that spell will not" or insysmsg "that spell is already"
                settimer magicReflectTimer 0
                break
            endif
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Magic Reflection'
        endwhile

        while casting
            if diffhits >= 50
                interrupt
                @setvar! SpellInterrupted 1
                break
            endif

            if EnableCurePotion = 1
                while poisoned and casting and not targetexists
                    if findtype "Orange Potion" self
                        dclicktype "Orange Potion"
                        if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                            overhead "[ CURE POTION ]" 44
                            settimer 'orangeMessageTimer' 0
                        endif 
                        wait 500
                    else
                        if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                            overhead "[ NO CURE POTS! ]" 337
                            settimer 'orangeMessageTimer' 0
                        endif
                        break
                    endif
                endwhile
            endif

            if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                if findtype "Yellow Potion" self as hPot
                    getlabel hPot potLabel
                    if "next" in potLabel
                        #do nothing
                    else
                        @setvar! ch 0

                        if counttype 3852 self as c
                            @setvar! ch c
                        endif
                        if insysmsg "potion satchel used"
                        endif
                        dclicktype 3852
                        getlabel backpack packdesc
                        wait 250

                        if ch != counttype 3852 self or insysmsg "potion satchel used"
                            settimer 'HealPotionTimer' 0
                            cooldown "Healing Potion" 11000
                            if EnableOverheadMessages = 1
                                overhead "[ HEAL POTION ]" 253
                            endif 
                        endif
                    endif
                else
                    if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                        overhead "[ NO HEAL POTS! ]" 337
                        settimer 'yellowMessageTimer' 0
                    endif
                endif
            endif
        endwhile
        wait 500
    endif

    if EnableReactiveArmour = 1 and skill 'magery' >= 30 and not findbuff "Reactive Armor" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and timer armorReflectTimer > 15000 and findtype 3980 self and findtype 3972 self and findtype 3981 self and not find ClosestTarget ground -1 -1 12
        cast 'Reactive Armor'
        while not casting
            getlabel backpack packdesc
            wait 250
            if insysmsg "that spell will not" or insysmsg "that spell is already"
                settimer armorReflectTimer 0
                break
            endif
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Reactive Armor'
        endwhile

        while casting
        endwhile
        getlabel backpack packdesc
        wait 250
    endif

    if EnableProtection = 1 and skill 'magery' >= 40 and not findbuff "Protection" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and findtype 3980 self and findtype 3972 self and findtype 3973 self and not find ClosestTarget ground -1 -1 12
        cast 'Protection'
        while not casting
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Protection'
        endwhile
        while casting
        endwhile
        wait 250
    endif

    if EnableBless = 1 and skill 'magery' >= 50 and not findbuff "Cunning" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and findtype 3972 self and findtype 3974 self and not find ClosestTarget ground -1 -1 12
        cast 'Bless'
        while not casting
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Bless'
            wait 50
        endwhile

        while not targetexists
            wait 100
        endwhile

        wft 1000
        target 'self'
        wait 250
    endif


    /////////////////////////
    //     FIND TARGET:    //
    /////////////////////////

    if find ClosestTarget ground -1 -1 12
        if not timerexists "AttackingTimer"
            createtimer "AttackingTimer" 
            settimer "AttackingTimer" 500
        endif 
        if timer "AttackingTimer" > 500 
            attack ClosestTarget
            settimer "AttackingTimer" 0
        endif
    else 

        ////////////////////////////
        //     NO TARGET LOOP:    //
        ////////////////////////////

        if targetexists
            hotkey 'cancel current target'
        endif

        hotkey 'target closest grey monster'
        wait 500
        @setvar TargetToAnalyze lasttarget

        if not find TargetToAnalyze ground -1 -1 12 
            if timer noTargetMessageTimer > 4000
                if EnableOverheadMessages = 1
                    overhead '[ NOTHING TO TARGET... ]' 2338
                else
                    overhead '  ' 2338
                endif
                settimer noTargetMessageTimer 0
            endif

            if weight > maxweight and EnableDropGoldWhenOverweight = 1
                if timer overweightMessageTimer > 4500
                    overhead "[ OVERWEIGHT! ]" 34
                    settimer overweightMessageTimer 0
                endif

                if DropGoldAmount != 0
                    clearignore
                    @setvar! DisableVacuums 1
                    wait 250 

                    if EnablePutLootinLockBox = 1
                        if findtype "wooden box" self as lockbox
                            if findtype "copper key" self as key
                                clearignore
                                getlabel lockbox lockboxlabel
                                wait 100
                                if "items" in lockboxlabel
                                    // Do nothing
                                else
                                    dclick key
                                    wft 1500
                                    target lockbox
                                    if EnableOverheadMessages = 1
                                        overhead "[loot box unlocked]" 84
                                    endif
                                    wait 500
                                    if insysmsg "It appears to be locked."
                                        dclick key
                                        wft 1500
                                        target lockbox
                                        wait 250
                                    endif
                                endif
                            elseif EnableOverheadMessages = 1
                                overhead "[ NO LOCKBOX KEY! ]" 337
                            endif
                        endif
                    endif

                    while weight > maxweight and diffhits < ActivateAutoHealHPdiff
                        if findtype "gold coin" self as easycomeeasygo
                            lift easycomeeasygo DropGoldAmount
                            droprelloc 0 0
                            getlabel backpack packdesc
                            if EnableOverheadMessages = 1
                                overhead "[ DROPPING GOLD... ]" 149
                            endif
                            wait 250
                            if insysmsg "cannot drop anything"
                                drop backpack -1 -1 -1
                                break 
                            endif
                            wait 250
                        else 
                            break 
                        endif
                    endwhile
                endif
            endif

            if EnableUsePotionKegs = 1 and findtype 'empty bottle%s%' self and findtype 'keg' self and diffhits < 10
                @setvar! PotionStockCheck 0
                while PotionStockCheck < 7 and findtype 'empty bottle%s%' self and diffhits < 10
                    if PotionStockCheck = 0 and ExplosionPotionAmount != 0
                        @setvar! PotionType 3853
                        @setvar! KegColour 419
                        @setvar! PotionAmounttoFill ExplosionPotionAmount
                        @setvar! PotionStockCheck 1
                    elseif PotionStockCheck = 1 and HealingPotionAmount != 0
                        @setvar! PotionType 3852
                        @setvar! KegColour 253
                        @setvar! PotionAmounttoFill HealingPotionAmount
                        @setvar! PotionStockCheck 2
                    elseif PotionStockCheck = 2 and CurePotionAmount != 0
                        @setvar! PotionType 3847
                        @setvar! KegColour 44
                        @setvar! PotionAmounttoFill CurePotionAmount
                        @setvar! PotionStockCheck 3
                    elseif PotionStockCheck = 3 and RefreshPotionAmount != 0
                        @setvar! PotionType 3851
                        @setvar! KegColour 37
                        @setvar! PotionAmounttoFill RefreshPotionAmount
                        @setvar! PotionStockCheck 4
                    elseif PotionStockCheck = 4 and StrengthPotionAmount != 0
                        @setvar! PotionType 3849
                        @setvar! KegColour 956
                        @setvar! PotionAmounttoFill StrengthPotionAmount
                        @setvar! PotionStockCheck 5
                    elseif PotionStockCheck = 5 and AgilityPotionAmount != 0
                        @setvar! PotionType 3848
                        @setvar! KegColour 93
                        @setvar! PotionAmounttoFill AgilityPotionAmount
                        @setvar! PotionStockCheck 6
                    elseif PotionStockCheck = 6 and ResistPotionAmount != 0
                        @setvar! PotionType 3846
                        @setvar! KegColour 1109
                        @setvar! PotionAmounttoFill ResistPotionAmount
                        @setvar! PotionStockCheck 7
                    else
                        break
                    endif
                    
                    while counttype PotionType self < PotionAmounttoFill and diffhits < 10
                        if diffhits > 10
                            replay
                        endif 

                        if not findtype 'empty bottle%s%' self
                            if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 5000
                                overhead "[ NO EMPTY BOTTLES... ]" 337
                                settimer 'PotionKegTimer' 0 
                            endif
                            break
                        endif
                        
                        if findtype 'keg' self KegColour as myKeg
                            dclick myKeg
                            wait 250
                            if EnableOverheadMessages = 1
                                if timer 'PotionKegTimer' > 2000
                                    overhead '[ FILLING POTS... ]' KegColour
                                    settimer 'PotionKegTimer' 0
                                endif
                            endif
                        else 
                            if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 5000
                                overhead "[ NO KEG TO USE... ]" KegColour
                                settimer 'PotionKegTimer' 0 
                            endif
                            break
                        endif
                    endwhile
                        
                    if counttype PotionType self < PotionAmounttoFill and not findtype 'empty bottle%s%' self 
                        if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 5000
                            overhead "[ NO EMPTY BOTTLES... ]" 337
                            settimer 'PotionKegTimer' 0 
                        endif
                        break
                    endif
                endwhile
            endif
            
            if not warmode 
                if EnableAutoRedRecall = 1 or EnableAutoWeightRecall = 1 and WILDERNESSMODE = 1
                    overhead "[ RECALLING IN... ]" 2114
                    if warmode
                        break
                    endif
                    wait 500
                    overhead "3" 69
                    wait 1000
                    if warmode
                        break
                    endif
                    overhead "2" 69
                    wait 1000
                    if warmode
                        break
                    endif
                    overhead "1" 69
                    wait 500
                    if warmode
                        break
                    else
                        @setvar! AutoRecallTime 1
                        hotkey 'Toggle Peace Only'
                        replay
                    endif
                elseif EnableAutoRedDungeonGate = 1 or EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                    if EnableOverheadMessages = 1
                        overhead "[ DUNGEON ESCAPE! ]" 337
                    else
                        overhead "  " 337
                    endif
                    settimer "RUNAWAY" 2000
                    @setvar! TimeToGo 1
                    @setvar! WarModeToggledWhileFighting 0
                    hotkey 'Toggle Peace Only'
                    replay
                endif
            endif

            if EnableHealPotion = 1 and diffhits >= HealPotionHPdiff
                if findtype "Yellow Potion" self as HealPot
                    getlabel HealPot HealPotlabel
                    if "next" in HealPotlabel
                        // Do nothing
                    else
                        @setvar! HealPotionCheck 0

                        if counttype 3852 self as HealPotCount
                            @setvar! HealPotionCheck HealPotCount
                        endif

                        clearsysmsg
                        dclicktype 3852
                        getlabel backpack backpackdesc
                        wait 250

                        if HealPotionCheck != counttype 3852 self or insysmsg "potion satchel used"
                            settimer 'HealPotionTimer' 0
                            cooldown "Healing Potion" HealingPotionCooldown
                            if EnableOverheadMessages = 1
                                if insysmsg "potion satchel used"
                                    overhead '[ FREE HEAL POTION ]' 253
                                else
                                    overhead "[ HEAL POTION ]" 253
                                endif
                            endif 
                            clearsysmsg
                        endif
                    endif
                else
                    if timer 'yellowMessageTimer' > 4500
                        overhead "[ NO HEAL POTS! ]" 337
                        settimer 'yellowMessageTimer' 0
                    endif
                endif
            endif

            if EnableAutoSatchels = 1
                if findtype "3962|3963|3972|3973|3974|3976|3980|3981" backpack and findtype "reagent satchel" self as MyWizardBag
                    while findtype "reagent satchel" self as MyWizardBag
                        getlabel MyWizardBag MyWizardBagdesc
                        if 'decorative' in MyWizardBagdesc
                            @ignore MyWizardBag
                        else
                            break
                        endif
                    endwhile
                    if timer "WizardSatchelTimer" > 60000
                        menu MyWizardBag 0
                        wait 250
                        settimer "WizardSatchelTimer" 0
                    endif
                endif
                if findtype "Yellow Potion|Orange Potion|Red Potion|White Potion|Blue Potion|Black Potion|" backpack and findtype 31262 self as MyPotBag
                    if timer "PotionSatchelTimer" > 60000
                        menu MyPotBag 0
                        wait 250
                        settimer "PotionSatchelTimer" 0
                    endif
                endif
            endif

            if EnableAutoCarving = 1 and findtype 11552 self
                while findtype "corpse" ground -1 -1 2 as deadbody and diffhits < ActivateAutoHealHPdiff 
                    if findtype 11552 self
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        while not targetexists
                            skill 'forensicevaluation'
                        endwhile
                        if targetexists and find deadbody ground -1 -1 2
                            target 'self'
                            @ignore deadbody
                            wait 500
                        endif
                        if insysmsg "You dont see anything nearby"
                            clearsysmsg 
                            break
                        else
                            if EnableOverheadMessages = 1 and timer SkinningTimer > 3000 
                                overhead "[ SKINNING... ]" 333
                                settimer SkinningTimer 0
                            endif
                        endif 
                    else 
                        if EnableOverheadMessages = 1 and timer SkinningTimer > 15000
                            overhead "[ NO SKINNING KNIFE ]" 337
                            settimer SkinningTimer 0
                            break
                        endif  
                    endif 
                endwhile
            endif 

            if EnableGoldVacuum = 1 and DisableVacuums != 1
                if findtype "gold coin" ground -1 -1 12 as droppedmoney and timer "GoldRadar" > 3500
                    overhead "  " 149 droppedmoney
                    settimer "GoldRadar" 0
                endif
                while findtype "gold coin" ground -1 -1 2 as droppedmoney and diffhits < ActivateAutoHealHPdiff
                    overhead "  " 149
                    hotkey "Grab Item"
                    wft 2500
                    target droppedmoney
                    wait 250
                    if insysmsg "Invalid or inaccessible item"
                        wait 500
                        @ignore droppedmoney
                    endif
                    wait 250
                endwhile
            endif

            if EnableDungeonCleanup = 1 and DisableVacuums != 1
                while findtype "iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 2 as item and diffhits < ActivateAutoHealHPdiff
                    if EnableOverheadMessages = 1
                        if timer "DungeonCleanup" > 1500
                            overhead '[ CLEANUP... ]' 420
                            settimer "DungeonCleanup" 0
                        endif
                    else
                        if timer "DungeonCleanup" > 1500
                            overhead '  ' 420
                            settimer "DungeonCleanup" 0
                        endif
                    endif
                    hotkey "Grab Item"
                    wft 1000
                    target item
                    wait 250
                endwhile

                if findtype "iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 15 as dungeonjunk and timer "DungeonCleanupRadar" > 3500
                    overhead "  " 420 dungeonjunk
                    settimer "DungeonCleanupRadar" 0
                endif
            endif

            if insysmsg "to be locked"
                clearsysmsg 
                replay
            endif
            
            if not warmode
                @setvar! TimeToGo 1
                replay
            endif

            if not varexist "NoLockbox"
                @setvar! NoLockbox 0
            endif

            if findtype "wooden box" self and findtype "copper key" self
                @setvar! NoLockbox 0
            endif

            if EnablePutLootinLockBox = 1 and NoLockbox != 1 and timer LootTimer > 5000 and warmode
                if not findtype "wooden box" backpack or not findtype "copper key" backpack
                    if EnableOverheadMessages = 1
                        overhead "[ NO LOCKBOX FOUND! ]" 337
                    endif
                    @setvar! NoLockbox 1
                    wait 1500
                elseif counttype 2474 backpack > 1 or counttype 4110 backpack > 1
                    if EnableOverheadMessages = 1
                        overhead "[ TOO MANY LOCKBOXES/KEYS! ]" 337
                    endif
                    @setvar! NoLockbox 1
                    wait 1500
                else
                    clearsysmsg
                    hotkey 'Target closest grey monster'
                    wait 500
                    if insysmsg "matching that was found"
                        if findtype "wooden box" backpack as lockbox and findtype "copper key" backpack as key
                            if findtype '3821|31169|31172|31190|31128|31142|31141|31002|31130|31000|31001|31180|31182|31178|30991|30999|31014|20014|20012|20010|20008|20006|30992|30997|31176|31188|30998|30989|30996|30995|31186|31184|30994|30990|30993|37181|4026|4025|31010|31008|31007|31006|31015|31005|31009|31012|31011|31004|31003|31191|39911|17686|31014|30994|31142|31190|24434|43206|29363|43166|22336|29348|17087|3985|8826|3827|29030|3836|5981|4248|5359|3839|3838|3843|2597|29036|48407|3865|3859|3885|3856|3878|3877|3873|3861|3862|576|5123|7177|7027|3920|5131|5179|5075|5060|5076|5042|10245|3938|3913|7169|3909|5063|5089|7170|7033|3762|5040|5103|5117|7181|7029|3568|6264|3742|5139|6263|7026|5125|3740|5121|5204|5105|5185|5078|5115|7175|5059|7034|3713|3915|5112|5070|5049|5205|5046|7035|3911|7179|5106|5143|3573|3719|5177|7610|5181|3917|5132|7031|5207|5056|5085|3763|5129|5187|3721|5138|3570|5101|5061|5074|5142|5182|5146|6265|5090|5203|5044|5144|3932|5201|5127|3572|7173|5135|3937|3571|22326|27611|9917|3821|5356|8455|5362|45315|8454|22187|5901|7163|3903|126867981|7982|7983|7984|7985|7986|7987|7988|7989|7990|7991|7992|7993|7994|7995|7996|7997|7998|7999|8000|8001|8002|8003|8004|8005|8006|8007|8008|8009|8010|8011|8012|8013|8014|8015|8016|8017|8018|8019|8020|8021|8022|8023|8024|8025|8026|8027|8028|8029|8030|8031|8032|8033|8034|8035|8036|8037|8038|8039|8040|8041|8042|8033|8044|39889|39891|39892|39896|39897|39898|39905|39909|39911|39912|39916|39917|39918|3843|3838|3839|3842|15296|15297|29025|29034|29036|2472|2475|3648|3649|3650|3651|3708|3712|29832|29833|7107' backpack as loottostore
                                getlabel lockbox lockboxLabel
                                if "items" in lockboxLabel
                                    wait 500
                                    if EnableOverheadMessages = 1 and timer "STORELOOT" > 5000
                                        overhead "[ SECURING LOOT... ]" 149
                                        settimer "STORELOOT" 0
                                    endif
                                else
                                    if EnableOverheadMessages = 1
                                        overhead "[loot box unlocked]" 84
                                    endif
                                    dclick key
                                    wft 1500
                                    target lockbox
                                    wait 500
                                    if EnableOverheadMessages = 1 and timer "STORELOOT" > 5000
                                        overhead "[ SECURING LOOT... ]" 149
                                        settimer "STORELOOT" 0
                                    endif
                                endif
                                while findtype '3821|31169|31172|31190|31128|31142|31141|31002|31130|31000|31001|31180|31182|31178|30991|30999|31014|20014|20012|20010|20008|20006|30992|30997|31176|31188|30998|30989|30996|30995|31186|31184|30994|30990|30993|37181|4026|4025|31010|31008|31007|31006|31015|31005|31009|31012|31011|31004|31003|31191|39911|17686|31014|30994|31142|31190|24434|43206|29363|43166|22336|29348|17087|3985|8826|3827|29030|3836|5981|4248|5359|3839|3838|3843|2597|29036|48407|3865|3859|3885|3856|3878|3877|3873|3861|3862|576|5123|7177|7027|3920|5131|5179|5075|5060|5076|5042|10245|3938|3913|7169|3909|5063|5089|7170|7033|3762|5040|5103|5117|7181|7029|3568|6264|3742|5139|6263|7026|5125|3740|5121|5204|5105|5185|5078|5115|7175|5059|7034|3713|3915|5112|5070|5049|5205|5046|7035|3911|7179|5106|5143|3573|3719|5177|7610|5181|3917|5132|7031|5207|5056|5085|3763|5129|5187|3721|5138|3570|5101|5061|5074|5142|5182|5146|6265|5090|5203|5044|5144|3932|5201|5127|3572|7173|5135|3937|3571|22326|27611|9917|3821|5356|8455|5362|45315|8454|22187|5901|7163|3903|126867981|7982|7983|7984|7985|7986|7987|7988|7989|7990|7991|7992|7993|7994|7995|7996|7997|7998|7999|8000|8001|8002|8003|8004|8005|8006|8007|8008|8009|8010|8011|8012|8013|8014|8015|8016|8017|8018|8019|8020|8021|8022|8023|8024|8025|8026|8027|8028|8029|8030|8031|8032|8033|8034|8035|8036|8037|8038|8039|8040|8041|8042|8033|8044|39889|39891|39892|39896|39897|39898|39905|39909|39911|39912|39916|39917|39918|3843|3838|3839|3842|15296|15297|29025|29034|29036|2472|2475|3648|3649|3650|3651|3708|3712|29832|29833|7107' backpack as loottostore
                                    if find loottostore lockbox
                                        @ignore loottostore
                                    else
                                        clearsysmsg
                                        lift loottostore 9999
                                        drop lockbox -1 -1 -1
                                        wait 500
                                        if insysmsg "to be locked" 
                                            dclick key
                                            wft 1500 
                                            target lockbox
                                            wait 500
                                            clearsysmsg
                                        endif 
                                    endif
                                endwhile
                                dclick key
                                wft 1500
                                target lockbox
                                if EnableOverheadMessages = 1
                                    overhead "[loot box locked]" 69
                                endif
                                @setvar! NeedtoSecureLoot 0
                            endif
                            getlabel lockbox lockboxLabel
                            if "items" in lockboxLabel
                                dclick key
                                wft 1500
                                target lockbox
                                @setvar! NeedtoSecureLoot 0
                                settimer "LootTimer" 0
                            endif
                        endif
                    endif
                endif
            endif

            if EnableWeightWarningMessage = 1
                if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
                    if EnableOverheadMessages = 1
                        overhead "[ WEIGHT WARNING... ]" 77
                        settimer "WeightTimer" 0
                    else
                        overhead "  " 77
                        settimer "WeightTimer" 0
                    endif
                    elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                    if EnableOverheadMessages = 1
                        overhead "[ WEIGHT WARNING! ]" 153
                        settimer "WeightTimer" 0
                    else
                        overhead "  " 153
                        settimer "WeightTimer" 0
                    endif
                elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                    if EnableOverheadMessages = 1
                        overhead "[ WEIGHT LIMIT REACHED! ]" 37
                        settimer "WeightTimer" 0
                    else
                        overhead "  " 37
                        settimer "WeightTimer" 0
                    endif

                    if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                        wait 1000
                        hotkey 'Toggle Peace Only'
                        @setvar! AutoWeightRecall 1
                        @setvar! WarModeToggledWhileFighting 0
                        @setvar! TimeToGo 1
                        replay
                    elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                        if timer "RECALLDELAY" > 3500 and EnableAutoRecallOverheadMessages = 1
                            overhead "[ WAITING TO RECALL... ]" 149
                            settimer "RECALLDELAY" 0
                        endif
                        wait 500
                    elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                        wait 1000
                        hotkey 'Toggle Peace Only'
                        @setvar! TimeToGo 1
                        replay
                    else
                        overhead "[ OVERWEIGHT! ]" 337
                        sysmsg "Time to head home and unload your loot!" 0
                        settimer "WeightTimer" 0
                    endif
                endif
            endif
            
            if insysmsg "to be locked"
                clearsysmsg 
                replay
            endif

            if targetexists
                hotkey 'cancel current target'
            endif
            replay

        //////////////////////////
        //     TARGET CHECK:    //
        //////////////////////////

        elseif not dead TargetToAnalyze
            while diffhits < ActivateAutoHealHPdiff
                if timer searchingMessageTimer > 15000
                    if EnableOverheadMessages = 1
                        overhead '[ ANALYZING TARGETS... ]' 90
                    endif
                    settimer searchingMessageTimer 0
                endif

                if index != 0
                    hotkey "next non-friendly monster target"
                    @setvar! TargetToAnalyze lasttarget
                endif

                if insysmsg "world is saving"
                    settimer "WorldSaveTimer" 0
                    if EnableOverheadMessages = 1
                        overhead "[ WORLD SAVING... ]" 253
                    endif 
                    while timer "WorldSaveTimer" < 4500
                        if insysmsg "save complete"
                            break
                        endif
                        wait 100
                    endwhile   
                    if EnableOverheadMessages = 1
                        overhead "[ SAVE COMPLETE! ]" 253
                    endif 
                endif

                if find TargetToAnalyze ground -1 -1 12
                    getlabel TargetToAnalyze tempLabel

                    while "-" in tempLabel
                        getlabel TargetToAnalyze tempLabel
                    endwhile

                    if inlist animalsIgnoreList tempLabel
                        @ignore TargetToAnalyze
                    else
                        skill 'begging'
                        while not targetexists
                           if insysmsg! 'you must wait'
                                break
                           endif
                        endwhile
                        if not insysmsg 'you must wait'
                            target TargetToAnalyze
                            getlabel backpack packdesc
                            wait 250
                        endif

                        if not dead TargetToAnalyze
                            if insysmsg "Target cannot be seen"
                                if timer "CANNOTSEE" > 4500 and EnableOverheadMessages = 1
                                    overhead  "[ CANNOT BE SEEN! ]" 44 TargetToAnalyze
                                    settimer "CANNOTSEE" 0
                                elseif timer "CANNOTSEE" > 4500 and EnableOverheadMessages = 0
                                    overhead "  " 44 TargetToAnalyze
                                    settimer "CANNOTSEE" 0
                                endif
                            elseif insysmsg "That is too far away."
                                if timer "TOOFAR" > 4500 and EnableOverheadMessages = 1
                                    overhead "[ TOO FAR AWAY! ]" 44 TargetToAnalyze
                                    overhead "[ GET CLOSER! ]" 69
                                    settimer "TOOFAR" 0
                                elseif timer "TOOFAR" > 4500 and EnableOverheadMessages = 0
                                    overhead "  " 44 TargetToAnalyze
                                    settimer "TOOFAR" 0
                                endif
                            elseif insysmsg "Perhaps" or insysmsg "You are too far away from them." or insysmsg "They do not appear to have anything to offer you." or insysmsg! "You must wait"

                                if insysmsg "You must wait"
                                    hotkey 'target closest grey monster'
                                    @setvar! TargetToAnalyze lasttarget
                                endif

                                if ClosestTarget != TargetToAnalyze
                                    settimer CurseTimer 60000
                                    settimer ManaDrainTimer 60000
                                endif

                                @setvar! ClosestTarget TargetToAnalyze
                                @setvar! previousTarget currentTarget
                                attack ClosestTarget
                                settimer 'PainSpikeDelayTimer' 0
                                @setvar! ClosestTargetisSticky 0

                                if timer "ATTACKTIMER" > 15000
                                    if EnableOverheadMessages = 1
                                        overhead "[ ATTACK! ]" 69
                                        settimer "ATTACKTIMER" 0
                                    else
                                        settimer "ATTACKTIMER" 0
                                    endif
                                endif
                                break
                            endif
                        endif
                    endif
                endif
                if targetexists
                    hotkey 'cancel current target'
                endif
                if casting
                    interrupt
                endif
            endwhile
        endif
    endif

    if EnableFrostAspect = 1
        if insysmsg "Frost Shell activated"
            cooldown "Frost Shell Active" 5000
            if EnableOverheadMessages = 1
                overhead "[ FROST SHELL! ]" 2234
            else 
                overhead "  " 2234
            endif
            if FrostAspectTier = 0
                cooldown "Frost Shell Cooldown" 30000
            elseif FrostAspectTier = 1
                cooldown "Frost Shell Cooldown" 29000
            elseif FrostAspectTier = 2
                cooldown "Frost Shell Cooldown" 28000
                    elseif FrostAspectTier = 3
                cooldown "Frost Shell Cooldown" 27000
            elseif FrostAspectTier = 4
                cooldown "Frost Shell Cooldown" 26000
            elseif FrostAspectTier = 5
                cooldown "Frost Shell Cooldown" 25000
            elseif FrostAspectTier = 6
                cooldown "Frost Shell Cooldown" 24000
            elseif FrostAspectTier = 7
                cooldown "Frost Shell Cooldown" 23000
            elseif FrostAspectTier = 8
                cooldown "Frost Shell Cooldown" 22000
            elseif FrostAspectTier = 9
                cooldown "Frost Shell Cooldown" 21000
            elseif FrostAspectTier = 10
                cooldown "Frost Shell Cooldown" 20000
            elseif FrostAspectTier = 11
                cooldown "Frost Shell Cooldown" 19000
            elseif FrostAspectTier = 12
                cooldown "Frost Shell Cooldown" 18000
            elseif FrostAspectTier = 13
                cooldown "Frost Shell Cooldown" 17000
            elseif FrostAspectTier = 14
                cooldown "Frost Shell Cooldown" 16000
            elseif FrostAspectTier = 15
                cooldown "Frost Shell Cooldown" 15000
            elseif FrostAspectTier = 14
                cooldown "Frost Shell Cooldown" 15000
            endif
            clearsysmsg
        endif 
    endif 


    //////////////////////////
    //  BEGIN ATTACK LOOP:  //
    //////////////////////////

    while not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and diffhits < ActivateAutoHealHPdiff and mana >= 4
        if timer "TargetTimer" > 4000 and find ClosestTarget ground -1 -1 12
            getlabel ClosestTarget TargetDesc
            if EnableOverheadMessages = 1
                if "Paragon" in TargetDesc and find ClosestTarget ground -1 -1 12
                    overhead "  PARAGON!  " 12 ClosestTarget
                    settimer "TargetTimer" 0
                elseif find ClosestTarget ground -1 -1 12
                    overhead "  TARGET  " 253 ClosestTarget
                    settimer "TargetTimer" 0
                endif
            else
                if "Paragon" in TargetDesc and find ClosestTarget ground -1 -1 12
                    overhead "  " 12 ClosestTarget
                    settimer "TargetTimer" 0
                elseif find ClosestTarget ground -1 -1 12
                    overhead "  " 253 ClosestTarget
                    settimer "TargetTimer" 0
                endif
            endif
        endif

        if timer "TargetChecker" > 15000
            settimer "TargetChecker" 0
            replay
        endif

        if insysmsg "Mana Thief activated" 
            if EnableOverheadMessages = 1
                overhead "[ MANA THIEF! ]" 22
            endif 
            cooldown "Mana Thief" 60000
            clearsysmsg
        endif 

        if insysmsg "world is saving"
            settimer "WorldSaveTimer" 0
            if EnableOverheadMessages = 1
                overhead "[ WORLD SAVING... ]" 253
            endif 
            while timer "WorldSaveTimer" < 4500
                if insysmsg "save complete"
                    break
                endif
                wait 100
            endwhile   
            if EnableOverheadMessages = 1
                overhead "[ SAVE COMPLETE! ]" 253
            endif 
        endif

        if diffhits >= HealPotionHPdiff and EnableHealPotion = 1
            if findtype "Yellow Potion" self as hPot
                getlabel hPot potLabel
                if "next" in potLabel
                    #do nothing
                else
                    @setvar! ch 0

                    if counttype 3852 self as c
                        @setvar! ch c
                    endif
                    if insysmsg "potion satchel used"
                    endif

                    dclicktype 3852
                    getlabel backpack packdesc
                    wait 250

                    if ch != counttype 3852 self or insysmsg "potion satchel used"
                        settimer 'HealPotionTimer' 0
                        cooldown "Healing Potion" 11000
                        if EnableOverheadMessages = 1
                            overhead "[ HEAL POTION ]" 253
                        endif 
                    endif
                endif
            else
                if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO HEAL POTS! ]" 337
                    settimer 'yellowMessageTimer' 0
                endif
            endif
        endif

        if EnableWeaponCheck = 1 and skill 'Arcane' >= 50 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
            if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                for 5
                if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                    getlabel myArcaneStaff myArcaneStafflabel            
                    if "Aspect" in myArcaneStafflabel
                        break
                    elseif "unidentified" in myArcaneStafflabel
                        ignore myArcaneStaff
                    else 
                        break 
                    endif 
                endif 
                endfor 
                dclick myArcaneStaff
                clearignore 
                wait 500
            else
                if timer "ArcaneStaffCheck" > 5000 and EnableOverheadMessages = 1
                    overhead "[ NO ARCANE STAFF! ]" 337
                    settimer "ArcaneStaffCheck" 0
                endif
            endif
        endif

        if EnableFrostAspect = 1
            if insysmsg "Frost Shell activated"
                cooldown "Frost Shell Active" 5000
                if EnableOverheadMessages = 1
                    overhead "[ FROST SHELL! ]" 2234
                else 
                    overhead "  " 2234
                endif
                if FrostAspectTier = 0
                    cooldown "Frost Shell Cooldown" 30000
                elseif FrostAspectTier = 1
                    cooldown "Frost Shell Cooldown" 29000
                elseif FrostAspectTier = 2
                    cooldown "Frost Shell Cooldown" 28000
                        elseif FrostAspectTier = 3
                    cooldown "Frost Shell Cooldown" 27000
                elseif FrostAspectTier = 4
                    cooldown "Frost Shell Cooldown" 26000
                elseif FrostAspectTier = 5
                    cooldown "Frost Shell Cooldown" 25000
                elseif FrostAspectTier = 6
                    cooldown "Frost Shell Cooldown" 24000
                elseif FrostAspectTier = 7
                    cooldown "Frost Shell Cooldown" 23000
                elseif FrostAspectTier = 8
                    cooldown "Frost Shell Cooldown" 22000
                elseif FrostAspectTier = 9
                    cooldown "Frost Shell Cooldown" 21000
                elseif FrostAspectTier = 10
                    cooldown "Frost Shell Cooldown" 20000
                elseif FrostAspectTier = 11
                    cooldown "Frost Shell Cooldown" 19000
                elseif FrostAspectTier = 12
                    cooldown "Frost Shell Cooldown" 18000
                elseif FrostAspectTier = 13
                    cooldown "Frost Shell Cooldown" 17000
                elseif FrostAspectTier = 14
                    cooldown "Frost Shell Cooldown" 16000
                elseif FrostAspectTier = 15
                    cooldown "Frost Shell Cooldown" 15000
                elseif FrostAspectTier = 14
                    cooldown "Frost Shell Cooldown" 15000
                endif
                clearsysmsg
            endif 
        endif 
        
        if diffhits > ActivateAutoHealHPdiff 
            replay
        endif

        if EnablePKradar = 1
            if timer "PKRadar" > 1000
                hotkey 'Next Murderer Player Target'
                wait 500
                if insysmsg "No one matching that was found"
                    settimer "PKRadar" 0
                    clearsysmsg
                else
                    hotkey 'Toggle Peace Only'
                    @setvar! RedTargetFound 1
                    @setvar! TimeToGo 1
                    @setvar! MurdererTarget lasttarget
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    replay
                endif
            endif
        endif

        if EnableTrackingAutoRecall = 1
            if PKTrackingRange = 60
                if insysmsg ": 60 step" or insysmsg "60 space" or insysmsg ": 59 step" or insysmsg "59 space" or insysmsg ": 58 step" or insysmsg "58 space" or insysmsg ": 57 step" or insysmsg "57 space" or insysmsg ": 56 step" or insysmsg "56 space" or insysmsg ": 55 step" or insysmsg "55 space" or insysmsg ": 54 step" or insysmsg "54 space" or insysmsg ": 53 step" or insysmsg "53 space" or insysmsg ": 52 step" or insysmsg "52 space" or insysmsg ": 51 step" or insysmsg "51 space" or insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            elseif PKTrackingRange = 50
                if insysmsg ": 50 step" or insysmsg "50 space" or insysmsg ": 49 step" or insysmsg "49 space" or insysmsg ": 48 step" or insysmsg "48 space" or insysmsg ": 47 step" or insysmsg "47 space" or insysmsg ": 46 step" or insysmsg "46 space" or insysmsg ": 45 step" or insysmsg "45 space" or insysmsg ": 44 step" or insysmsg "44 space" or insysmsg ": 43 step" or insysmsg "43 space" or insysmsg ": 42 step" or insysmsg "42 space" or insysmsg ": 41 step" or insysmsg "41 space" or insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            elseif PKTrackingRange = 40
                if insysmsg ": 40 step" or insysmsg "40 space" or insysmsg ": 39 step" or insysmsg "39 space" or insysmsg ": 38 step" or insysmsg "38 space" or insysmsg ": 37 step" or insysmsg "37 space" or insysmsg ": 36 step" or insysmsg "36 space" or insysmsg ": 35 step" or insysmsg "35 space" or insysmsg ": 34 step" or insysmsg "34 space" or insysmsg ": 33 step" or insysmsg "33 space" or insysmsg ": 32 step" or insysmsg "32 space" or insysmsg ": 31 step" or insysmsg "31 space" or insysmsg ": 30 step" or insysmsg "30 space" or insysmsg ": 29 step" or insysmsg "29 space" or insysmsg ": 28 step" or insysmsg "28 space" or insysmsg ": 27 step" or insysmsg "27 space" or insysmsg ": 26 step" or insysmsg "26 space" or insysmsg ": 25 step" or insysmsg "25 space" or insysmsg ": 24 step" or insysmsg "24 space" or insysmsg ": 23 step" or insysmsg "23 space" or insysmsg ": 22 step" or insysmsg "22 space" or insysmsg ": 21 step" or insysmsg "21 space" or insysmsg ": 20 step" or insysmsg "20 space" or insysmsg ": 19 step" or insysmsg "19 space" or insysmsg ": 18 step" or insysmsg "18 space" or insysmsg ": 17 step" or insysmsg "17 space" or insysmsg ": 16 step" or insysmsg "16 space" or insysmsg ": 15 step" or insysmsg "15 space" or insysmsg ": 14 step" or insysmsg "14 space" or insysmsg ": 13 step" or insysmsg "13 space" or insysmsg ": 12 step" or insysmsg "12 space" or insysmsg ": 11 step" or insysmsg "11 space" or insysmsg ": 10 step" or insysmsg "10 space" or insysmsg ": 9 step" or insysmsg "(9 space" or insysmsg ": 8 step" or insysmsg "(8 space" or insysmsg ": 7 step" or insysmsg "(7 space" or insysmsg ": 6 step" or insysmsg "(6 space" or insysmsg ": 5 step" or insysmsg "(5 space" or insysmsg ": 4 step" or insysmsg "(4 space" or insysmsg ": 3 step" or insysmsg "(3 space" or insysmsg ": 2 step" or insysmsg "(2 space" or insysmsg ": 1 step" or insysmsg "(1 space" or insysmsg ": 0 step" or insysmsg "(0 space"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            elseif PKTrackingRange = 0
                if insysmsg "Now tracking"
                    hotkey 'Toggle Peace Only'
                    if EnableRedAlertOverhead = 1
                        overhead "[ !! RED ALERT !! ]" 37
                    endif
                    @setvar! RedTargetFound 1
                    @setvar! WarModeToggledWhileFighting 0
                    clearsysmsg
                    replay
                endif
            endif
        endif

        if EnableWeightWarningMessage = 1
            if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING... ]" 77
                    settimer "WeightTimer" 0
                else
                    overhead "  " 77
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING! ]" 153
                    settimer "WeightTimer" 0
                else
                    overhead "  " 153
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT LIMIT REACHED! ]" 37
                    settimer "WeightTimer" 0
                else
                    overhead "  " 37
                    settimer "WeightTimer" 0
                endif

                if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    wait 500
                    hotkey 'Toggle Peace Only'
                    @setvar! AutoWeightRecall 1
                    replay
                elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    if timer "RECALLDELAY" > 3500 and EnableAutoRecallOverheadMessages = 1
                        overhead "[ WAITING TO RECALL... ]" 149
                        settimer "RECALLDELAY" 0
                    endif
                    wait 500
                elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                    wait 500
                    hotkey 'Toggle Peace Only'
                    @setvar! TimeToGo 1
                    replay
                else
                    if EnableOverheadMessages = 1
                        overhead "[ OVERWEIGHT! ]" 337
                    else
                        overhead "  " 337
                    endif
                    wait 1500
                    overhead "[ STOPPING SCRIPT! ]" 88
                    stop
                endif
            endif
        endif

        if skill 'Necromancy' >= 50 and not gumpexists 622436516
            if findtype 'necromancer book' backpack
                yell '[necromancyhotbar'
                while not gumpexists 622436516
                    yell '[necromancyhotbar'
                    waitforgump 622436516 1000
                endwhile
                wait 500
            elseif EnableOverheadMessages = 1
                overhead "[ NO NECRO BOOK! ]" 337
                wait 1000
            endif
        endif

        if skill "Arcane" >= 80 and EnableArcaneWeaponAbility = 1
            settimer ArcaneWeaponAbilityTimer 10000
            if EnableArcaneCodexAbilityHotbar = 1
                if not gumpexists 3954121934
                    yell '[abilitieshotbar'
                    wait 500
                endif
            endif
        endif

        if EnableWeaponCheck = 1 and skill 'Arcane' >= 50 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
            if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                for 5
                if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                    getlabel myArcaneStaff myArcaneStafflabel            
                    if "Aspect" in myArcaneStafflabel
                        break
                    elseif "unidentified" in myArcaneStafflabel
                        ignore myArcaneStaff
                    else 
                        break 
                    endif 
                endif 
                endfor 
                dclick myArcaneStaff
                clearignore 
                wait 500
            else
                if timer "ArcaneStaffCheck" > 5000 and EnableOverheadMessages = 1
                    overhead "[ NO ARCANE STAFF! ]" 337
                    settimer "ArcaneStaffCheck" 0
                endif
            endif
        endif

        if EnableAutoTaunting = 1
            if skill 'Parrying' >= 80 and find ClosestTarget ground -1 -1 12 and timer "TauntingTimer" > 15000
                say "[Taunt"
                wft 500
                target ClosestTarget
                wait 250
                if not targetexists
                    if insysmsg "Cannot be seen"
                        settimer "TauntingTimer" 10000
                    else
                        if EnableOverheadMessages = 1
                            overhead "[ TAUNTING... ]" 2117
                        endif
                        settimer "TauntingTimer" 0
                    endif
                endif
            endif
        endif

        if not findtype "3972" or not findtype "3962" or not findtype "3963" or not findtype "3980" or not findtype "3976" or not findtype "3973" or not findtype "3974" or not findtype "3981" self
            @setvar! missingRegs 1
            if timer noRegsMessageTimer > 5000 and EnableOverheadMessages = 1
                overhead "[ MISSING REGS! ]" 337
                settimer noRegsMessageTimer 0
            endif
        else
            @setvar! missingRegs 0
        endif

        if EnableUsePotionKegs = 1 and findtype 'empty bottle%s%' self and findtype 'keg' self and diffhits < ActivateAutoHealHPdiff 
            @setvar! PotionStockCheck 0

            while PotionStockCheck < 7 and findtype 'empty bottle%s%' backpack
                if diffhits > ActivateAutoHealHPdiff 
                    replay
                endif 

                if PotionStockCheck = 0 and ExplosionPotionAmount != 0
                    @setvar! PotionType 3853
                    @setvar! KegColour 419
                    @setvar! PotionAmounttoFill ExplosionPotionAmount
                    @setvar! PotionStockCheck 1
                elseif PotionStockCheck = 1 and HealingPotionAmount != 0
                    @setvar! PotionType 3852
                    @setvar! KegColour 253
                    @setvar! PotionAmounttoFill HealingPotionAmount
                    @setvar! PotionStockCheck 2
                elseif PotionStockCheck = 2 and CurePotionAmount != 0
                    @setvar! PotionType 3847
                    @setvar! KegColour 44
                    @setvar! PotionAmounttoFill CurePotionAmount
                    @setvar! PotionStockCheck 3
                elseif PotionStockCheck = 3 and RefreshPotionAmount != 0
                    @setvar! PotionType 3851
                    @setvar! KegColour 37
                    @setvar! PotionAmounttoFill RefreshPotionAmount
                    @setvar! PotionStockCheck 4
                elseif PotionStockCheck = 4 and StrengthPotionAmount != 0
                    @setvar! PotionType 3849
                    @setvar! KegColour 956
                    @setvar! PotionAmounttoFill StrengthPotionAmount
                    @setvar! PotionStockCheck 5
                elseif PotionStockCheck = 5 and AgilityPotionAmount != 0
                    @setvar! PotionType 3848
                    @setvar! KegColour 93
                    @setvar! PotionAmounttoFill AgilityPotionAmount
                    @setvar! PotionStockCheck 6
                elseif PotionStockCheck = 6 and ResistPotionAmount != 0
                    @setvar! PotionType 3846
                    @setvar! KegColour 1109
                    @setvar! PotionAmounttoFill ResistPotionAmount 
                    @setvar! PotionStockCheck 7
                else 
                    replay
                endif

                while counttype PotionType self < PotionAmounttoFill
                    if diffhits > ActivateAutoHealHPdiff 
                        replay
                    endif 

                    if not findtype 'empty bottle%s%' self
                        if EnableOverheadMessages = 1
                            overhead "[ NO EMPTY BOTTLES ]" 337
                        endif 
                        replay
                    endif

                    if findtype 'keg' self KegColour as myKeg
                        dclick myKeg
                        while queued
                            wait 250
                        endwhile        
                    else 
                        break 
                    endif 

                    if insysmsg 'You pour some'
                        if EnableOverheadMessages = 1 and timer 'PotionKegTimer' > 3500
                            overhead '[ FILLING POTS... ]' KegColour
                            clearsysmsg
                            settimer 'PotionKegTimer' 0
                        else 
                            overhead '  ' KegColour
                        endif 
                    elseif insysmsg 'You must wait'
                        wait 250 
                        clearsysmsg
                    endif
                endwhile

                if counttype PotionType self < PotionAmounttoFill and not findtype 'empty bottle%s%' backpack
                    if EnableOverheadMessages = 1
                        overhead "[ NO EMPTY BOTTLES ]" 337
                    endif 
                    replay
                endif
            endwhile
        endif 

        if EnableStrengthPotion = 1 and diffhits < ActivateAutoHealHPdiff 
            if skill 'Alchemy' > 0 and skill 'Alchemy' < 2
                if insysmsg "You may now use a strength" or not findbuff "Strength"
                    if findtype "White Potion" self
                        dclicktype "White Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ STRENGTH POTION ]" 956
                        endif
                        wait 250
                    else
                        if timer whiteMessageTimer > 4500
                            overhead "[ NO STRENGTH POTS! ]" 337
                            settimer whiteMessageTimer 0
                        endif
                    endif 
                    clearsysmsg
                endif
            else
                if not findbuff "Strength"
                    if findtype "White Potion" self
                        dclicktype "White Potion"
                        if EnableOverheadMessages = 1
                            overhead "[ STRENGTH POTION ]" 956
                        endif
                        wait 250
                    else
                        if timer whiteMessageTimer > 4500
                            overhead "[ NO STRENGTH POTS! ]" 337
                            settimer whiteMessageTimer 0
                        endif
                    endif
                endif
            endif 
        endif 

        if EnableAgilityPotion = 1 and not findbuff "Agility"
            if findtype "Blue Potion" self
                dclicktype "Blue Potion"
                if EnableOverheadMessages = 1
                    overhead "[ AGILITY POTION ]" 93
                endif 
                wait 250
            else
                if timer blueMessageTimer > 4500 and EnableOverheadMessages = 1
                overhead "[ NO AGILITY POTS! ]" 337
                    settimer blueMessageTimer 0
                endif
            endif
        endif

        if EnableResistPotion = 1 and not findbuff "Magic Resist"
            if findtype "Black Potion" self
                dclicktype "Black Potion"
                if EnableOverheadMessages = 1
                    overhead "[ RESIST POTION ]" 1109
                endif 
                wait 250
            else
                if timer blackMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO RESIST POTS! ]" 337
                    settimer blackMessageTimer 0
                endif
            endif
        endif

        if EnableRefreshPotion = 1 and diffstam > RefreshPotionSPdiff
            if findtype "Red Potion" self
                dclicktype "Red Potion"
                if EnableOverheadMessages = 1
                    overhead "[ REFRESH POTION ]" 37
                endif 
                wait 250
            else
                if timer redMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO REFRESH POTS! ]" 337
                    settimer redMessageTimer 0
                endif
            endif
        endif

        if counttype 29012 self = 0 and EnableMagicMushroomMaker = 1
            while counttype 29012 self < MakeMushroomAmount and mana > 3 and diffhits < ActivateAutoHealHPdiff
                if not casting
                    cast 'create food'
                endif
                if diffhits > ActivateAutoHealHPdiff
                    break
                endif 
            endwhile
        endif

        if EnableEatMagicMushrooms = 1
            if diffmana > EatMushroomManadiff and MakeMushroomAmount > 0 and timer MushroomTimer > MagicMushroomCooldown
                if counttype 29012 backpack

                    dclicktype 29012 backpack
                    getlabel backpack packdesc
                    wait 250

                    if insysmsg "You consume a magic mushroom"
                        settimer MushroomTimer 0
                        cooldown "Mushroom" MagicMushroomCooldown
                        if EnableOverheadMessages = 1
                            overhead "[ EATING SHROOMS... ]" 12
                        endif
                    endif
                elseif EnableOverheadMessages = 1
                    overhead "[ OUT OF SHROOMS! ]" 337
                endif
            endif
        endif

        if skill 'Cooking' >= 50 and EnableManaSnacking = 1
            if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as mysnack
                if not timerexists 'SnackTimer'
                    createtimer 'SnackTimer'
                    settimer 'SnackTimer' EatSnackCooldown
                endif
                if timer 'SnackTimer' > EatSnackCooldown and diffmana > EatSnackManadiff
                    if EnableOverheadMessages = 1
                        overhead "[ MANA MUNCHING... ]" 420
                    endif                
                    dclick mysnack
                    wait 500
                    settimer 'SnackTimer' 0
                    cooldown "Snacking" EatSnackCooldown
                endif
            else
                if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                    overhead "[ NO MORE FOOD! ]" 337
                    settimer foodMessageTimer 0
                endif
            endif
        elseif not findbuff "food"
            if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as food
                dclick food
                wait 500
            else
                if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                    overhead "[ NO MORE FOOD! ]" 337
                    settimer foodMessageTimer 0
                endif
            endif
        endif

        if skill 'Cooking' >= 50 and timer 'HealPotionTimer' < 11000 and EnableEatSnackstoHeal = 1 and diffhits > EatSnacktoHealHPdiff
            if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as mysnack
                if timer 'SnackTimer' > 60000
                    if EnableOverheadMessages = 1
                        overhead "[ HP MUNCHING... ]" 420
                    endif
                    dclick mysnack
                    wait 500
                    settimer 'SnackTimer' 0
                    cooldown "Snacking" 60000
                endif
            endif
        endif

        @setvar! SpellInterrupted 0

        if targetexists
            hotkey 'cancel current target'
        endif
        
        if diffhits > ActivateAutoHealHPdiff 
            break
        endif

        if EnableCastCurse = 1 and timer CurseTimer > 60000 and mana >= 11 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3972 self and findtype 3976 self and findtype 3980 self
            @setvar! SpellInterrupted 0
            cast 'Curse'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Curse'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if diffhits >= 50
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD
                    if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                                    overhead "[ CURE POTION ]" 44
                                    settimer 'orangeMessageTimer' 0
                                endif 
                                wait 500
                            else
                                if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer 'orangeMessageTimer' 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif
                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    settimer 'HealPotionTimer' 0
                                    cooldown "Healing Potion" 11000
                                    if EnableOverheadMessages = 1
                                        overhead "[ HEAL POTION ]" 253
                                    endif 
                                endif
                                if not casting
                                    break
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile

            if SpellInterrupted = 0
                settimer CurseTimer 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                endif
            endif
        endif 

        if EnableCastManaDrain = 1 and timer ManaDrainTimer > 60000 and mana >= 11 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3962 self and findtype 3974 self and findtype 3981 self
            @setvar! SpellInterrupted 0
            cast 'Mana Drain'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Mana Drain'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if diffhits >= 50
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD
                    if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                                    overhead "[ CURE POTION ]" 44
                                    settimer 'orangeMessageTimer' 0
                                endif 
                                wait 500
                            else
                                if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer 'orangeMessageTimer' 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif
                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    settimer 'HealPotionTimer' 0
                                    cooldown "Healing Potion" 11000
                                    if EnableOverheadMessages = 1
                                        overhead "[ HEAL POTION ]" 253
                                    endif 
                                endif
                                if not casting
                                    break
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile

            if SpellInterrupted = 0
                settimer ManaDrainTimer 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                endif
            endif
        endif 

        if EnableAutoExplosionPots = 1
            if findtype 'purple potion' self as explotPot
                getlabel explotPot potLabel
                if "(" in potLabel
                    if timer PurplePotionTimer > 15500 
                        @setvar! PurplePotionReady 1
                    else
                        @setvar! PurplePotionReady 0
                    endif
                else
                    @setvar! PurplePotionReady 1
                endif
            
                if skill 'Alchemy' < 80
                    if timer TelekinesisTimer > 60000 or ClosestTargetisSticky = 0
                        if PurplePotionReady = 1 and find ClosestTarget ground -1 -1 12 and not dead ClosestTarget
                            if findtype 'purple potion' self
                                while not targetexists
                                    cast 'Telekinesis'
                                endwhile
                                clearsysmsg 
                                wft 500
                                target ClosestTarget
                                wait 250
                                if insysmsg "You are too far"
                                    @setvar! ClosestTargetisSticky 0
                                    clearsysmsg 
                                else 
                                    if EnableOverheadMessages = 1 
                                        overhead  '[ EXPLOSION POTION! ]' 419
                                    endif
                                    settimer TelekinesisTimer 0
                                    @setvar! ClosestTargetisSticky 1 
                                endif
                            endif 
                        endif               
                    endif 
                else 
                    @setvar! ClosestTargetisSticky 1
                endif 
            else 
                if EnableOverheadMessages = 1 and timer purpleMessageTimer > 15000
                    overhead '[ NO PURPLE POTIONS ]' 337
                    settimer purpleMessageTimer 0
                endif 
            endif 
        endif

        if EnableAutoExplosionPots = 1
            if timer TelekinesisTimer > 60000 
                @setvar! ClosestTargetisSticky 0
                settimer TelekinesisTimer 0
                replay
            endif 
        endif 

        if PurplePotionReady = 1 and ClosestTargetisSticky = 1 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "Where should i throw this potion?" 
                potion 'explosion'
            endwhile

            @setvar! PurplePotionReady 0
            settimer PurplePotionTimer 0

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    @setvar! SpellInterrupted 1
                    hotkey 'cancel current target'
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                cooldown "Purple Potion" 15000
                getlabel backpack packdesc
            endif
        endif 

        if gumpexists 622436516
            if ingump "12/|13/|14/|15/|16/|17/|18/|19/|20/|21/|11/|10/|9/|8/|7/|6/|5/" 622436516
                @setvar! StrangleAvailable 1
                @setvar! MindRotAvailable 1
                @setvar! CorpseSkinAvailable 1
                @setvar! EvilOmenAvailable 1
                @setvar! PainSpikeAvailable 1
            elseif ingump "4/" 622436516
                if ingump "14/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "3/" 622436516
                if ingump "13/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "2/" 622436516
                if ingump "12/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "1/" 622436516
                if ingump "11/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "0/" 622436516
                if ingump "10/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            endif
        endif 
 
        if EnableNecroStrangle = 1 and StrangleAvailable = 1 and timer StrangleTimer > 30000 and skill 'necromancy' >= 85 and mana >= 50 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'strangle'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer StrangleTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ STRANGLE ]' 333
                endif
                settimer StrangleTimer 0
                cooldown "Strangle" 30000
            endif
        endif 

        if gumpexists 622436516
            if ingump "12/|13/|14/|15/|16/|17/|18/|19/|20/|21/|11/|10/|9/|8/|7/|6/|5/" 622436516
                @setvar! StrangleAvailable 1
                @setvar! MindRotAvailable 1
                @setvar! CorpseSkinAvailable 1
                @setvar! EvilOmenAvailable 1
                @setvar! PainSpikeAvailable 1
            elseif ingump "4/" 622436516
                if ingump "14/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "3/" 622436516
                if ingump "13/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "2/" 622436516
                if ingump "12/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "1/" 622436516
                if ingump "11/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "0/" 622436516
                if ingump "10/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            endif
        endif 

        if EnableNecroCorpseSkin = 1 and CorpseSkinAvailable = 1 and timer CorpseSkinTimer > 30000 and skill 'necromancy' >= 65 and mana >= MinimumManaAmounttoNecroBuff and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'corpse skin'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer CorpseSkinTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ CORPSE SKIN ]' 2117
                endif
                settimer CorpseSkinTimer 0
                cooldown "Corpse Skin" 30000
            endif
        endif 

        if gumpexists 622436516
            if ingump "12/|13/|14/|15/|16/|17/|18/|19/|20/|21/|11/|10/|9/|8/|7/|6/|5/" 622436516
                @setvar! StrangleAvailable 1
                @setvar! MindRotAvailable 1
                @setvar! CorpseSkinAvailable 1
                @setvar! EvilOmenAvailable 1
                @setvar! PainSpikeAvailable 1
            elseif ingump "4/" 622436516
                if ingump "14/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "3/" 622436516
                if ingump "13/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "2/" 622436516
                if ingump "12/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "1/" 622436516
                if ingump "11/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "0/" 622436516
                if ingump "10/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            endif
        endif 
 
        if EnableNecroMindRot = 1 and MindRotAvailable = 1 and timer MindRotTimer > 30000 and skill 'necromancy' >= 75 and mana >= MinimumManaAmounttoNecroBuff and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'mind rot'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer MindRotTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ MIND ROT ]' 330
                endif
                settimer MindRotTimer 0
                cooldown "Mind Rot" 30000
            endif
        endif 

        if gumpexists 622436516
            if ingump "12/|13/|14/|15/|16/|17/|18/|19/|20/|21/|11/|10/|9/|8/|7/|6/|5/" 622436516
                @setvar! StrangleAvailable 1
                @setvar! MindRotAvailable 1
                @setvar! CorpseSkinAvailable 1
                @setvar! EvilOmenAvailable 1
                @setvar! PainSpikeAvailable 1
            elseif ingump "4/" 622436516
                if ingump "14/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "3/" 622436516
                if ingump "13/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "2/" 622436516
                if ingump "12/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "1/" 622436516
                if ingump "11/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "0/" 622436516
                if ingump "10/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            endif
        endif 

        if EnableNecroEvilOmen = 1 and EvilOmenAvailable = 1 and timer EvilOmenTimer > 30000 and skill 'necromancy' >= 60 and mana >= MinimumManaAmounttoNecroBuff and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'evil omen'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer EvilOmenTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ EVIL OMEN ]' 2114
                endif
                settimer EvilOmenTimer 0
                cooldown "Evil Omen" 30000
            endif
        endif 

        if gumpexists 622436516
            if ingump "12/|13/|14/|15/|16/|17/|18/|19/|20/|21/|11/|10/|9/|8/|7/|6/|5/" 622436516
                @setvar! StrangleAvailable 1
                @setvar! MindRotAvailable 1
                @setvar! CorpseSkinAvailable 1
                @setvar! EvilOmenAvailable 1
                @setvar! PainSpikeAvailable 1
            elseif ingump "4/" 622436516
                if ingump "14/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "3/" 622436516
                if ingump "13/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "2/" 622436516
                if ingump "12/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "1/" 622436516
                if ingump "11/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            elseif ingump "0/" 622436516
                if ingump "10/" 622436516
                    @setvar! StrangleAvailable 1
                    @setvar! MindRotAvailable 1
                    @setvar! CorpseSkinAvailable 1
                    @setvar! EvilOmenAvailable 1
                    @setvar! PainSpikeAvailable 1
                else 
                    @setvar! StrangleAvailable 0
                    @setvar! MindRotAvailable 0
                    @setvar! CorpseSkinAvailable 0
                    @setvar! EvilOmenAvailable 0
                    @setvar! PainSpikeAvailable 0
                endif 
            endif
        endif 
 
        if EnableNecroPainSpike = 1 and PainSpikeAvailable = 1 and timer 'PainSpikeTimer' > 30000 and skill 'necromancy' >= 95 and mana >= MinimumManaAmounttoNecroBuff and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 8 and findtype 8198 ground -1 -1 4 as corpsespike and timer 'PainSpikeDelayTimer' > PainSpikeAttackDelay
            @setvar! SpellInterrupted 0
            clearsysmsg 
            while not insysmsg "unholy symbols remaining"
                yell "[PainSpike"
                wft 1500
                target corpsespike

                if insysmsg "You do not see any corpses"
                    settimer PainSpikeTimer 25000
                    @setvar! SpellInterrupted 1
                    break
                else
                    settimer PainSpikeTimer 0
                endif

                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer PainSpikeTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ PAIN SPIKE! ]' 333
                endif
                settimer PainSpikeTimer 0
                cooldown "Pain Spike" 30000
                clearsysmsg 
            endif
        endif 

        if EnableCastMagicArrow = 1 and timer MagicArrowTimer > MagicArrowCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 4 and mana < 14 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3980 self
            @setvar! SpellInterrupted 0
            cast 'magic arrow'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'magic arrow'
            endwhile

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer MagicArrowTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer MagicArrowTimer 15000
                endif
            endif
        endif 

        if EnableCastHarm = 1 and timer HarmTimer > HarmCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 6 and mana < 14 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3976 self and findtype 3981 self
            @setvar! SpellInterrupted 0
            cast 'harm'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'harm'
            endwhile

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer HarmTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer HarmTimer 15000
                endif
            endif
        endif 

        if EnableCastFireball = 1 and timer FireballTimer > FireballCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 9 and mana < 14 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3962 self
            @setvar! SpellInterrupted 0
            cast 'fireball'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'fireball'
            endwhile

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer FireballTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer FireballTimer 15000
                endif
            endif
        endif 

        if EnableCastLightning = 1 and timer LightningTimer > LightningCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 11 and mana < 20 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3974 self and findtype 3980 self
            @setvar! SpellInterrupted 0
            cast 'lightning'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'lightning'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if diffhits > 70
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD
                    if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                                    overhead "[ CURE POTION ]" 44
                                    settimer 'orangeMessageTimer' 0
                                endif 
                                wait 500
                            else
                                if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer 'orangeMessageTimer' 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif
                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    settimer 'HealPotionTimer' 0
                                    cooldown "Healing Potion" 11000
                                    if EnableOverheadMessages = 1
                                        overhead "[ HEAL POTION ]" 253
                                    endif 
                                endif
                                if not casting
                                    break
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer LightningTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer LightningTimer 15000
                endif
            endif
        endif 

        if mana > 20 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            if diffhits < ActivateAutoHealHPdiff
                @setvar! spellCD 0
                @setvar! SpellInterrupted 0

                if insysmsg "Mana Thief activated" 
                    if EnableOverheadMessages = 1
                        overhead "[ MANA THIEF! ]" 22
                    endif 
                    cooldown "Mana Thief" 60000
                    clearsysmsg
                endif 

                if EnableFrostAspect = 1
                    if insysmsg "Frost Shell activated"
                        cooldown "Frost Shell Active" 5000
                        if EnableOverheadMessages = 1
                            overhead "[ FROST SHELL! ]" 2234
                        else 
                            overhead "  " 2234
                        endif
                        if FrostAspectTier = 0
                            cooldown "Frost Shell Cooldown" 30000
                        elseif FrostAspectTier = 1
                            cooldown "Frost Shell Cooldown" 29000
                        elseif FrostAspectTier = 2
                            cooldown "Frost Shell Cooldown" 28000
                        elseif FrostAspectTier = 3
                            cooldown "Frost Shell Cooldown" 27000
                        elseif FrostAspectTier = 4
                            cooldown "Frost Shell Cooldown" 26000
                        elseif FrostAspectTier = 5
                            cooldown "Frost Shell Cooldown" 25000
                        elseif FrostAspectTier = 6
                            cooldown "Frost Shell Cooldown" 24000
                        elseif FrostAspectTier = 7
                            cooldown "Frost Shell Cooldown" 23000
                        elseif FrostAspectTier = 8
                            cooldown "Frost Shell Cooldown" 22000
                        elseif FrostAspectTier = 9
                            cooldown "Frost Shell Cooldown" 21000
                        elseif FrostAspectTier = 10
                            cooldown "Frost Shell Cooldown" 20000
                        elseif FrostAspectTier = 11
                            cooldown "Frost Shell Cooldown" 19000
                        elseif FrostAspectTier = 12
                            cooldown "Frost Shell Cooldown" 18000
                        elseif FrostAspectTier = 13
                            cooldown "Frost Shell Cooldown" 17000
                        elseif FrostAspectTier = 14
                            cooldown "Frost Shell Cooldown" 16000
                        elseif FrostAspectTier = 15
                            cooldown "Frost Shell Cooldown" 15000
                        elseif FrostAspectTier = 14
                            cooldown "Frost Shell Cooldown" 15000
                        endif
                        clearsysmsg
                    endif 
                endif 

                if EnableCastFlamestrike = 1 and mana >= 40 and findtype 3981 self and findtype 3980 self
                    cast 'flamestrike'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'flamestrike'
                    endwhile
                    settimer "ExplosionCD" 8000
                    settimer "EnergyBoltCD" 0
                    settimer "MindBlastCD" 0
                    @settimer! spellTimer 0
                    @setvar! spellCD 1500
                elseif EnableCastExplosion = 1 and mana >= 20 and findtype 3963 self and findtype 3974 self and timer "ExplosionCD" > 8000
                    cast 'Explosion'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'Explosion'
                    endwhile
                    settimer "ExplosionCD" 0
                    settimer "EnergyBoltCD" 8000
                    settimer "MindBlastCD" 0
                    @settimer! spellTimer 0
                    @setvar! spellCD 1200
                elseif EnableCastEnergyBolt = 1 and mana >= 20 and findtype 3962 self and findtype 3976 self and timer "EnergyBoltCD" > 8000
                    cast 'energy bolt'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'energy bolt'
                    endwhile
                    settimer "ExplosionCD" 0
                    settimer "EnergyBoltCD" 0
                    settimer "MindBlastCD" 8000
                    @settimer! spellTimer 0
                    @setvar! spellCD 1200
                elseif EnableCastMindblast = 1 and mana >= 20 and findtype 3962 self and findtype 3974 self and findtype 3976 self and findtype 3980 self and timer "MindBlastCD" > 8000
                    cast 'mind blast'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'mind blast'
                    endwhile
                    settimer "ExplosionCD" 2000
                    settimer "EnergyBoltCD" 0
                    settimer "MindBlastCD" 0
                    @settimer! spellTimer 0
                    @setvar! spellCD 1000
                endif

                while not targetexists and spellCD != 0
                    if mana < 14
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif
                    if diffhits > 70
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif
                    if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif
                    if insysmsg "Your concentration is disturbed"
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif

                    if timer spellTimer < spellCD
                        if EnableCurePotion = 1
                            while poisoned and casting and not targetexists
                                if findtype "Orange Potion" self
                                    dclicktype "Orange Potion"
                                    if EnableOverheadMessages = 1 and timer 'orangeMessageTimer' > 3500
                                        overhead "[ CURE POTION ]" 44
                                        settimer 'orangeMessageTimer' 0
                                    endif 
                                    wait 500
                                else
                                    if timer 'orangeMessageTimer' > 5000 and EnableOverheadMessages = 1
                                        overhead "[ NO CURE POTS! ]" 337
                                        settimer 'orangeMessageTimer' 0
                                    endif
                                    break
                                endif
                            endwhile
                        endif

                        if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                            if findtype "Yellow Potion" self as hPot
                                getlabel hPot potLabel
                                if "next" in potLabel
                                    // Do nothing
                                else
                                    @setvar! ch 0

                                    if counttype 3852 self as c
                                        @setvar! ch c
                                    endif
                                    if insysmsg "potion satchel used"
                                    endif
                                    dclicktype 3852
                                    getlabel backpack packdesc
                                    wait 250

                                    if ch != counttype 3852 self or insysmsg "potion satchel used"
                                        settimer 'HealPotionTimer' 0
                                        cooldown "Healing Potion" 11000
                                        if EnableOverheadMessages = 1
                                            overhead "[ HEAL POTION ]" 253
                                        endif  
                                    endif
                                    if not casting
                                        break
                                    endif
                                endif
                            else
                                if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                    overhead "[ NO HEAL POTS! ]" 337
                                    settimer 'yellowMessageTimer' 0
                                endif
                            endif
                        endif
                    endif
                endwhile

                if SpellInterrupted = 0 and spellCD != 0
                    target ClosestTarget
                    getlabel backpack packdesc
                    wait 250

                    if insysmsg "target cannot be seen"
                        @setvar! ClosestTarget 0
                        @setvar! currentTarget 0
                        break
                    endif
                endif
            endif
        endif

        if EnableGoldVacuum = 1 and DisableVacuums != 1
            if findtype "gold coin" ground -1 -1 12 as droppedmoney and timer "GoldRadar" > 3500
                overhead "  " 149 droppedmoney
                settimer "GoldRadar" 0
            endif
            while findtype "gold coin" ground -1 -1 2 as droppedmoney and diffhits < ActivateAutoHealHPdiff
                overhead "  " 149
                hotkey "Grab Item"
                wft 2500
                target droppedmoney
                wait 250
                if insysmsg "Invalid or inaccessible item"
                    wait 500
                    @ignore droppedmoney
                endif
                wait 250
            endwhile
        endif

        if EnableDungeonCleanup = 1 and diffhits < ActivateAutoHealHPdiff 
            while findtype "iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 2 as item
                if EnableOverheadMessages = 1 
                    if timer "DungeonCleanup" > 1500
                        overhead '[ CLEANUP... ]' 420
                        settimer "DungeonCleanup" 0
                    endif 
                else
                    if timer "DungeonCleanup" > 1500
                        overhead '  ' 420
                        settimer "DungeonCleanup" 0
                    endif 
                endif
                hotkey "Grab Item"
                wft 1000
                target item
                wait 500                    
            endwhile

            if findtype "gold coin|iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 15 as dungeonjunk and timer "DungeonCleanupRadar" > 3500
                overhead "" 420 dungeonjunk
                settimer "DungeonCleanupRadar" 0
            endif
        endif

        if dead ClosestTarget or not find ClosestTarget ground -1 -1 12
            replay
        endif

        if insysmsg "world is saving"
            settimer "WorldSaveTimer" 0 
            if EnableOverheadMessages = 1  
                overhead "[ WORLD SAVING... ]" 253   
            endif   
            while timer "WorldSaveTimer" < 4500
                if insysmsg "save complete"
                    break
                endif
                wait 100
            endwhile   
            if EnableOverheadMessages = 1
                overhead "[ SAVE COMPLETE! ]" 253
            endif 
        endif

        if EnableArcaneCodexStances != 0 or EnableArcaneCodexFinisher != 0 and diffhits < ActivateAutoHealHPdiff 
            if skill 'Arcane' >= 80
                if findtype "arcane codex" backpack as MyCodex
                    if not gumpexists 2016719803 and EnableArcaneCodexHotbar = 1
                        while not gumpexists 1066647553
                            say "[CodexHotBar"
                            wait 500
                            if gumpexists 2016719803
                                break
                            endif
                        endwhile
                    endif

                    if EnableArcaneCodexStances = 6 
                        if mana > SwitchArcaneCodexManaMinimum
                            if not warmode
                                @setvar! SwitchToLeechStance 0
                                @setvar! SwitchToShieldStance 0
                                @setvar! SwitchToScatterStance 0
                                @setvar! SwitchToFractureStance 0
                                @setvar! SwitchToSurgeStance 1
                            elseif cooldown "Frost Shell" or poisoned or findbuff "bleed" or findbuff "disease" or diffhits > 70
                                @setvar! SwitchToLeechStance 0
                                @setvar! SwitchToShieldStance 1
                                @setvar! SwitchToScatterStance 0
                                @setvar! SwitchToFractureStance 0
                                @setvar! SwitchToSurgeStance 0
                            elseif warmode
                                @setvar! SwitchToLeechStance 1
                                @setvar! SwitchToShieldStance 0
                                @setvar! SwitchToScatterStance 0
                                @setvar! SwitchToFractureStance 0
                                @setvar! SwitchToSurgeStance 0
                            endif
                        endif
                    elseif EnableArcaneCodexStances = 1
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 1
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 2
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 1
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 3
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 1
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 4
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 1
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 5
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 1
                    endif

                    getlabel MyCodex MyCodexDesc

                    if EnableArcaneCodexStances = 6 or EnableArcaneCodexFinisher = 3 
                        if timer "WeaponCodexTimer" > SwitchArcaneCodexCooldown and mana > SwitchArcaneCodexManaMinimum
                            if SwitchToLeechStance = 1 or SwitchToLeechStance = 0
                                if "Leech" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance1
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                   endif
                                endif
                            elseif SwitchToShieldStance = 1 or SwitchToShieldStance = 0
                                if "Shield" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance2
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 1 or EnableArcaneCodexFinisher = 3
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                endif
                            elseif SwitchToScatterStance = 1 or SwitchToScatterStance = 0
                                if "Scatter" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance3
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                endif
                            elseif SwitchToFractureStance = 1 or SwitchToFractureStance = 0
                                if "Fracture" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance4
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 2 or EnableArcaneCodexFinisher = 3
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                   endif
                                endif
                            elseif SwitchToSurgeStance = 1 or SwitchToSurgeStance = 0
                                if "Surge" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance5
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        endif
                    elseif EnableArcaneCodexStances != 6 and EnableArcaneCodexStances != 0 and EnableArcaneCodexFinisher != 3 
                        if EnableArcaneCodexFinisher != 0 and timer "WeaponCodexCheckTimer" > 2000 and mana > 50
                            if SwitchToLeechStance = 1
                                if "Leech" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance1
                                    settimer "WeaponCodexCheckTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                   endif
                                endif
                            elseif SwitchToShieldStance = 1
                                if "Shield" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance2
                                    settimer "WeaponCodexCheckTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 1 or EnableArcaneCodexFinisher = 3
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                endif
                            elseif SwitchToScatterStance = 1
                                if "Scatter" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance3
                                    settimer "WeaponCodexCheckTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                endif
                            elseif SwitchToFractureStance = 1
                                if "Fracture" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance4
                                    settimer "WeaponCodexCheckTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 2 or EnableArcaneCodexFinisher = 3
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        yell [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                   endif
                                endif
                            elseif SwitchToSurgeStance = 1
                                if "Surge" in MyCodexDesc
                                    // Do nothing
                                else
                                    yell [ArcaneStance5
                                    settimer "WeaponCodexCheckTimer" 0
                                    wait 500
                                endif
                                if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 2
                                    if "Catalyst" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher2
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                elseif EnableArcaneCodexFinisher = 1
                                    if "Drain" in MyCodexDesc
                                        // Do nothing
                                    elseif DisableWeaponFinisher != 1
                                        say [ArcaneFinisher1
                                        @setvar! DisableWeaponFinisher 0
                                        settimer "WeaponCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableWeaponFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        endif
                    endif
                endif
            endif
        endif

        if EnableShieldCodexStances != 0 or EnableShieldCodexFinisher != 0 and diffhits < ActivateAutoHealHPdiff 
            if skill "Parrying" >= 80 and findtype "shield codex" backpack as ShieldCodex
                if not gumpexists 2016719803 and EnableShieldCodexHotbar = 1
                    while not gumpexists 1066647553
                        say "[CodexHotBar"
                        wait 500
                        if gumpexists 2016719803
                            break
                        endif
                    endwhile
                endif

                if EnableShieldCodexStances = 6 
                    if mana > SwitchShieldCodexManaMinimum
                        if not warmode
                            @setvar! SwitchToShieldBashStance 0
                            @setvar! SwitchToWardingStance 0
                            @setvar! SwitchToTestudoStance 0
                            @setvar! SwitchToMirrorStance 0
                            @setvar! SwitchToBulwarkStance 1
                        elseif cooldown "Frost Shell" or findbuff "bleed" or findbuff "disease" or poisoned or diffhits > 70
                            @setvar! SwitchToShieldBashStance 0
                            @setvar! SwitchToWardingStance 1
                            @setvar! SwitchToTestudoStance 0
                            @setvar! SwitchToMirrorStance 0
                            @setvar! SwitchToBulwarkStance 0
                        elseif warmode
                            @setvar! SwitchToShieldBashStance 1
                            @setvar! SwitchToWardingStance 0
                            @setvar! SwitchToTestudoStance 0
                            @setvar! SwitchToMirrorStance 0
                            @setvar! SwitchToBulwarkStance 0
                        endif
                    endif
                elseif EnableShieldCodexStances = 1
                    @setvar! SwitchToShieldBashStance 1
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 2
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 2
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 3
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 1
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 4
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 1
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 5
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 1
                endif

                getlabel ShieldCodex ShieldCodexDesc

                if EnableShieldCodexStances = 6 or EnableShieldCodexFinisher = 3 
                    if mana > SwitchShieldCodexManaMinimum
                        if timer "ShieldCodexTimer" > SwitchShieldCodexCooldown
                            if SwitchToWardingStance = 1
                                if "Warding" in ShieldCodexDesc
                                    // Do nothing
                                else
                                    yell [ShieldsStance2
                                    settimer "ShieldCodexTimer" 0
                                    wait 500
                                endif

                                if EnableShieldCodexFinisher != 0
                                    if EnableShieldCodexFinisher = 2 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                        if "Barrier" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            say [ShieldsFinisher2
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    elseif EnableShieldCodexFinisher = 1 and DisableShieldFinisher != 1
                                        if "Last Stand" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            yell [ShieldsFinisher1
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    endif
                                endif
                            elseif SwitchToMirrorStance = 1
                                if "Mirror" in ShieldCodexDesc
                                    // Do nothing
                                else
                                    yell [ShieldsStance4
                                    settimer "ShieldCodexTimer" 0
                                    wait 500
                                endif

                                if EnableShieldCodexFinisher != 0
                                    if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                        if "Last Stand" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            yell [ShieldsFinisher1
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                        if "Barrier" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            say [ShieldsFinisher2
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    endif
                                endif
                            elseif SwitchToBulwarkStance = 1
                                if "Bulwark" in ShieldCodexDesc
                                    // Do nothing
                                else
                                    yell [ShieldsStance5
                                    settimer "ShieldCodexTimer" 0
                                    wait 500
                                endif

                                if EnableShieldCodexFinisher != 0
                                    if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                        if "Last Stand" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            yell [ShieldsFinisher1
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                        if "Barrier" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            say [ShieldsFinisher2
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    endif
                                endif
                            elseif SwitchToTestudoStance = 1
                                if "Testudo" in ShieldCodexDesc
                                    // Do nothing
                                else
                                    yell [ShieldsStance3
                                    settimer "ShieldCodexTimer" 0
                                    wait 500
                                endif

                                if EnableShieldCodexFinisher != 0
                                    if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                        if "Last Stand" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            yell [ShieldsFinisher1
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                        if "Barrier" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            say [ShieldsFinisher2
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    endif
                                endif
                            elseif SwitchToShieldBashStance = 1
                                if "Shield Bash" in ShieldCodexDesc
                                    // Do nothing
                                else
                                    yell [ShieldsStance1
                                    settimer "ShieldCodexTimer" 0
                                    wait 500
                                endif

                                if EnableShieldCodexFinisher != 0
                                    if EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                        if "Barrier" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            say [ShieldsFinisher2
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    elseif EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3  and DisableShieldFinisher != 1
                                        if "Last Stand" in ShieldCodexDesc
                                            // Do nothing
                                        else
                                            yell [ShieldsFinisher1
                                            settimer "ShieldCodexTimer" 0
                                            wait 500
                                            if insysmsg "You must first reach rank 5"
                                                @setvar! DisableShieldFinisher 1
                                            endif
                                        endif
                                    endif
                                endif
                            endif
                        endif
                    endif
                elseif EnableShieldCodexStances != 6 and EnableShieldCodexFinisher != 3
                    if timer "ShieldCodexCheckTimer" > 2000
                        if SwitchToWardingStance = 1
                            if "Warding" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance2
                                settimer "ShieldCodexCheckTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 2 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 1 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToMirrorStance = 1
                            if "Mirror" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance4
                                settimer "ShieldCodexCheckTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToBulwarkStance = 1
                            if "Bulwark" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance5
                                settimer "ShieldCodexCheckTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToTestudoStance = 1
                            if "Testudo" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance3
                                settimer "ShieldCodexCheckTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToShieldBashStance = 1
                            if "Shield Bash" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance1
                                settimer "ShieldCodexCheckTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3  and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexCheckTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        endif
                    endif
                endif
            endif
        endif

        if skill "Arcane" >= 80 and EnableArcaneWeaponAbility != 0 and diffhits < ActivateAutoHealHPdiff 
            if EnableArcaneCodexAbilityHotbar = 1
                if not gumpexists 3954121934
                    yell '[abilitieshotbar'
                    wait 500
                endif
            endif
            if timer ArcaneWeaponAbilityTimer > 60000
                if EnableArcaneWeaponAbility = 1
                    if diffmana > UseArcaneWeaponAbilityManadiff
                        say "[Weaponability1"
                        getlabel backpack packdesc
                        wait 500
                        if insysmsg "You cannot perform that ability yet"
                            settimer ArcaneWeaponAbilityTimer 55000
                        else
                            settimer ArcaneWeaponAbilityTimer 0
                            if EnableOverheadMessages = 1
                                overhead "[ SEEKING ABILITY! ]" 2114
                            endif
                            cooldown "Seeking Active" 15000
                            cooldown "Weapon Ability" 60000
                        endif
                    endif
                elseif EnableArcaneWeaponAbility = 2
                    if diffmana > UseArcaneWeaponAbilityManadiff
                        say "[Weaponability2"
                        getlabel backpack packdesc
                        wait 500
                        if insysmsg "You cannot perform that ability yet"
                            settimer ArcaneWeaponAbilityTimer 55000
                        else
                            settimer ArcaneWeaponAbilityTimer 0
                            if EnableOverheadMessages = 1
                                overhead "[ LEYLINE ABILITY! ]" 420
                            endif
                            cooldown "Leyline Active" 15000
                            cooldown "Weapon Ability" 60000
                        endif
                    endif
                elseif EnableArcaneWeaponAbility = 3
                    if diffmana > UseArcaneWeaponAbilityManadiff
                        say "[Weaponability3"
                        getlabel backpack packdesc
                        wait 500
                        if insysmsg "You cannot perform that ability yet"
                            settimer ArcaneWeaponAbilityTimer 55000
                        else
                            settimer ArcaneWeaponAbilityTimer 0
                            if EnableOverheadMessages = 1
                                overhead "[ SOULFIRE ABILITY! ]" 2116
                            endif
                            cooldown "Weapon Ability" 60000
                        endif
                    endif
                endif
            endif
        endif

        if mana < LowManaWarningAmount and timer ManaOverheadTimer > 4500 and LowManaWarningAmount != 0
            overhead "[ LOW MANA! ]" 34
            settimer ManaOverheadTimer 0
        endif
        
         if diffhits > ActivateAutoHealHPdiff 
             replay
         endif
              
        if not warmode
            @setvar! WarModeToggledWhileFighting 1
        endif

        if EnableOverheadMessages = 1
            if insysmsg "something invisible out of"
                overhead " SOMEONE HIDING! " 6
            endif

            if insysmsg "additional mastery chain link"
                overhead "[ CHAIN LINK UNLOCKED!! ]" 149
            endif

            if insysmsg "You have unlocked a codex upgrade point"
                overhead "[ CODEX POINT UNLOCKED! ]" 2114
            endif

            if insysmsg "enough experience to upgrade"
                overhead "[ ASPECT TIER UNLOCKED!! ]" 2234
            endif

            if insysmsg "causes you to bleed"
                overhead "[ YOU ARE BLEEDING... ]" 2118
            endif

            if insysmsg "You feel chilled!"
                overhead "[ YOU ARE CHILLED... ]" 2234
            endif

            if insysmsg "The creature pierces and bypasses your armor!"
                overhead "[ YOU ARE PIERCED... ]" 337
            endif

            if insysmsg "Your strike disarms your target!" and not dead ClosestTarget
                overhead "[ DISARMED! ]" 2114 ClosestTarget
            endif

            if insysmsg "Your attack hamstrings your target!" and not dead ClosestTarget
                overhead "[ HAMSTRUNG! ]" 2117 ClosestTarget
            endif

            if insysmsg "You drain your opponent"
                overhead "[ DRAIN FINISHER! ]" 22
            endif

            if insysmsg "You parry the spell"
                overhead "[ SPELL PARRY ]" 111
            endif

            if insysmsg "Frost Shell activated"
                overhead "[ FROST SHELL! ]" 2234
            endif
        else
            if insysmsg "additional mastery chain link"
                overhead " CHAIN! " 149
            endif

            if insysmsg "You have unlocked a codex upgrade point"
                overhead " CODEX " 2114
            endif

            if insysmsg "enough experience to upgrade"
                overhead " ASPECT " 2234
            endif

            if insysmsg "Your strike disarms your target!" and not dead ClosestTarget
                overhead "*disarmed*" 2114 ClosestTarget
            endif

            if insysmsg "Your attack hamstrings your target!" and not dead ClosestTarget
                overhead "*hamstrung*" 2117 ClosestTarget
            endif

            if insysmsg "something invisible out of"
                overhead "    " 6
            endif
        endif

        if EnableCurePotion = 1
            if poisoned
                replay
            endif
        endif
    endwhile

    ///////////////////////
    //  END COMBAT LOOP  //
    ///////////////////////

    setvar! NeedtoSecureLoot 1

    if insysmsg "world is saving"
        settimer "WorldSaveTimer" 0
        while timer "WorldSaveTimer" < 5000
            if insysmsg "save complete"
                break
            endif
            wait 250
        endwhile
        if EnableOverheadMessages = 1
            overhead "[ SAVE COMPLETE! ]" 253
        endif
    endif

    if EnableWeightWarningMessage = 1
        if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT WARNING... ]" 77
                settimer "WeightTimer" 0
            else
                overhead "  " 77
                settimer "WeightTimer" 0
            endif
        elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT WARNING! ]" 153
                settimer "WeightTimer" 0
            else
                overhead "  " 153
                settimer "WeightTimer" 0
            endif
        elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT LIMIT REACHED! ]" 37
                settimer "WeightTimer" 0
            else
                overhead "  " 37
                settimer "WeightTimer" 0
            endif
            if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                wait 1000
                hotkey 'Toggle Peace Only'
                @setvar! AutoWeightRecall 1
                @setvar! WarModeToggledWhileFighting 0
                @setvar! TimeToGo 1
                replay
            elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                if timer "RECALLDELAY" > 3500 and EnableAutoRecallOverheadMessages = 1
                    overhead "[ WAITING TO RECALL... ]" 149
                    settimer "RECALLDELAY" 0
                endif
                wait 500
            elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                wait 1000
                hotkey 'Toggle Peace Only'
                @setvar! TimeToGo 1
                replay
            else
                overhead "[ OVERWEIGHT! ]" 337
                sysmsg "Time to head home and unload your loot!" 0
                settimer "WeightTimer" 0
            endif
        endif
    endif

    if EnableAutoCarving = 1 and findtype 11552 self
        while findtype "corpse" ground -1 -1 2 as deadbody and diffhits < ActivateAutoHealHPdiff 
            if findtype 11552 self
                if targetexists
                    hotkey 'cancel current target'
                endif
                while not targetexists
                    skill 'forensicevaluation'
                endwhile
                if targetexists and find deadbody ground -1 -1 2
                    target 'self'
                    @ignore deadbody
                    wait 500
                endif
                if insysmsg "You dont see anything nearby"
                    clearsysmsg 
                    break
                else
                    if EnableOverheadMessages = 1 and timer SkinningTimer > 3000 
                        overhead "[ SKINNING... ]" 333
                        settimer SkinningTimer 0
                    endif
                endif 
            else 
                if EnableOverheadMessages = 1 and timer SkinningTimer > 15000
                    overhead "[ NO SKINNING KNIFE ]" 337
                    settimer SkinningTimer 0
                    break
                endif  
            endif 
        endwhile
    endif 
            
    if EnableGoldVacuum = 1 and DisableVacuums != 1
        if findtype "gold coin" ground -1 -1 12 as droppedmoney and timer "GoldRadar" > 3500
            overhead "  " 149 droppedmoney
            settimer "GoldRadar" 0
        endif
        while findtype "gold coin" ground -1 -1 2 as droppedmoney and diffhits < ActivateAutoHealHPdiff
            overhead "  " 149
            hotkey "Grab Item"
            wft 2500
            target droppedmoney
            wait 250
            if insysmsg "Invalid or inaccessible item"
                wait 500
                @ignore droppedmoney
            endif
            wait 250
        endwhile
    endif

    if EnableOverheadMessages = 1
        if insysmsg "additional mastery chain link!"
            overhead "[ NEW LINK UNLOCKED!! ]" 149
            wait 250
        endif

        if insysmsg "You have unlocked a codex upgrade point"
            overhead "[ CODEX POINT UNLOCKED! ]" 2114
            wait 250
        endif

        if insysmsg "enough experience to upgrade"
            overhead "[ ASPECT TIER UNLOCKED! ]" 2234
            wait 250
        endif
    else
        if insysmsg "additional mastery chain link!"
            overhead " CHAIN " 149
        endif

        if insysmsg "You have unlocked a codex upgrade point"
            overhead " CODEX " 2114
        endif

        if insysmsg "enough experience to upgrade"
            overhead " ASPECT " 2234
        endif
    endif

    if dead 
        break
    endif
endwhile


/////////////////////////
//  BEGIN DEATH LOOP:  //
/////////////////////////

if dead
    overhead "[ R.I.P. ]" 337      
    wait 1500
    while dead
        if insysmsg "world is saving"
            settimer "WorldSaveTimer" 0 
            if EnableOverheadMessages = 1  
                overhead "[ WORLD SAVING... ]" 253   
            endif   
            while timer "WorldSaveTimer" < 4500
                if insysmsg "save complete"
                    break
                endif
                wait 100
            endwhile   
            if EnableOverheadMessages = 1
                overhead "[ SAVE COMPLETE! ]" 253
            endif 
        endif

        @setvar! IHAVEDIED 1
        wait 500
        if timer "HEALERSEARCH" > 4000
            overhead "[ FIND A HEALER! ]" 0
            settimer "HEALERSEARCH" 0
        endif

        if findtype "blue moongate|30528|moongate" ground -1 -1 12 as EscapeGate
            if timer "GATEHERE" > 2000
                overhead "  " 253 EscapeGate
                settimer "GATEHERE" 0
            endif
        endif

        while not gumpexists 3773199800 and findtype "blue moongate|30528|moongate" ground 0 1 2 as EscapeGate
            dclick EscapeGate
            wait 500
        endwhile

        while gumpexists 3773199800
            gumpresponse 16
            wait 500
            waitforgump 3773199800
            gumpresponse 2
            overhead "[ GATING TO TOWN... ]" 88
            break
        endwhile

        while gumpexists 2957810225
            overhead "[ HEALED! ]" 84
            gumpresponse 1
            wait 1000
            gumpclose 2957810225
            break
        endwhile

        if not dead
           break
        endif
    endwhile
endif

if not dead
    if EnableDressAfterResurrection = 1
        wait 500
        dress 'UltimateArcaneMage'
        wait 500
        while queued
            wait 100
        endwhile
        wait 1000
        dress 'UltimateArcaneMage'
        while queued
            wait 100
        endwhile
        wait 1000
        dress 'UltimateArcaneMage'
        while queued
            wait 100
        endwhile
    endif
 
    wait 1000

    if EnableRecallAfterResurrection = 1
        hotkey 'Toggle Peace Only'
        @setvar! ResThenTimeToGo 1
        wait 1000
        replay
    else
        wait 2500
        overhead "[ STOPPING SCRIPT! ]" 88
        stop
    endif
endif 
replay

//////////////////////
//  END DEATH LOOP  //
//////////////////////






                                                                            #############################
                                                                           ###    SCRIPT ENDS HERE!    ###
                                                                            #############################





    // Thank you for using my scripts!  I can be contacted via email here: dan@danstockman.com 
    // Good luck out there and say hello if you see me in Avadon (Lord Glacier) - please don't PK me lol


