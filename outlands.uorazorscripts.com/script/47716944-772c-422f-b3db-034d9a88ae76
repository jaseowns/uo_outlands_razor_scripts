# This is an automated backup - check out https://outlands.uorazorscripts.com/script/47716944-772c-422f-b3db-034d9a88ae76 for latest
# Automation by Jaseowns
## Script: Glaciers Chill: Arcane Parry Mage Auto Pilot Script
## Created by: danstock._98439#0
#############################################

/////////
////////                Glaciers Chill ARCANE PARRY MAGE AUTO PILOT - UO OUTLANDS RAZOR SCRIPT version 1.0.1
///////
//////                      UO Outlands Razor script - Released May 16, 2025 - Updated May 20, 2025
/////                           Compiled by DanStock. (aka. Lord Glacier)
////




                                                                 ################################
                                                                //      QUICK MODE CHANGE:      \\
                                                               ####################################

                                                                   @setvar! DUNGEONMODE 1
                                                                   @setvar! WILDERNESSMODE 0

                                                                   # DUNGEON = Auto FIND GATE
                                                                   # WILDERNESS = Auto RECALL

                                                               ####################################
                                                                ##################################



                                        ###############################                     ###############################
                                       //  SUGGESTED SKILL TEMPLATE:  \\                   //      INVENTORY ITEMS:       \\
                                      ###################################                 ###################################

                                          #     120  Necromancy                               Book of Necromancy
                                          #     120  Cooking                                  Wizards Grimoire
                                          #     100  Eval Intelligence                        Parrying Codex
                                          #     100  Magery                                   Arcane Codex
                                          #     100  Arcane                                   Arcane Staff
                                          #     100  Wrestling                                Potion Satchel (w/ potions)
                                          #      80  Parrying                                 Wizard Satchel (w/ regs)
                                          #                                                   Magic Mushrooms
                                          #  ASPECT: ARCANE weapon                            Delectable food
                                          #          ARCANE armour                            Trapped pouches
                                          #                                                   Adventurers rope
                                          #       or ELDRITCH armour                          Scissors [blessed] *
                                          #       or VOID armour                              Wooden Box w/ copper key *
                                          #       or BLOOD armour                             Platemail (or bone) armour
                                          #       or FROST armour                             Arcane aspect crystals

                                      ##################################                  ##################################
                                       ################################                    ################################
                                        ##############################                      ##############################

                               
    ///////////////////////
    //    CHANGE LOG:    //
    ///////////////////////

#       May 20 2025 - version 1.0.2:  Fixed typo in Gold Drop section and updated logic for Weapon Abilities
#       May 18 2025 - version 1.0.1:  Added cooldown trigger for Mana Thief proc
#       May 16 2025 - version 1.0.0:  Public script release


    /////////////////
    //    TIPS:    //
    /////////////////

#       IMPT: FIRST RUN OF SCRIPT SHOULD BE DONE IN HOUSE/INN ROOM AND TAKES ROUGHLY 15 SECONDS TO COMPLETE INITIAL (ONE TIME) SETUP!
#           Initial setup can be redone by setting 'ResetScriptPermanentVariables' variable to '1' below!
#           Or you can re-target script variables individually in the 'Options' tab above the script

#       Script displays lots of OVERHEAD MESSAGES by default - these can be disabled in the variable section (minimal target indicators remain - it is my preferred mode!)
#       Recommend using Razor TEXT FILTERS to cancel redundant system messages and Razor spam
#       Script has optional COOLDOWNS you can add (see list below) but they are NOT required for script function - just handy to display on bars in your U.I.
#       Script uses ORGANIZER AGENT-01 for optional MAIN INVENTORY pouch organization (can be set to auto select your main bag in inventory reset below)
#       If enabled AUTO RECALL triggers when RED is within target range (~12 tiles) or when WEIGHT LIMIT is reached in WILDERNESSMODE
#       If enabled POTIONS will be automatically consumed as needed and MANUAL POTION USE MAY DISRUPT SCRIPT TIMING (turn off script potions if manual hotkey is preferred)
#       If enabled and RED is targeted (~12 tiles) in DUNGEONMODE (or WEIGHT LIMIT reached) script will use DUNGEON ESCAPE mode to locate and activate MOONGATES while keeping you alive
#       If enabled LOOT CHEST in your HOME/INN/BANK is used store goods, script uses ORGANIZER AGENTS 06-09 as sub-containers you can set inside the chest to organize items further
#       If enabled and WOODEN BOX and COPPER KEY found in inventory, script will automactially store and lock any looted items when not in combat
#       Script allows for manual selection of CODEX STANCES in the variable section below (or you can enable automatic stance switching instead)
#       If AUTO ARCANE CODEX stance switching is enabled:  peace = LEECH/DRAIN  war = SURGE/DRAIN  poisoned/bleeding/diseased/lowhp = SHIELD/CATALYST
#       If AUTO PARRY CODEX stance switching is enabled:  peace = SHIELD BASH/LAST STAND  war = BULWARK/LAST STAND  poisoned/bleeding/diseased/lowhp = WARDING/BARRIER
#       If you die the DEATH LOOP will auto select moongates and travel to last gated town and then waits to auto-select the resurrection gump when a HEALER is located
#       If enabled a DRESS LIST of your [blessed] wearables will be equipped after resurrection (must be named 'ArcaneMage')
#       If enabled after resurrection script can recall home (requires scrolls in [blessed] runebook), resupply, heal, activate aspect and even setup your pack with pouch stacks, etc.
#       If enabled INVENTORY RESET will stack trapped pouches on your main inventory pouch (after putting scissors inside to protect them from shelf restocking) and then hide the stack
#       Recommend use of DAMAGED TO DISEASED chain links, SPELL ASPECT CHANCE chain links and/or SPELL ASPECT MODIFIER chain links
#       Once ARCANE CODEX are sufficiently levelled PLATEMAIL ARMOUR can be used and no meditation skills will be necessary
#       Recommend prioritizing CREATE FOOD and MANA DRAIN spells in WIZARDS GRIMOIRE before moving on to other spells - this build is all about mana regeneration!
#       MANY FEATURES ARE TURNED 'OFF' BY DEFAULT!  MAKE SURE TO CHECK THE VARIABLE SECTION BELOW CLOSELY PRIOR TO FIRST USE!!
#       This script is a compilation of many existing scripts married to my own new stuff, but big thanks to user dennozz for many features I learned from studying their scripts!
#       I have done my best to make things simple to use and understand but it is a constant work in progress - CHECK FOR UPDATES OFTEN!




                                                            //////////////////////////////
                                                            //    RESET SCRIPT HERE:    //
                                                            //////////////////////////////

                                  ////  SET THIS VALUE TO 1 AND RUN SCRIPT TO UNSET ALL PERMANENT SCRIPT VARIABLES:  \\\\

                                                        @setvar! ResetScriptPermanentVariables 0

                           #############  THEN RETURN 'ResetScriptPermanentVariables' TO '0' TO RESTART INITIAL SETUP  #############
                           ####  (Or you can re-target script variables individually in the 'Options' tab above the script!)  ####




     ###################################################
    ###    OPTIONAL COOLDOWNS TO ADD IN UO CLIENT:    ###
    ###               (case sensitive!)               ###
     ###################################################

#         Healing Potion
#         Purple Potion
#         Mushroom
#         Snacking Timer
#         Mana Thief
#         Corpse Skin
#         Evil Omen
#         Mind Rot
#         Pain Spike
#         Strangle
#         Seeking Active
#         Leyline Active
#         Seeking
#         Leyline
#         Soulfire



     ###############################
    ###      USER VARIABLES:      ###
     ###############################

//////////////////
//   POTIONS:   //
//////////////////

@setvar! EnableHealPotion 1
@setvar! EnableCurePotion 1
@setvar! EnableRefreshPotion 1
@setvar! EnableStrengthPotion 0
@setvar! EnableResistPotion 0
@setvar! EnableAgilityPotion 0
@setvar! EnableAutoExplosionPots 0

@setvar! HealPotionHPdiff  35
@setvar! RefreshPotionSPdiff 10


//////////////////
//  OFFENSIVE:  //
//////////////////

@setvar! EnableCastFlamestrike 1
@setvar! EnableCastEnergyBolt 1
@setvar! EnableCastExplosion 1
@setvar! EnableCastMindblast 1

@setvar! EnableCastMagicArrow 1
@setvar! EnableCastFireball 1
@setvar! EnableCastLightning 1
@setvar! EnableCastHarm 1
@setvar! EnableCastCurse 1
@setvar! EnableCastManaDrain 1

@setvar! MagicArrowCooldown 60000
@setvar! FireballCooldown 60000
@setvar! LightningCooldown 60000
@setvar! HarmCooldown 60000
@setvar! CurseCooldown 60000
@setvar! ManaDrainCooldown 60000

@setvar! EnableAutoTaunting 0
    # Requires 80+ Parrying skill

@setvar! EnableArcaneCodexHotbar 0
@setvar! EnableArcaneCodexAbilityHotbar 0

@setvar! UseArcaneWeaponAbilityManaSP 85
@setvar! SwitchArcaneCodexManaMinimum 20
@setvar! SwitchArcaneCodexCooldown 5000

@setvar! EnableArcaneCodexStances 0
    # '0' for 'Disabled'
    # '1' for 'Leech Stance'
    # '2' for 'Shield Stance'
    # '3' for 'Scatter Stance'
    # '4' for 'Fracture Stance'
    # '5' for 'Surge Stance'
    # '6' for 'Auto Arcane Stance Switching'
        //  Auto:  PEACE = 'Leech Stance'  WAR = 'Surge Stance'  BLEED/POISON/LOWHP = 'Shield Stance'

@setvar! EnableArcaneCodexFinisher 0
    # '0' for 'Disabled'
    # '1' for 'Drain Finisher'
    # '2' for 'Catalyst Finisher'
    # '3' for 'Auto Arcane Finisher Switching'
        //  Auto:  PEACE/WAR = 'Drain Finisher'  BLEED/POISON/LOWHP = 'Catalyst Finisher'

@setvar! EnableArcaneWeaponAbility 0
    # '0' for 'Disabled'
    # '1' for 'Seeking Ability'
    # '2' for 'Leyline Ability'
    # '3' for 'Soulfire Ability'


//////////////////
//  DEFENSIVE:  //
//////////////////

@setvar! EnableAutoParalyzePouch 1

@setvar! EnableCastHeal 1
@setvar! EnableCastGreaterHeal 1
@setvar! EnableCastCure 1

@setvar! ActivateAutoHealHPdiff 45
@setvar! CastGreaterHealHPdiff 45
@setvar! CastHealHPdiff 60
@setvar! CastEmergencyHealHPdiff 75

@setvar! MiniumManaToApplyBuffs 90
@setvar! EnableMagicReflection 1
@setvar! EnableBless 1
@setvar! EnableReactiveArmour 1
@setvar! EnableProtection 1

@setvar! EnableMagicMushroom 1
@setvar! EatMushroomManaSP 60
@setvar! MushroomCooldown 60000
@setvar! EnableMushroomMaker 1
@setvar! MakeMushroomAmount 5
@setvar! LowManaWarningAmount 0

@setvar! EnableShieldCodexHotbar 0

@setvar! SwitchShieldCodexManaMinimum 20
@setvar! SwitchShieldCodexCooldown 5000

@setvar! EnableShieldCodexStances 0
    # '0' for 'Disabled'
    # '1' for 'Shield Bash Stance'
    # '2' for 'Warding Stance'
    # '3' for 'Testudo Stance'
    # '4' for 'Mirror Stance'
    # '5' for 'Bulwark Stance'
    # '6' for 'Auto Shield Stance Switching'
        //  Auto:  PEACE = 'Shield Bash Stance'  WAR = 'Bulwark Stance'  BLEED/POISON/LOWHP = 'Warding Stance'

@setvar! EnableShieldCodexFinisher 0
    # '0' for 'Disabled'
    # '1' for 'Last Stand Finisher'
    # '2' for 'Barrier Finisher'
    # '3' for 'Auto Shield Finisher Switching'
        //  Auto:  PEACE/WAR = 'Last Stand Finisher'  BLEED/POISON/LOWHP = 'Barrier Finisher'


///////////////////
//  NECROMANCY:  //
///////////////////

@setvar! EnableNecroMindRot 1
@setvar! EnableNecroEvilOmen 1
@setvar! EnableNecroCorpseSkin 1
@setvar! EnableNecroPainSpike 0
@setvar! EnableNecroStrangle 0


//////////////////
//   UTILITY:   //
//////////////////

@setvar! EnableOverheadMessages 1
@setvar! EnableAutoCarving 0
@setvar! EnableLootBag 0
@setvar! EnableAutoSatchels 0

@setvar! EnablePutLootinLockBox 0
    //  Must have WOODEN BOX and COPPER KEY and loot will be automatically secured while not in combat

@setvar! EnableDropGoldWhenOverweight 0
@setvar! DropGoldAmount 250

@setvar! EnableDungeonCleanup 0
    //  Will automatically pickup discarded resources (gold, regs, ingots, boards, etc.)

@setvar! EnableWeightWarningMessage 1
@setvar! GreenWarningDiffWeight 50
@setvar! YellowWarningDiffWeight 25
@setvar! RedWeightLimitDiffWeight 10
    //  Red limit will trigger 'Auto Recall/Dungeon Gate' (if enabled) or else script ends


/////////////////////////
//  AUTO RECALL/GATE:  //
/////////////////////////

@setvar! EnablePKradar 1
    //  No tracking skill required (uses target hotkeys)

@setvar! EnableCastRecall 1
    # '0' for 'Scrolls in charged Runebook to "first" rune'
    # '1' for 'Cast Recall to Runebook using "default" rune'

if EnablePKradar = 1
    if WILDERNESSMODE = 1
        @setvar! EnableAutoRedRecall 1
    elseif DUNGEONMODE = 1
        @setvar! EnableAutoRedDungeonGate 1
    endif
    //  Will only trigger if RED is within target range (~12 tiles)
endif

if WILDERNESSMODE = 1
    @setvar! EnableAutoWeightRecall 1
elseif DUNGEONMODE = 1
    @setvar! EnableAutoWeightDungeonGate 1
    @setvar! EnableRecallAfterDungeonGate 1
endif

@setvar! EnableRecallAfterResurrection 0
    //  Must have [blessed] runebook charged w/ scrolls
@setvar! EnableDressAfterResurrection 0
    //  Must have a 'Dress List' named 'ArcaneMage' for all [blessed] wearables

//  AUTO RECALL DESTINATION (choose only one):
    @setvar! OwnerInnRecall 0
    @setvar! CoOwnerInnRecall 0
    @setvar! InsideHouseRecall 0
    @setvar! OutsideHouseRecall 0
    @setvar! BankRecall 0 

        if OutsideHouseRecall = 1
            @setvar! EnableCloseMyDoor 0
            # Use ">info" to ID your own house door (to quickly close it behind you):
            @setvar! MyDoor 0x0000000
        endif 

        @setvar! HideAtHomeorInn 0
                    
                    
/////////////////////////
//    AFTER RECALL:    //
/////////////////////////

    @setvar! EnableSafeDeposit 0
    @setvar! EnableRepairBench 0
    @setvar! EnableResourceStockpile 0
    @setvar! EnableStorageShelf 0
    @setvar! EnableMagicRecycler 0
    @setvar! EnableStorageTomes 0
    @setvar! EnableLootChest 0
    @setvar! EnableReagentSplitter 0
        
    # This variable will reorganize your backpack after death (see instructions below)
        # Storage shelf loadout must consist of the following:
        //  Requires an equal amount of TRAPPED POUCHES and SCISSORS [blessed]
        //  Requires 1 UNTRAPPED POUCH (for main inventory - optionally set as Organizer Agent-01 below) and 1 BAG (for loot, etc.)
        //  Script will put scissors in each trapped pouch (to keep them from being grabbed during future shelf loading)
        //  Script then STACKS any trapped pouches on top of your main inventory pouch
        //  Loot bag will be moved into main inventory pouch and automatically set as your Grab Bag for Gridloot, etc.
        //  Script will then hide the stack underneath an ATLAS and put a DECOY TRAPPED POUCH out in the open
        //  ASPECT WEAPON and ARMOR will be re-activated automatically and HP restored to MAX
        //  Loadout reset finishes by opening backpack, main pouch, loot bag and any satchels
        @setvar! EnableResetInventoryAfterDeath 0
        @setvar! EnableSetMainPouchOrganizer01 0


////////////////////////
//  MOB IGNORE LIST:  //
////////////////////////

removelist animalsIgnoreList
createlist animalsIgnoreList
pushlist animalsIgnoreList "a plover"
pushlist animalsIgnoreList "a sheep"
pushlist animalsIgnoreList "a frenzied ostard"
pushlist animalsIgnoreList "a tundra ostard"
pushlist animalsIgnoreList "a desert ostard"
pushlist animalsIgnoreList "a forest ostard"
pushlist animalsIgnoreList "a finch"
pushlist animalsIgnoreList "a sparrow"
pushlist animalsIgnoreList "a towhee"
pushlist animalsIgnoreList "a lapwing"
pushlist animalsIgnoreList "a silverback"
pushlist animalsIgnoreList "a giant frog"
pushlist animalsIgnoreList "a crow"
pushlist animalsIgnoreList "a woodpecker"
pushlist animalsIgnoreList "a horse"
pushlist animalsIgnoreList "a swift"
pushlist animalsIgnoreList "a skylark"
pushlist animalsIgnoreList "a corpser"
pushlist animalsIgnoreList "a hawk"
pushlist animalsIgnoreList "a chickadee"
pushlist animalsIgnoreList "a cat"
pushlist animalsIgnoreList "a dog"
pushlist animalsIgnoreList "a black bear"
pushlist animalsIgnoreList "a brown bear"
pushlist animalsIgnoreList "a grizzly bear"
pushlist animalsIgnoreList "a bull"
pushlist animalsIgnoreList "a cow"
pushlist animalsIgnoreList "a chicken"
pushlist animalsIgnoreList "a bird"
pushlist animalsIgnoreList "an eagle"
pushlist animalsIgnoreList "an elk"
pushlist animalsIgnoreList "a great hart"
pushlist animalsIgnoreList "a kingfisher"
pushlist animalsIgnoreList "a hind"
pushlist animalsIgnoreList "a llama"
pushlist animalsIgnoreList "a sand crab"
pushlist animalsIgnoreList "a pig"
pushlist animalsIgnoreList "a polar bear"
pushlist animalsIgnoreList "a walrus"
pushlist animalsIgnoreList "a cougar"
pushlist animalsIgnoreList "a wolf"
pushlist animalsIgnoreList "a goat"
pushlist animalsIgnoreList "a raven"
pushlist animalsIgnoreList "a magpie"
pushlist animalsIgnoreList "a warbler"
pushlist animalsIgnoreList "a tern"
pushlist animalsIgnoreList "a nightingale"
pushlist animalsIgnoreList "a colossal frog"
pushlist animalsIgnoreList "a wren"
pushlist animalsIgnoreList "red rubble"
pushlist animalsIgnoreList "a spirit wolf"
pushlist animalsIgnoreList "a spirit sabertus"
pushlist animalsIgnoreList "a death asp"
pushlist animalsIgnoreList "a death adder"
pushlist animalsIgnoreList "a nuthatch"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"
pushlist animalsIgnoreList "ADD MOBS TO IGNORE HERE"

/////////////////////////
//  END OF VARIABLES!  //
/////////////////////////





################   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ########   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ########   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ########   !EDIT BELOW THIS LINE AT YOUR OWN RISK!   ################





///////////////////////
//   SCRIPT RESET:   //
///////////////////////

if ResetScriptPermanentVariables = 1
    unsetvar AutoRecallChargedRunebook
    unsetvar FirstRunArcaneMage
    unsetvar ArcaneMageAutoPilot
    unsetvar LootBag
    unsetvar LootChest
    overhead "[ SCRIPT VARIABLES RESET... ]" 333
    sysmsg "Please return 'ResetScriptPermanentVariables' to 0 to continue!" 153
    stop
endif


///////////////////////
//   TIMER SETUPS:   //
///////////////////////

if not timerexists 'REDALERT'
    createtimer 'REDALERT'
    settimer 'REDALERT' 0
endif

if not timerexists 'LootTimer'
    createtimer 'LootTimer'
    settimer 'LootTimer' 0
endif

if not timerexists 'PurplePotionTimer'
    createtimer 'PurplePotionTimer'
    settimer 'PurplePotionTimer' 0
endif

if not timerexists 'ExplosionCD'
    createtimer 'ExplosionCD'
    settimer 'ExplosionCD' 0
endif

if not timerexists 'EnergyBoltCD'
    createtimer 'EnergyBoltCD'
    settimer 'EnergyBoltCD' 0
endif

if not timerexists 'MindBlastCD'
    createtimer 'MindBlastCD'
    settimer 'MindBlastCD' 0
endif

if not timerexists 'WeightTimer'
    createtimer 'WeightTimer'
    settimer 'WeightTimer' 0
endif

if not timerexists 'PKRadar'
    createtimer 'PKRadar'
    settimer 'PKRadar' 0
endif

if not timerexists "DungeonEscape"
    createtimer "DungeonEscape"
    settimer "DungeonEscape" 0
endif

if not timerexists 'TargetChecker'
    createtimer 'TargetChecker'
    settimer 'TargetChecker' 0
endif

if not timerexists 'TauntingTimer'
    createtimer 'TauntingTimer'
    settimer 'TauntingTimer' 0
endif

if not timerexists "WeaponCodexTimer"
    createtimer "WeaponCodexTimer"
    settimer "WeaponCodexTimer" 0
endif

if not timerexists "ShieldCodexTimer"
    createtimer "ShieldCodexTimer"
    settimer "ShieldCodexTimer" 0
endif

if not timerexists "DungeonCleanup"
    createtimer "DungeonCleanup"
    settimer "DungeonCleanup" 0
endif

if not timerexists "DungeonCleanupRadar"
    createtimer "DungeonCleanupRadar"
    settimer "DungeonCleanupRadar" 0
endif

if not timerexists 'ArcaneStaffCheck'
    createtimer 'ArcaneStaffCheck'
    settimer 'ArcaneStaffCheck' 4500
endif

if not timerexists 'TargetTimer'
    createtimer 'TargetTimer'
    settimer 'TargetTimer' 4500
endif


if not timerexists 'ManaOverheadTimer'
    createtimer 'ManaOverheadTimer'
    settimer 'ManaOverheadTimer' 4500
endif

if not timerexists 'MANAWAIT'
    createtimer 'MANAWAIT'
    settimer 'MANAWAIT' 4500
endif

if not timerexists 'MURDERTARGET'
    createtimer 'MURDERTARGET'
    settimer 'MURDERTARGET' 4500
endif

if not timerexists 'GETCLOSER'
    createtimer 'GETCLOSER'
    settimer 'GETCLOSER' 4500
endif

if not timerexists 'GATEHERE'
    createtimer 'GATEHERE'
    settimer 'GATEHERE' 4500
endif

if not timerexists 'RECALLDELAY'
    createtimer 'RECALLDELAY'
    settimer 'RECALLDELAY' 4500
endif

if not timerexists 'CANNOTSEE'
    createtimer 'CANNOTSEE'
    settimer 'CANNOTSEE' 4500
endif

if not timerexists 'TOOFAR'
    createtimer 'TOOFAR'
    settimer 'TOOFAR' 4500
endif

if not timerexists 'HEALERSEARCH'
    createtimer 'HEALERSEARCH'
    settimer 'HEALERSEARCH' 4500
endif

if not timerexists 'overweightMessageTimer'
    createtimer 'overweightMessageTimer'
    settimer 'overweightMessageTimer' 4500
endif

if not timerexists 'noTargetMessageTimer'
    createtimer 'noTargetMessageTimer'
    settimer 'noTargetMessageTimer' 4500
endif

if not timerexists 'searchingMessageTimer'
    createtimer 'searchingMessageTimer'
    settimer 'searchingMessageTimer' 4500
endif

if not timerexists "inventorycheck"
    createtimer "inventorycheck"
    settimer "inventorycheck" 5000
endif

if not timerexists 'noRegsMessageTimer'
    createtimer 'noRegsMessageTimer'
    settimer 'noRegsMessageTimer' 4500
endif

if not timerexists 'foodMessageTimer'
    createtimer 'foodMessageTimer'
    settimer 'foodMessageTimer' 4500
endif

if not timerexists 'pouchMessageTimer'
    createtimer 'pouchMessageTimer'
    settimer 'pouchMessageTimer' 4500
endif

if not timerexists 'aidsMessageTimer'
    createtimer 'aidsMessageTimer'
    settimer 'aidsMessageTimer' 4500
endif

if not timerexists 'whiteMessageTimer'
    createtimer 'whiteMessageTimer'
    settimer 'whiteMessageTimer' 4500
endif

if not timerexists 'blueMessageTimer'
    createtimer 'blueMessageTimer'
    settimer 'blueMessageTimer' 4500
endif

if not timerexists 'blackMessageTimer'
    createtimer 'blackMessageTimer'
    settimer 'blackMessageTimer' 4500
endif

if not timerexists 'orangeMessageTimer'
    createtimer 'orangeMessageTimer'
    settimer 'orangeMessageTimer' 4500
endif

if not timerexists 'yellowMessageTimer'
    createtimer 'yellowMessageTimer'
    settimer 'yellowMessageTimer' 4500
endif

if not timerexists 'redMessageTimer'
    createtimer 'redMessageTimer'
    settimer 'redMessageTimer' 4500
endif

if not timerexists 'MeditationOverheadTimer'
    createtimer 'MeditationOverheadTimer'
    settimer 'MeditationOverheadTimer' 5000
endif

if not timerexists 'SkinningTimer'
    createtimer 'SkinningTimer'
    settimer 'SkinningTimer' 5000
endif

if not timerexists 'RUNAWAY'
    createtimer 'RUNAWAY'
    settimer 'RUNAWAY' 6000
endif

if not timerexists 'STORELOOT'
    createtimer 'STORELOOT'
    settimer 'STORELOOT' 6000
endif

if not timerexists 'MeditationTimer'
    createtimer 'MeditationTimer'
    settimer 'MeditationTimer' 10500
endif

if not timerexists 'ArcaneWeaponAbilityTimer'
    createtimer 'ArcaneWeaponAbilityTimer'
    settimer 'ArcaneWeaponAbilityTimer' 10500
endif

if not timerexists 'ATTACKTIMER'
    createtimer 'ATTACKTIMER'
    settimer 'ATTACKTIMER' 15000
endif

if not timerexists 'magicReflectTimer'
    createtimer 'magicReflectTimer'
    settimer 'magicReflectTimer' 15000
endif

if not timerexists 'armorReflectTimer'
    createtimer 'armorReflectTimer'
    settimer 'armorReflectTimer' 15000
endif

if not timerexists 'protectionTimer'
    createtimer 'protectionTimer'
    settimer 'protectionTimer' 15000
endif

if not timerexists 'EvilOmenTimer'
    createtimer 'EvilOmenTimer'
    settimer 'EvilOmenTimer' 30000
endif

if not timerexists 'CorpseSkinTimer'
    createtimer 'CorpseSkinTimer'
    settimer 'CorpseSkinTimer' 30000
endif

if not timerexists 'PainSpikeTimer'
    createtimer 'PainSpikeTimer'
    settimer 'PainSpikeTimer' 30000
endif

if not timerexists 'StrangleTimer'
    createtimer 'StrangleTimer'
    settimer 'StrangleTimer' 30000
endif

if not timerexists 'MindRotTimer'
    createtimer 'MindRotTimer'
    settimer 'MindRotTimer' 30000
endif

if not timerexists 'SnackTimer'
    createtimer 'SnackTimer'
    settimer 'SnackTimer' 60000
endif

if not timerexists 'WizardSatchelTimer'
    createtimer 'WizardSatchelTimer'
    settimer 'WizardSatchelTimer' 60000
endif

if not timerexists 'PotionSatchelTimer'
    createtimer 'PotionSatchelTimer'
    settimer 'PotionSatchelTimer' 60000
endif

if not timerexists 'CurseTimer'
    createtimer 'CurseTimer'
    settimer 'CurseTimer' CurseCooldown
endif

if not timerexists 'ManaDrainTimer'
    createtimer 'ManaDrainTimer'
    settimer 'ManaDrainTimer' ManaDrainCooldown
endif

if not timerexists 'MagicArrowTimer'
    createtimer 'MagicArrowTimer'
    settimer 'MagicArrowTimer' MagicArrowCooldown
endif

if not timerexists 'HarmTimer'
    createtimer 'HarmTimer'
    settimer 'HarmTimer' HarmCooldown
endif

if not timerexists 'FireballTimer'
    createtimer 'FireballTimer'
    settimer 'FireballTimer' FireballCooldown
endif

if not timerexists 'LightningTimer'
    createtimer 'LightningTimer'
    settimer 'LightningTimer' LightningCooldown
endif

if not timerexists 'MushroomTimer'
    createtimer 'MushroomTimer'
    settimer 'MushroomTimer' MushroomCooldown
endif

clearsysmsg

if not varexist previousTarget
    @setvar! previousTarget 0
endif


//////////////////////
//  INITIAL SETUP:  //
//////////////////////

if not dead
    if not varexist ArcaneMageAutoPilot
        overhead "Glaciers Chill Dexxer Auto Pilot Script" 2234
        overhead "version 1.0.2 - Last Updated May 20, 2025" 2663
        wait 2500
        overhead "Thank you for trying my Arcane Parry Mage AUTO PILOT script!  It appears this may be your first time running it..." 0
        wait 4000
        overhead "IMPT: Please make sure to check and adjust your VARIABLES!" 153
        wait 4500
        overhead "Please read the TIPS section at the beginning of the script for more info" 88
        wait 3000
        setvar ArcaneMageAutoPilot 1
        sysmsg "Beginning Glaciers Chill Arcane Parry Mage Auto Pilot script.......... " 0
        wait 1000
    endif

    if EnableAutoRedRecall = 1 or EnableAutoWeightRecall = 1 or EnableRecallAfterResurrection = 1 or EnableRecallAfterDungeonGate = 1
        if not varexist AutoRecallChargedRunebook
            wait 500
            overhead "Select your escape runebook..." 253
            wait 500
            overhead "You have enabled Auto Recall (PK or Weight) and must select a charged runebook to continue..." 0
            @setvar! AutoRecallChargedRunebook
            sysmsg "Will cast to 'default rune' in Runebook (if 'casting' enabled) or uses scrolls to 'first location' in Runebook (if no Magery skill)" 153
            wait 1500
        endif
    endif

    if EnableLootChest = 1
        if EnableAutoRedRecall = 1 or EnableAutoWeightRecall = 1 or EnableRecallAfterResurrection = 1 or EnableRecallAfterDungeonGate = 1
            if not varexist LootChest
                wait 500
                overhead "Select a secure container to store your Loot..." 253
                sysmsg "Can be disabled under script variables section." 0
                wait 1000
                overhead "Anything that will not go into a Resource Stockpile, Storage Shelf or Magic Recycler" 0
                overhead "(ie. Skill Orbs, Treasure Maps, Paragon chests, etc.)"
                @setvar! LootChest
                sysmsg "Use Razor Organizer Agents 06 - 09 for the Loot Chest and its contents - organize to your own liking!" 0
                wait 1500
            endif
        endif
    endif

    if EnableLootBag = 1 and IHAVEDIED != 1
        if EnableAutoRedRecall = 1 or EnableAutoWeightRecall = 1 or EnableRecallAfterResurrection = 1 or EnableRecallAfterDungeonGate = 1
            if not varexist LootBag
                wait 500
                overhead "Please select your loot bag..." 253
                wait 1000
                overhead "This should be whatever is set as your 'Grab Bag' and will be opened when unloading loot after recalling..." 0
                @setvar! LootBag
                wait 500
                while targetexists
                    wait 100
                endwhile
            endif
            if not find LootBag self
                if not varexist LootBag
                    wait 500
                    overhead "Select your loot bag..." 253
                    wait 500
                    @setvar! LootBag
                    wait 500
                    while targetexists
                        wait 100
                    endwhile
                endif
            endif
        endif
    endif

    if not varexist FirstRunArcaneMage
        wait 1000
        overhead "Good luck out there!" 2234
        overhead "         - Dan (aka. Glacier)" 2234
        wait 1500
        setvar FirstRunArcaneMage 1
    endif
endif


         ###############################
        ###    SCRIPT STARTS HERE:    ###
         ###############################


////////////////////////
//  BEGIN ALIVE LOOP  //
////////////////////////

while not dead
    if EnablePKradar = 1
        if timer "PKRadar" > 1000
            hotkey 'Next Murderer Player Target'
            wait 500
            if insysmsg "No one matching that was found"
                settimer "PKRadar" 0
                clearsysmsg
            else
                hotkey 'Toggle War Only'
                @setvar! RedTargetFound 1
                @setvar! TimeToGo 1
                @setvar! MurdererTarget lasttarget
            endif
        endif
    endif


    //////////////////////////
    //  BEGIN AUTO RECALL:  //
    //////////////////////////

    if warmode on
        if EnableAutoWeightRecall = 1 and AutoWeightRecall = 1
            if EnableDIYRecallScript = 1
                @setvar! AutoWeightRecall 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile
                    if EnableOverheadMessages = 1
                        overhead "[ AUTO WEIGHT RECALL! ]" 88
                        wait 1000
                    endif
                    @setvar! AutoWeightRecall 0

                @setvar! RECALLTIME 1
            endif
        elseif EnableAutoRedRecall = 1 and RedTargetFound = 1
            if EnableDIYRecallScript = 1
                @setvar! RedTargetFound 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                @setvar! RECALLTIME 1
            endif
        elseif EnableRecallAfterDungeonGate = 1 and DungeonGateThenTimeToGo = 1
            if EnableDIYRecallScript = 1
                @setvar! DungeonGateThenTimeToGo 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                if EnableOverheadMessages = 1
                    overhead "[ AUTO RECALL! ]" 88
                endif
                @setvar! DungeonGateThenTimeToGo 0
                @setvar! TimeToGo 0
                @setvar! RECALLTIME 1
            endif
        elseif EnableRecallAfterResurrection = 1 and ResThenTimeToGo = 1
            if EnableDIYRecallScript = 1
                @setvar! ResThenTimeToGo 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                if EnableOverheadMessages = 1
                    overhead "[ AUTO RECALL! ]" 88
                    wait 1000
                endif
                @setvar! ResThenTimeToGo 0
                @setvar! RecallScrollsOnly 1
                @setvar! RECALLTIME 1
            endif
        elseif AutoRecallTime = 1
            if EnableDIYRecallScript = 1
                @setvar! AutoRecallTime 0
                foreach RecallScript in DIYRecallScriptList
                    script RecallScript
                endfor
            else
                if targetexists
                    hotkey 'Cancel Current Target'
                endif

                hotkey 'Toggle Peace only'
                clearsysmsg

                while not varexist AutoRecallChargedRunebook and EnableDIYRecallScript != 1
                    overhead "Select your escape runebook..." 253
                    @setvar! AutoRecallChargedRunebook
                    wait 2500
                endwhile

                while mana < 11
                    if timer "MANAWAIT" > 4000 and EnableOverheadMessages = 1
                        overhead "[ WAITING FOR MANA... ]" 12
                        settimer "MANAWAIT" 0
                    endif
                    wait 500
                endwhile

                if EnableOverheadMessages = 1
                    overhead "[ AUTO RECALL! ]" 88
                    wait 1000
                endif
                @setvar! AutoRecallTime 0
                @setvar! RECALLTIME 1
            endif
        elseif EnableAutoRedDungeonGate = 1 or EnableAutoWeightDungeonGate = 1
            if TimeToGo = 1
                if RedTargetFound = 1 and timer "REDALERT" > 4500 and EnableOverheadMessages = 1
                    overhead "[ !! RED ALERT !! ]" 37
                    settimer "REDALERT" 0
                endif

                settimer "DungeonEscape" 0
                wait 500

            while timer "DungeonEscape" < 120000
                if EnablePKradar = 1
                    if timer "PKRadar" > 1000
                        hotkey 'Next Murderer Player Target'
                        wait 500
                        if insysmsg "No one matching that was found"
                            settimer "PKRadar" 0
                            clearsysmsg
                        else
                            if EnableRedAlertOverhead = 1 and timer "REDALERT" > 4500 and EnableOverheadMessages = 1
                                overhead "[ !! RED ALERT !! ]" 37
                                settimer "REDALERT" 0
                            endif
                        endif
                    endif
                endif

                while find MurdererTarget ground -1 -1 12
                    if timer "MURDERTARGET" > 4500
                        if EnableOverheadMessages = 1
                            overhead "¼ PK TARGET ¼" 337 MurdererTarget
                        else
                            overhead " ¼ " 337 MurdererTarget
                        endif
                        settimer "MURDERTARGET" 0
                    endif

                    if EnableAutoParalyzePouch = 1
                        if paralyzed
                            if findtype "pouch" self
                                yell "[pouch"
                            else
                                if EnableOverheadMessages = 1
                                    overhead "[ NO MORE POUCHES! ]" 337
                                endif
                            endif
                       endif
                    endif

                    if EnableStrengthPotion = 1 and not findbuff "Strength"
                        if findtype "White Potion" self
                            dclicktype "White Potion"
                            wait 250
                        else
                            if timer whiteMessageTimer > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO STRENGTH POTS! ]" 337
                                settimer whiteMessageTimer 0
                            endif
                        endif
                    endif

                    if EnableAgilityPotion = 1 and not findbuff "Agility"
                        if findtype "Blue Potion" self
                            dclicktype "Blue Potion"
                            wait 250
                        else
                            if timer blueMessageTimer > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO AGILITY POTS! ]" 34
                                settimer blueMessageTimer 0
                            endif
                        endif
                    endif

                    if EnableResistPotion = 1 and not findbuff "Magic Resist"
                        if findtype "Black Potion" self
                            dclicktype "Black Potion"
                            wait 250
                        else
                            if timer blackMessageTimer > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO RESIST POTS! ]" 337
                                settimer blackMessageTimer 0
                            endif
                        endif
                    endif

                    if EnableRefreshPotion = 1 and diffstam > RefreshPotionSPdiff
                        if findtype "Red Potion" self
                            dclicktype "Red Potion"
                            wait 250
                        else
                            if timer redMessageTimer > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO REFRESH POTS! ]" 337
                                settimer redMessageTimer 0
                            endif
                        endif
                    endif

                    if EnableAutoParalyzePouch = 1
                        if paralyzed
                            if findtype "pouch" self
                                yell "[pouch"
                                hotkey 'Toggle War Only'
                                @setvar! RedTargetFound 1
                                replay
                            else
                                if EnableOverheadMessages = 1
                                    overhead "[ NO MORE POUCHES! ]" 337
                                endif
                            endif
                       endif
                    endif

                    if diffhits >= 1 and not bandaging
                        if skill 'healing' >= 30 or skill "veterinary" >= 50
                            if findtype 'clean bandage%s%' backpack
                                if targetexists
                                    hotkey 'cancel current target'
                                endif
                                dclicktype 'clean bandage%s%'
                                wft 1000
                                target 'self'
                                wait 500
                            else
                                if timer aidsMessageTimer > 5000 and EnableOverheadMessages = 1
                                    overhead "[ OUT OF BANDAGES! ]" 337
                                    settimer aidsMessageTimer 0
                                endif
                            endif
                        endif
                    endif

                    if EnableCurePotion = 1 or EnableCastCure = 1
                        while poisoned
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                wait 500
                            else
                                if timer orangeMessageTimer > 5000 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer orangeMessageTimer 0
                                endif

                                if diffhits >= 30 or not findtype 3972 self or not findtype 3973 self
                                    break
                                endif

                                if skill 'magery' >= 40 and mana >= 6 and EnableCastCure = 1 and not casting
                                    cast 'cure'
                                    wait 50
                                    while not casting
                                        if targetexists
                                            hotkey 'cancel current target'
                                        endif
                                        cast 'cure'
                                        wait 50
                                    endwhile
                                    while not targetexists
                                        wait 100
                                    endwhile
                                    wft 1000
                                    target 'self'
                                    wait 500
                                else
                                    break
                                endif
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif

                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    cooldown "Healing Potion" 11000
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif

                    if skill 'magery' >= 40 and diffhits >= CastHealHPdiff and diffhits < 5 and mana >= 4 and EnableCastHeal = 1 and not casting
                        cast 'heal'
                        while not casting
                            if targetexists
                                hotkey 'cancel current target'
                            endif
                            cast 'heal'
                        endwhile

                        while not targetexists
                            if insysmsg "Your concentration is disturbed"
                                interrupt
                                @setvar! SpellInterrupted 1
                                break
                            endif
                        endwhile

                        if SpellInterrupted = 0
                            target 'self'
                        endif
                    elseif skill 'magery' >= 40 and diffhits >= CastEmergencyHealHPdiff and mana >= 4 and EnableCastHeal = 1 and not casting
                        cast 'heal'
                        while not casting
                            if targetexists
                                hotkey 'cancel current target'
                            endif
                            cast 'heal'
                        endwhile

                        while not targetexists
                            if insysmsg "Your concentration is disturbed"
                                interrupt
                                @setvar! SpellInterrupted 1
                                break
                            endif
                        endwhile

                        if SpellInterrupted = 0
                            target 'self'
                        endif
                    elseif skill 'magery' >= 60 and diffhits >= CastGreaterHealHPdiff and diffhits < 5 and mana >= 11 and EnableCastGreaterHeal = 1 and not casting
                        cast 'greater heal'
                        while not casting
                            if targetexists
                                hotkey 'cancel current target'
                            endif
                            cast 'greater heal'
                        endwhile

                        @settimer! spellTimer 0
                        @setvar! spellCD 800

                        while not targetexists
                            if insysmsg "Your concentration is disturbed"
                                interrupt
                                @setvar! SpellInterrupted 1
                                break
                            endif

                            if timer spellTimer < spellCD

                                if EnableCurePotion = 1
                                    while poisoned and casting and not targetexists
                                        if findtype "Orange Potion" self
                                            dclicktype "Orange Potion"
                                            wait 250
                                        else
                                            if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                                                overhead "[ NO CURE POTS! ]" 337
                                                settimer orangeMessageTimer 0
                                            endif
                                            break
                                        endif
                                    endwhile
                                endif

                                if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                                    if findtype "Yellow Potion" self as hPot
                                        getlabel hPot potLabel
                                        if "next" in potLabel
                                            #do nothing
                                        else
                                            @setvar! ch 0

                                            if counttype 3852 self as c
                                                @setvar! ch c
                                            endif
                                            if insysmsg "potion satchel used"
                                            endif

                                            dclicktype 3852
                                            getlabel backpack packdesc
                                            wait 250

                                            if ch != counttype 3852 self or insysmsg "potion satchel used"
                                                cooldown "Healing Potion" 11000
                                                if diffhits < ActivateAutoHealHPdiff
                                                    interrupt
                                                    if targetexists
                                                        hotkey 'cancel current target'
                                                    endif
                                                endif
                                            endif
                                        endif
                                    else
                                        if timer 'yellowMessageTimer' > 5000 and EnableOverheadMessages = 1
                                            overhead "[ NO HEAL POTS! ]" 337
                                            settimer 'yellowMessageTimer' 0
                                        endif
                                    endif
                                endif
                            endif
                        endwhile

                        if SpellInterrupted = 0
                            target 'self'
                        endif
                    endif

                    while not gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                        dclick EscapeGate
                    endwhile

                    if gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                        while gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                            gumpresponse 2 3899019871
                            wait 250
                        endwhile
                        wait 1500
                        @setvar! TimeToGo 0
                        if EnableDIYRecallScript = 1
                            foreach RecallScript in DIYRecallScriptList
                                script RecallScript
                            endfor
                        else
                            hotkey 'Toggle War Only'
                            @setvar! DungeonGateThenTimeToGo 1
                            replay
                        endif
                    endif

                    while not gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                        dclick EscapeGate
                    endwhile

                    if gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                        while gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                            gumpresponse 2 3899019871
                            wait 250
                        endwhile
                        wait 1500
                        @setvar! TimeToGo 0
                        if EnableDIYRecallScript = 1
                            foreach RecallScript in DIYRecallScriptList
                                script RecallScript
                            endfor
                        else
                            hotkey 'Toggle War Only'
                            @setvar! DungeonGateThenTimeToGo 1
                            replay
                        endif
                    endif

                    while not gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                        dclick EscapeGate
                    endwhile

                    if gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                        while gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                                gumpresponse 2 3773199800
                                wait 250
                        endwhile
                        wait 1500
                        @setvar! TimeToGo 0
                        if EnableDIYRecallScript = 1
                            foreach RecallScript in DIYRecallScriptList
                                script RecallScript
                            endfor
                        else
                            hotkey 'Toggle War Only'
                            @setvar! DungeonGateThenTimeToGo 1
                            replay
                        endif
                    endif

                    while not gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                        dclick EscapeGate
                    endwhile

                    if gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                        while gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                            gumpresponse 2 3899019871
                            wait 250
                        endwhile
                        wait 1500
                        @setvar! TimeToGo 0
                        if EnableDIYRecallScript = 1
                            foreach RecallScript in DIYRecallScriptList
                                script RecallScript
                            endfor
                            hotkey 'Toggle War Only'
                            @setvar! DungeonGateThenTimeToGo 1
                            replay
                        endif
                    endif

                    if findtype "moongate" ground -1 1 12 or findtype "blue moongate" ground -1 1 12 as EscapeGate
                        if timer "GETCLOSER" > 4500
                            if EnableOverheadMessages = 1
                                overhead "[ GET CLOSER! ]" 77
                            else
                                overhead " Ï " 77
                            endif
                            settimer "GETCLOSER" 0
                        endif

                        if timer "GATEHERE" > 500
                            overhead " ¼ " 253 EscapeGate
                            settimer "GATEHERE" 0
                        endif
                    else
                        if timer "RUNAWAY" > 6000
                            if EnableOverheadMessages = 1
                                overhead "[ GET TO A GATE... ]" 2114
                            else
                                overhead " Ï " 2114
                            endif
                            settimer "RUNAWAY" 0
                        endif
                    endif

                    if weight > maxweight and EnableDropGoldWhenOverweight = 1
                        if timer overweightMessageTimer > 4500 and EnableOverheadMessages = 1
                            overhead "[ OVERWEIGHT! ]" 34
                            settimer overweightMessageTimer 0
                        endif

                        if DropGoldAmount != 0
                            while weight > maxweight
                                if findtype "gold coin" backpack as easycomeeasygo
                                    lift easycomeeasygo DropGoldAmount
                                    droprelloc 0 0
                                    getlabel backpack packdesc
                                    wait 250
                                    if insysmsg "cannot drop anything"
                                        drop backpack -1 -1 -1
                                    endif
                                    wait 500
                                endif
                            endwhile
                        endif
                    endif

                    if not warmode
                        if EnableOverheadMessages = 1
                            overhead "[ ESCAPE CANCELLED! ]" 88
                        else
                            overhead " Ï " 88
                        endif
                        replay
                    endif
                endwhile

                if EnableStrengthPotion = 1 and not findbuff "Strength"
                    if findtype "White Potion" self
                        dclicktype "White Potion"
                        wait 250
                    else
                        if timer whiteMessageTimer > 4500 and EnableOverheadMessages = 1
                            overhead "[ NO STRENGTH POTS! ]" 337
                            settimer whiteMessageTimer 0
                        endif
                    endif
                endif

                if EnableAgilityPotion = 1 and not findbuff "Agility"
                    if findtype "Blue Potion" self
                        dclicktype "Blue Potion"
                        wait 250
                    else
                        if timer blueMessageTimer > 4500 and EnableOverheadMessages = 1
                            overhead "[ NO AGILITY POTS! ]" 34
                            settimer blueMessageTimer 0
                        endif
                    endif
                endif

                if EnableResistPotion = 1 and not findbuff "Magic Resist"
                    if findtype "Black Potion" self
                        dclicktype "Black Potion"
                        wait 250
                    else
                        if timer blackMessageTimer > 4500 and EnableOverheadMessages = 1
                            overhead "[ NO RESIST POTS! ]" 337
                            settimer blackMessageTimer 0
                        endif
                    endif
                endif

                if EnableRefreshPotion = 1 and diffstam > RefreshPotionSPdiff
                    if findtype "Red Potion" self
                        dclicktype "Red Potion"
                        wait 250
                    else
                        if timer redMessageTimer > 4500 and EnableOverheadMessages = 1
                            overhead "[ NO REFRESH POTS! ]" 337
                            settimer redMessageTimer 0
                        endif
                    endif
                endif

                if paralyzed
                    if findtype "pouch" backpack 38
                        yell "[pouch"
                        wait 250
                    else
                        if timer pouchMessageTimer > 5000 and EnableOverheadMessages = 1
                            overhead "[ NO MORE POUCHES! ]" 337
                            settimer pouchMessageTimer 0
                        endif
                    endif
                endif

                if diffhits >= 1 and not bandaging
                    if skill 'healing' >= 30 or skill "veterinary" >= 50
                        if findtype 'clean bandage%s%' backpack
                            if targetexists
                                hotkey 'cancel current target'
                            endif
                            dclicktype 'clean bandage%s%'
                            wft 1000
                            target 'self'
                            wait 500
                        else
                            if timer aidsMessageTimer > 5000 and EnableOverheadMessages = 1
                                overhead "[ OUT OF BANDAGES! ]" 337
                                settimer aidsMessageTimer 0
                            endif
                        endif
                    endif
                endif

                if EnableCurePotion = 1 or EnableCastCure = 1
                    while poisoned
                        if findtype "Orange Potion" self
                            dclicktype "Orange Potion"
                            wait 500
                        else
                            if timer orangeMessageTimer > 5000 and EnableOverheadMessages = 1
                                overhead "[ NO CURE POTS! ]" 337
                                settimer orangeMessageTimer 0
                            endif

                            if diffhits >= 30 or not findtype 3972 self or not findtype 3973 self
                                break
                            endif

                            if skill 'magery' >= 40 and mana >= 6 and EnableCastCure = 1 and not casting
                                cast 'cure'
                                wait 50
                                while not casting
                                    if targetexists
                                        hotkey 'cancel current target'
                                    endif
                                    cast 'cure'
                                    wait 50
                                endwhile
                                while not targetexists
                                    wait 100
                                endwhile
                                wft 1000
                                target 'self'
                                wait 500
                            else
                                break
                            endif
                        endif
                    endwhile
                endif

                if diffhits >= HealPotionHPdiff and EnableHealPotion = 1
                    if findtype "Yellow Potion" self as hPot
                        getlabel hPot potLabel
                        if "next" in potLabel
                            #do nothing
                        else
                            @setvar! ch 0

                            if counttype 3852 self as c
                                @setvar! ch c
                            endif
                            if insysmsg "potion satchel used"
                            endif

                            dclicktype 3852
                            getlabel backpack packdesc
                            wait 250

                            if ch != counttype 3852 self or insysmsg "potion satchel used"
                                cooldown "Healing Potion" 11000
                            endif
                        endif
                    else
                        if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                            overhead "[ NO HEAL POTS! ]" 337
                            settimer 'yellowMessageTimer' 0
                        endif
                    endif
                endif

                if skill 'magery' >= 40 and diffhits >= CastHealHPdiff and diffhits < 5 and mana >= 4 and EnableCastHeal = 1 and not casting
                    cast 'heal'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'heal'
                    endwhile

                    while not targetexists
                        if insysmsg "Your concentration is disturbed"
                            interrupt
                            @setvar! SpellInterrupted 1
                            break
                        endif
                    endwhile

                    if SpellInterrupted = 0
                        target 'self'
                    endif
                elseif skill 'magery' >= 40 and diffhits >= CastEmergencyHealHPdiff and mana >= 4 and EnableCastHeal = 1 and not casting
                    cast 'heal'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'heal'
                    endwhile

                    while not targetexists
                        if insysmsg "Your concentration is disturbed"
                            interrupt
                            @setvar! SpellInterrupted 1
                            break
                        endif
                    endwhile

                    if SpellInterrupted = 0
                        target 'self'
                    endif
                elseif skill 'magery' >= 60 and diffhits >= CastGreaterHealHPdiff and diffhits < 5 and mana >= 11 and EnableCastGreaterHeal = 1 and not casting
                    cast 'greater heal'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'greater heal'
                    endwhile

                    @settimer! spellTimer 0
                    @setvar! spellCD 800

                    while not targetexists
                        if insysmsg "Your concentration is disturbed"
                            interrupt
                            @setvar! SpellInterrupted 1
                            break
                        endif

                        if timer spellTimer < spellCD

                            if EnableCurePotion = 1
                                while poisoned and casting and not targetexists
                                    if findtype "Orange Potion" self
                                        dclicktype "Orange Potion"
                                        wait 250
                                    else
                                        if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                                            overhead "[ NO CURE POTS! ]" 337
                                            settimer orangeMessageTimer 0
                                        endif
                                        break
                                    endif
                                endwhile
                            endif

                            if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                                if findtype "Yellow Potion" self as hPot
                                    getlabel hPot potLabel
                                    if "next" in potLabel
                                        #do nothing
                                    else
                                        @setvar! ch 0

                                        if counttype 3852 self as c
                                            @setvar! ch c
                                        endif
                                        if insysmsg "potion satchel used"
                                        endif

                                        dclicktype 3852
                                        getlabel backpack packdesc
                                        wait 250

                                        if ch != counttype 3852 self or insysmsg "potion satchel used"
                                            cooldown "Healing Potion" 11000
                                            if diffhits < ActivateAutoHealHPdiff
                                                interrupt
                                                if targetexists
                                                    hotkey 'cancel current target'
                                                endif
                                            endif
                                        endif
                                    endif
                                else
                                    if timer 'yellowMessageTimer' > 5000 and EnableOverheadMessages = 1
                                        overhead "[ NO HEAL POTS! ]" 337
                                        settimer 'yellowMessageTimer' 0
                                    endif
                                endif
                            endif
                        endif
                    endwhile
                    if SpellInterrupted = 0
                        target 'self'
                    endif
                endif

                if EnableAutoParalyzePouch = 1
                    if paralyzed
                        if findtype "pouch" self
                            yell "[pouch"
                        else
                            if EnableOverheadMessages = 1
                                overhead "[ NO MORE POUCHES! ]" 337
                            endif
                        endif
                   endif
                endif

                if weight > maxweight and EnableDropGoldWhenOverweight = 1
                    if timer overweightMessageTimer > 4500 and EnableOverheadMessages = 1
                        overhead "[ OVERWEIGHT! ]" 34
                        settimer overweightMessageTimer 0
                    endif

                    if DropGoldAmount != 0
                        while weight > maxweight
                            if findtype "gold coin" backpack as easycomeeasygo
                                lift easycomeeasygo DropGoldAmount
                                droprelloc 0 0
                                getlabel backpack packdesc
                                wait 250
                                if insysmsg "cannot drop anything"
                                    drop backpack -1 -1 -1
                                endif
                                wait 500
                            endif
                        endwhile
                    endif
                endif

                if not warmode
                    if EnableOverheadMessages = 1
                        overhead "[ ESCAPE CANCELLED! ]" 88
                    else
                        overhead " Ï " 88
                    endif
                    replay
                endif

                while not gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                    while gumpexists 3899019871 and findtype "blue moongate" ground 0 1 2 as EscapeGate
                        gumpresponse 2 3899019871
                        wait 250
                    endwhile
                    wait 1500
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle War Only'
                        @setvar! DungeonGateThenTimeToGo 1
                        replay
                    endif
                endif

                while not gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                    while gumpexists 3899019871 and findtype 30528 ground 2091 1 1 as EscapeGate
                        gumpresponse 2 3899019871
                        wait 250
                    endwhile
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle War Only'
                        @setvar! DungeonGateThenTimeToGo 1
                        replay
                    endif
                endif

                while not gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                    while gumpexists 3773199800 and findtype "blue moongate" ground -1 1 2 as EscapeGate
                        gumpresponse 2 3773199800
                        wait 250
                    endwhile
                    wait 1500
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle War Only'
                        @setvar! DungeonGateThenTimeToGo 1
                        replay
                    endif
                endif

                while not gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                    dclick EscapeGate
                endwhile

                if gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                    while gumpexists 3899019871 and findtype "moongate" ground -1 -1 2 as EscapeGate
                        gumpresponse 2 3899019871
                        wait 250
                    endwhile
                    wait 1500
                    @setvar! TimeToGo 0
                    if EnableDIYRecallScript = 1
                        foreach RecallScript in DIYRecallScriptList
                            script RecallScript
                        endfor
                    else
                        hotkey 'Toggle War Only'
                        @setvar! DungeonGateThenTimeToGo 1
                        replay
                    endif
                endif

                if findtype "moongate" ground -1 1 12 or findtype "blue moongate" ground -1 1 12 as EscapeGate
                    if timer "GETCLOSER" > 4500
                        if EnableOverheadMessages = 1
                            overhead "[ GET CLOSER! ]" 77
                        else
                            overhead " Ï " 77
                        endif
                        settimer "GETCLOSER" 0
                    endif
                    if timer "GATEHERE" > 500
                        overhead " ¼ " 253 EscapeGate
                        settimer "GATEHERE" 0
                    endif
                else
                    if timer "RUNAWAY" > 6000
                        if EnableOverheadMessages = 1
                            overhead "[ GET TO A GATE... ]" 2114
                        else
                            overhead " Ï " 2114
                        endif
                        settimer "RUNAWAY" 0
                    endif
                endif
            endwhile
            endif
        elseif EnableAutoRedRecall = 0 and EnableAutoWeightRecall = 0 and TimeToGo = 0
            hotkey 'Toggle Peace only'
            @setvar! TimeToGo 0
        elseif EnableAutoRedDungeonGate = 0 and EnableAutoWeightDungeonGate = 0 and TimeToGo = 0
            hotkey 'Toggle Peace only'
            @setvar! TimeToGo 0
        endif
    endif

    if RECALLTIME = 1
        if EnableCastRecall = 1 and skill "Magery" >= 60 and RecallScrollsOnly != 1 and findtype '3962' self and findtype '3963' self and findtype '3974' self
            cast "Recall"
            while not targetexists
                wait 100
            endwhile
            target AutoRecallChargedRunebook
            wait 1000
            for 5
            wait 100
            if insysmsg 'Your concentration is disturbed'
                overhead 'Shit! Trying that again...' 2234
                cast "Recall"
                while not targetexists
                    wait 100
                endwhile
                target AutoRecallChargedRunebook
                clearsysmsg
            endif
            endfor
        else
            dclick AutoRecallChargedRunebook
            waitforgump 1551740969
            gumpresponse 2
            wait 1000
            for 5
            wait 500
            if insysmsg 'Your concentration is disturbed'
                overhead 'Shit! Trying that again...' 2234
                dclick AutoRecallChargedRunebook
                waitforgump 1551740969
                gumpresponse 2
                wait 1000
                clearsysmsg
            endif
            endfor
        endif

        if insysmsg 'Your concentration is disturbed'
            for 5
                if diffhits > 25 and not cooldown "Healing Potion"
                    if findtype "Yellow Potion" self as healpot
                        dclick healpot
                        wait 750
                        cooldown "Healing Potion" 11000
                    endif
                endif

                while poisoned
                    if findtype "Orange Potion" self as curepot
                        dclick curepot
                        wait 500
                    endif
                endwhile

                clearsysmsg
                overhead '[ INTERUPTED! ]' 153
                wait 2500
                dclick AutoRecallChargedRunebook
                waitforgump 1551740969
                gumpresponse 2
                wait 1000
                if insysmsg 'Your concentration is disturbed'
                    wait 1500
                else
                    break
                endif
            endfor
        endif
        
        if OutsideHouseRecall = 1
            wait 2500
            if find MyDoor ground -1 -1 2 and EnableCloseMyDoor = 1
                dclick MyDoor 
                overhead "*door slams!*" 0 MyDoor
                wait 1000
            endif
            wait 2500
        elseif OwnerInnRecall = 1
            wait 500
            say "Innkeeper, I need a room!" 2234
            waitforgump 2393832411
            gumpresponse 4
            wait 1500
        elseif CoOwnerInnRecall = 1
            wait 500
            say "Innkeeper, I need a room!" 2234
            waitforgump 2393832411
            gumpresponse 5
            wait 500
            gumpresponse 100
            wait 1500
        elseif InsideHouseRecall = 1
            wait 500
        elseif BankRecall = 1
            say "Open my bank!" 2234
            wait 1000
        else 
            wait 500
        endif

        if HideAtHomeorInn = 1
            useskill "Hiding"
        endif

        clearignore
        @setvar! RecallScrollsOnly 0
        @setvar! RECALLTIME 0

        if EnableResetInventoryAfterDeath = 1 and IHAVEDIED = 1
            if EnableOverheadMessages = 1
                overhead "[ RESETTING LOADOUT... ]" 77
                wait 500
            endif
        endif

        if IHAVEDIED != 1
            if skill 'Arcane' >= 50 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
                if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                    dclick myArcaneStaff
                    wait 500
                else
                    if timer "ArcaneStaffCheck" > 5000 and EnableOverheadMessages = 1
                        overhead "[ NO STAFF! ]" 337
                        settimer "ArcaneStaffCheck" 0
                    endif
                endif
            endif

            if EnableLootBag = 1
                dclick LootBag
                wait 500
            endif

            if EnableLootChest = 1
                dclick LootChest
                wait 500
            endif

            if EnablePutLootinLockBox = 1
                if findtype "wooden box" backpack as LootBox
                    if findtype "copper key" backpack as LootKey
                        getlabel LootBox LootBoxLabel
                        if "items" in LootBoxLabel
                            dclick LootBox
                        else
                            dclick LootKey
                            wft 1000
                            target LootBox
                            overhead "[lockbox opened]"
                            wait 500
                            dclick LootBox
                        endif
                    elseif EnableOverheadMessages = 1
                        overhead "[ NO LOCKBOX KEY! ]" 337
                    endif
                endif
            endif

            wait 500

            if EnableSafeDeposit = 1
                if findtype "bank deposit safe" ground -1 -1 2 as safe
                    while findtype "gold coin" backpack as gold
                        lift gold 60000
                        if EnableOverheadMessages = 1
                            overhead "[ DEPOSITING GOLD... ]" 149
                        else
                            overhead " ¼ " 149
                        endif
                            drop safe -1 -1 -1
                            wait 1500
                    endwhile
                    while findtype 2539 backpack as dubs
                        if EnableOverheadMessages = 1
                            overhead "[ DEPOSITING DUBS... ]" 149
                        else
                            overhead " ¼ " 149
                        endif
                        lift dubs 60000
                        drop safe -1 -1 -1
                        wait 1500
                    endwhile
                elseif EnableOverheadMessages = 1
                    overhead "[ NO BANK SAFE FOUND ]" 337
                    wait 1500
                endif
            endif

            if EnableResourceStockpile = 1
                if findtype "resource container" ground -1 -1 2 as resource
                    menu resource 0
                    wft 500
                    target self
                        if EnableOverheadMessages = 1
                            overhead "[ PILING RESOURCES... ]" 84
                        else
                            overhead " ¼ " 84
                        endif
                    wait 1500
                elseif EnableOverheadMessages = 1
                    overhead "[ NO RESOURCE STOCKPILE FOUND ]" 337
                    wait 1500
                endif
            endif

            if EnableRepairBench = 1
                if findtype "repair bench" ground -1 -1 3 as RepairBench
                    clearsysmsg
                    dclick RepairBench
                    wait 500
                    if insysmsg "You do not have any items equipped or in your backpack in need of repairs."
                        if EnableOverheadMessages = 1
                            overhead "[ NOTHING TO REPAIR! ]" 0
                        endif
                        wait 1500
                    else
                        if EnableOverheadMessages = 1
                            overhead "[ REPAIRING EQUIPMENT... ]" 339
                        else
                            overhead " Ï " 339
                        endif
                        settimer RepairTimer 0
                    while timer RepairTimer <= 5000
                        if insysmsg "Repair"
                            break
                        endif
                    endwhile
                        if EnableOverheadMessages = 1
                            overhead "[ ITEMS REPAIRED! ]" 0
                            wait 500
                            overhead "Repair took: {{RepairTimer}}ms" 77
                        else
                            overhead " Ï " 0
                        endif
                        removetimer RepairTimer
                        wait 500
                    endif
                elseif EnableOverheadMessages = 1
                    overhead "[ NO REPAIR BENCH FOUND ]" 337
                    wait 1500
                endif
            endif

            if EnableMagicRecycler = 1
                if findtype "ornate elven chest|magic item recycler" ground -1 -1 2 as recycler
                    for 2
                    getlabel recycler recyclerdesc
                    if "(125 items" in recyclerdesc
                        dclick recycler
                        waitforgump 4045111101
                        gumpresponse 7
                        waitforgump 4045111101
                        gumpresponse 6
                        waitforgump 4045111101
                        gumpresponse 6
                        if EnableOverheadMessages = 1
                            overhead "[ RECYCLING JUNK... ]" 66
                        else
                            overhead " Ï " 66
                        endif
                        wait 500
                        gumpclose 4045111101
                        if findtype "resource container" ground -1 -1 2 as resource and EnableResourceStockpile = 1
                            menu resource 0
                            wft 1500
                            target recycler
                            wait 1000
                            if EnableOverheadMessages = 1
                                overhead "[ PILING RESOURCES... ]" 112
                            else
                                overhead " ¼ " 112
                            endif
                            wait 500
                        elseif EnableOverheadMessages = 1
                            overhead "[ NO RESOURCE STOCKPILE FOUND ]" 337
                        endif
                        menu recycler 1
                        wait 500
                        if insysmsg "0 recyclable"
                            break
                        else
                            if EnableOverheadMessages = 1
                                overhead "[ ADDING TO RECYCLER... ]" 6
                            else
                                overhead " ¼ " 6
                            endif
                            wait 1500
                        endif
                        break
                    else
                        menu recycler 1
                        wait 500
                        if insysmsg "0 recyclable"
                            if EnableOverheadMessages = 1 and timer "inventorycheck" > 5000
                                overhead "[ NO MAGIC LOOT! ]" 6
                            else
                                overhead " Ï " 6
                            endif
                            break
                        else
                            if EnableOverheadMessages = 1
                                overhead "[ ADDING TO RECYCLER... ]" 6
                            else
                                overhead " ¼ " 6
                            endif
                            settimer "inventorycheck" 0
                            wait 1500
                        endif
                    endif
                    wait 500
                    endfor
                elseif EnableOverheadMessages = 1
                    overhead "[ NO MAGIC ITEM RECYCLER FOUND ]" 337
                endif
            endif

            if EnableLootChest = 1
                dclick LootChest
                if EnableOverheadMessages = 1
                    overhead "[ STASHING LOOT... ]" 69
                else
                    overhead " ¼ " 69
                endif
                wait 500
                for 2
                hotkey "Organizer Agent-06"
                wait 250
                hotkey "Organizer Agent-07"
                wait 250
                hotkey "Organizer Agent-08"
                wait 250
                hotkey "Organizer Agent-09"
                wait 250
                endfor
                while queued
                    wait 100
                endwhile
            endif

            if EnableStorageTomes = 1
                if findtype "book" ground -1 -1 2 as StorageTome or findtype "book" LootChest as StorageTome
                    while findtype "book" ground -1 -1 2 as StorageTome
                        menu StorageTome 0
                        if EnableOverheadMessages = 1 and timer "inventorycheck" > 3500
                            overhead "[ STORING TOME ITEMS! ]" 2117
                            settimer "inventorycheck" 0
                        elseif EnableOverheadMessages = 0 and timer "inventorycheck" > 3500
                            overhead " ¼ " 2117
                            settimer "inventorycheck" 0
                        endif
                        wait 250
                        @ignore StorageTome
                    endwhile
                    while findtype "book" LootChest as StorageTome
                        menu StorageTome 0
                        if EnableOverheadMessages = 1 and timer "inventorycheck" > 3500
                            overhead "[ STORING TOME ITEMS! ]" 2117
                            settimer "inventorycheck" 0
                        elseif EnableOverheadMessages = 0 and timer "inventorycheck" > 3500
                            overhead " ¼ " 2117
                            settimer "inventorycheck" 0
                        endif
                        wait 250
                        @ignore StorageTome
                    endwhile
                    @clearignore
                elseif EnableOverheadMessages = 1
                    overhead "[ NO STORAGE TOMES FOUND ]" 337
                    wait 1500
                endif
            endif
        endif

        if EnableStorageShelf = 1
            if findtype "storage shelf" ground -1 -1 2 as shelf
                if IHAVEDIED != 1
                    menu shelf 0
                    wft 500
                    target self
                    if EnableOverheadMessages = 1
                        overhead "[ STORING GOODS... ]" 2114
                    else
                        overhead " ¼ " 2114
                    endif
                    wait 500
                    gumpclose 3232825965
                    wait 1000
                endif
                menu shelf 1
                if EnableOverheadMessages = 1
                    overhead "[ RESUPPLYING... ]" 93
                    wait 500
                else
                    overhead " ² " 93
                endif
                wait 1000
            elseif EnableOverheadMessages = 1
                overhead "[ NO STORAGE SHELF FOUND ]" 337
                wait 1500
            endif
        endif

        if EnableResetInventoryAfterDeath = 1 and IHAVEDIED = 1
            clearignore

            if skill 'healing' > 0 and hp < maxhp and not bandaging
                if findtype 'clean bandage%s%' self
                    hotkey 'Bandage Self'
                    if EnableOverheadMessages = 1
                        overhead "[ BANDAGING... ]" 88
                        wait 500
                    endif
                endif
                wait 500
            endif

            if not varexist maininventorybag or not find maininventorybag self
                overhead "[ SELECT MAIN POUCH... ]" 253
                @setvar! maininventorybag
                wft 500
                while targetexists
                    wait 100
                endwhile
                overhead "[ MAIN POUCH SET! ]" 93
                wait 500
            endif

            lift maininventorybag
            wait 500
            drop backpack 69 69 0
            wait 500

            if EnableSetMainPouchOrganizer01 = 1
                hotkey 'Set Organizer Hotbag-01'
                wft 1000
                target maininventorybag
                if EnableOverheadMessages = 1
                    overhead "[ POUCH SET TO AGENT-01! ]" 84
                endif
                wait 500
            endif

            dclick maininventorybag
            wait 1000
            sysmsg "Auto-selecting your loot/grab bag..." 0
            hotkey 'Set Grab Item Hotbag'
            wft 1500

            while targetexists
                if findtype 'bag' self as grabbag
                    target grabbag
                    wait 500
                else
                    wait 1000
                    sysmsg "Auto-select failed!  Please manually target your loot/grab bag!" 0
                    wait 1000
                    overhead "[ SELECT GRAB BAG... ]" 253
                    wait 3500
                endif
                wait 500
            endwhile
            overhead "[ GRAB BAG SET! ]" 93
            wait 500

            if find grabbag self
                lift grabbag
                wait 500
                drop maininventorybag -1 -1 -1
                wait 500
                @ignore maininventorybag
            endif

            while findtype 'scissors' self
                if skill 'healing' > 0 and hp < maxhp and not bandaging
                    if findtype 'clean bandage%s%' self
                        hotkey 'Bandage Self'
                        if EnableOverheadMessages = 1
                            overhead "[ BANDAGING... ]" 88
                        endif
                    else
                        if EnableOverheadMessages = 1
                            overhead "[ NO BANDAGES! ]" 337
                        endif
                    endif
                endif

                if findtype 'scissors' backpack as myscissors
                    if findtype 'pouch' self as trappedpouch
                        lift myscissors
                        wait 250
                        drop trappedpouch
                        wait 750
                        lift trappedpouch
                        wait 250
                        drop backpack 69 69 0
                        @ignore trappedpouch
                        @ignore myscissors
                    endif
                endif

                wait 500
                while queued
                    wait 100
                endwhile
            endwhile

            clearignore

            while findtype 'pouch' backpack as decoypouch
                getlabel decoypouch decoypouchlabel
                wait 250
                if '(1 items' in decoypouchlabel
                    lift decoypouch
                    drop backpack 97 97 0
                    break
                else
                    @ignore decoypouch
                endif
            endwhile

            if skill 'healing' > 0 and hp < maxhp and not bandaging
                if findtype 'clean bandage%s%' self
                    hotkey 'Bandage Self'
                    if EnableOverheadMessages = 1
                        overhead "[ BANDAGING... ]" 88
                        wait 500
                    endif
                else
                    if EnableOverheadMessages = 1
                        overhead "[ NO BANDAGES! ]" 337
                        wait 500
                    endif
                endif
            endif

            if findtype 'atlas' backpack as hidemypouchstack
                lift hidemypouchstack
                drop backpack 72 66 0
                wait 500
            else
                say "[atlas"
                wait 500
                if findtype 'atlas' backpack as hidemypouchstack
                    lift hidemypouchstack
                    drop backpack 72 66 0
                    wait 500
                endif
            endif

            if EnableOverheadMessages = 1
                overhead "[ ACTIVATING ASPECT... ]" 2234
                wait 500
            endif

            say "[aspect"
            waitforgump 2424293173
            gumpresponse 8
            wait 500
            gumpresponse 8
            wait 250
            gumpresponse 17
            wait 500
            gumpresponse 17
            wait 250
            gumpclose 2424293173
            dclick backpack
            wait 250

            if skill 'Arcane' >= 80 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
                if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                    dclick myArcaneStaff
                    wait 500
                else
                    if timer "ArcaneStaffCheck" > 5000 and EnableOverheadMessages = 1
                        overhead "[ NO STAFF! ]" 337
                        settimer "ArcaneStaffCheck" 0
                    endif
                endif
            endif

            if skill 'magery' >= 60 and hp < maxhp and mana >= 11 and not casting
                while hp < maxhp
                    cast 'greater heal'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'greater heal'
                    endwhile
                    while not targetexists
                        wait 100
                    endwhile
                    target 'self'
                    wait 500
                endwhile
            endif

            if findtype "storage shelf" ground -1 -1 2 as shelf
                menu shelf 1
                wait 500
            endif

            if find maininventorybag self
                dclick maininventorybag
                wait 500
            endif

            if findtype 'alchemists satchel' self as BagofPot
                dclick BagofPot
                wait 500
            endif

            if findtype 'reagent satchel' self as WizardBag
                dclick WizardBag
                wait 500
            endif

            if find grabbag self
                dclick grabbag
                wait 500
            endif

            clearignore
            @setvar! IHAVEDIED 0
            overhead "[ RESET COMPLETE! ]" 69
            wait 500
        endif

        if EnableReagentSplitter = 1
            if findtype "reagent satchel" self
                while findtype "reagent satchel" self as MyWizardBag
                    getlabel MyWizardBag MyWizardBagdesc
                    if 'decorative' in MyWizardBagdesc
                        @ignore MyWizardBag
                    else
                        break
                    endif
                endwhile
                sysmsg "Disable 'EnableReagentSplitter' in script variables to turn off this feature!" 0
                dclick MyWizardBag
                wait 500
                if EnableOverheadMessages = 1 and timer "inventorycheck" > 3500
                    overhead "[ SPLITTING REGS... ]" 111
                    settimer "inventorycheck" 0
                elseif EnableOverheadMessages = 0 and timer "inventorycheck" > 3500
                    overhead " Ï " 111
                    settimer "inventorycheck" 0
                endif
                @setvar! amount 0
                @setvar! regsID 3981
                @setvar! myCounter 0
                while findtype regsID self as r
                    @setvar! myCounter index
                    @ignore r
                endwhile
                @clearignore
                if counttype regsID self <= 15
                    @setvar! amount 2
                elseif counttype regsID self <= 30
                    @setvar! amount 4
                elseif counttype regsID self <= 50
                    @setvar! amount 10
                elseif counttype regsID self <= 100
                    @setvar! amount 20
                elseif counttype regsID self <= 150
                    @setvar! amount 30
                elseif counttype regsID self <= 200
                    @setvar! amount 40
                else
                    @setvar! amount 50
                endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 65 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 65 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 65 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 65 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 65 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3962
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                    if moveRegs = 1
                        if index = 0
                            lift regs amount
                            drop MyWizardBag 44 76 0
                            wait 150
                        elseif index = 1
                            lift regs amount
                            drop MyWizardBag 68 76 0
                            wait 150
                        elseif index = 2
                            lift regs amount
                            drop MyWizardBag 96 76 0
                            wait 150
                        elseif index = 3
                            lift regs amount
                            drop MyWizardBag 121 76 0
                            wait 150
                        else
                            lift regs amount
                            drop MyWizardBag 142 76 0
                            wait 150
                        endif
                    endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3976
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 88 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 88 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 88 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 88 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 88 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3974
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 100 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 100 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 100 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 100 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 100 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3980
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 112 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 112 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 112 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 112 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 112 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3973
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 124 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 124 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 124 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 124 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 124 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3963
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 136 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 136 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 136 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 136 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 136 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 3972
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 50
                        @setvar! amount 10
                    elseif counttype regsID self <= 100
                        @setvar! amount 20
                    elseif counttype regsID self <= 150
                        @setvar! amount 30
                    elseif counttype regsID self <= 200
                        @setvar! amount 40
                    else
                        @setvar! amount 50
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        if moveRegs = 1
                            if index = 0
                                lift regs amount
                                drop MyWizardBag 44 148 0
                                wait 150
                            elseif index = 1
                                lift regs amount
                                drop MyWizardBag 68 148 0
                                wait 150
                            elseif index = 2
                                lift regs amount
                                drop MyWizardBag 96 148 0
                                wait 150
                            elseif index = 3
                                lift regs amount
                                drop MyWizardBag 121 148 0
                                wait 150
                            else
                                lift regs amount
                                drop MyWizardBag 142 148 0
                                wait 150
                            endif
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                    @setvar! regsID 8012
                    @setvar! myCounter 0
                    while findtype regsID self as r
                        @setvar! myCounter index
                        @ignore r
                    endwhile
                    @clearignore
                    if counttype regsID self <= 5
                        @setvar! amount 1
                    elseif counttype regsID self <= 10
                        @setvar! amount 2
                    elseif counttype regsID self <= 20
                        @setvar! amount 4
                    elseif counttype regsID self <= 40
                        @setvar! amount 8
                    else
                        @setvar! amount 15
                    endif
                    while findtype regsID self as regs
                        @setvar! moveRegs 0
                        if myCounter = 0
                            @setvar! moveRegs 1
                        elseif myCounter != 0 and not find regs MyWizardBag
                            @setvar! moveRegs 1
                        endif
                        @ignore regs
                        if moveRegs = 1
                            wait 500
                        endif
                    endwhile
                elseif EnableOverheadMessages = 1
                    overhead "[ NO WIZARD BAG! ]" 337
                endif
            endif
            overhead "[ SCRIPT COMPLETE! ]" 88
            hotkey "Organizer Agent-01"
            @setvar! IHAVEDIED 0
            @setvar! TimeToGo 0
            @setvar! SkipInfiniteLoop 0
            @setvar! RedTargetFound 0
            @setvar! RECALLTIME 0
            stop
        endif
    endif

    //////////////////////////
    //   END AUTO RECALL    //
    //////////////////////////


    ///////////////////////////
    //  BEGIN HEALING LOOP:  //
    ///////////////////////////

    while diffhits >= ActivateAutoHealHPdiff or poisoned
        if dead
            replay
        endif

        if EnablePKradar = 1
            if timer "PKRadar" > 1000
                hotkey 'Next Murderer Player Target'
                wait 500
                if insysmsg "No one matching that was found"
                    settimer "PKRadar" 0
                    clearsysmsg
                else
                    hotkey 'Toggle War Only'
                    @setvar! RedTargetFound 1
                    @setvar! TimeToGo 1
                    @setvar! MurdererTarget lasttarget
                    replay
                endif
            endif
        endif

        if EnableWeightWarningMessage = 1
            if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING... ]" 77
                    settimer "WeightTimer" 0
                else
                    overhead "  " 77
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING! ]" 153
                    settimer "WeightTimer" 0
                else
                    overhead "  " 153
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT LIMIT REACHED! ]" 37
                    settimer "WeightTimer" 0
                else
                    overhead " Ï " 37
                    settimer "WeightTimer" 0
                endif

                if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    wait 1000
                    hotkey 'Toggle War Only'
                    @setvar! AutoWeightRecall 1
                    replay
                elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    if timer "RECALLDELAY" > 3500 and EnableOverheadMessages = 1
                        overhead "[ WAITING TO RECALL... ]" 149
                        settimer "RECALLDELAY" 0
                    endif
                    wait 500
                elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                    wait 500
                    hotkey 'Toggle War Only'
                    @setvar! TimeToGo 1
                    replay
                else
                    if EnableOverheadMessages = 1
                        overhead "[ OVERWEIGHT! ]" 337
                    else
                        overhead "  " 337
                    endif
                    wait 1500
                    overhead "[ STOPPING SCRIPT! ]" 88
                endif
            endif
        endif

        if not findtype "3972|3962|3963|3980|3976|3973|3974|3981" self
            @setvar! missingRegs 1
            if timer noRegsMessageTimer > 5000
                overhead "[ MISSING REGS! ]" 337
                settimer noRegsMessageTimer 0
            endif
        else
            @setvar! missingRegs 0
        endif

        @setvar! SpellInterrupted 0

        if EnableStrengthPotion = 1 and not findbuff "Strength"
            if findtype "White Potion" self
                dclicktype "White Potion"
                wait 250
            else
                if timer whiteMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO STRENGTH POTS! ]" 337
                    settimer whiteMessageTimer 0
                endif
            endif
        endif

        if EnableAgilityPotion = 1 and not findbuff "Agility"
            if findtype "Blue Potion" self
                dclicktype "Blue Potion"
                wait 250
            else
                if timer blueMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO AGILITY POTS! ]" 34
                    settimer blueMessageTimer 0
                endif
            endif
        endif

        if EnableResistPotion = 1 and not findbuff "Magic Resist"
            if findtype "Black Potion" self
                dclicktype "Black Potion"
                wait 250
            else
                if timer blackMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO RESIST POTS! ]" 337
                    settimer blackMessageTimer 0
                endif
            endif
        endif

        if EnableRefreshPotion = 1 and diffstam > RefreshPotionSPdiff
            if findtype "Red Potion" self
                dclicktype "Red Potion"
                wait 250
            else
                if timer redMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO REFRESH POTS! ]" 337
                    settimer redMessageTimer 0
                endif
            endif
        endif

        if paralyzed and EnableAutoParalyzePouch = 1
            if findtype "pouch" backpack 38
                yell "[pouch"
                wait 250
            else
                if timer pouchMessageTimer > 5000 and EnableOverheadMessages = 1
                    overhead "[ NO MORE POUCHES! ]" 337
                    settimer pouchMessageTimer 0
                endif
            endif
        endif

        if EnableCurePotion = 1 or EnableCastCure = 1
            while poisoned
                if findtype "Orange Potion" self
                    dclicktype "Orange Potion"
                    wait 500
                else
                    if timer orangeMessageTimer > 5000 and EnableOverheadMessages = 1
                        overhead "[ NO CURE POTS! ]" 337
                        settimer orangeMessageTimer 0
                    endif

                    if diffhits >= 30 or not findtype 3972 self or not findtype 3973 self
                        break
                    endif

                    if skill 'magery' >= 40 and mana >= 6 and EnableCastCure = 1 and not casting
                        cast 'cure'
                        wait 50
                        while not casting
                            if targetexists
                                hotkey 'cancel current target'
                            endif
                            cast 'cure'
                            wait 50
                        endwhile
                        while not targetexists
                            wait 100
                        endwhile
                        wft 1000
                        target 'self'
                        wait 500
                    else
                        break
                    endif
                endif
            endwhile
        endif

        if diffhits >= HealPotionHPdiff and EnableHealPotion = 1
            if findtype "Yellow Potion" self as hPot
                getlabel hPot potLabel
                if "next" in potLabel
                    #do nothing
                else
                    @setvar! ch 0

                    if counttype 3852 self as c
                        @setvar! ch c
                    endif
                    if insysmsg "potion satchel used"
                    endif

                    dclicktype 3852
                    getlabel backpack packdesc
                    wait 250

                    if ch != counttype 3852 self or insysmsg "potion satchel used"
                        cooldown "Healing Potion" 11000
                    endif
                endif
            else
                if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO HEAL POTS! ]" 337
                    settimer 'yellowMessageTimer' 0
                endif
            endif
        endif

        @setvar! SpellInterrupted 0
        
        if skill 'magery' >= 40 and diffhits >= CastHealHPdiff and mana >= 4 and EnableCastHeal = 1 and not casting
            cast 'heal'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'heal'
            endwhile

            while not targetexists
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target 'self'
            endif
        elseif skill 'magery' >= 40 and diffhits >= CastEmergencyHealHPdiff and mana >= 4 and EnableCastHeal = 1 and not casting
            cast 'heal'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'heal'
            endwhile

            while not targetexists
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target 'self'
            endif
        elseif skill 'magery' >= 60 and diffhits >= CastGreaterHealHPdiff and mana >= 11 and EnableCastGreaterHeal = 1 and not casting
            cast 'greater heal'
            while not casting
                cast 'greater heal'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD

                if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                wait 250
                            else
                                if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer orangeMessageTimer 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif

                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    cooldown "Healing Potion" 11000
                                    if diffhits < ActivateAutoHealHPdiff
                                        interrupt
                                    endif
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 5000 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile
            if SpellInterrupted = 0
                target 'self'
            endif
        endif
    endwhile

    ////////////////////////
    //  END HEALING LOOP  //
    ////////////////////////


    if EnableWeightWarningMessage = 1
        if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT WARNING... ]" 77
                settimer "WeightTimer" 0
            else
                overhead "  " 77
                settimer "WeightTimer" 0
            endif
        elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT WARNING! ]" 153
                settimer "WeightTimer" 0
            else
                overhead "  " 153
                settimer "WeightTimer" 0
            endif
        elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
            if EnableOverheadMessages = 1
                overhead "[ WEIGHT LIMIT REACHED! ]" 37
                settimer "WeightTimer" 0
            else
                overhead " Ï " 37
                settimer "WeightTimer" 0
            endif

            if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                wait 1000
                hotkey 'Toggle War Only'
                @setvar! AutoWeightRecall 1
                replay
            elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                if timer "RECALLDELAY" > 3500 and EnableOverheadMessages = 1
                    overhead "[ WAITING TO RECALL... ]" 149
                    settimer "RECALLDELAY" 0
                endif
                wait 500
            elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                wait 500
                hotkey 'Toggle War Only'
                @setvar! TimeToGo 1
                replay
            else
                if EnableOverheadMessages = 1
                    overhead "[ OVERWEIGHT! ]" 337
                else
                    overhead "  " 337
                endif
                wait 1500
                overhead "[ STOPPING SCRIPT! ]" 88
            endif
        endif
    endif

    if skill 'necromancy' >= 50 and not gumpexists 622436516
        if findtype 'necromancer book' backpack
            yell '[necromancyhotbar'
            while not gumpexists 622436516
                yell '[necromancyhotbar'
                waitforgump 622436516 1000
            endwhile
            wait 500
        elseif EnableOverheadMessages = 1
            overhead "[ NO NECRO BOOK! ]" 337
            wait 2500
        endif
    endif

    if not findtype "3972|3962|3963|3980|3976|3973|3974|3981" self
        @setvar! missingRegs 1
        if timer noRegsMessageTimer > 5000
            overhead "[ MISSING REGS! ]" 337
            settimer noRegsMessageTimer 0
        endif
    else
        @setvar! missingRegs 0
    endif

    if weight > maxweight and EnableDropGoldWhenOverweight = 1
        if timer overweightMessageTimer > 4500
            overhead "[ OVERWEIGHT! ]" 34
            settimer overweightMessageTimer 0
        endif

        if DropGoldAmount != 0
            while weight > maxweight
                if findtype "gold coin" backpack as easycomeeasygo
                    lift easycomeeasygo DropGoldAmount
                    droprelloc 0 0
                    getlabel backpack packdesc
                    wait 250
                    if insysmsg "cannot drop anything"
                        drop backpack -1 -1 -1
                    endif
                    wait 500
                endif
            endwhile
        endif
    endif

    while EnableAutoCarving = 1 and findtype "corpse" ground -1 -1 2 as deadbody and diffhits < ActivateAutoHealHPdiff and findtype 11552 backpack
        if timer SkinningTimer > 5000
            if targetexists
                hotkey 'cancel current target'
            endif
            while not targetexists
                skill 'forensicevaluation'
            endwhile
            if targetexists and find deadbody ground -1 -1 2
                if EnableOverheadMessages = 1
                    overhead "[ SKINNING... ]" 333
                endif
                target 'self'
                @ignore deadbody
                settimer SkinningTimer 0
            endif
        endif
    endwhile

    if EnablePKradar = 1
        if timer "PKRadar" > 1000
            hotkey 'Next Murderer Player Target'
            wait 500
            if insysmsg "No one matching that was found"
                settimer "PKRadar" 0
                clearsysmsg
            else
                hotkey 'Toggle War Only'
                @setvar! RedTargetFound 1
                @setvar! TimeToGo 1
                @setvar! MurdererTarget lasttarget
                replay
            endif
        endif
    endif

    if skill 'Cooking' >= 50
        if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as mysnack
            if not timerexists 'SnackTimer'
                createtimer 'SnackTimer'
                settimer 'SnackTimer' 60000
            endif
            if timer 'SnackTimer' > 60000 and diffmana > 50
                dclick mysnack
                wait 500
                settimer 'SnackTimer' 0
                cooldown "Snacking Timer" 60000
            endif
        else
            if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                overhead "[ NO MORE FOOD! ]" 337
                settimer foodMessageTimer 0
            endif
        endif
    elseif not findbuff "food"
        if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as food
            dclick food
            wait 500
        else
            if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                overhead "[ NO MORE FOOD! ]" 337
                settimer foodMessageTimer 0
            endif
        endif
    endif

    if counttype 29012 backpack = 0 and EnableMushroomMaker = 1
        while counttype 29012 backpack < MakeMushroomAmount and mana > 3 and diffhits < ActivateAutoHealHPdiff
            if not casting
                cast 'create food'
            endif
        endwhile
    endif

    if EnableMagicMushroom = 1
        if mana < EatMushroomManaSP and MakeMushroomAmount > 0 and timer MushroomTimer > MushroomCooldown
            if counttype 29012 backpack

                dclicktype 29012 backpack
                getlabel backpack packdesc
                wait 250

                if insysmsg "You consume a magic mushroom"
                    settimer MushroomTimer 0
                    cooldown "Mushroom" MushroomCooldown
                    if insysmsg "You consume a magic mushroom" and EnableOverheadMessages = 1
                        overhead "[ EATING SHROOMS... ]" 12
                    endif
                endif
            elseif EnableOverheadMessages = 1
                overhead "[ OUT OF SHROOMS! ]" 337
            endif
        endif
    endif

    @setvar! SpellInterrupted 0

    if EnableMagicReflection = 1 and skill 'magery' >= 70 and not findbuff "Magic Reflection" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and timer magicReflectTimer > 15000 and findtype 3972 self and findtype 3974 self and findtype 3981 self and not find ClosestTarget ground -1 -1 12
        cast 'Magic Reflection'
        while not casting
            getlabel backpack packdesc
            wait 250
            if insysmsg "that spell will not" or insysmsg "that spell is already"
                settimer magicReflectTimer 0
                break
            endif
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Magic Reflection'
        endwhile

        while casting
            if diffhits >= 50
                interrupt
                @setvar! SpellInterrupted 1
                break
            endif

            if EnableCurePotion = 1
                while poisoned and casting and not targetexists
                    if findtype "Orange Potion" self
                        dclicktype "Orange Potion"
                        wait 250
                    else
                        if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                            overhead "[ NO CURE POTS! ]" 337
                            settimer orangeMessageTimer 0
                        endif
                        break
                    endif
                endwhile
            endif

            if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                if findtype "Yellow Potion" self as hPot
                    getlabel hPot potLabel
                    if "next" in potLabel
                        #do nothing
                    else
                        @setvar! ch 0

                        if counttype 3852 self as c
                            @setvar! ch c
                        endif
                        if insysmsg "potion satchel used"
                        endif
                        dclicktype 3852
                        getlabel backpack packdesc
                        wait 250

                        if ch != counttype 3852 self or insysmsg "potion satchel used"
                            cooldown "Healing Potion" 11000
                        endif
                    endif
                else
                    if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                        overhead "[ NO HEAL POTS! ]" 337
                        settimer 'yellowMessageTimer' 0
                    endif
                endif
            endif
        endwhile
        wait 500
    endif

    if EnableReactiveArmour = 1 and skill 'magery' >= 30 and not findbuff "Reactive Armor" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and timer armorReflectTimer > 15000 and findtype 3980 self and findtype 3972 self and findtype 3981 self and not find ClosestTarget ground -1 -1 12
        cast 'Reactive Armor'
        while not casting
            getlabel backpack packdesc
            wait 250
            if insysmsg "that spell will not" or insysmsg "that spell is already"
                settimer armorReflectTimer 0
                break
            endif
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Reactive Armor'
        endwhile

        while casting
        endwhile
        getlabel backpack packdesc
        wait 250
    endif

    if EnableProtection = 1 and skill 'magery' >= 40 and not findbuff "Protection" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and findtype 3980 self and findtype 3972 self and findtype 3973 self and not find ClosestTarget ground -1 -1 12
        cast 'Protection'
        while not casting
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Protection'
        endwhile
        while casting
        endwhile
        wait 250
    endif

    if EnableBless = 1 and skill 'magery' >= 50 and not findbuff "Cunning" and mana >= MiniumManaToApplyBuffs and diffhits < ActivateAutoHealHPdiff and findtype 3972 self and findtype 3974 self and not find ClosestTarget ground -1 -1 12
        cast 'Bless'
        while not casting
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Bless'
            wait 50
        endwhile

        while not targetexists
            wait 100
        endwhile

        wft 1000
        target 'self'
        wait 250
    endif

    if find ClosestTarget ground -1 -1 12
        // Do nothing
    else
        if targetexists
            hotkey 'cancel current target'
        endif

        hotkey 'target closest grey monster'
        wait 500

        if not find lasttarget ground -1 -1 12
            if timer noTargetMessageTimer > 4500
                if EnableOverheadMessages = 1
                    overhead '[ NOTHING TO TARGET... ]' 2338
                else
                    overhead ' Ï ' 2338
                endif
                settimer noTargetMessageTimer 0
            endif

            if weight > maxweight and EnableDropGoldWhenOverweight = 1
                if timer overweightMessageTimer > 4500
                    overhead "[ OVERWEIGHT! ]" 34
                    settimer overweightMessageTimer 0
                endif

                if DropGoldAmount != 0
                    while weight > maxweight
                        if findtype "gold coin" backpack as easycomeeasygo
                            lift easycomeeasygo DropGoldAmount
                            droprelloc 0 0
                            getlabel backpack packdesc
                            wait 250
                            if insysmsg "cannot drop anything"
                                drop backpack -1 -1 -1
                            endif
                            wait 500
                        endif
                    endwhile
                endif
            endif

            if EnableAutoSatchels = 1
                if findtype "3962|3963|3972|3973|3974|3976|3980|3981" backpack and findtype "reagent satchel" self as MyWizardBag
                    while findtype "reagent satchel" self as MyWizardBag
                        getlabel MyWizardBag MyWizardBagdesc
                        if 'decorative' in MyWizardBagdesc
                            @ignore MyWizardBag
                        else
                            break
                        endif
                    endwhile
                    if timer "WizardSatchelTimer" > 60000
                        menu MyWizardBag 0
                        wait 500
                        settimer "WizardSatchelTimer" 0
                    endif
                endif
                if findtype "Yellow Potion|Orange Potion|Red Potion|White Potion|Blue Potion|Black Potion|" backpack and findtype 31262 self as MyPotBag
                    if timer "PotionSatchelTimer" > 60000
                        menu MyPotBag 0
                        wait 500
                        settimer "PotionSatchelTimer" 0
                    endif
                endif
            endif

            while EnableAutoCarving = 1 and findtype "corpse" ground -1 -1 2 as deadbody and diffhits < ActivateAutoHealHPdiff and findtype 11552 backpack
               if timer SkinningTimer > 5000
                    if targetexists
                        hotkey 'cancel current target'
                    endif

                    while not targetexists
                        skill 'forensicevaluation'
                    endwhile

                    if targetexists and find deadbody ground -1 -1 2
                        if EnableOverheadMessages = 1
                            overhead "[ SKINNING... ]" 333
                        endif
                        target 'self'
                        @ignore deadbody
                        settimer SkinningTimer 0
                    endif
                endif
            endwhile

            if insysmsg "appears to be locked"
                clearsysmsg 
                replay
            endif
            
            if warmode on
                @setvar! TimeToGo 1
                replay
            endif

            if not varexist "NoLockbox"
                @setvar! NoLockbox 0
            endif

            if findtype "wooden box" self and findtype "copper key" self
                @setvar! NoLockbox 0
            endif

            if EnablePutLootinLockBox = 1 and NoLockbox != 1 and timer LootTimer > 5000
                if not findtype "wooden box" backpack or not findtype "copper key" backpack
                    if EnableOverheadMessages = 1
                        overhead "[ NO LOCKBOX FOUND! ]" 337
                    endif
                    @setvar! NoLockbox 1
                    wait 1500
                elseif counttype 2474 backpack > 1 or counttype 4110 backpack > 1
                    if EnableOverheadMessages = 1
                        overhead "[ TOO MANY LOCKBOXES/KEYS! ]" 337
                    endif
                    @setvar! NoLockbox 1
                    wait 1500
                else
                    clearsysmsg
                    hotkey 'Target closest grey monster'
                    wait 500
                    if insysmsg "matching that was found"
                        if findtype "wooden box" backpack as lockbox and findtype "copper key" backpack as key
                            if findtype '3821|31169|31172|31190|31128|31142|31141|31002|31130|31000|31001|31180|31182|31178|30991|30999|31014|20014|20012|20010|20008|20006|30992|30997|31176|31188|30998|30989|30996|30995|31186|31184|30994|30990|30993|37181|4026|4025|31010|31008|31007|31006|31015|31005|31009|31012|31011|31004|31003|31191|39911|17686|31014|30994|31142|31190|24434|43206|29363|43166|22336|29348|17087|3985|8826|3827|29030|3836|5981|4248|5359|3839|3838|3843|2597|29036|48407|3865|3859|3885|3856|3878|3877|3873|3861|3862|576|5123|7177|7027|3920|5131|5179|5075|5060|5076|5042|10245|3938|3913|7169|3909|5063|5089|7170|7033|3762|5040|5103|5117|7181|7029|3568|6264|3742|5139|6263|7026|5125|3740|5121|5204|5105|5185|5078|5115|7175|5059|7034|3713|3915|5112|5070|5049|5205|5046|7035|3911|7179|5106|5143|3573|3719|5177|7610|5181|3917|5132|7031|5207|5056|5085|3763|5129|5187|3721|5138|3570|5101|5061|5074|5142|5182|5146|6265|5090|5203|5044|5144|3932|5201|5127|3572|7173|5135|3937|3571|22326|27611|9917|3821|5356|8455|5362|45315|8454|22187|5901|7163|3903|126867981|7982|7983|7984|7985|7986|7987|7988|7989|7990|7991|7992|7993|7994|7995|7996|7997|7998|7999|8000|8001|8002|8003|8004|8005|8006|8007|8008|8009|8010|8011|8012|8013|8014|8015|8016|8017|8018|8019|8020|8021|8022|8023|8024|8025|8026|8027|8028|8029|8030|8031|8032|8033|8034|8035|8036|8037|8038|8039|8040|8041|8042|8033|8044|39889|39891|39892|39896|39897|39898|39905|39909|39911|39912|39916|39917|39918|3843|3838|3839|3842|15296|15297|29025|29034|29036|2472|2475|3648|3649|3650|3651|3708|3712|29832|29833|7107' backpack as loottostore
                                getlabel lockbox lockboxLabel
                                if "items" in lockboxLabel
                                    wait 250
                                    if EnableOverheadMessages = 1 and timer "STORELOOT" > 5000
                                        overhead "[ SECURING LOOT... ]" 420
                                        wait 250
                                        settimer "STORELOOT" 0
                                    endif
                                else
                                    if EnableOverheadMessages = 1
                                        overhead "[loot box unlocked]" 84
                                    endif
                                    dclick key
                                    wft 1500
                                    target lockbox
                                    if EnableOverheadMessages = 1 and timer "STORELOOT" > 5000
                                        overhead "[ SECURING LOOT... ]" 420
                                        settimer "STORELOOT" 0
                                    endif
                                endif
                                while findtype '3821|31169|31172|31190|31128|31142|31141|31002|31130|31000|31001|31180|31182|31178|30991|30999|31014|20014|20012|20010|20008|20006|30992|30997|31176|31188|30998|30989|30996|30995|31186|31184|30994|30990|30993|37181|4026|4025|31010|31008|31007|31006|31015|31005|31009|31012|31011|31004|31003|31191|39911|17686|31014|30994|31142|31190|24434|43206|29363|43166|22336|29348|17087|3985|8826|3827|29030|3836|5981|4248|5359|3839|3838|3843|2597|29036|48407|3865|3859|3885|3856|3878|3877|3873|3861|3862|576|5123|7177|7027|3920|5131|5179|5075|5060|5076|5042|10245|3938|3913|7169|3909|5063|5089|7170|7033|3762|5040|5103|5117|7181|7029|3568|6264|3742|5139|6263|7026|5125|3740|5121|5204|5105|5185|5078|5115|7175|5059|7034|3713|3915|5112|5070|5049|5205|5046|7035|3911|7179|5106|5143|3573|3719|5177|7610|5181|3917|5132|7031|5207|5056|5085|3763|5129|5187|3721|5138|3570|5101|5061|5074|5142|5182|5146|6265|5090|5203|5044|5144|3932|5201|5127|3572|7173|5135|3937|3571|22326|27611|9917|3821|5356|8455|5362|45315|8454|22187|5901|7163|3903|126867981|7982|7983|7984|7985|7986|7987|7988|7989|7990|7991|7992|7993|7994|7995|7996|7997|7998|7999|8000|8001|8002|8003|8004|8005|8006|8007|8008|8009|8010|8011|8012|8013|8014|8015|8016|8017|8018|8019|8020|8021|8022|8023|8024|8025|8026|8027|8028|8029|8030|8031|8032|8033|8034|8035|8036|8037|8038|8039|8040|8041|8042|8033|8044|39889|39891|39892|39896|39897|39898|39905|39909|39911|39912|39916|39917|39918|3843|3838|3839|3842|15296|15297|29025|29034|29036|2472|2475|3648|3649|3650|3651|3708|3712|29832|29833|7107' backpack as loottostore
                                    if find loottostore lockbox
                                        @ignore loottostore
                                    else
                                        clearsysmsg
                                        lift loottostore 9999
                                        drop lockbox -1 -1 -1
                                        wait 500
                                    endif
                                    if warmode
                                        settimer "LootTimer" 0
                                        hotkey 'Toggle Peace Only'
                                        overhead " Ï " 420
                                        replay
                                    elseif diffhits > 35
                                        settimer "LootTimer" 0
                                        overhead " Ï " 420
                                        replay
                                    endif
                                endwhile
                                dclick key
                                wft 1500
                                target lockbox
                                if EnableOverheadMessages = 1
                                    overhead "[loot box locked]" 69
                                endif
                                @setvar! NeedtoSecureLoot 0
                            endif
                            getlabel lockbox lockboxLabel
                            if "items" in lockboxLabel
                                dclick key
                                wft 1500
                                target lockbox
                                @setvar! NeedtoSecureLoot 0
                                settimer "LootTimer" 0
                            endif
                        endif
                    endif
                endif
            endif
            
            if insysmsg "appears to be locked"
                clearsysmsg 
                replay
            endif

            if targetexists
                hotkey 'cancel current target'
            endif
        elseif noto lasttarget = "friend" or noto lasttarget = "innocent"
            if timer noTargetMessageTimer > 4500
                if EnableOverheadMessages = 1
                    overhead '[ NOTHING TO TARGET... ]' 2338
                else
                    overhead ' Ï ' 2338
                endif
                settimer noTargetMessageTimer 0
            endif

            if weight > maxweight and EnableDropGoldWhenOverweight = 1
                if timer overweightMessageTimer > 4500
                    overhead "[ OVERWEIGHT! ]" 34
                    settimer overweightMessageTimer 0
                endif

                if DropGoldAmount != 0
                    while weight > maxweight
                        if findtype "gold coin" backpack as easycomeeasygo
                            lift easycomeeasygo DropGoldAmount
                            droprelloc 0 0
                            getlabel backpack packdesc
                            wait 250
                            if insysmsg "cannot drop anything"
                                drop backpack -1 -1 -1
                            endif
                            wait 500
                        endif
                    endwhile
                endif
            endif

            if EnableAutoSatchels = 1
                if findtype "3962|3963|3972|3973|3974|3976|3980|3981" backpack and findtype "reagent satchel" self as MyWizardBag
                    while findtype "reagent satchel" self as MyWizardBag
                        getlabel MyWizardBag MyWizardBagdesc
                        if 'decorative' in MyWizardBagdesc
                            @ignore MyWizardBag
                        else
                            break
                        endif
                    endwhile
                    if timer "WizardSatchelTimer" > 60000
                        menu MyWizardBag 0
                        wait 500
                        settimer "WizardSatchelTimer" 0
                    endif
                endif
                if findtype "Yellow Potion|Orange Potion|Red Potion|White Potion|Blue Potion|Black Potion|" backpack and findtype 31262 self as MyPotBag
                    if timer "PotionSatchelTimer" > 60000
                        menu MyPotBag 0
                        wait 500
                        settimer "PotionSatchelTimer" 0
                    endif
                endif
            endif

            while EnableAutoCarving = 1 and findtype "corpse" ground -1 -1 2 as deadbody and diffhits < ActivateAutoHealHPdiff and findtype 11552 backpack
               if timer SkinningTimer > 5000
                    if targetexists
                        hotkey 'cancel current target'
                    endif

                    while not targetexists
                        skill 'forensicevaluation'
                    endwhile

                    if targetexists and find deadbody ground -1 -1 2
                        if EnableOverheadMessages = 1
                            overhead "[ SKINNING... ]" 333
                        endif
                        target 'self'
                        @ignore deadbody
                        settimer SkinningTimer 0
                    endif
                endif
            endwhile

            if warmode on
                @setvar! TimeToGo 1
                replay
            endif

            if EnableDungeonCleanup = 1
                while findtype "gold coin|iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 2 as item and timer "DungeonCleanup" > 1000
                    if EnableOverheadMessages = 1
                        overhead '[ CLEANUP... ]' 420
                    else
                        overhead ' ² ' 420
                    endif
                    hotkey "Grab Item"
                    wft 1000
                    target item
                    wait 500
                    settimer "DungeonCleanup" 0
                endwhile

                if findtype "gold coin|iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 10 as dungeonjunk and timer "DungeonCleanupRadar" > 3500
                    overhead "¼" 420 dungeonjunk
                    settimer "DungeonCleanupRadar" 0
                endif
            endif

            if not varexist "NoLockbox"
                @setvar! NoLockbox 0
            endif

            if findtype "wooden box" self and findtype "copper key" self
                @setvar! NoLockbox 0
            endif

            if EnablePutLootinLockBox = 1 and NoLockbox != 1 and timer LootTimer > 5000
                if not findtype "wooden box" backpack or not findtype "copper key" backpack
                    if EnableOverheadMessages = 1
                        overhead "[ NO LOCKBOX FOUND! ]" 337
                    endif
                    @setvar! NoLockbox 1
                    wait 1500
                elseif counttype 2474 backpack > 1 or counttype 4110 backpack > 1
                    if EnableOverheadMessages = 1
                        overhead "[ TOO MANY LOCKBOXES/KEYS! ]" 337
                    endif
                    @setvar! NoLockbox 1
                    wait 1500
                else
                    clearsysmsg
                    hotkey 'Target closest grey monster'
                    wait 500
                    if insysmsg "matching that was found"
                        if findtype "wooden box" backpack as lockbox and findtype "copper key" backpack as key
                            if findtype '3821|31169|31172|31190|31128|31142|31141|31002|31130|31000|31001|31180|31182|31178|30991|30999|31014|20014|20012|20010|20008|20006|30992|30997|31176|31188|30998|30989|30996|30995|31186|31184|30994|30990|30993|37181|4026|4025|31010|31008|31007|31006|31015|31005|31009|31012|31011|31004|31003|31191|39911|17686|31014|30994|31142|31190|24434|43206|29363|43166|22336|29348|17087|3985|8826|3827|29030|3836|5981|4248|5359|3839|3838|3843|2597|29036|48407|3865|3859|3885|3856|3878|3877|3873|3861|3862|576|5123|7177|7027|3920|5131|5179|5075|5060|5076|5042|10245|3938|3913|7169|3909|5063|5089||7170|7033|3762|5040|5103|5117|7181|7029|3568|6264|3742|5139|6263|7026|5125|3740|5121|5204|5105|5185|5078|5115|7175|5059|7034|3713|3915|5112|5070|5049|5205|5046|7035|3911|7179|5106|5143|3573|3719|5177|7610|5181|3917|5132|7031|5207|5056|5085|3763|5129|5187|3721|5138|3570|5101|5061|5074|5142|5182|5146|6265|5090|5203|5044|5144|3932|5201|5127|3572|7173|5135|3937|3571|22326|27611|9917|3821|5356|8455|5362|45315|8454|22187|5901|7163|3903|126867981|7982|7983|7984|7985|7986|7987|7988|7989|7990|7991|7992|7993|7994|7995|7996|7997|7998|7999|8000|8001|8002|8003|8004|8005|8006|8007|8008|8009|8010|8011|8012|8013|8014|8015|8016|8017|8018|8019|8020|8021|8022|8023|8024|8025|8026|8027|8028|8029|8030|8031|8032|8033|8034|8035|8036|8037|8038|8039|8040|8041|8042|8033|8044|39889|39891|39892|39896|39897|39898|39905|39909|39911|39912|39916|39917|39918|3843|3838|3839|3842|15296|15297|29025|29034|29036|2472|2475|3648|3649|3650|3651|3708|3712|29832|29833|7107' backpack as loottostore
                                getlabel lockbox lockboxLabel
                                if "items" in lockboxLabel
                                    wait 250
                                    if EnableOverheadMessages = 1 and timer "STORELOOT" > 5000
                                        overhead "[ SECURING LOOT... ]" 420
                                        wait 250
                                        settimer "STORELOOT" 0
                                    endif
                                else
                                    if EnableOverheadMessages = 1
                                        overhead "[loot box unlocked]" 84
                                    endif
                                    dclick key
                                    wft 1500
                                    target lockbox
                                    if EnableOverheadMessages = 1 and timer "STORELOOT" > 5000
                                        overhead "[ SECURING LOOT... ]" 420
                                        settimer "STORELOOT" 0
                                    endif
                                endif
                                while findtype '3821|31169|31172|31190|31128|31142|31141|31002|31130|31000|31001|31180|31182|31178|30991|30999|31014|20014|20012|20010|20008|20006|30992|30997|31176|31188|30998|30989|30996|30995|31186|31184|30994|30990|30993|37181|4026|4025|31010|31008|31007|31006|31015|31005|31009|31012|31011|31004|31003|31191|39911|17686|31014|30994|31142|31190|24434|43206|29363|43166|22336|29348|17087|3985|8826|3827|29030|3836|5981|4248|5359|3839|3838|3843|2597|29036|48407|3865|3859|3885|3856|3878|3877|3873|3861|3862|576|5123|7177|7027|3920|5131|5179|5075|5060|5076|5042|10245|3938|3913|7169|3909|5063|5089|7170|7033|3762|5040|5103|5117|7181|7029|3568|6264|3742|5139|6263|7026|5125|3740|5121|5204|5105|5185|5078|5115|7175|5059|7034|3713|3915|5112|5070|5049|5205|5046|7035|3911|7179|5106|5143|3573|3719|5177|7610|5181|3917|5132|7031|5207|5056|5085|3763|5129|5187|3721|5138|3570|5101|5061|5074|5142|5182|5146|6265|5090|5203|5044|5144|3932|5201|5127|3572|7173|5135|3937|3571|22326|27611|9917|3821|5356|8455|5362|45315|8454|22187|5901|7163|3903|126867981|7982|7983|7984|7985|7986|7987|7988|7989|7990|7991|7992|7993|7994|7995|7996|7997|7998|7999|8000|8001|8002|8003|8004|8005|8006|8007|8008|8009|8010|8011|8012|8013|8014|8015|8016|8017|8018|8019|8020|8021|8022|8023|8024|8025|8026|8027|8028|8029|8030|8031|8032|8033|8034|8035|8036|8037|8038|8039|8040|8041|8042|8033|8044|39889|39891|39892|39896|39897|39898|39905|39909|39911|39912|39916|39917|39918|3843|3838|3839|3842|15296|15297|29025|29034|29036|2472|2475|3648|3649|3650|3651|3708|3712|29832|29833|7107' backpack as loottostore
                                    if find loottostore lockbox
                                        @ignore loottostore
                                    else
                                        clearsysmsg
                                        lift loottostore 9999
                                        drop lockbox -1 -1 -1
                                        wait 500
                                    endif
                                    if warmode
                                        settimer "LootTimer" 0
                                        hotkey 'Toggle Peace Only'
                                        overhead " Ï " 420
                                        replay
                                    elseif diffhits > 35
                                        settimer "LootTimer" 0
                                        overhead " Ï " 420
                                        replay
                                    endif
                                endwhile
                                dclick key
                                wft 1500
                                target lockbox
                                if EnableOverheadMessages = 1
                                    overhead "[loot box locked]" 69
                                endif
                                @setvar! NeedtoSecureLoot 0
                            endif
                            getlabel lockbox lockboxLabel
                            if "items" in lockboxLabel
                                dclick key
                                wft 1500
                                target lockbox
                                @setvar! NeedtoSecureLoot 0
                                settimer "LootTimer" 0
                            endif
                        endif
                    endif
                endif
            endif

            if targetexists
                hotkey 'cancel current target'
            endif
        elseif not dead lasttarget
            @setvar! tempTarget lasttarget
            while diffhits < ActivateAutoHealHPdiff
                if timer searchingMessageTimer > 15000
                    if EnableOverheadMessages = 1
                        overhead '[ ANALYZING TARGETS... ]' 90
                    endif
                    settimer searchingMessageTimer 0
                endif

                @setvar! tempTarget lasttarget

                if index != 0
                    hotkey "next non-friendly monster target"
                    @setvar! tempTarget lasttarget
                endif

                if find tempTarget ground -1 -1 12
                    getlabel tempTarget tempLabel

                    while "-" in tempLabel
                        getlabel tempTarget tempLabel
                    endwhile

                    if inlist animalsIgnoreList tempLabel
                        @ignore tempTarget
                    else
                        skill 'begging'
                        while not targetexists
                           if insysmsg! 'you must wait'
                                break
                           endif
                        endwhile
                        if not insysmsg 'you must wait'
                            target tempTarget
                            getlabel backpack packdesc
                            wait 250
                        endif

                        if not dead tempTarget
                            if insysmsg "Target cannot be seen"
                                if timer "CANNOTSEE" > 4500 and EnableOverheadMessages = 1
                                    overhead  "[ CANNOT BE SEEN! ]" 44 tempTarget
                                    settimer "CANNOTSEE" 0
                                elseif timer "CANNOTSEE" > 4500 and EnableOverheadMessages = 0
                                    overhead " ¼ " 44 tempTarget
                                    settimer "CANNOTSEE" 0
                                endif
                            elseif insysmsg "That is too far away."
                                if timer "TOOFAR" > 4500 and EnableOverheadMessages = 1
                                    overhead "[ TOO FAR AWAY! ]" 44 tempTarget
                                    settimer "TOOFAR" 0
                                elseif timer "TOOFAR" > 4500 and EnableOverheadMessages = 0
                                    overhead " ¼ " 44 tempTarget
                                    settimer "TOOFAR" 0
                                endif
                            elseif insysmsg "Perhaps" or insysmsg "You are too far away from them." or insysmsg "They do not appear to have anything to offer you." or insysmsg! "You must wait"

                                if insysmsg "You must wait"
                                    hotkey 'target closest grey monster'
                                    @setvar! tempTarget lasttarget
                                endif

                                if ClosestTarget != tempTarget
                                    settimer CurseTimer CurseCooldown
                                    settimer ManaDrainTimer ManaDrainCooldown
                                endif

                                @setvar! ClosestTarget tempTarget
                                @setvar! previousTarget currentTarget
                                attack ClosestTarget

                                if timer "ATTACKTIMER" > 15000
                                    if EnableOverheadMessages = 1
                                        overhead "[ ATTACK! ]" 69
                                        settimer "ATTACKTIMER" 0
                                    else
                                        settimer "ATTACKTIMER" 0
                                    endif
                                endif
                                break
                            endif
                        endif
                    endif
                endif
                if targetexists
                    hotkey 'cancel current target'
                endif
                if casting
                    interrupt
                endif
            endwhile
        endif
    endif


    //////////////////////////
    //  BEGIN ATTACK LOOP:  //
    //////////////////////////

    while not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and diffhits < ActivateAutoHealHPdiff and mana >= 4
        if timer "TargetTimer" > 4000 and find ClosestTarget ground -1 -1 12
            getlabel ClosestTarget TargetDesc
            if EnableOverheadMessages = 1
                if "Paragon" in TargetDesc and find ClosestTarget ground -1 -1 12
                    overhead " ¼ PARAGON! ¼ " 12 ClosestTarget
                    settimer "TargetTimer" 0
                elseif find ClosestTarget ground -1 -1 12
                    overhead " ¼ TARGET ¼ " 253 ClosestTarget
                    settimer "TargetTimer" 0
                endif
            else
                if "Paragon" in TargetDesc and find ClosestTarget ground -1 -1 12
                    overhead " ¼ " 12 ClosestTarget
                    settimer "TargetTimer" 0
                elseif find ClosestTarget ground -1 -1 12
                    overhead " ¼ " 253 ClosestTarget
                    settimer "TargetTimer" 0
                endif
            endif
        endif

        if timerexists "TargetChecker" > 10000
            settimer "TargetChecker" 0
            replay
        endif

        if insysmsg "Mana Thief activated" 
            cooldown "Mana Thief" 60000
            clearsysmsg
        endif 
        
        if diffhits > ActivateAutoHealHPdiff 
            break
        endif

        if EnablePKradar = 1
            if timer "PKRadar" > 1000
                hotkey 'Next Murderer Player Target'
                wait 500
                if insysmsg "No one matching that was found"
                    settimer "PKRadar" 0
                    clearsysmsg
                else
                    hotkey 'Toggle War Only'
                    @setvar! RedTargetFound 1
                    @setvar! TimeToGo 1
                    @setvar! MurdererTarget lasttarget
                    replay
                endif
            endif
        endif

        if EnableWeightWarningMessage = 1
            if diffweight < GreenWarningDiffWeight and diffweight > YellowWarningDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING... ]" 77
                    settimer "WeightTimer" 0
                else
                    overhead "  " 77
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < YellowWarningDiffWeight and diffweight > RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT WARNING! ]" 153
                    settimer "WeightTimer" 0
                else
                    overhead "  " 153
                    settimer "WeightTimer" 0
                endif
            elseif diffweight < RedWeightLimitDiffWeight and timer "WeightTimer" > 6000
                if EnableOverheadMessages = 1
                    overhead "[ WEIGHT LIMIT REACHED! ]" 37
                    settimer "WeightTimer" 0
                else
                    overhead " Ï " 37
                    settimer "WeightTimer" 0
                endif

                if EnableAutoWeightRecall = 1 and not find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    wait 500
                    hotkey 'Toggle War Only'
                    @setvar! AutoWeightRecall 1
                    replay
                elseif EnableAutoWeightRecall = 1 and find ClosestTarget ground -1 -1 8 and WILDERNESSMODE = 1
                    if timer "RECALLDELAY" > 3500 and EnableOverheadMessages = 1
                        overhead "[ WAITING TO RECALL... ]" 149
                        settimer "RECALLDELAY" 0
                    endif
                    wait 500
                elseif EnableAutoWeightDungeonGate = 1 and DUNGEONMODE = 1
                    wait 500
                    hotkey 'Toggle War Only'
                    @setvar! TimeToGo 1
                    replay
                else
                    if EnableOverheadMessages = 1
                        overhead "[ OVERWEIGHT! ]" 337
                    else
                        overhead "  " 337
                    endif
                    wait 1500
                    overhead "[ STOPPING SCRIPT! ]" 88
                    stop
                endif
            endif
        endif

        if skill 'Necromancy' >= 50 and not gumpexists 622436516
            if findtype 'necromancer book' backpack
                yell '[necromancyhotbar'
                while not gumpexists 622436516
                    yell '[necromancyhotbar'
                    waitforgump 622436516 1000
                endwhile
                wait 500
            elseif EnableOverheadMessages = 1
                overhead "[ NO NECRO BOOK! ]" 337
                wait 1000
            endif
        endif

        if skill "Arcane" >= 80 and EnableArcaneWeaponAbility = 1
            settimer ArcaneWeaponAbilityTimer 10000
            if EnableArcaneCodexAbilityHotbar = 1
                if not gumpexists 3954121934
                    yell '[abilitieshotbar'
                    wait 500
                endif
            endif
        endif

        if skill 'Arcane' >= 50 and not findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" hand
            if findtype "31043|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31045|31047|31049|31051|31053|31055" self as myArcaneStaff
                dclick myArcaneStaff
                wait 500
            else
                if timer "ArcaneStaffCheck" > 5000 and EnableOverheadMessages = 1
                    overhead "[ NO STAFF! ]" 337
                    settimer "ArcaneStaffCheck" 0
                endif
            endif
        endif

        if EnableAutoTaunting = 1
            if skill 'Parrying' >= 80 and find ClosestTarget ground -1 -1 12 and timer "TauntingTimer" > 15000
                say "[Taunt"
                wft 1000
                target ClosestTarget
                wait 500
                if not targetexists
                    if insysmsg "Cannot be seen"
                        settimer "TauntingTimer" 10000
                    else
                        if EnableOverheadMessages = 1
                            overhead "[ TAUNTING... ]" 2117
                        endif
                        settimer "TauntingTimer" 0
                    endif
                endif
            endif
        endif

        if not findtype "3972|3962|3963|3980|3976|3973|3974|3981" self
            @setvar! missingRegs 1
            if timer noRegsMessageTimer > 5000
                overhead "[ MISSING REGS! ]" 337
                settimer noRegsMessageTimer 0
            endif
        else
            @setvar! missingRegs 0
        endif

        if skill 'Cooking' >= 50
            if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as mysnack
                if not timerexists 'SnackTimer'
                    createtimer 'SnackTimer'
                    settimer 'SnackTimer' 60000
                endif
                if timer 'SnackTimer' > 60000 and diffmana > 50
                    dclick mysnack
                    wait 500
                    settimer 'SnackTimer' 0
                    cooldown "Snacking Timer" 60000
                endif
            else
                if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                    overhead "[ NO MORE FOOD! ]" 337
                    settimer foodMessageTimer 0
                endif
            endif
        elseif not findbuff "food"
            if findtype "29774|28883|28885|28880|28879|28888|28886|29773|28881" backpack as food
                dclick food
                wait 500
            else
                if timer foodMessageTimer > 15000 and EnableOverheadMessages = 1
                    overhead "[ NO MORE FOOD! ]" 337
                    settimer foodMessageTimer 0
                endif
            endif
        endif

        if EnableStrengthPotion = 1 and not findbuff "Strength"
            if findtype "White Potion" self
                dclicktype "White Potion"
                wait 250
            else
                if timer whiteMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO STRENGTH POTS! ]" 337
                    settimer whiteMessageTimer 0
                endif
            endif
        endif

        if EnableAgilityPotion = 1 and not findbuff "Agility"
            if findtype "Blue Potion" self
                dclicktype "Blue Potion"
                wait 250
            else
                if timer blueMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO AGILITY POTS! ]" 34
                    settimer blueMessageTimer 0
                endif
            endif
        endif

        if EnableResistPotion = 1 and not findbuff "Magic Resist"
            if findtype "Black Potion" self
                dclicktype "Black Potion"
                wait 250
            else
                if timer blackMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO RESIST POTS! ]" 337
                    settimer blackMessageTimer 0
                endif
            endif
        endif

        if EnableRefreshPotion = 1 and diffstam > RefreshPotionSPdiff
            if findtype "Red Potion" self
                dclicktype "Red Potion"
                wait 250
            else
                if timer redMessageTimer > 4500 and EnableOverheadMessages = 1
                    overhead "[ NO REFRESH POTS! ]" 337
                    settimer redMessageTimer 0
                endif
            endif
        endif

        if counttype 29012 backpack = 0 and EnableMushroomMaker = 1
            while counttype 29012 backpack < MakeMushroomAmount and mana > 3 and diffhits < ActivateAutoHealHPdiff
                if not casting
                    cast 'create food'
                endif
            endwhile
        endif

        if EnableMagicMushroom = 1
            if mana < EatMushroomManaSP and MakeMushroomAmount > 0 and timer MushroomTimer > MushroomCooldown
                if counttype 29012 backpack

                    dclicktype 29012 backpack
                    getlabel backpack packdesc
                    wait 250

                    if insysmsg "You consume a magic mushroom"
                        settimer MushroomTimer 0
                        cooldown "Mushroom" MushroomCooldown
                        if insysmsg "You consume a magic mushroom" and EnableOverheadMessages = 1
                            overhead "[ EATING SHROOMS... ]" 12
                        endif
                    endif
                elseif EnableOverheadMessages = 1
                    overhead "[ OUT OF SHROOMS! ]" 337
                endif
            endif
        endif

        if ingump "20/" 622436516
            @setvar! unholyPoints 20
        elseif ingump "19/" 622436516
            @setvar! unholyPoints 19
        elseif ingump "18/" 622436516
            @setvar! unholyPoints 18
        elseif ingump "17/" 622436516
            @setvar! unholyPoints 17
        elseif ingump "16/" 622436516
            @setvar! unholyPoints 16
        elseif ingump "15/" 622436516
            @setvar! unholyPoints 15
        elseif ingump "14/" 622436516
            @setvar! unholyPoints 14
        elseif ingump "13/" 622436516
            @setvar! unholyPoints 13
        elseif ingump "12/" 622436516
            @setvar! unholyPoints 12
        elseif ingump "11/" 622436516
            @setvar! unholyPoints 11
        elseif ingump "10/" 622436516
            @setvar! unholyPoints 10
        elseif ingump "9/" 622436516
            @setvar! unholyPoints 9
        elseif ingump "8/" 622436516
            @setvar! unholyPoints 8
        elseif ingump "7/" 622436516
            @setvar! unholyPoints 7
        elseif ingump "6/" 622436516
            @setvar! unholyPoints 6
        elseif ingump "5/" 622436516
            @setvar! unholyPoints 5
        elseif ingump "4/" 622436516
            @setvar! unholyPoints 4
        elseif ingump "3/" 622436516
            @setvar! unholyPoints 3
        elseif ingump "2/" 622436516
            @setvar! unholyPoints 2
        elseif ingump "1/" 622436516
            @setvar! unholyPoints 1
        else
            @setvar unholyPoints 0
        endif

        if EnableAutoExplosionPots = 1
            if findtype 'purple potion' self as explotPot
                getlabel explotPot potLabel
                if "(" in potLabel
                    if timer PurplePotionTimer > 14500
                        @setvar! PurplePotionReady 1
                    else
                        @setvar! PurplePotionReady 0
                    endif
                else
                    @setvar! PurplePotionReady 1
                endif
            endif
        endif

        @setvar! SpellInterrupted 0

        if targetexists
            hotkey 'cancel current target'
        endif
        
        if diffhits > ActivateAutoHealHPdiff 
            break
        endif

        if PurplePotionReady = 1 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            @setvar! PurplePotionReady 0
            while not insysmsg "Where should i throw this potion?"
                potion 'explosion'
            endwhile

            settimer PurplePotionTimer 0

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    if warmode on
                        hotkey "Toggle Peace Only"
                    endif
                    @setvar! SpellInterrupted 1
                    hotkey 'cancel current target'
                    break
                endif
            endwhile
            if SpellInterrupted = 0
                target ClosestTarget
                cooldown "Purple Potion" 15000
                getlabel backpack packdesc
                wait 250
            endif
        elseif EnableCastCurse = 1 and timer CurseTimer > CurseCooldown and mana >= 11 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3972 self and findtype 3976 self and findtype 3980 self
            cast 'Curse'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Curse'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if diffhits >= 50
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    if warmode on
                        hotkey "Toggle Peace Only"
                    endif
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD
                    if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                wait 250
                            else
                                if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer orangeMessageTimer 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif
                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    cooldown "Healing Potion" 11000
                                endif
                                if not casting
                                    break
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile

            if SpellInterrupted = 0
                settimer CurseTimer 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                endif
            endif
        elseif EnableCastManaDrain = 1 and timer ManaDrainTimer > ManaDrainCooldown and mana >= 11 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3962 self and findtype 3974 self and findtype 3981 self
            cast 'Mana Drain'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Mana Drain'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if diffhits >= 50
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    if warmode on
                        hotkey "Toggle Peace Only"
                    endif
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD
                    if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                wait 250
                            else
                                if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                                    overhead "{ NO CURE POTS! ]" 337
                                    settimer orangeMessageTimer 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif
                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    cooldown "Healing Potion" 11000
                                endif
                                if not casting
                                    break
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile

            if SpellInterrupted = 0
                settimer ManaDrainTimer 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                endif
            endif
        elseif EnableNecroStrangle = 1 and unholyPoints > 3 and timer StrangleTimer > 30000 and skill 'necromancy' >= 85 and mana >= 50 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'strangle'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer StrangleTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ STRANGLE ]' 333
                endif
                settimer StrangleTimer 0
                cooldown "Strangle" 30000
            endif
        elseif EnableNecroCorpseSkin = 1 and unholyPoints > 1 and timer CorpseSkinTimer > 30000 and skill 'necromancy' >= 65 and mana >= 50 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'corpse skin'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer CorpseSkinTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ CORPSE SKIN ]' 2117
                endif
                settimer CorpseSkinTimer 0
                cooldown "Corpse Skin" 30000
            endif
        elseif EnableNecroEvilOmen = 1 and unholyPoints > 1 and timer EvilOmenTimer > 30000 and skill 'necromancy' >= 60 and mana >= 50 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'evil omen'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer EvilOmenTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ EVIL OMEN ]' 2114
                endif
                settimer EvilOmenTimer 0
                cooldown "Evil Omen" 30000
            endif
        elseif EnableNecroMindRot = 1 and unholyPoints > 4 and timer MindRotTimer > 30000 and skill 'necromancy' >= 75 and mana >= 50 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            while not insysmsg "unholy symbols remaining"
                hotkey 'mind rot'
                getlabel backpack packdesc
                wait 250
                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer MindRotTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ MIND ROT ]' 330
                endif
                settimer MindRotTimer 0
                cooldown "Mind Rot" 30000
            endif
        elseif EnableNecroPainSpike = 1 and unholyPoints > 4 and timer PainSpikeTimer > 30000 and skill 'necromancy' >= 95 and mana >= 50 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 2 and findtype 8198 ground -1 -1 2 as corpsespike
            while not insysmsg "unholy symbols remaining"
                yell "[PainSpike"
                wft 1500
                target corpsespike

                if insysmsg "You do not see any corpses"
                    settimer PainSpikeTimer 28000
                    break
                else
                    settimer PainSpikeTimer 0
                endif

                if insysmsg "seconds before you may use that ability again."
                    @setvar! SpellInterrupted 1
                    settimer PainSpikeTimer 28000
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                if EnableOverheadMessages = 1
                    overhead '[ PAIN SPIKE! ]' 333
                endif
                settimer PainSpikeTimer 0
                cooldown "Pain Spike" 30000
            endif
        elseif EnableCastMagicArrow = 1 and timer MagicArrowTimer > MagicArrowCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 4 and mana < 14 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3980 self
            cast 'magic arrow'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'magic arrow'
            endwhile

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    if warmode on
                        hotkey "Toggle Peace Only"
                    endif
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer MagicArrowTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer MagicArrowTimer 15000
                endif
            endif
        elseif EnableCastHarm = 1 and timer HarmTimer > HarmCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 6 and mana < 14 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3976 self and findtype 3981 self
            cast 'harm'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'harm'
            endwhile

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    if warmode on
                        hotkey "Toggle Peace Only"
                    endif
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer HarmTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer HarmTimer 15000
                endif
            endif
        elseif EnableCastFireball = 1 and timer FireballTimer > FireballCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 9 and mana < 14 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3962 self
            cast 'fireball'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'fireball'
            endwhile

            while not targetexists
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    if warmode on
                        hotkey "Toggle Peace Only"
                    endif
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer FireballTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer FireballTimer 15000
                endif
            endif
        elseif EnableCastLightning = 1 and timer LightningTimer > LightningCooldown and diffhits < ActivateAutoHealHPdiff and mana >= 11 and mana < 14 and not dead ClosestTarget and find ClosestTarget ground -1 -1 12 and findtype 3974 self and findtype 3980 self
            cast 'lightning'
            while not casting
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'lightning'
            endwhile

            @settimer! spellTimer 0
            @setvar! spellCD 800

            while not targetexists
                if diffhits >= 40
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                    if warmode on
                        hotkey "Toggle Peace Only"
                    endif
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif
                if insysmsg "Your concentration is disturbed"
                    interrupt
                    @setvar! SpellInterrupted 1
                    break
                endif

                if timer spellTimer < spellCD
                    if EnableCurePotion = 1
                        while poisoned and casting and not targetexists
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                wait 250
                            else
                                if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                                    overhead "[ NO CURE POTS! ]" 337
                                    settimer orangeMessageTimer 0
                                endif
                                break
                            endif
                        endwhile
                    endif

                    if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0

                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                if insysmsg "potion satchel used"
                                endif
                                dclicktype 3852
                                getlabel backpack packdesc
                                wait 250

                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    cooldown "Healing Potion" 11000
                                endif
                                if not casting
                                    break
                                endif
                            endif
                        else
                            if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                overhead "[ NO HEAL POTS! ]" 337
                                settimer 'yellowMessageTimer' 0
                            endif
                        endif
                    endif
                endif
            endwhile

            if SpellInterrupted = 0
                target ClosestTarget
                getlabel backpack packdesc
                wait 250

                if insysmsg "wizardry"
                    settimer LightningTimer 0
                elseif insysmsg "target cannot be seen"
                    @setvar! ClosestTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer LightningTimer 15000
                endif
            endif
        elseif mana > 20 and diffhits < ActivateAutoHealHPdiff and not dead ClosestTarget and find ClosestTarget ground -1 -1 12
            if diffhits < ActivateAutoHealHPdiff
                @setvar! spellCD 0

                if insysmsg "Mana Thief activated" 
                    cooldown "Mana Thief" 60000
                    clearsysmsg
                endif 

                if EnableCastFlamestrike = 1 and diffmana < 40 and findtype 3981 self and findtype 3980 self
                    cast 'flamestrike'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'flamestrike'
                    endwhile
                    settimer "ExplosionCD" 8000
                    settimer "EnergyBoltCD" 0
                    settimer "MindBlastCD" 0
                    @settimer! spellTimer 0
                    @setvar! spellCD 1400
                elseif EnableCastExplosion = 1 and mana >= 20 and findtype 3963 self and findtype 3974 self and timer "ExplosionCD" > 8000
                    cast 'Explosion'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'Explosion'
                    endwhile
                    settimer "ExplosionCD" 0
                    settimer "EnergyBoltCD" 8000
                    settimer "MindBlastCD" 0
                    @settimer! spellTimer 0
                    @setvar! spellCD 1200
                elseif EnableCastEnergyBolt = 1 and mana >= 20 and findtype 3962 self and findtype 3976 self and timer "EnergyBoltCD" > 8000
                    cast 'energy bolt'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'energy bolt'
                    endwhile
                    settimer "ExplosionCD" 0
                    settimer "EnergyBoltCD" 0
                    settimer "MindBlastCD" 8000
                    @settimer! spellTimer 0
                    @setvar! spellCD 1200
                elseif EnableCastMindblast = 1 and mana >= 20 and findtype 3962 self and findtype 3974 self and findtype 3976 self and findtype 3980 self and timer "MindBlastCD" > 8000
                    cast 'mind blast'
                    while not casting
                        if targetexists
                            hotkey 'cancel current target'
                        endif
                        cast 'mind blast'
                    endwhile
                    settimer "ExplosionCD" 2000
                    settimer "EnergyBoltCD" 0
                    settimer "MindBlastCD" 0
                    @settimer! spellTimer 0
                    @setvar! spellCD 1000
                endif

                while not targetexists and spellCD != 0
                    if mana < 14
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif
                    if diffhits >= ActivateAutoHealHPdiff
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif
                    if dead ClosestTarget and not find ClosestTarget ground -1 -1 12
                        if warmode on
                            hotkey "Toggle Peace Only"
                        endif
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif
                    if insysmsg "Your concentration is disturbed"
                        interrupt
                        @setvar! SpellInterrupted 1
                        break
                    endif

                    if timer spellTimer < spellCD
                        if EnableCurePotion = 1
                            while poisoned and casting and not targetexists
                                if findtype "Orange Potion" self
                                    dclicktype "Orange Potion"
                                    wait 250
                                else
                                    if timer orangeMessageTimer > 4500 and EnableOverheadMessages = 1
                                        overhead "[ NO CURE POTS! ]" 337
                                        settimer orangeMessageTimer 0
                                    endif
                                    break
                                endif
                            endwhile
                        endif

                        if diffhits >= HealPotionHPdiff and EnableHealPotion = 1 and casting and not targetexists
                            if findtype "Yellow Potion" self as hPot
                                getlabel hPot potLabel
                                if "next" in potLabel
                                    // Do nothing
                                else
                                    @setvar! ch 0

                                    if counttype 3852 self as c
                                        @setvar! ch c
                                    endif
                                    if insysmsg "potion satchel used"
                                    endif
                                    dclicktype 3852
                                    getlabel backpack packdesc
                                    wait 250

                                    if ch != counttype 3852 self or insysmsg "potion satchel used"
                                        cooldown "Healing Potion" 11000
                                    endif
                                    if not casting
                                        break
                                    endif
                                endif
                            else
                                if timer 'yellowMessageTimer' > 4500 and EnableOverheadMessages = 1
                                    overhead "[ NO HEAL POTS! ]" 337
                                    settimer 'yellowMessageTimer' 0
                                endif
                            endif
                        endif
                    endif
                endwhile

                if SpellInterrupted = 0 and spellCD != 0
                    target ClosestTarget
                    getlabel backpack packdesc
                    wait 250

                    if insysmsg "target cannot be seen"
                        @setvar! ClosestTarget 0
                        @setvar! currentTarget 0
                        break
                    endif
                endif
            endif
        endif

        if EnableDungeonCleanup = 1 and diffhits < ActivateAutoHealHPdiff 
            while findtype "gold coin|iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 2 as item and timer "DungeonCleanup" > 1000
                if EnableOverheadMessages = 1
                    overhead '[ CLEANUP... ]' 420
                else
                    overhead ' ² ' 420
                endif
                hotkey "Grab Item"
                wft 1000
                target item
                wait 500
                settimer "DungeonCleanup" 0
            endwhile

            if findtype "gold coin|iron ingot%s|board%s|cut up leather|3972|3962|3963|3980|3976|3973|3974|3981" ground -1 -1 10 as dungeonjunk and timer "DungeonCleanupRadar" > 3500
                overhead "¼" 420 dungeonjunk
                settimer "DungeonCleanupRadar" 0
            endif
        endif

        if dead ClosestTarget or not find ClosestTarget ground -1 -1 12
            if warmode on
                hotkey "Toggle Peace Only"
                replay
            endif
        endif

        if EnableArcaneCodexStances != 0 or EnableArcaneCodexFinisher != 0 and diffhits < ActivateAutoHealHPdiff 
            if skill 'Arcane' >= 80 and mana > SwitchArcaneCodexManaMinimum
                if findtype "arcane codex" backpack as MyCodex
                    if not gumpexists 2016719803 and EnableArcaneCodexHotbar = 1
                        while not gumpexists 1066647553
                            say "[CodexHotBar"
                            wait 500
                            if gumpexists 2016719803
                                break
                            endif
                        endwhile
                    endif

                    if EnableArcaneCodexStances = 6
                        if warmode
                            @setvar! SwitchToLeechStance 0
                            @setvar! SwitchToShieldStance 0
                            @setvar! SwitchToScatterStance 0
                            @setvar! SwitchToFractureStance 0
                            @setvar! SwitchToSurgeStance 1
                        elseif cooldown "Frost Shell" or poisoned or findbuff "bleed" or findbuff "disease" or diffhits > 60
                            @setvar! SwitchToLeechStance 0
                            @setvar! SwitchToShieldStance 1
                            @setvar! SwitchToScatterStance 0
                            @setvar! SwitchToFractureStance 0
                            @setvar! SwitchToSurgeStance 0
                        else
                            @setvar! SwitchToLeechStance 1
                            @setvar! SwitchToShieldStance 0
                            @setvar! SwitchToScatterStance 0
                            @setvar! SwitchToFractureStance 0
                            @setvar! SwitchToSurgeStance 0
                        endif
                    elseif EnableArcaneCodexStances = 1
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 1
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 2
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 1
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 3
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 1
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 4
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 1
                        @setvar! SwitchToSurgeStance 0
                    elseif EnableArcaneCodexStances = 5
                        getlabel MyCodex MyCodexDesc
                        @setvar! SwitchToLeechStance 0
                        @setvar! SwitchToShieldStance 0
                        @setvar! SwitchToScatterStance 0
                        @setvar! SwitchToFractureStance 0
                        @setvar! SwitchToSurgeStance 1
                    endif

                    getlabel MyCodex MyCodexDesc

                    if timer "WeaponCodexTimer" > SwitchArcaneCodexCooldown
                        if SwitchToLeechStance = 1
                            if "Leech" in MyCodexDesc
                                // Do nothing
                            else
                                yell [ArcaneStance1
                                settimer "WeaponCodexTimer" 0
                                wait 500
                            endif
                            if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 1
                                if "Drain" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    yell [ArcaneFinisher1
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            elseif EnableArcaneCodexFinisher = 2
                                if "Catalyst" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    yell [ArcaneFinisher2
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                               endif
                            endif
                        elseif SwitchToShieldStance = 1
                            if "Shield" in MyCodexDesc
                                // Do nothing
                            else
                                yell [ArcaneStance2
                                settimer "WeaponCodexTimer" 0
                                wait 500
                            endif
                            if EnableArcaneCodexFinisher = 2
                                if "Catalyst" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    yell [ArcaneFinisher2
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            elseif EnableArcaneCodexFinisher = 1 or EnableArcaneCodexFinisher = 3
                                if "Drain" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    yell [ArcaneFinisher1
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            endif
                        elseif SwitchToScatterStance = 1
                            if "Scatter" in MyCodexDesc
                                // Do nothing
                            else
                                yell [ArcaneStance3
                                settimer "WeaponCodexTimer" 0
                                wait 500
                            endif
                            if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 2
                                if "Catalyst" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    say [ArcaneFinisher2
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            elseif EnableArcaneCodexFinisher = 1
                                if "Drain" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    say [ArcaneFinisher1
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            endif
                        elseif SwitchToFractureStance = 1
                            if "Fracture" in MyCodexDesc
                                // Do nothing
                            else
                                yell [ArcaneStance4
                                settimer "WeaponCodexTimer" 0
                                wait 500
                            endif
                            if EnableArcaneCodexFinisher = 1
                                if "Drain" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    say [ArcaneFinisher1
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            elseif EnableArcaneCodexFinisher = 2 or EnableArcaneCodexFinisher = 3
                                if "Catalyst" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    yell [ArcaneFinisher2
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                               endif
                            endif
                        elseif SwitchToSurgeStance = 1
                            if "Surge" in MyCodexDesc
                                // Do nothing
                            else
                                yell [ArcaneStance5
                                settimer "WeaponCodexTimer" 0
                                wait 500
                            endif
                            if EnableArcaneCodexFinisher = 3 or EnableArcaneCodexFinisher = 2
                                if "Catalyst" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    say [ArcaneFinisher2
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            elseif EnableArcaneCodexFinisher = 1
                                if "Drain" in MyCodexDesc
                                    // Do nothing
                                elseif DisableWeaponFinisher != 1
                                    say [ArcaneFinisher1
                                    @setvar! DisableWeaponFinisher 0
                                    settimer "WeaponCodexTimer" 0
                                    wait 500
                                    if insysmsg "You must first reach rank 5"
                                        @setvar! DisableWeaponFinisher 1
                                    endif
                                endif
                            endif
                        endif
                    endif
                endif
            endif
        endif

        if EnableShieldCodexStances != 0 and mana > SwitchShieldCodexManaMinimum and diffhits < ActivateAutoHealHPdiff 
            if skill "Parrying" >= 80 and findtype "shield codex" backpack as ShieldCodex
                if not gumpexists 2016719803 and EnableShieldCodexHotbar = 1
                    while not gumpexists 1066647553
                        say "[CodexHotBar"
                        wait 500
                        if gumpexists 2016719803
                            break
                        endif
                    endwhile
                endif

                if EnableShieldCodexStances = 6
                    if warmode
                        @setvar! SwitchToShieldBashStance 0
                        @setvar! SwitchToWardingStance 0
                        @setvar! SwitchToTestudoStance 0
                        @setvar! SwitchToMirrorStance 0
                        @setvar! SwitchToBulwarkStance 1
                    elseif cooldown "Frost Shell" or findbuff "bleed" or findbuff "disease" or poisoned or diffhits > 60
                        @setvar! SwitchToShieldBashStance 0
                        @setvar! SwitchToWardingStance 1
                        @setvar! SwitchToTestudoStance 0
                        @setvar! SwitchToMirrorStance 0
                        @setvar! SwitchToBulwarkStance 0
                    else
                        @setvar! SwitchToShieldBashStance 1
                        @setvar! SwitchToWardingStance 0
                        @setvar! SwitchToTestudoStance 0
                        @setvar! SwitchToMirrorStance 0
                        @setvar! SwitchToBulwarkStance 0
                    endif
                elseif EnableShieldCodexStances = 1
                    @setvar! SwitchToShieldBashStance 1
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 2
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 2
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 3
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 1
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 4
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 1
                    @setvar! SwitchToBulwarkStance 0
                elseif EnableShieldCodexStances = 5
                    @setvar! SwitchToShieldBashStance 0
                    @setvar! SwitchToWardingStance 0
                    @setvar! SwitchToTestudoStance 0
                    @setvar! SwitchToMirrorStance 0
                    @setvar! SwitchToBulwarkStance 1
                endif

                getlabel ShieldCodex ShieldCodexDesc

                if EnableShieldCodexStances != 0 or EnableShieldCodexFinisher != 0
                    if timer "ShieldCodexTimer" > SwitchShieldCodexCooldown
                        if SwitchToWardingStance = 1
                            if "Warding" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance2
                                settimer "ShieldCodexTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 2 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 1 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToMirrorStance = 1
                            if "Mirror" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance4
                                settimer "ShieldCodexTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToBulwarkStance = 1
                            if "Bulwark" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance5
                                settimer "ShieldCodexTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToTestudoStance = 1
                            if "Testudo" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance3
                                settimer "ShieldCodexTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3 and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        elseif SwitchToShieldBashStance = 1
                            if "Shield Bash" in ShieldCodexDesc
                                // Do nothing
                            else
                                yell [ShieldsStance1
                                settimer "ShieldCodexTimer" 0
                                wait 500
                            endif

                            if EnableShieldCodexFinisher != 0
                                if EnableShieldCodexFinisher = 2 and DisableShieldFinisher != 1
                                    if "Barrier" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        say [ShieldsFinisher2
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                elseif EnableShieldCodexFinisher = 1 or EnableShieldCodexFinisher = 3  and DisableShieldFinisher != 1
                                    if "Last Stand" in ShieldCodexDesc
                                        // Do nothing
                                    else
                                        yell [ShieldsFinisher1
                                        settimer "ShieldCodexTimer" 0
                                        wait 500
                                        if insysmsg "You must first reach rank 5"
                                            @setvar! DisableShieldFinisher 1
                                        endif
                                    endif
                                endif
                            endif
                        endif
                    endif
                endif
            endif
        endif

        if skill "Arcane" >= 80 and EnableArcaneWeaponAbility != 0 and diffhits < ActivateAutoHealHPdiff 
            if EnableArcaneCodexAbilityHotbar = 1
                if not gumpexists 3954121934
                    yell '[abilitieshotbar'
                    wait 500
                endif
            endif
            if timer ArcaneWeaponAbilityTimer > 60000
                if EnableArcaneWeaponAbility = 1
                    if mana < UseArcaneWeaponAbilityManaSP
                        say "[Weaponability1"
                        getlabel backpack packdesc
                        wait 500
                        if insysmsg "You cannot perform that ability yet"
                            settimer ArcaneWeaponAbilityTimer 55000
                        else
                            settimer ArcaneWeaponAbilityTimer 0
                            if EnableOverheadMessages = 1
                                overhead "[ SEEKING ABILITY! ]" 2114
                            endif
                            cooldown "Seeking Active" 15000
                            cooldown "Seeking" 60000
                        endif
                    endif
                elseif EnableArcaneWeaponAbility = 2
                    if mana < UseArcaneWeaponAbilityManaSP
                        say "[Weaponability2"
                        getlabel backpack packdesc
                        wait 500
                        if insysmsg "You cannot perform that ability yet"
                            settimer ArcaneWeaponAbilityTimer 55000
                        else
                            settimer ArcaneWeaponAbilityTimer 0
                            if EnableOverheadMessages = 1
                                overhead "[ LEYLINE ABILITY! ]" 2115
                            endif
                            cooldown "Leyline Active" 15000
                            cooldown "Leyline" 60000
                        endif
                    endif
                elseif EnableArcaneWeaponAbility = 3
                    if mana < UseArcaneWeaponAbilityManaSP
                        say "[Weaponability3"
                        getlabel backpack packdesc
                        wait 500
                        if insysmsg "You cannot perform that ability yet"
                            settimer ArcaneWeaponAbilityTimer 55000
                        else
                            settimer ArcaneWeaponAbilityTimer 0
                            if EnableOverheadMessages = 1
                                overhead "[ SOULFIRE ABILITY! ]" 2116
                            endif
                            cooldown "Soulfire" 60000
                        endif
                    endif
                endif
            endif
        endif

        if mana < LowManaWarningAmount and timer ManaOverheadTimer > 4500 and LowManaWarningAmount != 0
            overhead "[ LOW MANA! ]" 34
            settimer ManaOverheadTimer 0
        endif
        
         if diffhits > ActivateAutoHealHPdiff 
             break
         endif
    endwhile

    @setvar! NeedtoSecureLoot 1

    ///////////////////////
    //  END ATTACK LOOP  //
    ///////////////////////

endwhile

//////////////////////
//  END ALIVE LOOP  //
//////////////////////


/////////////////////////
//  BEGIN DEATH LOOP:  //
/////////////////////////

if dead
    if EnableOverheadMessages = 1
        overhead "[ R.I.P. ]" 337
    endif
    wait 1500

    while dead
        @setvar! IHAVEDIED 1
        wait 500
        if timer "HEALERSEARCH" > 4000
            overhead "[ FIND A HEALER! ]" 0
            settimer "HEALERSEARCH" 0
        endif

        if findtype "blue moongate|30528|moongate" ground -1 -1 12 as EscapeGate
            if timer "GATEHERE" > 2000
                overhead " ¼ " 253 EscapeGate
                settimer "GATEHERE" 0
            endif
        endif

        while not gumpexists 3773199800 and findtype "blue moongate|30528|moongate" ground 0 1 2 as EscapeGate
            dclick EscapeGate
            wait 500
        endwhile

        while gumpexists 3773199800
            gumpresponse 16
            wait 500
            waitforgump 3773199800
            gumpresponse 2
            overhead "[ GATING TO TOWN... ]" 88
            break
        endwhile

        while gumpexists 2957810225
            overhead "[ HEALED! ]" 84
            gumpresponse 1
            wait 1000
            gumpclose 2957810225

            if EnableDressAfterResurrection = 1
                wait 500
                dress 'ArcaneMage'
                wait 500
                while queued
                    wait 100
                endwhile
                wait 1000
                dress 'ArcaneMage'
            endif

            if EnableRecallAfterResurrection = 1
                hotkey 'Toggle War Only'
                @setvar! ResThenTimeToGo 1
                wait 1000
                replay
            else
                wait 2500
                overhead "[ STOPPING SCRIPT! ]" 88
                stop
            endif
        endwhile
    endwhile
endif
replay

//////////////////////
//  END DEATH LOOP  //
//////////////////////



     ################
    ###  THE END!  ###
     ################
     
     
     
     
     