# This is an automated backup - check out https://outlands.uorazorscripts.com/script/d6b286a7-bebf-470b-a1ba-7d3a80114a79 for latest
# Automation by Jaseowns
## Script: Bapeth's Modern Dungeon Picker
## Created by: barryroser#0
#############################################

# "***Bapeths Modern Dungeon Picker***"
# Updated Sept 22nd 2024 (Auto Detect & Skin Corpses + Auto Recycle)
#
# "***READ THIS***READ THIS***READ THIS***READ THIS***"
#
# "***REQUIRED SETTINGS***"
#
# "In Game Dungeon Chest Menu"
# "Continuous Lockpicking" and "Continuous Remove Trap" must be checked in the lockpicking gump menu
# This gump menu appears when you attempt to open a chest
#
# "Auto Loot Control"
# This script uses razor "Auto-Queue Object Delay" setting
# Make sure this setting is turned ON in the razor Options tab > Targeting & Queues sub-tab
# And set "object delay to 503" AUTO LOOTING WILL BE SLOW IF YOU DONT DO THIS!
#
# "Cooldowns"
# This script uses three cooldowns called "Hiding" "Stealth" and "Stealing" (Stealing only for Pilfering)
# Create these in the in-game options menu under Cooldowns and they must be spelled correctly
# Sometimes a full game restart is needed if cooldowns are edited
#
# "***OPTIONAL SETTINGS***"
#
# "Time Dungeon Locked Doors"
# You can now toggle "WARMODE ON" when within range of a locked "Time Dungeon Door" to automatically lockpick it
# This will use any random lockpick type you have in your pack
#
#"Smoke Bomb Cooldown" for Stealth Pilfering
# Create a cooldown called "Smoke Bomb" (note the space), must be spelled exactly like that
# Default cooldown is set to minimum cooldown time of 60 seconds (This assumes you have 3 points in "Without a Trace")
# This can be edited by searching (ctrl + f) "60000" and replacing it with your personal cooldown timer that matches your thieves codex
# Possible timers for smoke bomb are "60000", "80000", "100000", or "120000" (this is milliseconds)
#
# "Wizard Hat Stealth Trick" - prevents you from stumbling over a player/mob while moving in stealth
# It is recommended to have in your pack a "Blessed and Aspected Armored Magical Wizard Hat" (Purchaseable at prev vendor)
# Alternatively you can buy a cheap "Magical Wizards Hat" from the Mage NPC in town (non-aspectable)
# This is for the stealth part of the script
# It will quick swap your hat and reduce your stamina
# If your hat ever gets stuck in a "spam loop"
# Go to Script tab > Options subtab and delete "bwiz" "bmain" and "nonaspectedwiz"
#
# "Auto Pilfer and Hide/Stealth Blocking"
# Toggle "WARMODE ON" for "AUTO-PILFER" - It is best to use the "TAB" button and ensure that "TAB" is set to toggle in UO options
# Toggle "WARMODE ON" to block the scripts smart hide/stealth feature (use for "Boss Room Custodians" and saving cooldown time)
#
# "Auto Chest Protection"
# "ACP" feature will instantly cast (Minimum "50 Magery" required to use)
# Wall of stone, Earth Elemental, Tele + Rope, or Reveal when you are detected
# Does not work when player is revealed by the reveal spell
# Toggle "Wall" "Earth" "Tele" "Reveal" or "None" by doubleclicking an "Atlas"
# Type "[Atlas" in game to spawn a free weightless "Atlas" in your bag
# Hotkey "Grants the player an Atlas" in razor hotkey tab if you dont want to doubleclick
#
# "Auto-Recycler"
# This feature will auto recycle bad items and keep the good ones - To use this feature:
# You must be carrying at least one "Container ID wand" and at least one "recycler tool" type (Tinker Tools, Sewing Kit, Saw, Tongs, or Scribes Pen)
# You must be carrying "scissors" (suggest blessed scissors in an Adventure Satchel so not to incur any extra weight)
# "Double click scissors" while the script is playing to activate the Auto-Recycler (Blocked while actively picking chest)
# ID wand will ID your "Main Layer Backpack" and recycle from there only
# If you want to edit the items that the script keeps - change "line 1403"
#
# "Lootbag"
# Set by using the razor hotkey "Set Grab Item Hotbag"
# Note : All items not in your "Main Backpack Layer" are ignored by the "Auto-Recycler"
#
# "Auto Detect & Skin Corpses"
# If you have a skinning knife and 50 or more "Forensic Evaluation"
# The script will show corpses and auto skin them when in range
# This feature is "Blocked in Warmode"
#
# "Auto Stealth"
# This is an in game setting that is reccomended to be turned ON
# Toggle this on and off by typing [AutoStealth in game
#
# "Spam Reduction"
# Options tab > Targeting & Queues subtab > Uncheck "Attack/Target name overhead"
# Filters tab > Text & Messages subtab > Check "Filter Repeating Razor Messages" ONLY
# 
# "Summoners Name Your Elemental"                                                         
# See "line 119 & 129" if you would like to custom name your earth elemental(s)
# Default is "LootGolem"
#
# -------------------------------"Recommended Builds"-------------------------------
# --"Pilfer Ninja"---------"Fat Ninja"----------"Summoner"--------"Pilfer Skinner"--
# Detect Hidden - 120  Detect Hidden - 120  Detect Hidden - 120  Forensic Eval-- 120
# Lockpicking ----120  Lockpicking ----120  Lockpicking ----120  Stealth ------- 120
# Stealth ------- 120  Stealth ------- 100  Stealth ------- 120  Hiding -------- 100
# Hiding -------- 100  Hiding -------- 100  Hiding -------- 100  Stealing ------ 100
# Magery --------- 80  Magery --------- 80  Magery -------- 100  Snooping ------ 100
# Camping -------- 80  Camping ------- 120  Camping -------- 80  Meditation ---- 100
# Stealing ------ 100  Stealing ------- 80  Spirit Speak --- 80  Magery --------- 80
#
# "Recommended Aspects, Links, and Codex/Tome"
# Harvest or Fortune Aspect (high end tools needed for Fortune and or low level aspect)
# Special/Rare loot Chance Links (Max 20) & Chest Success Chances/Progress Links (Max 10)
# If you Summon "Spirit Pact" and "Earthpull" upgrades are recommended (Summoner Tome)
# If you Steal and are going for chests only:  3pts "Overlooked" and 3pts "Without a Trace" is recommended (Thieves Codex)
# If you Steal and are Pilfering: 3pts "Camouflage" 3pts "Shadow Hands" and 3pts "Extortion" is recommended (Thieves Codex)
# Lockpicking/Detect can be lowered slightly to raise Camping if high end tools are used
#
# "Notes on Rares"
# Not all "Rares" are on the auto loot list
# Keep an eye out for unlooted rares
# I update the list as I find them
#
# "Notes on error" 
# "Screen transitions" and "teleporting far distances" will on occasion error the script 
# This is a bug in razor, simply play the script again if this happens
# It helps to make a habit of replaying the script often to ensure its always playing
# I recommend, if you know how to, loop this script into your other commonly used scripts
#
# "Script Starts Here"
if skill "Spirit Speak" >= 80 and findtype "an earth elemental" ground -1 -1 1 as Summon
    if not find "bsummon1" ground -1 -1
        while findtype "an earth elemental" ground -1 -1 1 as bsummon1
            if noto bsummon1 = "friend"
                @setvar "bsummon1" bsummon1
                # Name your summon if you like (no spaces must be unique)
                rename bsummon1 "LootGolem"
            endif
            break
        endwhile
        getlabel backpack ping
    elseif not find "bsummon2" ground -1 -1
        while findtype "an earth elemental" ground -1 -1 1 as bsummon2
            if noto bsummon2 = "friend"
                @setvar "bsummon2" bsummon2
                # Name your summon if you like (no spaces must be unique)
                rename bsummon2 "LootGolem"
            endif
            break
        endwhile
    endif
endif

if not varexist "bwiz" and findlayer self head as hat
    getlabel hat desc
    if "magical" in desc
        overhead "I should keep my wizard hat in my pack..." 36
        stop
    endif
endif

if not find "bwiz" backpack and findtype 5912 backpack as bwiz
    @setvar "bwiz" bwiz
    getlabel bwiz desc
    if "armored" in desc
        //donothing
    else 
        @setvar "nonaspectedwiz" bwiz
    endif
endif

if not find "bmain" self and findlayer self head as hat
    @setvar "bmain" hat
endif

if not varexist "bmain"
    overhead "I will need a hat to wear..." 38
    overhead "It can not be a magical wizard hat..." 38
    stop
endif

if skill "Lockpicking" >= 50 and not findtype "lockpicks" backpack and not timerexists lockpickcheck
    overhead "I have no Lockpicks..." 38
    createtimer lockpickcheck
endif
if timerexists lockpickcheck
    if timer lockpickcheck > 7000
        overhead "I have no Lockpicks..." 38
        settimer lockpickcheck 0
    endif
endif
if findtype "lockpicks" backpack
    removetimer lockpickcheck
endif

if skill "Detect" >= 50 and not findtype "drill" backpack and not timerexists drillcheck
    overhead "I have no Removal Tool..." 38
    createtimer drillcheck
endif
if timerexists drillcheck
    if timer drillcheck > 7000
        overhead "I have no Removal Tool..." 38
        settimer drillcheck 0
    endif
endif
if findtype "drill" backpack
    removetimer drillcheck
endif

if timerexists ots
    removetimer ots
endif

if timerexists bchestopen
    removetimer bchestopen
endif

if not timerexists tab
    createtimer tab
endif

if not timerexists getpilf
    createtimer getpilf
endif

if not timerexists spellinvis
    createtimer spellinvis
    settimer spellinvis 1200
endif

if not timerexists ACPcheck
    createtimer ACPcheck
endif

if not timerexists rptimer
    createtimer rptimer
endif

if skill "Magery" >= 80
    if timerexists reflect and not findbuff "Magic Reflection"
        if timer reflect > 30000
            overhead "Magic Reflect is ready..." 201
            settimer reflect 12000
        endif
    endif
    if findbuff "Magic Reflection" and timerexists reflect
        removetimer reflect
    endif
    if not findbuff "Magic Reflection" and not timerexists reflect
        createtimer reflect
    endif
endif

if skill "Magery" >= 20
    if timerexists reactive and not findbuff "Reactive Armor"
        if timer reactive > 30000
            overhead "Reactive Armor is ready..." 139
            settimer reactive 13500
        endif
    endif
    if findbuff "Reactive Armor" and timerexists reactive
        removetimer reactive
    endif
    if not findbuff "Reactive Armor" and not timerexists reactive
        createtimer reactive
    endif
endif

if not hidden and not timerexists brew and findbuff "Bleed" and findtype 50675 backpack as cbrew
    pause 1200
    dclick cbrew
    createtimer brew
elseif not hidden and not timerexists brew and findbuff "Diseased" and findtype 50675 backpack as cbrew
    while queued
        //donothing
    endwhile
    pause 650
    dclick cbrew
    createtimer brew
endif
if timerexists brew
    if timer brew >= 120000
        removetimer brew
    endif
endif

if not hidden and findbuff "Weaken" and not targetexists and findtype "White Potion" backpack as stpot
    while queued
        //donothing
    endwhile
    dclick stpot
endif

if not hidden and insysmsg "You are carrying too much weight" and not findbuff "Strength" and findtype "White Potion" backpack as wpot
    while queued
        //donothing
    endwhile
    dclick wpot
endif

if not hidden and stam <= 1 and timer rptimer > 1200 and findbuff "Strength" and findtype "Red Potion" backpack as redpot
    if counttype "Red Potion" >= 1
        while queued
            //donothing
        endwhile
        dclick redpot
        settimer rptimer 0
    endif
endif

if not hidden and paralyzed and not targetexists and findtype "pouch" backpack 38
    say "[Pouch"
endif

if not hidden and poisoned and not targetexists and findtype "Orange Potion" backpack as curepot
    while queued
        //donothing
    endwhile
    dclick curepot
endif
    
if not gumpexists 736038070 and skill "Lockpicking" >= 50 
    for 18
        if index > 0 and findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 index as chest
            getlabel chest desc
            if "lock" in desc
                overhead "{{desc}}" 2085 chest
                break
            else 
                overhead "{{desc}}" 1779 chest
                @ignore chest
            endif
        endif
    endfor
    @clearignore
endif

if warmode and findtype "barred metal door|metal door" ground -1 -1 2 as doorlock
    if findtype 5373 backpack as picks
        clearsysmsg 
        overhead "Time is of the essence..." 67
        for 2000
            dclick picks
            wft 1000
            target doorlock
            getlabel backpack ping
            if insysmsg "That is not locked"
                warmode "off"
                getlabel backpack ping
                break
            endif
            if insysmsg "Target cannot be seen"
                warmode "off"
                getlabel backpack ping
                break
            endif
            pause 3150
            if insysmsg "You pick the lock!"
                overhead "What lay beyond this door..." 87
                dclick doorlock
                warmode "off"
                getlabel backpack ping
                break
            endif
            if not findtype 5373 backpack
                overhead "Argh, it was my last pick..." 38
                warmode "off"
                getlabel backpack ping
                break
            endif
            if not findtype "barred metal door" ground -1 -1 2
                warmode "off"
                getlabel backpack ping
                break
            endif
            if not warmode 
                break
            endif
            if insysmsg "You have worn out your tool"
                overhead "This tool is worn out!" 805
            endif
            if insysmsg "fail"
                //do nothing
            elseif insysmsg "You pick the lock!"
                overhead "*pop*" 2091 bchest
                //do nothing
            elseif insysmsg  "You must remain stationary"
                //do nothing
            else
                warmode "off"
                getlabel backpack ping
                break
            endif
        endfor
     else 
         overhead "I am out of lockpicks!" 38
         warmode "off"
         getlabel backpack ping
     endif
endif

if skill "Stealing" >= 80 and warmode
    if timer getpilf >= 600
        settimer getpilf 0
        for 12
            hotkey 'Target Closest Murderer Monster'
            hotkey 'Next Grey Monster Target'
            @setvar pilfertarget lasttarget
            if find pilfertarget ground -1 -1 2
                overhead "Pilfer target acquired..." 2085
                getlabel pilfertarget desc
                overhead desc 1161
                break
            endif
        endfor
    endif
    if hidden
        while find pilfertarget ground -1 -1 2
            if not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing"
                clearsysmsg 
                if not targetexists 
                    if not timerexists repeatinvis and findbuff "Invisibility"
                        settimer spellinvis 0
                    endif
                    skill "Stealing"
                    wft 1000
                    target pilfertarget
                    hotkey 'Cancel Current Target'
                endif
                getlabel backpack ping
                break
            endif
            if not warmode 
                break
            endif
        endwhile 
        if insysmsg "You Steal"
            overhead "The goods are mine!" 2091
            cooldown "Stealing" 5000
            removetimer repeatinvis
            warmode off
            if not hidden
                if skill "Stealth" >= 80 and not cooldown "Smoke bomb" and not cooldown "Hiding" and not cooldown "Stealth" and findtype 52149 backpack as sbombs
                    while queued
                        //donothing
                    endwhile
                    dclick sbombs
                    getlabel backpack ping
                    if hidden
                        if not cooldown "Smoke bomb"
                            cooldown "Smoke bomb" 60000
                        endif
                    else 
                        overhead "I teleported too recently to Smoke..." 45
                    endif
                endif
                if timer spellinvis >= 1200 and not hidden and skill "Magery" >= 80 and mana >= 20
                    hotkey 'Cancel Current Target'
                    cast "Invisibility"
                    wft 3000
                    target self
                    warmode on
                    warmode off
                    hotkey 'Cancel Current Target'
                endif
            endif
        endif
        if insysmsg "The creature is barren"
            overhead "Another thief beat me to it..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "That is too far away"
            overhead "Argh, not close enough..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "Target cannot be seen"
            overhead "Argh, I cant see it..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "You have already stolen"
            overhead "I have already pilfered this..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "You fail"
            overhead "Argh, I failed to Pilfer..." 1779
            warmode off
            cooldown "Stealing" 5000
            if skill "Stealth" >= 80 and not cooldown "Smoke bomb" and not cooldown "Hiding" and not cooldown "Stealth" and findtype 52149 backpack as sbombs
                while queued
                    //donothing
                endwhile
                dclick sbombs
                getlabel backpack ping
                if hidden
                    if not cooldown "Smoke bomb"
                        cooldown "Smoke bomb" 60000
                    endif
                else 
                    overhead "I teleported too recently to Smoke..." 45
                endif
            endif
            if timer spellinvis >= 1200 and not hidden and skill "Magery" >= 80 and mana >= 20
                hotkey 'Cancel Current Target'
                cast "Invisibility"
                wft 3000
                target self
                warmode on
                warmode off
                hotkey 'Cancel Current Target'
                createtimer repeatinvis
            endif
        endif
    elseif not hidden
        while find pilfertarget ground -1 -1 2
            if not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing"
                clearsysmsg 
                if not targetexists 
                    skill "Stealing"
                    wft 1000
                    target pilfertarget
                    hotkey 'Cancel Current Target'
                endif
                getlabel backpack ping
                break
            endif
        endwhile 
        if insysmsg "retaliate"
            overhead "Argh, I failed to Pilfer" 1779
            cooldown "Stealing" 5000
            warmode off
            if not hidden and findtype "yellow potion" backpack as healpot
                while queued
                    //donothing
                endwhile
                dclick healpot
            endif
        endif
        if insysmsg "You Steal"
            overhead "I Pilfer Thee!" 68
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "The creature is barren"
            overhead "Another thief beat me to it..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "That is too far away"
            overhead "Argh, not close enough..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "Target cannot be seen"
            overhead "Argh, I cant see it..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
        if insysmsg "You have already stolen"
            overhead "I have already pilfered this..." 1779
            cooldown "Stealing" 5000
            warmode off
        endif
    endif
endif

if gumpexists 736038070
    gumpclose 736038070
endif

if findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2 as bchest and not targetexists 
    clearsysmsg 
    if not warmode 
        warmode on
        warmode off
    endif
    dclick bchest
    @setvar "bchest" lastobject
    waitforgump 736038070 1000
    if gumpexists 736038070 and not ingump "Cleared Of Traps"
        while gumpexists 736038070
            gumpresponse 7
            waitforgump 736038070 1000
            if insysmsg "You attempt to remove traps"
                clearsysmsg
                break
            endif
            if insysmsg "That appears to be devoid"
                clearsysmsg
                break
            endif
            if not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endwhile
        if not hidden
            if followers >= 1
                if find "bsummon1"
                    menu bsummon1 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon2"
                        menu bsummon2 2
                        wft 1000
                        target self  
                    endif
                elseif find "bsummon2"
                    menu bsummon2 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon1"
                        menu bsummon1 2
                        wft 1000
                        target self  
                    endif
                endif
            endif
            if not warmode and not cooldown "Hiding" and not cooldown "Stealth" and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endif
        overhead "*disarming*" 1060 bchest
        while not dead
            if not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
            if findbuff "Invisibility" and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                    removetimer ots
                endif
            endif
            if not warmode and hidden and not cooldown "Hiding" and not cooldown "Stealth" and not timerexists ots and skill "Stealth" >= 80
                skill "Stealth"
                getlabel backpack ping
                if not timerexists ots
                    createtimer ots
                endif
            endif
            if insysmsg "move quietly"
                getlabel backpack ping
                cooldown "Stealth" 10000
            endif
            if hidden and not cooldown "Hiding" and not cooldown "Stealth" and insysmsg "hide first" and skill "Hiding" >= 80
                pause 1000
                getlabel backpack ping
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
                removetimer ots
            endif
            if insysmsg  "You have successfully cleared it of traps"
                overhead "*tick*" 2091 bchest
                break
            endif
            if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
                break
            endif
            if find "bchest" ground -1 -1 2
# Note for author:
# The break here will not work on special Urkton Chests or possibly new Time Dungeon chests.
# It is not a big deal as this part is only for a specific sceanario in which another player
# opens a chest while you are trying to snatch their chest.  It will break into looting instantly.
# I still want to figure out a better way here.
                getlabel bchest desc
                if "wooden" in desc
                    //do nothing
                elseif "metal" in desc
                    //do nothing
                elseif "lock" in desc
                    //do nothing
                else 
                    overhead "*pop*" 2091 bchest
                    break
                endif
            endif
            if ingump "Cleared Of Traps"
                overhead "*tick*" 2091 bchest
                break
            endif
            if timer tab > 1000
                if not warmode 
                    warmode on
                    warmode off
                endif
                settimer tab 0
            endif
            if insysmsg "You make some progress towards clearing it of traps"
                overhead "*clink*" 810 bchest
            endif
            if insysmsg "You have worn out your tool"
                overhead "This tool is worn out!" 805
            endif
            if not targetexists and not casting and skill "Stealth" >= 80 and hidden and stam = maxstam and findtype 5912 self
                while not queued
                    if findlayer self head as hat
                        getlabel hat desc
                        if "magical" in desc
                            dclick "bmain"
                        else 
                            dclick "bwiz"
                            pause 500
                            getlabel backpack ping
                            dclick "bmain"
                        endif
                    endif
                    break
                endwhile
            endif
            if not targetexists and not casting and not findlayer self head
                while not queued
                    dclick "bmain"
                    break
                endwhile
            endif
            if not targetexists and not casting and findlayer self head as hat
                getlabel hat desc
                if "magical" in desc
                    while not queued
                        dclick "bmain"
                        break
                    endwhile
                endif
            endif
            if ingump "Shrines"
                if not timerexists "Wacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Wall of Stone ACP ------Enabled------" 2031
                    createtimer "Wall"
                    createtimer "Wacp"
                    removetimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Eacp" and skill "Spirit Speak" >= 80 and skill "Magery" >= 100
                    gumpclose 341416395
                    overhead "Earth Elemental ACP ------Enabled------" 1501
                    createtimer "Elemental"
                    createtimer "Eacp"
                    removetimer "Nacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Tacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Teleport + Rope ACP ------Enabled------" 1272
                    createtimer "Tele"
                    createtimer "Tacp"
                    removetimer "Nacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "None" 
                    removetimer "Reveal"  
                elseif not timerexists "Racp" and skill "Magery" >= 80
                    gumpclose 341416395
                    overhead "Reveal Spellcast ACP ------Enabled------" 2040
                    createtimer "Racp"
                    createtimer "Reveal"
                    removetimer "Nacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"  
                    removetimer "None"    
                elseif not timerexists "Nacp"
                    gumpclose 341416395
                    overhead "Auto Chest Protection ------Disabled------" 38
                    createtimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Wacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "Reveal" 
                endif
            endif
            if insysmsg "You have been revealed!" 
                if timerexists "Tele" and mana >= 9
                    say "[Spit"
                    cast 'Teleport'
                    if findtype "rope" backpack as rope
                        dclick rope
                    else 
                        overhead "I am out of rope..." 34
                    endif
                    removetimer "Tacp"
                    removetimer "Tele"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Wacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                endif
                if timerexists "Wall" and mana >= 9
                    say "[Yell"
                    cast 'Wall of Stone'
                    removetimer "Wacp"
                    removetimer "Wall"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                endif
                if timerexists "Elemental" and mana >= 50
                    say "[Anger"
                    cast 'Earth Elemental'
                    removetimer "Eacp"
                    removetimer "Elemental"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                endif
                if timerexists "Reveal" and mana >= 20
                    say "[Surprise"
                    cast 'Reveal'
                    removetimer "Racp"
                    removetimer "Reveal"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Eacp"
                    dclicktype "atlas" backpack
                endif
            endif
            if timer ACPcheck > 42000
                if timerexists "Tele"
                    overhead "Teleport ACP active" 1272
                endif
                if timerexists "Wall"
                    overhead "Wall ACP active" 2031
                endif
                if timerexists "Elemental"
                    overhead "Elemental ACP active" 1501
                endif
                if timerexists "Reveal"
                    overhead "Reveal ACP active" 2040
                endif
                settimer ACPcheck 0
            endif
            if insysmsg "Another player"
                while gumpexists 736038070
                    replay
                endwhile
            endif
        endwhile
        waitforgump 736038070 1000
    endif
    if gumpexists 736038070 and ingump "Cleared Of Traps"
        while gumpexists 736038070
            gumpresponse 4
            waitforgump 736038070 1000
            if insysmsg "You attempt to pick the lock"
                clearsysmsg
                break
            endif
            if insysmsg "It appears to be unlocked"
                clearsysmsg
                break
            endif
            if not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endwhile
        if not hidden
            if followers >= 1
                if find "bsummon1"
                    menu bsummon1 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon2"
                        menu bsummon2 2
                        wft 1000
                        target self  
                    endif
                elseif find "bsummon2"
                    menu bsummon2 2
                    wft 1000
                    target self
                    getlabel backpack ping
                    if find "bsummon1"
                        menu bsummon1 2
                        wft 1000
                        target self  
                    endif
                endif
            endif
            if not warmode and not cooldown "Hiding" and not cooldown "Stealth" and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
        endif
        overhead "*picking*" 1060 bchest
        while not dead
            if not hidden and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                warmode on
                warmode off
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
            endif
            if findbuff "Invisibility" and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and not warmode and skill "Hiding" >= 80
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                    removetimer ots
                endif
            endif
            if not warmode and hidden and not cooldown "Hiding" and not cooldown "Stealth" and not timerexists ots and skill "Stealth" >= 80
                skill "Stealth"
                getlabel backpack ping
                if not timerexists ots
                    createtimer ots
                endif
            endif
            if insysmsg "move quietly"
                getlabel backpack ping
                cooldown "Stealth" 10000
            endif
            if hidden and not cooldown "Hiding" and not cooldown "Stealth" and insysmsg "hide first" and skill "Hiding" >= 80
                pause 1000
                getlabel backpack ping
                skill "Hiding"
                getlabel backpack ping
                if hidden
                    getlabel backpack ping
                    cooldown "Hiding" 10000
                endif
                removetimer ots
            endif
            if insysmsg "You successfully pick the lock"
                overhead "*pop*" 2091 bchest
                break
            endif
            if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
                break
            endif
            if find "bchest" ground -1 -1 2
# Note for author:
# The break here will not work on special Urkton Chests or possibly new Time Dungeon chests.
# It is not a big deal as this part is only for a specific sceanario in which another player
# opens a chest while you are trying to snatch their chest.  It will break into looting instantly.
# I still want to figure out a better way here.
                getlabel bchest desc
                if "wooden" in desc
                    //do nothing
                elseif "metal" in desc
                    //do nothing
                elseif "lock" in desc
                    //do nothing
                else 
                    overhead "*pop*" 2091 bchest
                    break
                endif
            endif
            if timer tab > 1000
                if not warmode 
                    warmode on
                    warmode off
                endif
                settimer tab 0
            endif
            if insysmsg "You make some progress on the lock"
                overhead "*click*" 810 bchest
            endif
            if insysmsg "You have worn out your tool"
                overhead "This tool is worn out!" 805
            endif
            if not targetexists and not casting and not find "nonaspectedwiz" backpack and skill "Stealth" >= 80 and hidden and stam = maxstam and findtype 5912 self
                while not queued
                    if findlayer self head as hat
                        getlabel hat desc
                        if "magical" in desc
                            dclick "bmain"
                        else 
                            dclick "bwiz"
                            pause 500
                            getlabel backpack ping
                            dclick "bmain"
                        endif
                    endif
                    break
                endwhile
            endif
            if not targetexists and not casting and not findlayer self head
                while not queued
                    dclick "bmain"
                    break
                endwhile
            endif
            if not targetexists and not casting and findlayer self head as hat
                getlabel hat desc
                if "magical" in desc
                    while not queued
                        dclick "bmain"
                        break
                    endwhile
                endif
            endif
            if ingump "Shrines"
                if not timerexists "Wacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Wall of Stone ACP ------Enabled------" 2031
                    createtimer "Wall"
                    createtimer "Wacp"
                    removetimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Eacp" and skill "Spirit Speak" >= 80 and skill "Magery" >= 100
                    gumpclose 341416395
                    overhead "Earth Elemental ACP ------Enabled------" 1501
                    createtimer "Elemental"
                    createtimer "Eacp"
                    removetimer "Nacp"
                    removetimer "Tacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Tele"
                    removetimer "None"
                    removetimer "Reveal" 
                elseif not timerexists "Tacp" and skill "Magery" >= 50
                    gumpclose 341416395
                    overhead "Teleport + Rope ACP ------Enabled------" 1272
                    createtimer "Tele"
                    createtimer "Tacp"
                    removetimer "Nacp"
                    removetimer "Racp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "None" 
                    removetimer "Reveal"  
                elseif not timerexists "Racp" and skill "Magery" >= 80
                    gumpclose 341416395
                    overhead "Reveal Spellcast ACP ------Enabled------" 2040
                    createtimer "Racp"
                    createtimer "Reveal"
                    removetimer "Nacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"  
                    removetimer "None"    
                elseif not timerexists "Nacp"
                    gumpclose 341416395
                    overhead "Auto Chest Protection ------Disabled------" 38
                    createtimer "Nacp"
                    removetimer "Eacp"
                    removetimer "Tacp"
                    removetimer "Wacp"
                    removetimer "Wall"
                    removetimer "Elemental"
                    removetimer "Tele"
                    removetimer "Reveal" 
                endif
            endif
            if insysmsg "You have been revealed!" 
                if timerexists "Tele" and mana >= 9
                    say "[Spit"
                    cast 'Teleport'
                    if findtype "rope" backpack as rope
                        dclick rope
                    else 
                        overhead "I am out of rope..." 34
                    endif
                    removetimer "Tacp"
                    removetimer "Tele"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Wacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                endif
                if timerexists "Wall" and mana >= 9
                    say "[Yell"
                    cast 'Wall of Stone'
                    removetimer "Wacp"
                    removetimer "Wall"
                    createtimer "Eacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                endif
                if timerexists "Elemental" and mana >= 50
                    say "[Anger"
                    cast 'Earth Elemental'
                    removetimer "Eacp"
                    removetimer "Elemental"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Racp"
                    dclicktype "atlas" backpack
                endif
                if timerexists "Reveal" and mana >= 20
                    say "[Surprise"
                    cast 'Reveal'
                    removetimer "Racp"
                    removetimer "Reveal"
                    createtimer "Wacp"
                    createtimer "Nacp"
                    createtimer "Tacp"
                    createtimer "Eacp"
                    dclicktype "atlas" backpack
                endif
            endif
            if timer ACPcheck > 42000
                if timerexists "Tele"
                    overhead "Teleport ACP active" 1272
                endif
                if timerexists "Wall"
                    overhead "Wall ACP active" 2031
                endif
                if timerexists "Elemental"
                    overhead "Elemental ACP active" 1501
                endif
                if timerexists "Reveal"
                    overhead "Reveal ACP active" 2040
                endif
                settimer ACPcheck 0
            endif
            if insysmsg "Another player"
                while gumpexists 736038070
                    replay
                endwhile
            endif
        endwhile
    endif
endif

if find "bchest" ground -1 -1 2 as bchest and not targetexists 
    clearsysmsg 
    while findtype "cathedral tapestry|Darkscale tapestry|large painting|landscape painting|portrait painting|hieroglyph|figurine|statue|44987|49730|47107|18653|45127|20103|47103|29363|47105|29361|43453|5899|47109|45250|41509|43447|18657|4025|51308|45156|51304|45214|28769|28799|28803|28765|45211|45248|51259|45220|51328|45218|3842|51327|45222|45241|51336|11858|51375|45282|54722|45255|45246|28795|44983|45235|45251|45238|51258|51314|28761|45236|51260|54718|18400|45252|18656|47111|3839|45239|45242|45254|45281|45247|42241|45216|28775|2594|51321|3838|51318|5901|5905|45259|5903|48407|51302|4248|27611|15296|43166|5359|5981|4026|3985|25359|17686|3836|17087|5356|29030|24434|22336|29036|3843|29025|51098|29034|8826|51094|576|3827|22326|45315|3891|2539|39898|39896|39892|39918|39911|39916|39897|39905|39891|39917|39912|39909|39889|31047|31017|31049|31019|31055|31051|31053|31025|31027|31031|31041|54717|31021|31011|31023|31029|31043|31003|31035|31033|31045|31037|31002|20006|31169|31006|30999|31012|31009|30996|7109|7107|31128|31188|20014|31014|31004|31142|31001|31000|37181|31010|30998|31172|30988|30997|31038|31141|7947|20008|31005|31191|31008|31007|30994|30993|31182|30989|20012|31186|31178|31015|30991|20010|20016|31184|31190|30990|30995|31176|31180|30992|31130|5207|7031|7026|7034|7033|7027|7035|7029|5078|5063|5059|5105|5060|5138|5129|5201|5142|5143|5076|5106|7610|5139|5090|5103|5132|7177|5061|7181|7179|3920|5042|5127|5117|5185|5125|3938|5177|3937|5044|5121|3915|3909|3568|3932|5123|5144|5119|5056|5135|5187|5074|5089|3934|3913|3917|3721|5075|5046|5049|7170|5146|5205|5203|5115|5204|5040|5179|5070|5182|5085|5181|3719|7173|5131|3911|5101|7175|7169|3713|5112|22187|9917|3859|3862|3878|3865|3856|3873|3877|3834|3742|3762|3740|3763|10245|3572|3573|3571|3885|7127|4225|12686|19985|19981|19984|19982|19983|19991|19989|19986|19987|19988|19994|19995|19992|19993|19990|19980|19977|19976|19978|7154|19979|3861|3821" bchest as bitem
        if not timerexists bchestopen
            createtimer bchestopen
            overhead "The treasure is mine!" 2091
        endif
        hotkey 'Grab Item' 
        target bitem
        while queued
            //donothing
        endwhile
        if insysmsg "That container cannot hold"
            if str = 120
                overhead "My cup runneth over!..." 1779
            else 
                overhead "Waiting on skill cooldown..." 45
                while cooldown "Hiding" or cooldown "Stealth" or cooldown "Stealing"
                    //donothing
                endwhile
            endif
            while queued
                //donothing
            endwhile
            if str < 120 and not cooldown "Hiding" and not cooldown "Stealth" and not cooldown "Stealing" and findtype "White Potion" backpack as fatpot
                dclick fatpot
                overhead "Mandrake strengthens me..." 88
                skill "Hiding"
                getlabel backpack ping
            elseif findbuff "Strength"
                break
            endif
        endif
        if not findtype 3651|3649|3648|3650|3708|2475 ground -1 -1 2
            break
        endif
    endwhile
endif

if ingump "Shrines"
    if not timerexists "Wacp" and skill "Magery" >= 50
        gumpclose 341416395
        overhead "Wall of Stone ACP ------Enabled------" 2031
        createtimer "Wall"
        createtimer "Wacp"
        removetimer "Nacp"
        removetimer "Eacp"
        removetimer "Tacp"
        removetimer "Racp"
        removetimer "Elemental"
        removetimer "Tele"
        removetimer "None"
        removetimer "Reveal" 
    elseif not timerexists "Eacp" and skill "Spirit Speak" >= 80 and skill "Magery" >= 100
        gumpclose 341416395
        overhead "Earth Elemental ACP ------Enabled------" 1501
        createtimer "Elemental"
        createtimer "Eacp"
        removetimer "Nacp"
        removetimer "Tacp"
        removetimer "Racp"
        removetimer "Wall"
        removetimer "Tele"
        removetimer "None"
        removetimer "Reveal" 
    elseif not timerexists "Tacp" and skill "Magery" >= 50
        gumpclose 341416395
        overhead "Teleport + Rope ACP ------Enabled------" 1272
        createtimer "Tele"
        createtimer "Tacp"
        removetimer "Nacp"
        removetimer "Racp"
        removetimer "Wall"
        removetimer "Elemental"
        removetimer "None" 
        removetimer "Reveal"  
    elseif not timerexists "Racp" and skill "Magery" >= 80
        gumpclose 341416395
        overhead "Reveal Spellcast ACP ------Enabled------" 2040
        createtimer "Racp"
        createtimer "Reveal"
        removetimer "Nacp"
        removetimer "Wall"
        removetimer "Elemental"
        removetimer "Tele"  
        removetimer "None"    
    elseif not timerexists "Nacp"
        gumpclose 341416395
        overhead "Auto Chest Protection ------Disabled------" 38
        createtimer "Nacp"
        removetimer "Eacp"
        removetimer "Tacp"
        removetimer "Wacp"
        removetimer "Wall"
        removetimer "Elemental"
        removetimer "Tele"
        removetimer "Reveal" 
    endif
endif
if insysmsg "You have been revealed!" 
    if timerexists "Tele" and mana >= 9
        say "[Spit"
        cast 'Teleport'
        if findtype "rope" backpack as rope
            dclick rope
        else 
            overhead "I am out of rope..." 34
        endif
        removetimer "Tacp"
        removetimer "Tele"
        createtimer "Eacp"
        createtimer "Nacp"
        createtimer "Wacp"
        createtimer "Racp"
        dclicktype "atlas" backpack
    endif
    if timerexists "Wall" and mana >= 9
        say "[Yell"
        cast 'Wall of Stone'
        removetimer "Wacp"
        removetimer "Wall"
        createtimer "Eacp"
        createtimer "Nacp"
        createtimer "Tacp"
        createtimer "Racp"
        dclicktype "atlas" backpack
    endif
    if timerexists "Elemental" and mana >= 50
        say "[Anger"
        cast 'Earth Elemental'
        removetimer "Eacp"
        removetimer "Elemental"
        createtimer "Wacp"
        createtimer "Nacp"
        createtimer "Tacp"
        createtimer "Racp"
        dclicktype "atlas" backpack
    endif
    if timerexists "Reveal" and mana >= 20
        say "[Surprise"
        cast 'Reveal'
        removetimer "Racp"
        removetimer "Reveal"
        createtimer "Wacp"
        createtimer "Nacp"
        createtimer "Tacp"
        createtimer "Eacp"
        dclicktype "atlas" backpack
    endif
endif

if not targetexists and not casting and skill "Stealth" >= 80 and hidden and stam = maxstam and findtype 5912 self
    while not queued
        if findlayer self head as hat
            getlabel hat desc
            if "magical" in desc
                dclick "bmain"
            else 
                dclick "bwiz"
                pause 500
                getlabel backpack ping
                dclick "bmain"
            endif
        endif
        break
    endwhile
endif
if not targetexists and not casting and not findlayer self head
    while not queued
        dclick "bmain"
        break
    endwhile
endif
if not targetexists and not casting and findlayer self head as hat
    getlabel hat desc
    if "magical" in desc
        while not queued
            dclick "bmain"
            break
        endwhile
    endif
endif

if timer ACPcheck > 42000
    if timerexists "Tele"
        overhead "Teleport ACP active" 1272
    endif
    if timerexists "Wall"
        overhead "Wall ACP active" 2031
    endif
    if timerexists "Elemental"
        overhead "Elemental ACP active" 1501
    endif
    if timerexists "Reveal"
        overhead "Reveal ACP active" 2040
    endif
    settimer ACPcheck 0
endif
if insysmsg "What should I use these scissors on?"
    gumpclose 949095101
    wft 500
    clearall
    pause 503
    getlabel backpack ping
    if findtype "sewing kit|saw|pen and ink|tongs|tool kit" backpack as breakdowntool
        if findtype 20495 backpack as IDwand
            overhead "Time to cut some weight..." 88
            dclick IDwand
            wft 500
            target backpack
            getlabel backpack ping
            if insysmsg "No unidentified items found"
                overhead "No items to ID" 88
            endif
            if findtype 3834 backpack 0 as bbook
                @ignore bbook
            endif
        else 
            overhead "I need a Container ID Wand..." 38
        endif  
        while not gumpexists 949095101
            dclick breakdowntool
            waitforgump 949095101 500
        endwhile
        while not ingump "Recycle Single Item" 949095101
            gumpresponse 2
            waitforgump 949095101 500
        endwhile
        while findtype 5056|5059|5060|5061|5063|5070|5074|5075|5076|5078|5085|5089|5090|5101|5103|5105|5106|5129|5131|5132|5135|5138|5139|5142|5143|5144|5146|5201|5203|5204|5205|5207|7169|7170|7173|7175|7177|7179|7181|7610|7947|31003|31004|31005|31006|31007|31008|31009|31010|31011|31012|31015|31191|31017|31019|31021|31023|31025|31027|31029|31031|31033|31035|31037|31038|31041|31043|31045|31047|31049|31051|31053|31055|3834|3740|3742|3762|3763|10245|20006|20008|20010|20012|20014|20016|7026|7027|7029|7031|7033|7034|7035|7107|7109|31002|31130|3920|5042|5117|30990|30993|30994|30995|31184|31186|3719|3922|3938|5121|5123|5125|30989|30992|30996|30997|30998|31176|31188|3568|3713|3721|3932|5040|5044|5112|5127|5177|5179|5181|30991|30999|31000|31001|31014|31178|31180|31182|3909|3911|3913|3915|3917|3934|3937|5046|5049|5115|5119|5182|5185|5187|30988|31128|31190|22187|31141|31142|31169|31172 backpack as IDitem
            getlabel IDitem desc
            if "aspect" in desc or "vanquishing" in desc or "supremely" in desc or "slaying" in desc or "enticement" in desc or "invulnerability" in desc
                @ignore IDitem
            else 
                while find "IDitem" backpack
                    gumpresponse 3
                    waitforgump 949095101 500
                    target IDitem
                endwhile
            endif
        endwhile
        if gumpexists 949095101
            gumpclose 949095101
        endif
        if targetexists 
            hotkey "Cancel Current Target"
        endif
        while findtype 4225|7127|7154 backpack as trash
            while queued
                //do nothing
            endwhile
            lift trash 60000
            droprelloc -0 -0
            pause 500
            getlabel backpack ping
        endwhile
        while findtype 3827 backpack 0 as scroll
            while queued
                //do nothing
            endwhile
            lift scroll 60000
            droprelloc  -0 -0
            pause 500
            getlabel backpack ping
        endwhile
        overhead "Useless items are discarded..." 78
    else 
        overhead "I need a crafting tool to recycle..." 38
    endif
endif
if skill "Forensic Evaluation" >= 50 and not hidden and not casting and findtype "Elven Spellblade" backpack
    if not warmode
        for 18
            if index > 0 and findtype "corpse" ground -1 -1 index as corpselocation
                overhead "corpse" 76 corpselocation
                @ignore corpselocation
            endif
        endfor
        @clearignore 
        if not find "bknife" backpack and findtype "Elven Spellblade" backpack as newknife
            @setvar "bknife" newknife
        endif
        while findtype "corpse" ground -1 -1 2 as bcorpse
            while queued
                //do nothing
            endwhile
            dclick "bknife"
            wft 500
            target bcorpse
            getlabel backpack ping
            pause 500
            if insysmsg "You carve materials from the corpse"
                overhead "*fresh cut*" 88 bcorpse
                @ignore bcorpse
            elseif insysmsg "That corpse has already been carved"
                overhead "*carved*" 38 bcorpse
                @ignore bcorpse
            endif
        endwhile
    endif
endif
loop