# This is an automated backup - check out https://outlands.uorazorscripts.com/script/da922f96-72cd-4f5b-92fe-e5604813ddfa for latest
# Automation by Jaseowns
## Script: SUPER Auto Mage Attacker
## Created by: dennozz#0
#############################################

#Auto-mage attack 2.45

#********** INFORMATION **********# 

#Made by @dennozz on discord. 
#Inspired/learned by other scrips in https://outlands.uorazorscripts.com/

#This script will auto attacking using magery/necromancy spells. Script will auto heal and auto summon pets if needed.
#This script will work with full Mage Arcanes, Necro Mages, Mage Summoners.

#--- *!*!* SCRIPT IS UNDER DEVELOPMENT. *!*!*!* ---#

# !!! SOON TO BE ADDED: Auto Summoning !!! #

#********** SET YOUR SETTINGS **********#   

#--- Set Target Mode ---#
# 0 - Auto Target Selection 
# 1 - Manual selection using hotkey `set last target`

@setvar! targetSelectionMode 0

#--- Set Mage attack spells ---#

@setvar! castMagicArrow 1
@setvar! castHarm 1
@setvar! castFireball 1
@setvar! castLightning 1

#- Big spells prioritize order -#

@setvar! castFlamestrike 1
@setvar! castEnergyBolt 0
@setvar! castExplosion 0
@setvar! castMindblast 1

#--- Poison ---#

@setvar! castPoison 1

#- Poison Level
# 0 - Greater or lesser 
# 1 - Deadly 
# 2 - Lethal
@setvar! poisonLevel 1

@setvar! castCurse 1
@setvar! castManaDrain 1

#--- Set Mage attack cooldowns ---#

@setvar! magicArrowCD 20000
@setvar! harmCD 20000
@setvar! fireballCD 60000
@setvar! lightningCD 20000

@setvar! miniSpellsWithoutWizardGrimoreCD 10000

#--- Set Necromancy Spells ---#

@setvar! NecroMindRot 1

@setvar! NecroEvilOmen 1
@setvar! NecroCorpseSkin 1
@setvar! NecroStrangle 0
@setvar! minManaToUseDamageBuffNecroSpells 40

#- Poison Strike -#
# 0 - Disabled
# 1 - Apply in 1 ticks left or less
# 2 - Apply in 2 ticks left or less
# 3 - Apply in 3 ticks left or less
# 4 - Apply in 4 ticks left or less
# 5 - Apply in 5 ticks left or less
# 6 - Apply in 6 ticks left or less
# 7 - Apply in 7 ticks left or less
# 8 - Apply in 8 ticks left or less
# 9 - Apply in 9 ticks left or less
# 10 - Apply in 10 ticks left or less

@setvar! NecroPoisonStrike 10

#--- Set Mage auto heals ---#

@setvar! miniHeal 1
@setvar! greaterHeal 1
@setvar! cureSpell 1

#--- Set Mage Buffs ---#

@setvar! magicReflect 1
@setvar! bless 1
@setvar! armorReflect 1
@setvar! protectionSpell 1
@setvar! miniumManaToBuff 50

#--- Set mushrooms ---#

@setvar! mushroomCount 3
@setvar! eatMushWhenManaLowerThan 50

@setvar! mushroomTimerCD 60000
if not timerexists mushroomTimer
    settimer mushroomTimer mushroomTimerCD
endif

#--- Set potions ---#

@setvar! drinkStr 1
@setvar! strengthLowerThan 100

@setvar! drinkAgility 1
@setvar! drinkMagicResist 1
@setvar! drinkHeal 1
@setvar! drinkCure 1

@setvar! drinkRefresh 1
@setvar! staminaLowerThan 15

#--- Auto healing hp diffs ---#

@setvar! lowDiff 20 
@setvar! medDiff 30
@setvar! highDiff 50
@setvar! extremeDiff 60
@setvar! criticalDiff 75

#--- Arcane Weapon Ability ---#

@setvar! useWeaponAbility 2
@setvar useAbilityWhenManaLowerThan 65

#--- Meditation ---#

@setvar! useMeditationSkill 1
@setvar! meditateWhenManaBelow 14
@setvar! meditateUntilManaReach 65

#--- Drop Gold When Overweight ---#

@setvar! amountOfGoldToDrop 500

#--- Optional : Have a cooldown named `Heal Pot` ---#

@setvar! healingPotCD 11000

#********** DO NOT EDIT FROM HERE UNLESS YOU KNOW HOW TO SCRIPT **********# 

@setvar! castStrike 0 
@setvar! repeatCastingPoison 0 

if 1 = targetSelectionMode
    @setvar! currentTarget 0 
    @setvar! foundTarget 0 
    @setvar! tempTarget 0 
endif

@setvar! necroGump 622436516
@setvar! unholyPoints 0

if castExplosion = 1
    @setvar! bigSpellCounter 2
elseif castEnergyBolt = 1 
    @setvar! bigSpellCounter 1
endif

if not varexist previousTarget
    @setvar! previousTarget 0
endif

@setvar! maxwaittimeinms 650

@setvar! curseCD 60000
@setvar! manaDrainCD 60000

if not timerexists curseTimer
    settimer curseTimer curseCD
endif

if not timerexists manaDrainTimer
    settimer manaDrainTimer manaDrainCD
endif

#--- Necro spells timers ---#

@setvar! evilOmenCD 30000

if not timerexists evilOmenTimer
    settimer evilOmenTimer evilOmenCD
endif

@setvar! corpseSkinCD 30000

if not timerexists corpseSkinTimer
    settimer corpseSkinTimer corpseSkinCD
endif

@setvar! strangleCD 30000

if not timerexists strangleTimer
    settimer strangleTimer strangleCD
endif

@setvar! mindRotCD 30000

if not timerexists mindRotTimer
    settimer mindRotTimer mindRotCD
endif

@setvar! poisonStrikeCD 30000

if not timerexists poisonStrikeTimer
    settimer poisonStrikeTimer poisonStrikeCD
endif

#--- Script msgs timers ---#

@setvar! overweightMessageCD 3000
settimer overweightMessageTimer overweightMessageCD

@setvar! noTargetMessageCD 3000
settimer noTargetMessageTimer noTargetMessageCD

@setvar! poisonLabelCD 5000
settimer poisonLabelTimer poisonLabelCD

@setvar! targetSelectCD 5000
settimer targetSelectTimer targetSelectCD

#--- Resources timers ---#

@setvar! pouchMessageCD 2000
settimer pouchMessageTimer pouchMessageCD

@setvar! aidsMessageCD 2500
settimer aidsMessageTimer aidsMessageCD

@setvar! whiteMessageCD 3000
settimer whiteMessageTimer whiteMessageCD

@setvar! blueMessageCD 3500
settimer blueMessageTimer blueMessageCD

@setvar! blackMessageCD 4000
settimer blackMessageTimer blackMessageCD

@setvar! orangeMessageCD 4500
settimer orangeMessageTimer orangeMessageCD

@setvar! yellowMessageCD 5000
settimer yellowMessageTimer yellowMessageCD

@setvar! redMessageCD 5500
settimer redMessageTimer redMessageCD

#--- Magery buffs timers ---#

@setvar! magicReflectCD 15000
settimer magicReflectTimer magicReflectCD

@setvar! armorReflectCD 15000
settimer armorReflectTimer armorReflectCD

@setvar! protectionCD 15000
settimer protectionTimer protectionCD

@setvar! manaMessageCD 2222
settimer manaMessageTimer manaMessageCD

#--- Magery attack spells timers ---#

if not timerexists magicArrowTimer 
    settimer magicArrowTimer magicArrowCD
endif

if not timerexists harmTimer 
    settimer harmTimer harmCD
endif

if not timerexists fireballTimer 
    settimer fireballTimer fireballCD
endif

if not timerexists lightningTimer 
    settimer lightningTimer lightningCD
endif

if skill "Arcane" >= 80
    @setvar! weaponAbilityCD 5000
    settimer weaponAbilityTimer weaponAbilityCD

    if not gumpexists 3954121934
        yell '[abilitieshotbar'
    endif 
endif

#********** ACTIVATE NECROMANCER BAR IF USING ANY NECRO SPELLS **********# 
        
if skill 'necromancy' >= 50
    if findtype 'necromancer book' backpack
        yell '[necromancyhotbar'
        while not gumpexists 622436516
            yell '[necromancyhotbar'
            waitforgump 622436516 maxwaittimeinms
        endwhile
    else
        overhead "Necro Book NOT Found!" 34
        wait 1000
    endif
endif
    
while not dead
    
    @setvar! currentlyAttacking 0 
    
    if weight > maxweight
        if timer overweightMessageTimer > overweightMessageCD
            overhead "Overweight !!" 34
            settimer overweightMessageTimer 0
        endif
        
        if 0 != amountOfGoldToDrop
            while weight > maxweight
                if findtype "gold coin" backpack as item
                    lift item amountOfGoldToDrop
                    droprelloc 0 0
                    getlabel backpack xxx
                    wait 200
                    if insysmsg "cannot drop anything"
                        drop backpack -1 -1 -1
                    endif
                    wait maxwaittimeinms
                    overhead "* Gold Dropped *" 55
                endif
            endwhile            
        endif
    endif

#********** AUTO HEALING START  **********#         

    while diffhits >= lowDiff or paralyzed or poisoned
        sysmsg "auto-healing activated" 11      
        #--- Trapped ---#
        
        if paralyzed 
            if findtype "pouch" backpack 38 
                yell "[pouch"            
                wait 200
            else
                if timer pouchMessageTimer > pouchMessageCD
                    overhead "Out of Pouches!" 34
                    settimer pouchMessageTimer 0
                endif
            endif
        endif
            
        #--- Self bandage ---#
        
        if diffhits >= 1 and not bandaging
            if skill 'healing' >= 50 or skill "veterinary" >= 50
                if findtype 'clean bandage%s%' backpack
                
                    if targetexists
                        hotkey 'cancel current target'  
                    endif
                    dclicktype 'clean bandage%s%'
                    waitfortarget maxwaittimeinms
                    target 'self'
                    wait 200            
                else
                    if timer aidsMessageTimer > aidsMessageCD
                        overhead "Out of bandages" 34
                        settimer aidsMessageTimer 0
                    endif
                endif
            endif
        endif
            
        #--- Poisoned ---#
        
        if 1 = drinkCure or 1 = cureSpell
            while poisoned
                if findtype "Orange Potion" self
                    dclicktype "Orange Potion"
                    wait 200
                else
                    if timer orangeMessageTimer > orangeMessageCD
                        overhead "Out of cure pots" 34
                        settimer orangeMessageTimer 0
                    endif
                    
                    if diffhits > highDiff or not findtype 3972 self or not findtype 3973 self
                        break
                    endif
                    
                    if skill 'magery' >= 40 and mana >= 6 and 1 = cureSpell and not casting
                        cast 'cure'
                        wait 50
                        while not casting                   
                            if targetexists
                                hotkey 'cancel current target'
                            endif
                            cast 'cure'  
                            wait 50
                        endwhile  
                        while not targetexists and casting
                        endwhile
                        waitfortarget maxwaittimeinms
                        target 'self' 
                        wait 200
                    else 
                        break
                    endif
                endif
                
            endwhile
        endif
            
        #--- Drink Heal Pot ---#
        
        if diffhits >= highDiff and 1 = drinkHeal
            if findtype "Yellow Potion" self as hPot
                getlabel hPot potLabel
                if "next" in potLabel
                    #do nothing
                else
                    @setvar! ch 0
                    
                    if counttype 3852 self as c
                        @setvar! ch c
                    endif
                    clearsysmsg  
                    
                    dclicktype 3852
                    getlabel backpack xxx
                    wait 200
                                
                    if ch != counttype 3852 self or insysmsg "potion satchel used"
                        cooldown "Heal Pot" healingPotCD
                    endif
                endif
            else
                if timer yellowMessageTimer > yellowMessageCD
                    overhead "Out of heals pots" 34
                    settimer yellowMessageTimer 0
                endif
            endif
        endif
            
        #--- Cast heals ---#
        
        if skill 'magery' >= 40 and diffhits >= lowDiff and diffhits < medDiff and mana >= 4 and miniHeal = 1 and not casting
            cast 'heal'
            while not casting                   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'heal'
            endwhile  
            
            while not targetexists and casting
            endwhile
            
            waitfortarget maxwaittimeinms
            target 'self' 
            wait 200  
            
        elseif skill 'magery' >= 60 and diffhits >= medDiff and diffhits <= highDiff mana >= 11 and greaterHeal = 1 and not casting
            cast 'greater heal'         
            while not casting                   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'greater heal'
            endwhile  
            
            while not targetexists and casting
                
                #--- Poisoned ---#
                
                if 1 = drinkCure
                    while poisoned
                        if findtype "Orange Potion" self
                            dclicktype "Orange Potion"
                            wait 200
                        else
                            if timer orangeMessageTimer > orangeMessageCD
                                overhead "Out of cure pots" 34
                                settimer orangeMessageTimer 0
                                break
                            endif
            
                        endif
                    endwhile
                endif            
            
                #--- Drink Heal Pot ---#
                
                if diffhits >= highDiff and 1 = drinkHeal
                    if findtype "Yellow Potion" self as hPot
                        getlabel hPot potLabel
                        if "next" in potLabel
                            #do nothing
                        else
                            @setvar! ch 0
                            
                            if counttype 3852 self as c
                                @setvar! ch c
                            endif
                            clearsysmsg  
                            
                            dclicktype 3852
                            getlabel backpack xxx
                            wait 200
                                        
                            if ch != counttype 3852 self or insysmsg "potion satchel used"
                                cooldown "Heal Pot" healingPotCD
                            endif
                        endif
                    else
                        if timer yellowMessageTimer > yellowMessageCD
                            overhead "Out of heals pots" 34
                            settimer yellowMessageTimer 0
                        endif
                    endif
                endif
        
            endwhile
            
            waitfortarget maxwaittimeinms
            target 'self' 
            wait 200 
            
        elseif skill 'magery' >= 40 and diffhits > highDiff and mana >= 4 and miniHeal = 1 and not casting
            cast 'heal'     
            while not casting                   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'heal' 
            endwhile  
            
            while not targetexists and casting
            endwhile
            
            waitfortarget maxwaittimeinms
            target 'self' 
            wait 200  
        
        endif 
    
    endwhile

#********* EAT TRAY FOOD *********
    
    if not findbuff "food" and findtype "tray" backpack as fody    
        dclick fody
        wait 200
    endif
    
#********* CREATE MUSHROOMS *********
    
    if counttype 29012 backpack = 0
        while counttype 29012 backpack < mushroomCount
            cast 'create food'
            wait 100
        endwhile
    endif  
    
    if 1 = targetSelectionMode
        if insysmsg "target a new"
            @clearsysmsg 
            if targetexists
                hotkey 'cancel current target'            
                overhead "Select Target: " 55
                @setvar! tempTarget   
                getlabel backpack xxx
                wait 200
                if insysmsg "Select" and not targetexists 
                else     
                    sysmsg "Re-target creature:" 34
                    @setvar! tempTarget       
                endif    
            endif
        endif    

        if find tempTarget ground -1 -1 12 and not dead tempTarget
            if previousTarget != tempTarget
                sysmsg "Resetting timers" 15
                settimer curseTimer curseCD
                settimer manaDrainTimer manaDrainCD
            endif
        
            @setvar! foundTarget 1 
            @setvar! currentTarget tempTarget
            @setvar! previousTarget currentTarget
            attack currentTarget
            getlabel currentTarget myLabel
            sysmsg "Target: {{myLabel}}" 55          
        else 
            if timer targetSelectTimer > targetSelectCD
                overhead "* Waiting for Target *" 11
                settimer targetSelectTimer 0    
            endif
        endif
        wait 200    
    else 
    
#********* AUTO-SELECT NEW TARGET *********
    
        if not find currentTarget ground -1 -1 12
            @setvar! currentTarget 0
            @setvar! foundTarget 0
            
            hotkey 'target closest grey monster'
            wait 25
            
            if not find lasttarget ground -1 -1 12
                if timer noTargetMessageTimer > noTargetMessageCD
                    overhead 'No target nearby' 33
                    settimer noTargetMessageTimer 0
                endif
            else
                @setvar! tempTarget lasttarget
                while index != 20
                    @setvar! tempTarget lasttarget 
                    if index != 0 
                        hotkey "next non-friendly monster target"
                        @setvar! tempTarget lasttarget 
                        #overhead "*{{index}}*" 34 tempTarget
                        
                        if index = 1
                            @setvar! firstTarget lasttarget
                        elseif firstTarget = tempTarget
                            @setvar! foundTarget 2
                            break
                        endif
                    endif
                    
                    if find tempTarget ground -1 -1 12
                        clearsysmsg
                        
                        skill 'begging'
                        waitfortarget maxwaittimeinms
                        target tempTarget
                        getlabel backpack xxx
                        wait 200
                        
                        if insysmsg "Target cannot be seen"
                            sysmsg "*Not visible* [{{index}}]" 44
                            overhead  "*Not visible* [{{index}}]" 44 tempTarget
                        elseif insysmsg "That is too far away."
                            overhead "*Too far* [{{index}}]" 44 tempTarget
                        #elseif insysmsg "You must wait"
                            #overhead "*Skill cooldown*" 11
                            #sysmsg "*Skill cooldown*" 11
                            #break
                        elseif insysmsg "Perhaps" or insysmsg "You are too far away from them." or insysmsg "They do not appear to have anything to offer you." or insysmsg! "You must wait"
                            
                            if insysmsg "You must wait"
                                overhead "* target skill cooldown targetting closest mob *" 34
                                hotkey 'target closest grey monster'   
                                @setvar! tempTarget lasttarget 
                            endif
                            
                            if previousTarget != tempTarget
                                sysmsg "Resetting timers" 15
                                settimer curseTimer curseCD
                                settimer manaDrainTimer manaDrainCD
                            endif
                        
                            @setvar! foundTarget 1 
                            @setvar! currentTarget tempTarget
                            @setvar! previousTarget currentTarget
                            attack currentTarget
                            getlabel currentTarget myLabel
                            sysmsg "Target: {{myLabel}}" 55
                            
                            break
                        endif
                    endif
                    wait 50
                endwhile
            endif
            
            if targetexists
                hotkey 'cancel current target'
            endif
        endif
    endif
    
    while 1 = foundTarget and not dead currentTarget and find currentTarget ground -1 -1 12

        if followers > 0 and 0 = currentlyAttacking
            clearsysmsg
            while not dead 
                say 'ALL Guard ME' 11
                getlabel backpack xxx
                wait 200   
                if insysmsg "Ignoring speech request"
                else 
                    break
                endif
            endwhile
        endif
        
        @setvar! currentlyAttacking 1
        
        if weight > maxweight
            if timer overweightMessageTimer > overweightMessageCD
                overhead "Overweight !!" 34
                settimer overweightMessageTimer 0
            endif
            
            if 0 != amountOfGoldToDrop
                while weight > maxweight
                    if findtype "gold coin" backpack as item
                        lift item amountOfGoldToDrop
                        droprelloc 0 0
                        getlabel backpack xxx
                        wait 200
                        if insysmsg "cannot drop anything"
                            drop backpack -1 -1 -1
                        endif
                        wait maxwaittimeinms
                        overhead "* Gold Dropped *" 55
                    endif
                endwhile            
            endif
        endif
        
#********** DRINK POTION IF NEEDED **********#
        
        #--- Drink str pot ---#
        
        if drinkStr = 1 and str < strengthLowerThan
            if not findbuff "Strength" 
                if findtype "White Potion" self
                    dclicktype "White Potion"
                    wait 200
                else
                    if timer whiteMessageTimer > whiteMessageCD
                        overhead "Out of str pots" 34
                        settimer whiteMessageTimer 0 
                    endif
                endif
            endif
        endif
        
        #--- Drink agility pot ---#
        
        if drinkAgility = 1
            if not findbuff "Agility" 
                if findtype "Blue Potion" self
                    dclicktype "Blue Potion"
                    wait 200
                else
                    if timer blueMessageTimer > blueMessageCD
                        overhead "Out of agility pots" 34
                        settimer blueMessageTimer 0 
                    endif
                endif
            endif
        endif
            
        #--- Drink magic resist pot ---#
    
        if drinkMagicResist = 1
            if not findbuff "Magic Resist" 
                if findtype "Black Potion" self
                    dclicktype "Black Potion"
                    wait 200
                else
                    if timer blackMessageTimer > blackMessageCD
                        overhead "Out of resist pots" 34
                        settimer blackMessageTimer 0
                    endif
                endif
            endif
        endif
        
        #--- Drink red pot ---#
        
        if stam < staminaLowerThan and 1 = drinkRefresh
            if findtype "Red Potion" self
                dclicktype "Red Potion"
                wait 200
            else
                if timer redMessageTimer > redMessageCD
                    overhead "Out of refresh pots" 34
                    settimer redMessageTimer 0 
                endif
            endif
        endif
        
#********** CHECK POISONING STATUS **********#
        
        if castPoison = 1 and not dead currentTarget and find currentTarget ground -1 -1 12
            @setvar! repeatCastingPoison 1
            
            while not dead currentTarget and find currentTarget ground -1 -1 12
                getlabel currentTarget targetLabel
                sysmsg "#1"
                if "-" in targetLabel
                    getlabel currentTarget targetLabel
                    #sysmsg targetLabel 34
                else 
                    #sysmsg targetLabel 65
                    break
                endif
            endwhile
            
            if "Ticks" in targetLabel or "resists" in targetLabel
                
                if timer poisonLabelTimer > poisonLabelCD
                    overhead targetLabel 44
                    overhead targetLabel  44 currentTarget
                    settimer poisonLabelTimer 0
                endif     
                
                if 2 = poisonLevel
                    if "Lethal" in targetLabel
                        @setvar! repeatCastingPoison 0
                    endif
                elseif 1 = poisonLevel
                    if "Lethal" in targetLabel or "Deadly" in targetLabel
                        @setvar! repeatCastingPoison 0
                    endif
                else 
                    @setvar! repeatCastingPoison 0
                endif
                
                if 0 = repeatCastingPoison and 0 != NecroPoisonStrike 
                    
                    if ingump "20/" 622436516
                        @setvar! unholyPoints 20
                    elseif ingump "19/" 622436516
                        @setvar! unholyPoints 19
                    elseif ingump "18/" 622436516
                        @setvar! unholyPoints 18
                    elseif ingump "17/" 622436516
                        @setvar! unholyPoints 17
                    elseif ingump "16/" 622436516
                        @setvar! unholyPoints 16
                    elseif ingump "15/" 622436516
                        @setvar! unholyPoints 15
                    elseif ingump "14/" 622436516
                        @setvar! unholyPoints 14
                    elseif ingump "13/" 622436516
                        @setvar! unholyPoints 13
                    elseif ingump "12/" 622436516
                        @setvar! unholyPoints 12
                    elseif ingump "11/" 622436516
                        @setvar! unholyPoints 11
                    elseif ingump "10/" 622436516
                        @setvar! unholyPoints 10
                    elseif ingump "9/" 622436516
                        @setvar! unholyPoints 9
                    elseif ingump "8/" 622436516
                        @setvar! unholyPoints 8
                    elseif ingump "7/" 622436516
                        @setvar! unholyPoints 7
                    elseif ingump "6/" 622436516
                        @setvar! unholyPoints 6
                    elseif ingump "5/" 622436516
                        @setvar! unholyPoints 5
                    elseif ingump "4/" 622436516
                        @setvar! unholyPoints 4
                    elseif ingump "3/" 622436516
                        @setvar! unholyPoints 3
                    elseif ingump "2/" 622436516
                        @setvar! unholyPoints 2
                    elseif ingump "1/" 622436516
                        @setvar! unholyPoints 1
                    else 
                        @setvar unholyPoints 0
                    endif  
                    
                    if 1 = NecroPoisonStrike 
                        if "[1" in targetLabel
                            @setvar! castStrike 1
                        endif
                    elseif 2 = NecroPoisonStrike 
                        if "[2" in targetLabel
                            @setvar! castStrike 1
                        endif
                    elseif 3 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel
                            @setvar! castStrike 1 
                        endif                    
                    elseif 4 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel or "[4" in targetLabel
                            @setvar! castStrike 1 
                        endif                      
                    elseif 5 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel or "[4" in targetLabel or "[5" in targetLabel
                            @setvar! castStrike 1 
                        endif                      
                    elseif 6 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel or "[4" in targetLabel or "[5" in targetLabel or "[6" in targetLabel
                            @setvar! castStrike 1 
                        endif                         
                    elseif 7 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel or "[4" in targetLabel or "[5" in targetLabel or "[6" in targetLabel or "[7" in targetLabel
                            @setvar! castStrike 1 
                        endif                    
                    elseif 8 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel or "[4" in targetLabel or "[5" in targetLabel or "[6" in targetLabel or "[7" in targetLabel or "[8" in targetLabel
                            @setvar! castStrike 1 
                        endif                      
                    elseif 9 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel or "[4" in targetLabel or "[5" in targetLabel or "[6" in targetLabel or "[7" in targetLabel or "[8" in targetLabel or "[9" in targetLabel
                            @setvar! castStrike 1 
                        endif                      
                    elseif 10 = NecroPoisonStrike 
                        if "[2" in targetLabel or "[3" in targetLabel or "[4" in targetLabel or "[5" in targetLabel or "[6" in targetLabel or "[7" in targetLabel or "[8" in targetLabel or "[9" in targetLabel or "[10" in targetLabel
                            @setvar! castStrike 1 
                        endif                       
                    endif
                    
                endif
            endif
        endif
        
        if ingump "20/" 622436516
            @setvar! unholyPoints 20
        elseif ingump "19/" 622436516
            @setvar! unholyPoints 19
        elseif ingump "18/" 622436516
            @setvar! unholyPoints 18
        elseif ingump "17/" 622436516
            @setvar! unholyPoints 17
        elseif ingump "16/" 622436516
            @setvar! unholyPoints 16
        elseif ingump "15/" 622436516
            @setvar! unholyPoints 15
        elseif ingump "14/" 622436516
            @setvar! unholyPoints 14
        elseif ingump "13/" 622436516
            @setvar! unholyPoints 13
        elseif ingump "12/" 622436516
            @setvar! unholyPoints 12
        elseif ingump "11/" 622436516
            @setvar! unholyPoints 11
        elseif ingump "10/" 622436516
            @setvar! unholyPoints 10
        elseif ingump "9/" 622436516
            @setvar! unholyPoints 9
        elseif ingump "8/" 622436516
            @setvar! unholyPoints 8
        elseif ingump "7/" 622436516
            @setvar! unholyPoints 7
        elseif ingump "6/" 622436516
            @setvar! unholyPoints 6
        elseif ingump "5/" 622436516
            @setvar! unholyPoints 5
        elseif ingump "4/" 622436516
            @setvar! unholyPoints 4
        elseif ingump "3/" 622436516
            @setvar! unholyPoints 3
        elseif ingump "2/" 622436516
            @setvar! unholyPoints 2
        elseif ingump "1/" 622436516
            @setvar! unholyPoints 1
        else 
            @setvar unholyPoints 0
        endif 

#********** CAST POISON  **********#          
         
        if repeatCastingPoison = 1 and diffhits < lowDiff and mana >= 9 and not dead currentTarget and find currentTarget ground -1 -1 12

            cast 'Poison'           
            while not casting   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Poison'             
            endwhile  
            
            while not targetexists and casting
                if dead currentTarget and not find currentTarget ground -1 -1 12
                    interrupt
                endif
            endwhile
            
            waitfortarget 650

            if not dead currentTarget and find currentTarget ground -1 -1 12
                
                if 1 = NecroMindRot and 2 < unholyPoints and timer mindRotTimer > mindRotCD and skill 'necromancy' >= 75 
                    clearsysmsg
                    yell '[mindrot'
                    getlabel backpack xxx
                    wait 100 
                    
                    while not dead currentTarget and find currentTarget ground -1 -1 12
                        sysmsg "#2"
                        if insysmsg "unholy symbols remaining"
                            break
                        endif
                        yell '[mindrot'
                        getlabel backpack xxx
                        wait 100
                    endwhile
                    
                    say '[>Mind Rot<]' 44
                    settimer mindRotTimer 0
                endif
                
                target currentTarget
                getlabel backpack xxx
                wait 200 
                
                if insysmsg "target cannot be seen"
                    @setvar! foundTarget 0
                    @setvar! currentTarget 0
                    break
                endif
            else
                hotkey 'cancel current target'
            endif 

#********* CAST NECRO POISON STRIKE *********   

        elseif dead
            clearsysmsg
            yell '[poisonstrike'
            getlabel backpack xxx
            wait 100 
            
            while not targetexists
                yell '[poisonstrike'
                getlabel backpack xxx
                wait 100
            endwhile
            
            waitfortarget 650
            target currentTarget
            
            getlabel backpack xxx
            wait 200 

            if insysmsg "unholy symbols remaining"
                overhead '[>Poison Strike<]' 44
                settimer poisonStrikeTimer 0
            else 
            endif

#********** CAST CURSE  **********#    

        elseif 1 = castCurse and timer curseTimer > curseCD and mana >= 11 and diffhits < lowDiff and not dead currentTarget and find currentTarget ground -1 -1 12
            @setvar! wasInterrupted 0 
            cast 'Curse'           
            while not casting   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Curse'             
            endwhile  
            
            while not targetexists and casting
                if dead currentTarget and not find currentTarget ground -1 -1 12
                    interrupt
                    @setvar! wasInterrupted 1
                endif
                
                #--- Poisoned ---#
                
                if 1 = drinkCure
                    while poisoned
                        if findtype "Orange Potion" self
                            dclicktype "Orange Potion"
                            wait 200
                        else
                            if timer orangeMessageTimer > orangeMessageCD
                                overhead "Out of cure pots" 34
                                settimer orangeMessageTimer 0
                                break
                            endif
            
                        endif
                    endwhile
                endif            
            
                #--- Drink Heal Pot ---#
                
                if diffhits >= highDiff and 1 = drinkHeal
                    if findtype "Yellow Potion" self as hPot
                        getlabel hPot potLabel
                        if "next" in potLabel
                            #do nothing
                        else
                            @setvar! ch 0
                            
                            if counttype 3852 self as c
                                @setvar! ch c
                            endif
                            clearsysmsg  
                            
                            dclicktype 3852
                            getlabel backpack xxx
                            wait 200
                                        
                            if ch != counttype 3852 self or insysmsg "potion satchel used"
                                cooldown "Heal Pot" healingPotCD
                            endif
                        endif
                    else
                        if timer yellowMessageTimer > yellowMessageCD
                            overhead "Out of heals pots" 34
                            settimer yellowMessageTimer 0
                        endif
                    endif
                endif
                
            endwhile
            
            waitfortarget 650  

            if not targetexists
                @setvar! wasInterrupted 1
            endif    
            
            if not dead currentTarget and find currentTarget ground -1 -1 12 and targetexists
                settimer curseTimer 0
                target currentTarget
                getlabel backpack xxx
                wait 200
                
                if insysmsg "target cannot be seen"
                    @setvar! foundTarget 0
                    @setvar! currentTarget 0
                    break
                endif
            else
                hotkey 'cancel current target'
                break
            endif      
            
#********** CAST MANA DRAIN  **********#

        elseif 1 = castManaDrain and timer manaDrainTimer > manaDrainCD and mana >= 11 and diffhits < lowDiff and not dead currentTarget and find currentTarget ground -1 -1 12
            @setvar! wasInterrupted 0 
            cast 'Mana Drain'           
            while not casting   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Mana Drain'            
            endwhile  
            
            while not targetexists and casting
                if dead currentTarget and not find currentTarget ground -1 -1 12
                    interrupt
                    @setvar! wasInterrupted 1
                endif
                
                #--- Poisoned ---#
                
                if 1 = drinkCure
                    while poisoned
                        if findtype "Orange Potion" self
                            dclicktype "Orange Potion"
                            wait 200
                        else
                            if timer orangeMessageTimer > orangeMessageCD
                                overhead "Out of cure pots" 34
                                settimer orangeMessageTimer 0
                                break
                            endif
            
                        endif
                    endwhile
                endif            
            
                #--- Drink Heal Pot ---#
                
                if diffhits >= highDiff and 1 = drinkHeal
                    if findtype "Yellow Potion" self as hPot
                        getlabel hPot potLabel
                        if "next" in potLabel
                            #do nothing
                        else
                            @setvar! ch 0
                            
                            if counttype 3852 self as c
                                @setvar! ch c
                            endif
                            clearsysmsg  
                            
                            dclicktype 3852
                            getlabel backpack xxx
                            wait 200
                                        
                            if ch != counttype 3852 self or insysmsg "potion satchel used"
                                cooldown "Heal Pot" healingPotCD
                            endif
                        endif
                    else
                        if timer yellowMessageTimer > yellowMessageCD
                            overhead "Out of heals pots" 34
                            settimer yellowMessageTimer 0
                        endif
                    endif
                endif
                
            endwhile
            
            waitfortarget 650  

            if not targetexists
                @setvar! wasInterrupted 1
                sysmsg "interrupted curse" 44
            endif   
            
            if not dead currentTarget and find currentTarget ground -1 -1 12 and targetexists
                settimer manaDrainTimer 0
                target currentTarget
                getlabel backpack xxx
                wait 200
                
                if insysmsg "target cannot be seen"
                    @setvar! foundTarget 0
                    @setvar! currentTarget 0
                    break
                endif
            else
                hotkey 'cancel current target'
                break
            endif 
            
#********* CAST NECRO STRANGLE *********            
            
        elseif 1 = NecroStrangle and 3 < unholyPoints and timer strangleTimer > strangleCD and skill 'necromancy' >= 85 and mana >= minManaToUseDamageBuffNecroSpells and diffhits < lowDiff and not dead currentTarget and find currentTarget ground -1 -1 12
            clearsysmsg
            yell '[strangle'
            getlabel backpack xxx
            wait 100 
            while not dead currentTarget and find currentTarget ground -1 -1 12
                sysmsg "#4"
                if insysmsg "unholy symbols remaining"
                    break
                endif
                yell '[strangle'
                getlabel backpack xxx
                wait 100
            endwhile
            
            say '[>Strangle<]' 44
            settimer strangleTimer 0
            
#********* CAST NECRO CORPSE SKIN *********
            
        elseif 1 = NecroCorpseSkin and 1 < unholyPoints and timer corpseSkinTimer > corpseSkinCD and skill 'necromancy' >= 65 and mana >= minManaToUseDamageBuffNecroSpells and diffhits < lowDiff and not dead currentTarget and find currentTarget ground -1 -1 12
            clearsysmsg
            yell '[corpseskin'
            getlabel backpack xxx
            wait 100
            while not dead currentTarget and find currentTarget ground -1 -1 12
                sysmsg "#5"
                if insysmsg "unholy symbols remaining"
                    break
                endif
                yell '[corpseskin'
                getlabel backpack xxx
                wait 100
            endwhile
            
            say '[>Corpse Skin<]' 44
            settimer corpseSkinTimer 0

#********* CAST NECRO EVIL OMEN *********

        elseif 1 = NecroEvilOmen and 1 < unholyPoints and timer evilOmenTimer > evilOmenCD and skill 'necromancy' >= 60 and mana >= minManaToUseDamageBuffNecroSpells and diffhits < lowDiff and not dead currentTarget and find currentTarget ground -1 -1 12
            clearsysmsg
            yell '[evilomen'
            getlabel backpack xxx
            wait 100 
            while not dead currentTarget and find currentTarget ground -1 -1 12
                sysmsg "#6"
                if insysmsg "unholy symbols remaining"
                    break
                endif
                yell '[evilomen'
                getlabel backpack xxx
                wait 100
            endwhile
            
            say '[>Evil Omen<]' 44
            settimer evilOmenTimer 0

#********** CAST MAGIC ARROW  **********#

        elseif castMagicArrow = 1 and timer magicArrowTimer > magicArrowCD and diffhits < lowDiff and mana >= 4 and not dead currentTarget and find currentTarget ground -1 -1 12
            cast 'magic arrow'           
            while not casting   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'magic arrow'             
            endwhile  
            
            while not targetexists and casting
                if dead currentTarget and not find currentTarget ground -1 -1 12
                    interrupt
                endif
            endwhile
            
            waitfortarget 650

            if not dead currentTarget and find currentTarget ground -1 -1 12 and targetexists
                target currentTarget
                getlabel backpack xxx
                wait 200
                
                if insysmsg "wizardry"
                    settimer magicArrowTimer 0 
                elseif insysmsg "target cannot be seen"
                    @setvar! foundTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer magicArrowTimer miniSpellsWithoutWizardGrimoreCD
                endif
            else
                hotkey 'cancel current target'
                break
            endif    
            
#********** CAST HARM  **********#        

        elseif castHarm = 1 and timer harmTimer > harmCD and diffhits < lowDiff and mana >= 6 and not dead currentTarget and find currentTarget ground -1 -1 12
            cast 'harm'           
            while not casting    
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'harm'             
            endwhile  
            
            while not targetexists and casting 
                if dead currentTarget and not find currentTarget ground -1 -1 12
                    interrupt
                endif
            endwhile
            
            waitfortarget 650

            if not dead currentTarget and find currentTarget ground -1 -1 12 and targetexists
                target currentTarget
                getlabel backpack xxx
                wait 200 
                
                if insysmsg "wizardry"
                    settimer harmTimer 0 
                elseif insysmsg "target cannot be seen"
                    @setvar! foundTarget 0
                    @setvar! currentTarget 0
                    break
                else 
                    settimer harmTimer miniSpellsWithoutWizardGrimoreCD
                endif
            else
                hotkey 'cancel current target'
                break
            endif   
 
#********** CAST FIREBALL  **********#   

        elseif castFireball = 1 and timer fireballTimer > fireballCD and diffhits < lowDiff and mana >= 9 and not dead currentTarget and find currentTarget ground -1 -1 12
            cast 'fireball'           
            while not casting    
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'fireball'             
            endwhile  
            
            while not targetexists and casting 
                if dead currentTarget and not find currentTarget ground -1 -1 12
                    interrupt
                endif
            endwhile
            
            waitfortarget 650

            if not dead currentTarget and find currentTarget ground -1 -1 12 and targetexists
                target currentTarget
                getlabel backpack xxx
                wait 200
                
                if insysmsg "wizardry"
                    settimer fireballTimer 0 
                elseif insysmsg "target cannot be seen"
                    @setvar! foundTarget 0
                    @setvar! currentTarget 0
                    break
                else
                    settimer fireballTimer miniSpellsWithoutWizardGrimoreCD
                endif
            else
                hotkey 'cancel current target'
                break
            endif  

#********** CAST LIGHTNING  **********#   

        elseif castLightning = 1 and timer lightningTimer > lightningCD and diffhits < lowDiff and mana >= 11 and not dead currentTarget and find currentTarget ground -1 -1 12
            cast 'lightning'           
            while not casting   
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'lightning'             
            endwhile  
            
            while not targetexists and casting
                if dead currentTarget and not find currentTarget ground -1 -1 12
                    interrupt
                endif
                
                #--- Poisoned ---#
                
                if 1 = drinkCure
                    while poisoned
                        if findtype "Orange Potion" self
                            dclicktype "Orange Potion"
                            wait 200
                        else
                            if timer orangeMessageTimer > orangeMessageCD
                                overhead "Out of cure pots" 34
                                settimer orangeMessageTimer 0
                                break
                            endif
            
                        endif
                    endwhile
                endif            
            
                #--- Drink Heal Pot ---#
                
                if diffhits >= highDiff and 1 = drinkHeal
                    if findtype "Yellow Potion" self as hPot
                        getlabel hPot potLabel
                        if "next" in potLabel
                            #do nothing
                        else
                            @setvar! ch 0
                            
                            if counttype 3852 self as c
                                @setvar! ch c
                            endif
                            clearsysmsg  
                            
                            dclicktype 3852
                            getlabel backpack xxx
                            wait 200
                                        
                            if ch != counttype 3852 self or insysmsg "potion satchel used"
                                cooldown "Heal Pot" healingPotCD
                            endif
                        endif
                    else
                        if timer yellowMessageTimer > yellowMessageCD
                            overhead "Out of heals pots" 34
                            settimer yellowMessageTimer 0
                        endif
                    endif
                endif
                
            endwhile
            
            waitfortarget 650

            if not dead currentTarget and find currentTarget ground -1 -1 12 and targetexists
                target currentTarget
                getlabel backpack xxx
                wait 200 
                
                if insysmsg "wizardry"
                    settimer lightningTimer 0 
                elseif insysmsg "target cannot be seen"
                    @setvar! foundTarget 0
                    @setvar! currentTarget 0
                    break
                else 
                    settimer lightningTimer miniSpellsWithoutWizardGrimoreCD
                endif
            else
                hotkey 'cancel current target'
                break
            endif 

#********** CAST BIG SPELLS  **********# 

        elseif castExplosion = 1 or castFlamestrike = 1 or castEnergyBolt = 1 or castMindblast = 1 and not dead currentTarget and find currentTarget ground -1 -1 12
            
            if castFlamestrike = 1 and mana >= 40 and diffhits < lowDiff
            
                cast 'flamestrike'           
                while not casting    
                    if targetexists
                        hotkey 'cancel current target'
                    endif
                    cast 'flamestrike'             
                endwhile
            
            elseif castEnergyBolt = 1 and bigSpellCounter = 1 and mana >= 20 and diffhits < lowDiff
            
                cast 'energy bolt'           
                while not casting    
                    if targetexists
                        hotkey 'cancel current target'
                    endif
                    cast 'energy bolt'             
                endwhile
                
            elseif castExplosion = 1 and bigSpellCounter = 2 and mana >= 20 and diffhits < lowDiff
            
                cast 'Explosion'           
                while not casting    
                    if targetexists
                        hotkey 'cancel current target'
                    endif
                    cast 'Explosion'             
                endwhile
            
            elseif castMindblast = 1 and mana >= 14 and diffhits < lowDiff
            
                cast 'mind blast'           
                while not casting    
                    if targetexists
                        hotkey 'cancel current target'
                    endif
                    cast 'mind blast'             
                endwhile
            
            endif
            
            getlabel backpack xxx
            wait 100
                
            if casting
                
                while casting
                    if dead currentTarget and not find currentTarget ground -1 -1 12
                        interrupt
                    endif
                    
                    if targetexists 'harmful'
                        target currentTarget
                    endif
                    
                    #--- Poisoned ---#
                    
                    if 1 = drinkCure
                        while poisoned
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                wait 200
                            else
                                if timer orangeMessageTimer > orangeMessageCD
                                    overhead "Out of cure pots" 34
                                    settimer orangeMessageTimer 0
                                    break
                                endif
                
                            endif
                        endwhile
                    endif            
                
                    #--- Drink Heal Pot ---#
                    
                    if diffhits >= highDiff and 1 = drinkHeal
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0
                                
                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                clearsysmsg  
                                
                                dclicktype 3852
                                getlabel backpack xxx
                                wait 200
                                            
                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    cooldown "Heal Pot" healingPotCD
                                endif
                            endif
                        else
                            if timer yellowMessageTimer > yellowMessageCD
                                overhead "Out of heals pots" 34
                                settimer yellowMessageTimer 0
                            endif
                        endif
                    endif
                    
                endwhile
                
                waitfortarget 650
    
                if not dead currentTarget and find currentTarget ground -1 -1 12 and targetexists
                    target currentTarget
                    getlabel backpack xxx
                    wait 200
                    
                    if insysmsg "target cannot be seen"
                        @setvar! foundTarget 0
                        @setvar! currentTarget 0
                        break
                    endif
                    
                    if bigSpellCounter = 1 
                        if castExplosion = 1 
                            @setvar! bigSpellCounter 2
                        endif
                    elseif bigSpellCounter = 2
                        if castEnergyBolt = 1 
                            @setvar! bigSpellCounter 1
                        endif
                    endif
                    
                else
                    hotkey 'cancel current target'
                    break
                endif 
                
            endif
        endif
        
        if mana < 40 and timer manaMessageTimer > manaMessageCD
            overhead "Low mana warning" 34
            settimer manaMessageTimer 0
        endif
        
#********** AUTO HEALING START  **********#         

        while diffhits >= lowDiff or paralyzed or poisoned
            sysmsg "auto-healing activated" 11      
            #--- Trapped ---#
            
            if paralyzed 
                if findtype "pouch" backpack 38 
                    yell "[pouch"            
                    wait 200
                else
                    if timer pouchMessageTimer > pouchMessageCD
                        overhead "Out of Pouches!" 34
                        settimer pouchMessageTimer 0
                    endif
                endif
            endif
                
            #--- Self bandage ---#
            
            if diffhits >= 1 and not bandaging
                if skill 'healing' >= 50 or skill "veterinary" >= 50
                    if findtype 'clean bandage%s%' backpack
                    
                        if targetexists
                            hotkey 'cancel current target'  
                        endif
                        dclicktype 'clean bandage%s%'
                        waitfortarget maxwaittimeinms
                        target 'self'
                        wait 200            
                    else
                        if timer aidsMessageTimer > aidsMessageCD
                            overhead "Out of bandages" 34
                            settimer aidsMessageTimer 0
                        endif
                    endif
                endif
            endif
                
            #--- Poisoned ---#
            
            if 1 = drinkCure or 1 = cureSpell
                while poisoned
                    if findtype "Orange Potion" self
                        dclicktype "Orange Potion"
                        wait 200
                    else
                        if timer orangeMessageTimer > orangeMessageCD
                            overhead "Out of cure pots" 34
                            settimer orangeMessageTimer 0
                        endif
                        
                        if diffhits > highDiff or not findtype 3972 self or not findtype 3973 self
                            break
                        endif
                        
                        if skill 'magery' >= 40 and mana >= 6 and 1 = cureSpell and not casting
                            cast 'cure'
                            wait 50
                            while not casting                   
                                if targetexists
                                    hotkey 'cancel current target'
                                endif
                                cast 'cure'  
                                wait 50
                            endwhile  
                            while not targetexists and casting
                            endwhile
                            waitfortarget maxwaittimeinms
                            target 'self' 
                            wait 200
                        else 
                            break
                        endif
                    endif
                    
                endwhile
            endif
                
            #--- Heal Pot ---#
            
            if diffhits >= highDiff and 1 = drinkHeal
                if findtype "Yellow Potion" self as hPot
                    getlabel hPot potLabel
                    if "next" in potLabel
                        #do nothing
                    else
                        @setvar! ch 0
                        
                        if counttype 3852 self as c
                            @setvar! ch c
                        endif
                        clearsysmsg  
                        
                        dclicktype 3852
                        getlabel backpack xxx
                        wait 200
                                    
                        if ch != counttype 3852 self or insysmsg "potion satchel used"
                            cooldown "Heal Pot" healingPotCD
                        endif
                    endif
                else
                    if timer yellowMessageTimer > yellowMessageCD
                        overhead "Out of heals pots" 34
                        settimer yellowMessageTimer 0
                    endif
                endif
            endif
                
            #--- Cast heals ---#
            
            if skill 'magery' >= 40 and diffhits >= lowDiff and diffhits <= medDiff and mana >= 4 and miniHeal = 1 and not casting
                cast 'heal'
                while not casting                   
                    if targetexists
                        hotkey 'cancel current target'
                    endif
                    cast 'heal'
                endwhile  
                
                while not targetexists and casting
                endwhile
                
                waitfortarget maxwaittimeinms
                target 'self' 
                wait 200  
                
            elseif skill 'magery' >= 60 and diffhits >= medDiff and diffhits <= highDiff mana >= 11 and greaterHeal = 1 and not casting
                cast 'greater heal'         
                while not casting                   
                    if targetexists
                        hotkey 'cancel current target'
                    endif
                    cast 'greater heal'
                endwhile  
                
                while not targetexists and casting
                
                    #--- Poisoned ---#
                    
                    if 1 = drinkCure
                        while poisoned
                            if findtype "Orange Potion" self
                                dclicktype "Orange Potion"
                                wait 200
                            else
                                if timer orangeMessageTimer > orangeMessageCD
                                    overhead "Out of cure pots" 34
                                    settimer orangeMessageTimer 0
                                    break
                                endif
                
                            endif
                        endwhile
                    endif            
                
                    #--- Drink Heal Pot ---#
                    
                    if diffhits >= highDiff and 1 = drinkHeal
                        if findtype "Yellow Potion" self as hPot
                            getlabel hPot potLabel
                            if "next" in potLabel
                                #do nothing
                            else
                                @setvar! ch 0
                                
                                if counttype 3852 self as c
                                    @setvar! ch c
                                endif
                                clearsysmsg  
                                
                                dclicktype 3852
                                getlabel backpack xxx
                                wait 200
                                            
                                if ch != counttype 3852 self or insysmsg "potion satchel used"
                                    cooldown "Heal Pot" healingPotCD
                                endif
                            endif
                        else
                            if timer yellowMessageTimer > yellowMessageCD
                                overhead "Out of heals pots" 34
                                settimer yellowMessageTimer 0
                            endif
                        endif
                    endif
            
                endwhile
                
                waitfortarget maxwaittimeinms
                target 'self' 
                wait 200 
                
            elseif skill 'magery' >= 40 and diffhits >= medDiff and mana >= 4 and miniHeal = 1 and not casting
                cast 'heal'     
                while not casting                   
                    if targetexists
                        hotkey 'cancel current target'
                    endif
                    cast 'heal' 
                endwhile  
                
                while not targetexists and casting
                endwhile
                
                waitfortarget maxwaittimeinms
                target 'self' 
                wait 200  
            
            endif 
        
        endwhile
        
#********* CREATE MUSHROOMS *********
    
        if counttype 29012 backpack = 0
            while counttype 29012 backpack < mushroomCount
                cast 'create food'
                wait 100
            endwhile
        endif   
    
 #********** EAT MUSHROOM  **********# 
 
        if mana < eatMushWhenManaLowerThan and mushroomCount > 0
            if timer mushroomTimer > mushroomTimerCD
                if counttype 29012 backpack as c
                    @setvar! cm c
                
                    dclicktype 29012 backpack
                    getlabel backpack xxx
                    wait 200
                    
                    if cm != counttype 29012 backpack
                        settimer mushroomTimer 0
                    endif
                else 
                    overhead "No mushrooms found!" 34
                endif
            endif
        endif
        
#********* USE MEDITATION *********

        if 1 = useMeditationSkill and mana < meditateWhenManaBelow and not findbuff "meditating"
            skill 'meditation'
            getlabel backpack xxx
            wait 200
            if findbuff 'meditating'
                overhead '* meditating *' 88
                while mana < meditateUntilManaReach and diffhits < medDiff
                    #interrupt here if hp is low
                    if not findbuff 'meditating'
                        break
                    endif
                endwhile
            endif
        endif  

 #********** USE WEAPON ABILITY **********# 
 
        if skill "Arcane" >= 80
            if timer weaponAbilityTimer > weaponAbilityCD
                if useWeaponAbility = 1
                    if mana < useAbilityWhenManaLowerThan
                        yell '[weaponAbility2'
                        wait 50
                        yell '[weaponAbility1'
                        settimer weaponAbilityTimer 0
                    endif
                elseif useWeaponAbility = 2 
                    if mana < useAbilityWhenManaLowerThan
                        yell '[weaponAbility1'
                        wait 50
                        yell '[weaponAbility2'
                        settimer weaponAbilityTimer 0
                    endif        
                elseif useWeaponAbility = 3 
                    if mana < useAbilityWhenManaLowerThan
                        yell '[weaponAbility2'
                        wait 50
                        yell '[weaponAbility3'
                        settimer weaponAbilityTimer 0
                    endif        
                endif
            endif
        endif    
    endwhile
    
    if followers > 0 and 1 = currentlyAttacking
        clearsysmsg
        while not dead 
            say 'ALL Guard ME' 11
            getlabel backpack xxx
            wait 200   
            if insysmsg "Ignoring speech request"
            else 
                break
            endif  
        endwhile
    endif
    
#********** DRINK POTION IF NEEDED **********#
    
    #--- Drink str pot ---#
    
    if drinkStr = 1 and str < strengthLowerThan
        if not findbuff "Strength" 
            if findtype "White Potion" self
                dclicktype "White Potion"
                getlabel backpack xxx
                wait 200
            else
                if timer whiteMessageTimer > whiteMessageCD
                    overhead "Out of str pots" 34
                    settimer whiteMessageTimer 0 
                endif
            endif
        endif
    endif
    
    #--- Drink agility pot ---#
    
    if drinkAgility = 1
        if not findbuff "Agility" 
            if findtype "Blue Potion" self
                dclicktype "Blue Potion"
                getlabel backpack xxx
                wait 200
            else
                if timer blueMessageTimer > blueMessageCD
                    overhead "Out of agility pots" 34
                    settimer blueMessageTimer 0 
                endif
            endif
        endif
    endif
        
    #--- Drink magic resist pot ---#

    if drinkMagicResist = 1
        if not findbuff "Magic Resist" 
            if findtype "Black Potion" self
                dclicktype "Black Potion"
                getlabel backpack xxx
                wait 200
            else
                if timer blackMessageTimer > blackMessageCD
                    overhead "Out of resist pots" 34
                    settimer blackMessageTimer 0
                endif
            endif
        endif
    endif
    
    #--- Drink red pot ---#
    
    if stam < staminaLowerThan and 1 = drinkRefresh
        if findtype "Red Potion" self
            dclicktype "Red Potion"
            getlabel backpack xxx
            wait 200
        else
            if timer redMessageTimer > redMessageCD
                overhead "Out of refresh pots" 34
                settimer redMessageTimer 0 
            endif
        endif
    endif
    
#********** AUTO-MAGERY BUFFS IF NEEDED **********          

    if magicReflect = 1 and skill 'magery' >= 70 and not findbuff "Magic Reflection" and mana >= miniumManaToBuff and diffhits < lowDiff
        if timer magicReflectTimer > magicReflectCD
            cast 'Magic Reflection'
            while not casting and diffhits < lowDiff    
                getlabel backpack xxx
                wait 200
                if insysmsg "that spell will not" or insysmsg "that spell is already"
                    settimer magicReflectTimer 0
                    break  
                endif
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Magic Reflection'
            endwhile 
            
            while casting and diffhits < highDiff   
            
                #--- Poisoned ---#
                
                if 1 = drinkCure
                    while poisoned
                        if findtype "Orange Potion" self
                            dclicktype "Orange Potion"
                            wait 200
                        else
                            if timer orangeMessageTimer > orangeMessageCD
                                overhead "Out of cure pots" 34
                                settimer orangeMessageTimer 0
                                break
                            endif
            
                        endif
                    endwhile
                endif            
            
                #--- Drink Heal Pot ---#
                
                if diffhits >= highDiff and 1 = drinkHeal
                    if findtype "Yellow Potion" self as hPot
                        getlabel hPot potLabel
                        if "next" in potLabel
                            #do nothing
                        else
                            @setvar! ch 0
                            
                            if counttype 3852 self as c
                                @setvar! ch c
                            endif
                            clearsysmsg  
                            
                            dclicktype 3852
                            getlabel backpack xxx
                            wait 200
                                        
                            if ch != counttype 3852 self or insysmsg "potion satchel used"
                                cooldown "Heal Pot" healingPotCD
                            endif
                        endif
                    else
                        if timer yellowMessageTimer > yellowMessageCD
                            overhead "Out of heals pots" 34
                            settimer yellowMessageTimer 0
                        endif
                    endif
                endif
                
            endwhile
            wait 200  
        endif    
    endif
    
    if armorReflect = 1 and skill 'magery' >= 30 and not findbuff "Reactive Armor" and mana >= miniumManaToBuff and diffhits < lowDiff
        if timer magicReflectTimer > magicReflectCD
            cast 'Reactive Armor'
            while not casting and diffhits < highDiff       
                getlabel backpack xxx
                wait 200
                if insysmsg "that spell will not" or insysmsg "that spell is already"
                    settimer armorReflectTimer 0
                    break  
                endif
                if targetexists
                    hotkey 'cancel current target'
                endif
                cast 'Reactive Armor'
            endwhile  
            
            while casting and diffhits < lowDiff   
            endwhile
            wait 200  
        endif    
    endif     
    
    if protectionSpell = 1 and skill 'magery' >= 40 and not findbuff "Protection" and mana >= miniumManaToBuff and diffhits < lowDiff
        cast 'Protection'
        while not casting and diffhits < highDiff 
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Protection'
        endwhile  
        while casting and diffhits < lowDiff   
        endwhile
        wait 200  
    endif 
    
    if bless = 1 and skill 'magery' >= 50 and not findbuff "Cunning" and mana >= miniumManaToBuff and diffhits < lowDiff
        cast 'Bless'         
        while not casting and diffhits < highDiff                   
            if targetexists
                hotkey 'cancel current target'
            endif
            cast 'Bless'
            wait 50
        endwhile  
        
        while not targetexists and casting
        endwhile
        
        waitfortarget maxwaittimeinms
        target 'self' 
        wait 200  
    endif  
    
#********* CREATE MUSHROOMS *********
    
    if counttype 29012 backpack = 0
        while counttype 29012 backpack < mushroomCount
            cast 'create food'
            wait 100
        endwhile
    endif   
    
 #********** EAT MUSHROOM  **********# 
 
    if mana < eatMushWhenManaLowerThan and mushroomCount > 0
        if timer mushroomTimer > mushroomTimerCD
            if counttype 29012 backpack as c
                @setvar! cm c
            
                dclicktype 29012 backpack
                getlabel backpack xxx
                wait 200
                
                if cm != counttype 29012 backpack
                    settimer mushroomTimer 0
                endif
            else 
                overhead "No mushrooms found!" 34
            endif
        endif
    endif
    
#********* USE MEDITATION *********

    if 1 = useMeditationSkill and mana < meditateWhenManaBelow and not findbuff "meditating"
        skill 'meditation'
        getlabel backpack xxx
        wait 200
        if findbuff 'meditating'
            overhead '* meditating *' 88
            while mana < meditateUntilManaReach and diffhits < medDiff
                #interrupt here if hp is low
                if not findbuff 'meditating'
                    break
                endif
            endwhile
        endif
    endif 
    
endwhile